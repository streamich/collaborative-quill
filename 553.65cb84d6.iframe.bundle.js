/*! For license information please see 553.65cb84d6.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkcollaborative_quill=self.webpackChunkcollaborative_quill||[]).push([[553],{"./node_modules/@jsonjoy.com/buffers/lib/Reader.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Reader=void 0;const decodeUtf8_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/index.js");exports.Reader=class Reader{constructor(){this.uint8=new Uint8Array([]),this.view=new DataView(this.uint8.buffer),this.x=0}reset(uint8){this.x=0,this.uint8=uint8,this.view=new DataView(uint8.buffer,uint8.byteOffset,uint8.length)}peek(){return this.view.getUint8(this.x)}peak(){return this.peek()}skip(length){this.x+=length}buf(size){const end=this.x+size,bin=this.uint8.subarray(this.x,end);return this.x=end,bin}u8(){return this.uint8[this.x++]}i8(){return this.view.getInt8(this.x++)}u16(){let x=this.x;const num=(this.uint8[x++]<<8)+this.uint8[x++];return this.x=x,num}i16(){const num=this.view.getInt16(this.x);return this.x+=2,num}u32(){const num=this.view.getUint32(this.x);return this.x+=4,num}i32(){const num=this.view.getInt32(this.x);return this.x+=4,num}u64(){const num=this.view.getBigUint64(this.x);return this.x+=8,num}i64(){const num=this.view.getBigInt64(this.x);return this.x+=8,num}f32(){const pos=this.x;return this.x+=4,this.view.getFloat32(pos)}f64(){const pos=this.x;return this.x+=8,this.view.getFloat64(pos)}utf8(size){const start=this.x;return this.x+=size,(0,decodeUtf8_1.decodeUtf8)(this.uint8,start,size)}ascii(length){const uint8=this.uint8;let str="";const end=this.x+length;for(let i=this.x;i<end;i++)str+=String.fromCharCode(uint8[i]);return this.x=end,str}}},"./node_modules/@jsonjoy.com/buffers/lib/Slice.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Slice=void 0;exports.Slice=class Slice{constructor(uint8,view,start,end){this.uint8=uint8,this.view=view,this.start=start,this.end=end}subarray(){return this.uint8.subarray(this.start,this.end)}}},"./node_modules/@jsonjoy.com/buffers/lib/Writer.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Writer=void 0;const Slice_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/Slice.js"),EMPTY_UINT8=new Uint8Array([]),EMPTY_VIEW=new DataView(EMPTY_UINT8.buffer),hasBuffer="function"==typeof Buffer,utf8Write=hasBuffer?Buffer.prototype.utf8Write:null,from=hasBuffer?Buffer.from:null,textEncoder="undefined"!=typeof TextEncoder?new TextEncoder:null;exports.Writer=class Writer{constructor(allocSize=65536){this.allocSize=allocSize,this.view=EMPTY_VIEW,this.x0=0,this.x=0,this.uint8=new Uint8Array(allocSize),this.size=allocSize,this.view=new DataView(this.uint8.buffer)}grow(size){const x0=this.x0,x=this.x,oldUint8=this.uint8,newUint8=new Uint8Array(size),view=new DataView(newUint8.buffer),activeSlice=oldUint8.subarray(x0,x);newUint8.set(activeSlice,0),this.x=x-x0,this.x0=0,this.uint8=newUint8,this.size=size,this.view=view}ensureCapacity(capacity){const byteLength=this.size,remaining=byteLength-this.x;if(remaining<capacity){const totalRequired=byteLength-this.x0+(capacity-remaining);this.grow(totalRequired<=this.allocSize?this.allocSize:2*totalRequired)}}move(capacity){this.ensureCapacity(capacity),this.x+=capacity}reset(){this.x0=this.x}newBuffer(size){const uint8=this.uint8=new Uint8Array(size);this.size=size,this.view=new DataView(uint8.buffer),this.x=this.x0=0}flush(){const result=this.uint8.subarray(this.x0,this.x);return this.x0=this.x,result}flushSlice(){const slice=new Slice_1.Slice(this.uint8,this.view,this.x0,this.x);return this.x0=this.x,slice}u8(char){this.ensureCapacity(1),this.uint8[this.x++]=char}u16(word){this.ensureCapacity(2),this.view.setUint16(this.x,word),this.x+=2}u32(dword){this.ensureCapacity(4),this.view.setUint32(this.x,dword),this.x+=4}i32(dword){this.ensureCapacity(4),this.view.setInt32(this.x,dword),this.x+=4}u64(qword){this.ensureCapacity(8),this.view.setBigUint64(this.x,BigInt(qword)),this.x+=8}f64(float){this.ensureCapacity(8),this.view.setFloat64(this.x,float),this.x+=8}u8u16(u8,u16){this.ensureCapacity(3);let x=this.x;this.uint8[x++]=u8,this.uint8[x++]=u16>>>8,this.uint8[x++]=255&u16,this.x=x}u8u32(u8,u32){this.ensureCapacity(5);let x=this.x;this.uint8[x++]=u8,this.view.setUint32(x,u32),this.x=x+4}u8u64(u8,u64){this.ensureCapacity(9);let x=this.x;this.uint8[x++]=u8,this.view.setBigUint64(x,BigInt(u64)),this.x=x+8}u8f32(u8,f32){this.ensureCapacity(5);let x=this.x;this.uint8[x++]=u8,this.view.setFloat32(x,f32),this.x=x+4}u8f64(u8,f64){this.ensureCapacity(9);let x=this.x;this.uint8[x++]=u8,this.view.setFloat64(x,f64),this.x=x+8}buf(buf,length){this.ensureCapacity(length);const x=this.x;this.uint8.set(buf,x),this.x=x+length}utf8(str){const maxLength=4*str.length;if(maxLength<168)return this.utf8Native(str);if(utf8Write){const writeLength=utf8Write.call(this.uint8,str,this.x,maxLength);return this.x+=writeLength,writeLength}if(from){const uint8=this.uint8,offset=uint8.byteOffset+this.x,writeLength=from(uint8.buffer).subarray(offset,offset+maxLength).write(str,0,maxLength,"utf8");return this.x+=writeLength,writeLength}if(maxLength>1024&&textEncoder){const writeLength=textEncoder.encodeInto(str,this.uint8.subarray(this.x,this.x+maxLength)).written;return this.x+=writeLength,writeLength}return this.utf8Native(str)}utf8Native(str){const length=str.length,uint8=this.uint8;let offset=this.x,pos=0;for(;pos<length;){let value=str.charCodeAt(pos++);if(4294967168&value){if(4294965248&value){if(value>=55296&&value<=56319&&pos<length){const extra=str.charCodeAt(pos);56320==(64512&extra)&&(pos++,value=((1023&value)<<10)+(1023&extra)+65536)}4294901760&value?(uint8[offset++]=value>>18&7|240,uint8[offset++]=value>>12&63|128,uint8[offset++]=value>>6&63|128):(uint8[offset++]=value>>12&15|224,uint8[offset++]=value>>6&63|128)}else uint8[offset++]=value>>6&31|192;uint8[offset++]=63&value|128}else uint8[offset++]=value}const writeLength=offset-this.x;return this.x=offset,writeLength}ascii(str){const length=str.length;this.ensureCapacity(length);const uint8=this.uint8;let x=this.x,pos=0;for(;pos<length;)uint8[x++]=str.charCodeAt(pos++);this.x=x}}},"./node_modules/@jsonjoy.com/buffers/lib/f16.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeF16=void 0;const pow=Math.pow;exports.decodeF16=binary=>{const exponent=(31744&binary)>>10,fraction=1023&binary;return(binary>>15?-1:1)*(exponent?31===exponent?fraction?NaN:1/0:pow(2,exponent-15)*(1+fraction/1024):fraction/1024*6103515625e-14)}},"./node_modules/@jsonjoy.com/buffers/lib/isFloat32.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isFloat32=void 0;const view=new DataView(new ArrayBuffer(4));exports.isFloat32=n=>(view.setFloat32(0,n),n===view.getFloat32(0))},"./node_modules/@jsonjoy.com/buffers/lib/isUint8Array.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isUint8Array=void 0,exports.isUint8Array="function"==typeof Buffer?x=>x instanceof Uint8Array||Buffer.isBuffer(x):x=>x instanceof Uint8Array},"./node_modules/@jsonjoy.com/buffers/lib/printOctets.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.printOctets=void 0;exports.printOctets=(octets,max=16)=>{let str="";if(!octets.length)return str;octets[0]<16&&(str+="0"),str+=octets[0].toString(16);for(let i=1;i<octets.length&&i<max;i++){const n=octets[i];str+=" ",n<16&&(str+="0"),str+=n.toString(16)}return octets.length>max&&(str+=`… (${octets.length-max} more)`),str}},"./node_modules/@jsonjoy.com/buffers/lib/utf8/CachedUtf8Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CachedUtf8Decoder=void 0;const v10_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importDefault(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/v10.js"));let x=1+Math.round(4294967294*Math.random());class CacheItem{constructor(bytes,value){this.bytes=bytes,this.value=value}}exports.CachedUtf8Decoder=class CachedUtf8Decoder{constructor(){this.caches=[];for(let i=0;i<31;i++)this.caches.push([])}get(bytes,offset,size){const records=this.caches[size-1],len=records.length;FIND_CHUNK:for(let i=0;i<len;i++){const record=records[i],recordBytes=record.bytes;for(let j=0;j<size;j++)if(recordBytes[j]!==bytes[offset+j])continue FIND_CHUNK;return record.value}return null}store(bytes,value){const records=this.caches[bytes.length-1],record=new CacheItem(bytes,value);records.length>=16?records[function randomU32(min,max){return x^=x<<13,x^=x>>>17,x^=x<<5,(x>>>0)%(max-min+1)+min}(0,15)]=record:records.push(record)}decode(bytes,offset,size){if(!size)return"";const cachedValue=this.get(bytes,offset,size);if(null!==cachedValue)return cachedValue;const value=(0,v10_1.default)(bytes,offset,size),copy=Uint8Array.prototype.slice.call(bytes,offset,offset+size);return this.store(copy,value),value}}},"./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeAscii.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeAsciiMax15=exports.decodeAscii=void 0;const fromCharCode=String.fromCharCode;exports.decodeAscii=(src,position,length)=>{const bytes=[];for(let i=0;i<length;i++){const byte=src[position++];if(128&byte)return;bytes.push(byte)}return fromCharCode.apply(String,bytes)};exports.decodeAsciiMax15=(src,position,length)=>{if(length<4){if(length<2){if(0===length)return"";{const a=src[position++];return(128&a)>1?void(position-=1):fromCharCode(a)}}{const a=src[position++],b=src[position++];if((128&a)>0||(128&b)>0)return void(position-=2);if(length<3)return fromCharCode(a,b);const c=src[position++];return(128&c)>0?void(position-=3):fromCharCode(a,b,c)}}{const a=src[position++],b=src[position++],c=src[position++],d=src[position++];if((128&a)>0||(128&b)>0||(128&c)>0||(128&d)>0)return void(position-=4);if(length<6){if(4===length)return fromCharCode(a,b,c,d);{const e=src[position++];return(128&e)>0?void(position-=5):fromCharCode(a,b,c,d,e)}}if(length<8){const e=src[position++],f=src[position++];if((128&e)>0||(128&f)>0)return void(position-=6);if(length<7)return fromCharCode(a,b,c,d,e,f);const g=src[position++];return(128&g)>0?void(position-=7):fromCharCode(a,b,c,d,e,f,g)}{const e=src[position++],f=src[position++],g=src[position++],h=src[position++];if((128&e)>0||(128&f)>0||(128&g)>0||(128&h)>0)return void(position-=8);if(length<10){if(8===length)return fromCharCode(a,b,c,d,e,f,g,h);{const i=src[position++];return(128&i)>0?void(position-=9):fromCharCode(a,b,c,d,e,f,g,h,i)}}if(length<12){const i=src[position++],j=src[position++];if((128&i)>0||(128&j)>0)return void(position-=10);if(length<11)return fromCharCode(a,b,c,d,e,f,g,h,i,j);const k=src[position++];return(128&k)>0?void(position-=11):fromCharCode(a,b,c,d,e,f,g,h,i,j,k)}{const i=src[position++],j=src[position++],k=src[position++],l=src[position++];if((128&i)>0||(128&j)>0||(128&k)>0||(128&l)>0)return void(position-=12);if(length<14){if(12===length)return fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l);{const m=src[position++];return(128&m)>0?void(position-=13):fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l,m)}}{const m=src[position++],n=src[position++];if((128&m)>0||(128&n)>0)return void(position-=14);if(length<15)return fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l,m,n);const o=src[position++];return(128&o)>0?void(position-=15):fromCharCode(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o)}}}}}},"./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decodeUtf8=void 0;const v16_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importDefault(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/v16.js"));exports.decodeUtf8=v16_1.default},"./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/v10.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fromCharCode=String.fromCharCode;exports.default=(buf,start,length)=>{let offset=start;const end=offset+length;let str="";for(;offset<end;){const octet1=buf[offset++];if(!(128&octet1)){str+=fromCharCode(octet1);continue}const octet2=63&buf[offset++];if(192==(224&octet1)){str+=fromCharCode((31&octet1)<<6|octet2);continue}const octet3=63&buf[offset++];if(224!=(240&octet1))if(240==(248&octet1)){let unit=(7&octet1)<<18|octet2<<12|octet3<<6|63&buf[offset++];if(unit>65535){unit-=65536;const unit0=unit>>>10&1023|55296;unit=56320|1023&unit,str+=fromCharCode(unit0,unit)}else str+=fromCharCode(unit)}else str+=fromCharCode(octet1);else str+=fromCharCode((31&octet1)<<12|octet2<<6|octet3)}return str}},"./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/v16.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),decodeAscii_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeAscii.js"),v18_1=tslib_1.__importDefault(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/v18.js")),hasBuffer="undefined"!=typeof Buffer,utf8Slice=hasBuffer?Buffer.prototype.utf8Slice:null,from=hasBuffer?Buffer.from:null,longDecoder=utf8Slice?(buf,start,length)=>utf8Slice.call(buf,start,start+length):from?(buf,start,length)=>from(buf).subarray(start,start+length).toString("utf8"):v18_1.default;exports.default=(buf,start,length)=>length<16?((buf,start,length)=>(0,decodeAscii_1.decodeAsciiMax15)(buf,start,length)??(0,v18_1.default)(buf,start,length))(buf,start,length):length<32?((buf,start,length)=>(0,decodeAscii_1.decodeAscii)(buf,start,length)??(0,v18_1.default)(buf,start,length))(buf,start,length):longDecoder(buf,start,length)},"./node_modules/@jsonjoy.com/buffers/lib/utf8/decodeUtf8/v18.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const fromCharCode=String.fromCharCode;exports.default=(buf,start,length)=>{let offset=start;const end=offset+length,points=[];for(;offset<end;){let code=buf[offset++];if(128&code){const octet2=63&buf[offset++];if(192==(224&code))code=(31&code)<<6|octet2;else{const octet3=63&buf[offset++];if(224==(240&code))code=(31&code)<<12|octet2<<6|octet3;else if(240==(248&code)){let unit=(7&code)<<18|octet2<<12|octet3<<6|63&buf[offset++];if(unit>65535){unit-=65536;const unit0=unit>>>10&1023|55296;code=56320|1023&unit,points.push(unit0)}else code=unit}}}points.push(code)}return fromCharCode.apply(String,points)}},"./node_modules/@jsonjoy.com/buffers/lib/utf8/sharedCachedUtf8Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const CachedUtf8Decoder_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/CachedUtf8Decoder.js");exports.default=new CachedUtf8Decoder_1.CachedUtf8Decoder},"./node_modules/@jsonjoy.com/json-pack/lib/JsonPackExtension.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsonPackExtension=void 0;exports.JsonPackExtension=class JsonPackExtension{constructor(tag,val){this.tag=tag,this.val=val}}},"./node_modules/@jsonjoy.com/json-pack/lib/JsonPackValue.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JsonPackValue=void 0;exports.JsonPackValue=class JsonPackValue{constructor(val){this.val=val}}},"./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborDecoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborDecoder=void 0;const CborDecoderBase_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborDecoderBase.js"),JsonPackValue_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/JsonPackValue.js");class CborDecoder extends CborDecoderBase_1.CborDecoderBase{readAsMap(){const octet=this.reader.u8(),minor=31&octet;if(5===octet>>5)return this.readMap(minor);throw 0}readMap(minor){const length=this.readMinorLen(minor);return length>=0?this.readMapRaw(length):this.readMapIndef()}readMapRaw(length){const map=new Map;for(let i=0;i<length;i++){const key=this.readAny(),value=this.readAny();map.set(key,value)}return map}readMapIndef(){const map=new Map;for(;255!==this.reader.peak();){const key=this.readAny();if(255===this.reader.peak())throw 7;const value=this.readAny();map.set(key,value)}return this.reader.x++,map}skipN(n){for(let i=0;i<n;i++)this.skipAny()}skipAny(){this.skipAnyRaw(this.reader.u8())}skipAnyRaw(octet){const minor=31&octet;switch(octet>>5){case 0:case 1:this.skipUNint(minor);break;case 2:this.skipBin(minor);break;case 3:this.skipStr(minor);break;case 4:this.skipArr(minor);break;case 5:this.skipObj(minor);break;case 7:this.skipTkn(minor);break;case 6:this.skipTag(minor)}}skipMinorLen(minor){if(minor<=23)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}skipUNint(minor){if(!(minor<=23))switch(minor){case 24:return this.reader.skip(1);case 25:return this.reader.skip(2);case 26:return this.reader.skip(4);case 27:return this.reader.skip(8);default:throw 1}}skipBin(minor){const length=this.skipMinorLen(minor);if(length>=0)this.reader.skip(length);else{for(;255!==this.reader.peak();)this.skipBinChunk();this.reader.x++}}skipBinChunk(){const octet=this.reader.u8(),minor=31&octet;if(2!==octet>>5)throw 2;if(minor>27)throw 3;this.skipBin(minor)}skipStr(minor){const length=this.skipMinorLen(minor);if(length>=0)this.reader.skip(length);else{for(;255!==this.reader.peak();)this.skipStrChunk();this.reader.x++}}skipStrChunk(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)throw 4;if(minor>27)throw 5;this.skipStr(minor)}skipArr(minor){const length=this.skipMinorLen(minor);if(length>=0)this.skipN(length);else{for(;255!==this.reader.peak();)this.skipAny();this.reader.x++}}skipObj(minor){const length=this.readMinorLen(minor);if(length>=0)return this.skipN(2*length);for(;255!==this.reader.peak();){if(this.skipAny(),255===this.reader.peak())throw 7;this.skipAny()}this.reader.x++}skipTag(minor){if(this.skipMinorLen(minor)<0)throw 1;this.skipAny()}skipTkn(minor){switch(minor){case 24:return void this.reader.skip(1);case 25:return void this.reader.skip(2);case 26:return void this.reader.skip(4);case 27:return void this.reader.skip(8)}if(!(minor<=23))throw 1}validate(value,offset=0,size=value.length){this.reader.reset(value),this.reader.x=offset;const start=offset;this.skipAny();if(this.reader.x-start!==size)throw 8}decodeLevel(value){return this.reader.reset(value),this.readLevel()}readLevel(){const octet=this.reader.u8(),minor=31&octet;switch(octet>>5){case 4:return this.readArrLevel(minor);case 5:return this.readObjLevel(minor);default:return super.readAnyRaw(octet)}}readPrimitiveOrVal(){switch(this.reader.peak()>>5){case 4:case 5:return this.readAsValue();default:return this.readAny()}}readAsValue(){const reader=this.reader,start=reader.x;this.skipAny();const end=reader.x;return new JsonPackValue_1.JsonPackValue(reader.uint8.subarray(start,end))}readObjLevel(minor){const length=this.readMinorLen(minor);return length>=0?this.readObjRawLevel(length):this.readObjIndefLevel()}readObjRawLevel(length){const obj={};for(let i=0;i<length;i++){const key=this.key(),value=this.readPrimitiveOrVal();obj[key]=value}return obj}readObjIndefLevel(){const obj={};for(;255!==this.reader.peak();){const key=this.key();if(255===this.reader.peak())throw 7;const value=this.readPrimitiveOrVal();obj[key]=value}return this.reader.x++,obj}readArrLevel(minor){const length=this.readMinorLen(minor);return length>=0?this.readArrRawLevel(length):this.readArrIndefLevel()}readArrRawLevel(length){const arr=[];for(let i=0;i<length;i++)arr.push(this.readPrimitiveOrVal());return arr}readArrIndefLevel(){const arr=[];for(;255!==this.reader.peak();)arr.push(this.readPrimitiveOrVal());return this.reader.x++,arr}readHdr(expectedMajor){const octet=this.reader.u8();if(octet>>5!==expectedMajor)throw 0;const minor=31&octet;if(minor<24)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1}throw 1}readStrHdr(){return this.readHdr(3)}readObjHdr(){return this.readHdr(5)}readArrHdr(){return this.readHdr(4)}findKey(key){const size=this.readObjHdr();for(let i=0;i<size;i++){if(this.key()===key)return this;this.skipAny()}throw 9}findIndex(index){if(index>=this.readArrHdr())throw 10;for(let i=0;i<index;i++)this.skipAny();return this}find(path){for(let i=0;i<path.length;i++){const segment=path[i];"string"==typeof segment?this.findKey(segment):this.findIndex(segment)}return this}}exports.CborDecoder=CborDecoder},"./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborDecoderBase.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborDecoderBase=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),f16_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/f16.js"),JsonPackExtension_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/JsonPackExtension.js"),JsonPackValue_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/JsonPackValue.js"),Reader_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/Reader.js"),sharedCachedUtf8Decoder_1=tslib_1.__importDefault(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/utf8/sharedCachedUtf8Decoder.js"));exports.CborDecoderBase=class CborDecoderBase{constructor(reader=new Reader_1.Reader,keyDecoder=sharedCachedUtf8Decoder_1.default){this.reader=reader,this.keyDecoder=keyDecoder}read(uint8){return this.reader.reset(uint8),this.readAny()}decode(uint8){return this.reader.reset(uint8),this.readAny()}val(){return this.readAny()}readAny(){const octet=this.reader.u8(),major=octet>>5,minor=31&octet;return major<4?major<2?0===major?this.readUint(minor):this.readNint(minor):2===major?this.readBin(minor):this.readStr(minor):major<6?4===major?this.readArr(minor):this.readObj(minor):6===major?this.readTag(minor):this.readTkn(minor)}readAnyRaw(octet){const major=octet>>5,minor=31&octet;return major<4?major<2?0===major?this.readUint(minor):this.readNint(minor):2===major?this.readBin(minor):this.readStr(minor):major<6?4===major?this.readArr(minor):this.readObj(minor):6===major?this.readTag(minor):this.readTkn(minor)}readMinorLen(minor){if(minor<24)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());case 31:return-1;default:throw 1}}readUint(minor){if(minor<25)return 24===minor?this.reader.u8():minor;if(minor<27)return 25===minor?this.reader.u16():this.reader.u32();{const num=this.reader.u64();return num>9007199254740991?num:Number(num)}}readNint(minor){if(minor<25)return 24===minor?-this.reader.u8()-1:-minor-1;if(minor<27)return 25===minor?-this.reader.u16()-1:-this.reader.u32()-1;{const num=this.reader.u64();return num>9007199254740990?-num-BigInt(1):-Number(num)-1}}readBin(minor){const reader=this.reader;if(minor<=23)return reader.buf(minor);switch(minor){case 24:return reader.buf(reader.u8());case 25:return reader.buf(reader.u16());case 26:return reader.buf(reader.u32());case 27:return reader.buf(Number(reader.u64()));case 31:{let size=0;const list=[];for(;255!==this.reader.peak();){const uint8=this.readBinChunk();size+=uint8.length,list.push(uint8)}this.reader.x++;const res=new Uint8Array(size);let offset=0;const length=list.length;for(let i=0;i<length;i++){const arr=list[i];res.set(arr,offset),offset+=arr.length}return res}default:throw 1}}readBinChunk(){const octet=this.reader.u8(),minor=31&octet;if(2!==octet>>5)throw 2;if(minor>27)throw 3;return this.readBin(minor)}readAsStr(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)throw 11;return this.readStr(minor)}readStr(minor){const reader=this.reader;if(minor<=23)return reader.utf8(minor);switch(minor){case 24:return reader.utf8(reader.u8());case 25:return reader.utf8(reader.u16());case 26:return reader.utf8(reader.u32());case 27:return reader.utf8(Number(reader.u64()));case 31:{let str="";for(;255!==reader.peak();)str+=this.readStrChunk();return this.reader.x++,str}default:throw 1}}readStrLen(minor){if(minor<=23)return minor;switch(minor){case 24:return this.reader.u8();case 25:return this.reader.u16();case 26:return this.reader.u32();case 27:return Number(this.reader.u64());default:throw 1}}readStrChunk(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)throw 4;if(minor>27)throw 5;return this.readStr(minor)}readArr(minor){const length=this.readMinorLen(minor);return length>=0?this.readArrRaw(length):this.readArrIndef()}readArrRaw(length){const arr=[];for(let i=0;i<length;i++)arr.push(this.readAny());return arr}readArrIndef(){const arr=[];for(;255!==this.reader.peak();)arr.push(this.readAny());return this.reader.x++,arr}readObj(minor){if(minor<28){let length=minor;switch(minor){case 24:length=this.reader.u8();break;case 25:length=this.reader.u16();break;case 26:length=this.reader.u32();break;case 27:length=Number(this.reader.u64())}const obj={};for(let i=0;i<length;i++){const key=this.key();if("__proto__"===key)throw 6;const value=this.readAny();obj[key]=value}return obj}if(31===minor)return this.readObjIndef();throw 1}readObjRaw(length){const obj={};for(let i=0;i<length;i++){const key=this.key(),value=this.readAny();obj[key]=value}return obj}readObjIndef(){const obj={};for(;255!==this.reader.peak();){const key=this.key();if(255===this.reader.peak())throw 7;const value=this.readAny();obj[key]=value}return this.reader.x++,obj}key(){const octet=this.reader.u8(),minor=31&octet;if(3!==octet>>5)return String(this.readAnyRaw(octet));const length=this.readStrLen(minor);if(length>31)return this.reader.utf8(length);const key=this.keyDecoder.decode(this.reader.uint8,this.reader.x,length);return this.reader.skip(length),key}readTag(minor){if(minor<=23)return this.readTagRaw(minor);switch(minor){case 24:return this.readTagRaw(this.reader.u8());case 25:return this.readTagRaw(this.reader.u16());case 26:return this.readTagRaw(this.reader.u32());case 27:return this.readTagRaw(Number(this.reader.u64()));default:throw 1}}readTagRaw(tag){return new JsonPackExtension_1.JsonPackExtension(tag,this.readAny())}readTkn(minor){switch(minor){case 20:return!1;case 21:return!0;case 22:return null;case 23:return;case 24:return new JsonPackValue_1.JsonPackValue(this.reader.u8());case 25:return this.f16();case 26:return this.reader.f32();case 27:return this.reader.f64()}if(minor<=23)return new JsonPackValue_1.JsonPackValue(minor);throw 1}f16(){return(0,f16_1.decodeF16)(this.reader.u16())}}},"./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborEncoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborEncoder=void 0;const isFloat32_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/isFloat32.js"),JsonPackExtension_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/JsonPackExtension.js"),CborEncoderFast_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborEncoderFast.js"),JsonPackValue_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/JsonPackValue.js");class CborEncoder extends CborEncoderFast_1.CborEncoderFast{writeUnknown(value){this.writeNull()}writeAny(value){switch(typeof value){case"number":return this.writeNumber(value);case"string":return this.writeStr(value);case"boolean":return this.writer.u8(+value+244);case"object":if(!value)return this.writer.u8(246);switch(value.constructor){case Object:return this.writeObj(value);case Array:return this.writeArr(value);case Uint8Array:return this.writeBin(value);case Map:return this.writeMap(value);case JsonPackExtension_1.JsonPackExtension:return this.writeTag(value.tag,value.val);case JsonPackValue_1.JsonPackValue:const buf=value.val;return this.writer.buf(buf,buf.length);default:return value instanceof Uint8Array?this.writeBin(value):Array.isArray(value)?this.writeArr(value):value instanceof Map?this.writeMap(value):this.writeUnknown(value)}case"undefined":return this.writeUndef();case"bigint":return this.writeBigInt(value);default:return this.writeUnknown(value)}}writeFloat(float){(0,isFloat32_1.isFloat32)(float)?this.writer.u8f32(250,float):this.writer.u8f64(251,float)}writeMap(map){this.writeMapHdr(map.size),map.forEach((value,key)=>{this.writeAny(key),this.writeAny(value)})}writeUndef(){this.writer.u8(247)}}exports.CborEncoder=CborEncoder},"./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborEncoderFast.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CborEncoderFast=void 0;const Writer_1=__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/Writer.js"),isSafeInteger=Number.isSafeInteger;exports.CborEncoderFast=class CborEncoderFast{constructor(writer=new Writer_1.Writer){this.writer=writer}encode(value){return this.writeAny(value),this.writer.flush()}encodeToSlice(value){return this.writeAny(value),this.writer.flushSlice()}writeAny(value){switch(typeof value){case"number":return this.writeNumber(value);case"string":return this.writeStr(value);case"boolean":return this.writer.u8(+value+244);case"object":if(!value)return this.writer.u8(246);return value.constructor===Array?this.writeArr(value):this.writeObj(value)}}writeCbor(){this.writer.u8u16(217,55799)}writeEnd(){this.writer.u8(255)}writeNull(){this.writer.u8(246)}writeBoolean(bool){bool?this.writer.u8(245):this.writer.u8(244)}writeNumber(num){isSafeInteger(num)?this.writeInteger(num):"bigint"==typeof num?this.writeBigInt(num):this.writeFloat(num)}writeBigInt(int){int>=0?this.writeBigUint(int):this.writeBigSint(int)}writeBigUint(uint){if(uint<=Number.MAX_SAFE_INTEGER)return this.writeUInteger(Number(uint));this.writer.u8u64(27,uint)}writeBigSint(int){if(int>=Number.MIN_SAFE_INTEGER)return this.encodeNint(Number(int));const uint=-BigInt(1)-int;this.writer.u8u64(59,uint)}writeInteger(int){int>=0?this.writeUInteger(int):this.encodeNint(int)}writeUInteger(uint){const writer=this.writer;writer.ensureCapacity(9);const uint8=writer.uint8;let x=writer.x;uint<=23?uint8[x++]=0+uint:uint<=255?(uint8[x++]=24,uint8[x++]=uint):uint<=65535?(uint8[x++]=25,writer.view.setUint16(x,uint),x+=2):uint<=4294967295?(uint8[x++]=26,writer.view.setUint32(x,uint),x+=4):(uint8[x++]=27,writer.view.setBigUint64(x,BigInt(uint)),x+=8),writer.x=x}encodeNumber(num){this.writeNumber(num)}encodeInteger(int){this.writeInteger(int)}encodeUint(uint){this.writeUInteger(uint)}encodeNint(int){const uint=-1-int,writer=this.writer;writer.ensureCapacity(9);const uint8=writer.uint8;let x=writer.x;uint<24?uint8[x++]=32+uint:uint<=255?(uint8[x++]=56,uint8[x++]=uint):uint<=65535?(uint8[x++]=57,writer.view.setUint16(x,uint),x+=2):uint<=4294967295?(uint8[x++]=58,writer.view.setUint32(x,uint),x+=4):(uint8[x++]=59,writer.view.setBigUint64(x,BigInt(uint)),x+=8),writer.x=x}writeFloat(float){this.writer.u8f64(251,float)}writeBin(buf){const length=buf.length;this.writeBinHdr(length),this.writer.buf(buf,length)}writeBinHdr(length){const writer=this.writer;length<=23?writer.u8(64+length):length<=255?writer.u16(22528+length):length<=65535?writer.u8u16(89,length):length<=4294967295?writer.u8u32(90,length):writer.u8u64(91,length)}writeStr(str){const writer=this.writer,maxSize=4*str.length;writer.ensureCapacity(5+maxSize);const uint8=writer.uint8;let lengthOffset=writer.x;maxSize<=23?writer.x++:maxSize<=255?(uint8[writer.x++]=120,lengthOffset=writer.x,writer.x++):maxSize<=65535?(uint8[writer.x++]=121,lengthOffset=writer.x,writer.x+=2):(uint8[writer.x++]=122,lengthOffset=writer.x,writer.x+=4);const bytesWritten=writer.utf8(str);maxSize<=23?uint8[lengthOffset]=96+bytesWritten:maxSize<=255?uint8[lengthOffset]=bytesWritten:maxSize<=65535?writer.view.setUint16(lengthOffset,bytesWritten):writer.view.setUint32(lengthOffset,bytesWritten)}writeStrHdr(length){const writer=this.writer;length<=23?writer.u8(96+length):length<=255?writer.u16(30720+length):length<=65535?writer.u8u16(121,length):writer.u8u32(122,length)}writeAsciiStr(str){this.writeStrHdr(str.length),this.writer.ascii(str)}writeArr(arr){const length=arr.length;this.writeArrHdr(length);for(let i=0;i<length;i++)this.writeAny(arr[i])}writeArrHdr(length){const writer=this.writer;length<=23?writer.u8(128+length):length<=255?writer.u16(38912+length):length<=65535?writer.u8u16(153,length):length<=4294967295?writer.u8u32(154,length):writer.u8u64(155,length)}writeObj(obj){const keys=Object.keys(obj),length=keys.length;this.writeObjHdr(length);for(let i=0;i<length;i++){const key=keys[i];this.writeStr(key),this.writeAny(obj[key])}}writeObjHdr(length){const writer=this.writer;length<=23?writer.u8(160+length):length<=255?writer.u16(47104+length):length<=65535?writer.u8u16(185,length):length<=4294967295?writer.u8u32(186,length):writer.u8u64(187,length)}writeMapHdr(length){this.writeObjHdr(length)}writeStartMap(){this.writer.u8(191)}writeTag(tag,value){this.writeTagHdr(tag),this.writeAny(value)}writeTagHdr(tag){const writer=this.writer;tag<=23?writer.u8(192+tag):tag<=255?writer.u16(55296+tag):tag<=65535?writer.u8u16(217,tag):tag<=4294967295?writer.u8u32(218,tag):writer.u8u64(219,tag)}writeTkn(value){const writer=this.writer;value<=23?writer.u8(224+value):value<=255&&writer.u16(63488+value)}writeStartStr(){this.writer.u8(127)}writeStrChunk(str){throw new Error("Not implemented")}writeEndStr(){throw new Error("Not implemented")}writeStartBin(){this.writer.u8(95)}writeBinChunk(buf){throw new Error("Not implemented")}writeEndBin(){throw new Error("Not implemented")}writeStartArr(){this.writer.u8(159)}writeArrChunk(item){throw new Error("Not implemented")}writeEndArr(){this.writer.u8(255)}writeStartObj(){this.writer.u8(191)}writeObjChunk(key,value){throw new Error("Not implemented")}writeEndObj(){this.writer.u8(255)}}},"./node_modules/@jsonjoy.com/json-pointer/lib/find.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isObjectReference=exports.isArrayEnd=exports.isArrayReference=exports.find=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/hasOwnProperty.js"),{isArray}=Array;exports.find=(val,path)=>{const pathLength=path.length;if(!pathLength)return{val};let obj,key;for(let i=0;i<pathLength;i++)if(obj=val,key=path[i],isArray(obj)){const length=obj.length;if("-"===key)key=length;else if("string"==typeof key){const key2=~~key;if(""+key2!==key)throw new Error("INVALID_INDEX");if(key=key2,key<0)throw new Error("INVALID_INDEX")}val=obj[key]}else{if("object"!=typeof obj||!obj)throw new Error("NOT_FOUND");val=(0,hasOwnProperty_1.hasOwnProperty)(obj,key)?obj[key]:void 0}return{val,obj,key}};exports.isArrayReference=ref=>isArray(ref.obj)&&"number"==typeof ref.key;exports.isArrayEnd=ref=>ref.obj.length===ref.key;exports.isObjectReference=ref=>"object"==typeof ref.obj&&"string"==typeof ref.key},"./node_modules/@jsonjoy.com/json-pointer/lib/findByPointer/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/findByPointer/v5.js"),exports)},"./node_modules/@jsonjoy.com/json-pointer/lib/findByPointer/v5.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.findByPointer=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/hasOwnProperty.js"),util_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/util.js"),{isArray}=Array;exports.findByPointer=(pointer,val)=>{if(!pointer)return{val};let obj,key,indexOfSlash=0,indexAfterSlash=1;for(;indexOfSlash>-1;)if(indexOfSlash=pointer.indexOf("/",indexAfterSlash),key=indexOfSlash>-1?pointer.substring(indexAfterSlash,indexOfSlash):pointer.substring(indexAfterSlash),indexAfterSlash=indexOfSlash+1,obj=val,isArray(obj)){const length=obj.length;if("-"===key)key=length;else{const key2=~~key;if(""+key2!==key)throw new Error("INVALID_INDEX");if(key=key2,key<0)throw"INVALID_INDEX"}val=obj[key]}else{if("object"!=typeof obj||!obj)throw"NOT_FOUND";key=(0,util_1.unescapeComponent)(key),val=(0,hasOwnProperty_1.hasOwnProperty)(obj,key)?obj[key]:void 0}return{val,obj,key}}},"./node_modules/@jsonjoy.com/json-pointer/lib/get.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/hasOwnProperty.js");exports.get=(val,path)=>{const pathLength=path.length;let key;if(!pathLength)return val;for(let i=0;i<pathLength;i++)if(key=path[i],val instanceof Array){if("number"!=typeof key){if("-"===key)return;const key2=~~key;if(""+key2!==key)return;key=key2}val=val[key]}else{if("object"!=typeof val)return;if(!val||!(0,hasOwnProperty_1.hasOwnProperty)(val,key))return;val=val[key]}return val}},"./node_modules/@jsonjoy.com/json-pointer/lib/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/util.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/validate.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/get.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/find.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/findByPointer/index.js"),exports)},"./node_modules/@jsonjoy.com/json-pointer/lib/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/@jsonjoy.com/json-pointer/lib/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isInteger=exports.isRoot=exports.toPath=void 0,exports.unescapeComponent=unescapeComponent,exports.escapeComponent=escapeComponent,exports.parseJsonPointer=parseJsonPointer,exports.formatJsonPointer=function formatJsonPointer(path){return(0,exports.isRoot)(path)?"":"/"+path.map(component=>escapeComponent(String(component))).join("/")},exports.isChild=function isChild(parent,child){if(parent.length>=child.length)return!1;for(let i=0;i<parent.length;i++)if(parent[i]!==child[i])return!1;return!0},exports.isPathEqual=function isPathEqual(p1,p2){if(p1.length!==p2.length)return!1;for(let i=0;i<p1.length;i++)if(p1[i]!==p2[i])return!1;return!0},exports.parent=function parent(path){if(path.length<1)throw new Error("NO_PARENT");return path.slice(0,path.length-1)},exports.isValidIndex=function isValidIndex(index){if("number"==typeof index)return!0;const n=Number.parseInt(index,10);return String(n)===index&&n>=0};const r1=/~1/g,r2=/~0/g,r3=/~/g,r4=/\//g;function unescapeComponent(component){return-1===component.indexOf("~")?component:component.replace(r1,"/").replace(r2,"~")}function escapeComponent(component){return-1===component.indexOf("/")&&-1===component.indexOf("~")?component:component.replace(r3,"~0").replace(r4,"~1")}function parseJsonPointer(pointer){return pointer?pointer.slice(1).split("/").map(unescapeComponent):[]}exports.toPath=pointer=>"string"==typeof pointer?parseJsonPointer(pointer):pointer;exports.isRoot=path=>!path.length;exports.isInteger=str=>{const len=str.length;let charCode,i=0;for(;i<len;){if(charCode=str.charCodeAt(i),!(charCode>=48&&charCode<=57))return!1;i++}return!0}},"./node_modules/@jsonjoy.com/json-pointer/lib/validate.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validatePath=exports.validateJsonPointer=void 0;exports.validateJsonPointer=pointer=>{if("string"==typeof pointer){if(pointer){if("/"!==pointer[0])throw new Error("POINTER_INVALID");if(pointer.length>1024)throw new Error("POINTER_TOO_LONG")}}else(0,exports.validatePath)(pointer)};const{isArray}=Array;exports.validatePath=path=>{if(!isArray(path))throw new Error("Invalid path.");if(path.length>256)throw new Error("Path too long.");for(const step of path)switch(typeof step){case"string":case"number":continue;default:throw new Error("Invalid path step.")}}},"./node_modules/@jsonjoy.com/util/lib/buffers/Reader.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/Reader.js"),exports)},"./node_modules/@jsonjoy.com/util/lib/buffers/Writer.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/Writer.js"),exports)},"./node_modules/@jsonjoy.com/util/lib/buffers/isUint8Array.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/isUint8Array.js"),exports)},"./node_modules/@jsonjoy.com/util/lib/buffers/printOctets.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/@jsonjoy.com/buffers/lib/printOctets.js"),exports)},"./node_modules/@jsonjoy.com/util/lib/hasOwnProperty.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hasOwnProperty=void 0;const has=Object.prototype.hasOwnProperty;exports.hasOwnProperty=function hasOwnProperty(obj,key){return has.call(obj,key)}},"./node_modules/@jsonjoy.com/util/lib/isEmpty.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.isEmpty=void 0;exports.isEmpty=obj=>{for(const key in obj)if(Object.prototype.hasOwnProperty.call(obj,key))return!1;return!0}},"./node_modules/@jsonjoy.com/util/lib/sort/insertion.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.sort=void 0;exports.sort=arr=>{const length=arr.length;for(let i=1;i<length;i++){const currentValue=arr[i];let position=i;for(;0!==position&&arr[position-1]>currentValue;)arr[position]=arr[position-1],position--;arr[position]=currentValue}return arr}},"./node_modules/eventemitter3/index.js":module=>{"use strict";var has=Object.prototype.hasOwnProperty,prefix="~";function Events(){}function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function addListener(emitter,event,fn,context,once){if("function"!=typeof fn)throw new TypeError("The listener must be a function");var listener=new EE(fn,context||emitter,once),evt=prefix?prefix+event:event;return emitter._events[evt]?emitter._events[evt].fn?emitter._events[evt]=[emitter._events[evt],listener]:emitter._events[evt].push(listener):(emitter._events[evt]=listener,emitter._eventsCount++),emitter}function clearEvent(emitter,evt){0===--emitter._eventsCount?emitter._events=new Events:delete emitter._events[evt]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),(new Events).__proto__||(prefix=!1)),EventEmitter.prototype.eventNames=function eventNames(){var events,name,names=[];if(0===this._eventsCount)return names;for(name in events=this._events)has.call(events,name)&&names.push(prefix?name.slice(1):name);return Object.getOwnPropertySymbols?names.concat(Object.getOwnPropertySymbols(events)):names},EventEmitter.prototype.listeners=function listeners(event){var evt=prefix?prefix+event:event,handlers=this._events[evt];if(!handlers)return[];if(handlers.fn)return[handlers.fn];for(var i=0,l=handlers.length,ee=new Array(l);i<l;i++)ee[i]=handlers[i].fn;return ee},EventEmitter.prototype.listenerCount=function listenerCount(event){var evt=prefix?prefix+event:event,listeners=this._events[evt];return listeners?listeners.fn?1:listeners.length:0},EventEmitter.prototype.emit=function emit(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if(listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;case 4:listeners[i].fn.call(listeners[i].context,a1,a2,a3);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function on(event,fn,context){return addListener(this,event,fn,context,!1)},EventEmitter.prototype.once=function once(event,fn,context){return addListener(this,event,fn,context,!0)},EventEmitter.prototype.removeListener=function removeListener(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events[evt])return this;if(!fn)return clearEvent(this,evt),this;var listeners=this._events[evt];if(listeners.fn)listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context||clearEvent(this,evt);else{for(var i=0,events=[],length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);events.length?this._events[evt]=1===events.length?events[0]:events:clearEvent(this,evt)}return this},EventEmitter.prototype.removeAllListeners=function removeAllListeners(event){var evt;return event?(evt=prefix?prefix+event:event,this._events[evt]&&clearEvent(this,evt)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=prefix,EventEmitter.EventEmitter=EventEmitter,module.exports=EventEmitter},"./node_modules/fast-diff/diff.js":module=>{function diff_main(text1,text2,cursor_pos,cleanup,_fix_unicode){if(text1===text2)return text1?[[0,text1]]:[];if(null!=cursor_pos){var editdiff=function find_cursor_edit_diff(oldText,newText,cursor_pos){var oldRange="number"==typeof cursor_pos?{index:cursor_pos,length:0}:cursor_pos.oldRange,newRange="number"==typeof cursor_pos?null:cursor_pos.newRange,oldLength=oldText.length,newLength=newText.length;if(0===oldRange.length&&(null===newRange||0===newRange.length)){var oldCursor=oldRange.index,oldBefore=oldText.slice(0,oldCursor),oldAfter=oldText.slice(oldCursor),maybeNewCursor=newRange?newRange.index:null,newCursor=oldCursor+newLength-oldLength;if((null===maybeNewCursor||maybeNewCursor===newCursor)&&!(newCursor<0||newCursor>newLength)){var newBefore=newText.slice(0,newCursor);if((newAfter=newText.slice(newCursor))===oldAfter){var prefixLength=Math.min(oldCursor,newCursor);if((oldPrefix=oldBefore.slice(0,prefixLength))===(newPrefix=newBefore.slice(0,prefixLength)))return make_edit_splice(oldPrefix,oldBefore.slice(prefixLength),newBefore.slice(prefixLength),oldAfter)}}if(null===maybeNewCursor||maybeNewCursor===oldCursor){var cursor=oldCursor,newAfter=(newBefore=newText.slice(0,cursor),newText.slice(cursor));if(newBefore===oldBefore){var suffixLength=Math.min(oldLength-cursor,newLength-cursor);if((oldSuffix=oldAfter.slice(oldAfter.length-suffixLength))===(newSuffix=newAfter.slice(newAfter.length-suffixLength)))return make_edit_splice(oldBefore,oldAfter.slice(0,oldAfter.length-suffixLength),newAfter.slice(0,newAfter.length-suffixLength),oldSuffix)}}}if(oldRange.length>0&&newRange&&0===newRange.length){var oldPrefix=oldText.slice(0,oldRange.index),oldSuffix=oldText.slice(oldRange.index+oldRange.length);if(!(newLength<(prefixLength=oldPrefix.length)+(suffixLength=oldSuffix.length))){var newPrefix=newText.slice(0,prefixLength),newSuffix=newText.slice(newLength-suffixLength);if(oldPrefix===newPrefix&&oldSuffix===newSuffix)return make_edit_splice(oldPrefix,oldText.slice(prefixLength,oldLength-suffixLength),newText.slice(prefixLength,newLength-suffixLength),oldSuffix)}}return null}(text1,text2,cursor_pos);if(editdiff)return editdiff}var commonlength=diff_commonPrefix(text1,text2),commonprefix=text1.substring(0,commonlength);commonlength=diff_commonSuffix(text1=text1.substring(commonlength),text2=text2.substring(commonlength));var commonsuffix=text1.substring(text1.length-commonlength),diffs=function diff_compute_(text1,text2){var diffs;if(!text1)return[[1,text2]];if(!text2)return[[-1,text1]];var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,i=longtext.indexOf(shorttext);if(-1!==i)return diffs=[[1,longtext.substring(0,i)],[0,shorttext],[1,longtext.substring(i+shorttext.length)]],text1.length>text2.length&&(diffs[0][0]=diffs[2][0]=-1),diffs;if(1===shorttext.length)return[[-1,text1],[1,text2]];var hm=function diff_halfMatch_(text1,text2){var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1;if(longtext.length<4||2*shorttext.length<longtext.length)return null;function diff_halfMatchI_(longtext,shorttext,i){for(var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,seed=longtext.substring(i,i+Math.floor(longtext.length/4)),j=-1,best_common="";-1!==(j=shorttext.indexOf(seed,j+1));){var prefixLength=diff_commonPrefix(longtext.substring(i),shorttext.substring(j)),suffixLength=diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));best_common.length<suffixLength+prefixLength&&(best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength),best_longtext_a=longtext.substring(0,i-suffixLength),best_longtext_b=longtext.substring(i+prefixLength),best_shorttext_a=shorttext.substring(0,j-suffixLength),best_shorttext_b=shorttext.substring(j+prefixLength))}return 2*best_common.length>=longtext.length?[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]:null}var hm,text1_a,text1_b,text2_a,text2_b,hm1=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/4)),hm2=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/2));if(!hm1&&!hm2)return null;hm=hm2?hm1&&hm1[4].length>hm2[4].length?hm1:hm2:hm1;text1.length>text2.length?(text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3]):(text2_a=hm[0],text2_b=hm[1],text1_a=hm[2],text1_b=hm[3]);var mid_common=hm[4];return[text1_a,text1_b,text2_a,text2_b,mid_common]}(text1,text2);if(hm){var text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3],mid_common=hm[4],diffs_a=diff_main(text1_a,text2_a),diffs_b=diff_main(text1_b,text2_b);return diffs_a.concat([[0,mid_common]],diffs_b)}return function diff_bisect_(text1,text2){for(var text1_length=text1.length,text2_length=text2.length,max_d=Math.ceil((text1_length+text2_length)/2),v_offset=max_d,v_length=2*max_d,v1=new Array(v_length),v2=new Array(v_length),x=0;x<v_length;x++)v1[x]=-1,v2[x]=-1;v1[v_offset+1]=0,v2[v_offset+1]=0;for(var delta=text1_length-text2_length,front=delta%2!=0,k1start=0,k1end=0,k2start=0,k2end=0,d=0;d<max_d;d++){for(var k1=-d+k1start;k1<=d-k1end;k1+=2){for(var k1_offset=v_offset+k1,y1=(x1=k1===-d||k1!==d&&v1[k1_offset-1]<v1[k1_offset+1]?v1[k1_offset+1]:v1[k1_offset-1]+1)-k1;x1<text1_length&&y1<text2_length&&text1.charAt(x1)===text2.charAt(y1);)x1++,y1++;if(v1[k1_offset]=x1,x1>text1_length)k1end+=2;else if(y1>text2_length)k1start+=2;else if(front){if((k2_offset=v_offset+delta-k1)>=0&&k2_offset<v_length&&-1!==v2[k2_offset])if(x1>=(x2=text1_length-v2[k2_offset]))return diff_bisectSplit_(text1,text2,x1,y1)}}for(var k2=-d+k2start;k2<=d-k2end;k2+=2){for(var x2,k2_offset=v_offset+k2,y2=(x2=k2===-d||k2!==d&&v2[k2_offset-1]<v2[k2_offset+1]?v2[k2_offset+1]:v2[k2_offset-1]+1)-k2;x2<text1_length&&y2<text2_length&&text1.charAt(text1_length-x2-1)===text2.charAt(text2_length-y2-1);)x2++,y2++;if(v2[k2_offset]=x2,x2>text1_length)k2end+=2;else if(y2>text2_length)k2start+=2;else if(!front){if((k1_offset=v_offset+delta-k2)>=0&&k1_offset<v_length&&-1!==v1[k1_offset]){var x1;y1=v_offset+(x1=v1[k1_offset])-k1_offset;if(x1>=(x2=text1_length-x2))return diff_bisectSplit_(text1,text2,x1,y1)}}}}return[[-1,text1],[1,text2]]}(text1,text2)}(text1=text1.substring(0,text1.length-commonlength),text2=text2.substring(0,text2.length-commonlength));return commonprefix&&diffs.unshift([0,commonprefix]),commonsuffix&&diffs.push([0,commonsuffix]),diff_cleanupMerge(diffs,_fix_unicode),cleanup&&function diff_cleanupSemantic(diffs){var changes=!1,equalities=[],equalitiesLength=0,lastequality=null,pointer=0,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0;for(;pointer<diffs.length;)0==diffs[pointer][0]?(equalities[equalitiesLength++]=pointer,length_insertions1=length_insertions2,length_deletions1=length_deletions2,length_insertions2=0,length_deletions2=0,lastequality=diffs[pointer][1]):(1==diffs[pointer][0]?length_insertions2+=diffs[pointer][1].length:length_deletions2+=diffs[pointer][1].length,lastequality&&lastequality.length<=Math.max(length_insertions1,length_deletions1)&&lastequality.length<=Math.max(length_insertions2,length_deletions2)&&(diffs.splice(equalities[equalitiesLength-1],0,[-1,lastequality]),diffs[equalities[equalitiesLength-1]+1][0]=1,equalitiesLength--,pointer=--equalitiesLength>0?equalities[equalitiesLength-1]:-1,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0,lastequality=null,changes=!0)),pointer++;changes&&diff_cleanupMerge(diffs);(function diff_cleanupSemanticLossless(diffs){function diff_cleanupSemanticScore_(one,two){if(!one||!two)return 6;var char1=one.charAt(one.length-1),char2=two.charAt(0),nonAlphaNumeric1=char1.match(nonAlphaNumericRegex_),nonAlphaNumeric2=char2.match(nonAlphaNumericRegex_),whitespace1=nonAlphaNumeric1&&char1.match(whitespaceRegex_),whitespace2=nonAlphaNumeric2&&char2.match(whitespaceRegex_),lineBreak1=whitespace1&&char1.match(linebreakRegex_),lineBreak2=whitespace2&&char2.match(linebreakRegex_),blankLine1=lineBreak1&&one.match(blanklineEndRegex_),blankLine2=lineBreak2&&two.match(blanklineStartRegex_);return blankLine1||blankLine2?5:lineBreak1||lineBreak2?4:nonAlphaNumeric1&&!whitespace1&&whitespace2?3:whitespace1||whitespace2?2:nonAlphaNumeric1||nonAlphaNumeric2?1:0}var pointer=1;for(;pointer<diffs.length-1;){if(0==diffs[pointer-1][0]&&0==diffs[pointer+1][0]){var equality1=diffs[pointer-1][1],edit=diffs[pointer][1],equality2=diffs[pointer+1][1],commonOffset=diff_commonSuffix(equality1,edit);if(commonOffset){var commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset),edit=commonString+edit.substring(0,edit.length-commonOffset),equality2=commonString+equality2}for(var bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2,bestScore=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);edit.charAt(0)===equality2.charAt(0);){equality1+=edit.charAt(0),edit=edit.substring(1)+equality2.charAt(0),equality2=equality2.substring(1);var score=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);score>=bestScore&&(bestScore=score,bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2)}diffs[pointer-1][1]!=bestEquality1&&(bestEquality1?diffs[pointer-1][1]=bestEquality1:(diffs.splice(pointer-1,1),pointer--),diffs[pointer][1]=bestEdit,bestEquality2?diffs[pointer+1][1]=bestEquality2:(diffs.splice(pointer+1,1),pointer--))}pointer++}})(diffs),pointer=1;for(;pointer<diffs.length;){if(-1==diffs[pointer-1][0]&&1==diffs[pointer][0]){var deletion=diffs[pointer-1][1],insertion=diffs[pointer][1],overlap_length1=diff_commonOverlap_(deletion,insertion),overlap_length2=diff_commonOverlap_(insertion,deletion);overlap_length1>=overlap_length2?(overlap_length1>=deletion.length/2||overlap_length1>=insertion.length/2)&&(diffs.splice(pointer,0,[0,insertion.substring(0,overlap_length1)]),diffs[pointer-1][1]=deletion.substring(0,deletion.length-overlap_length1),diffs[pointer+1][1]=insertion.substring(overlap_length1),pointer++):(overlap_length2>=deletion.length/2||overlap_length2>=insertion.length/2)&&(diffs.splice(pointer,0,[0,deletion.substring(0,overlap_length2)]),diffs[pointer-1][0]=1,diffs[pointer-1][1]=insertion.substring(0,insertion.length-overlap_length2),diffs[pointer+1][0]=-1,diffs[pointer+1][1]=deletion.substring(overlap_length2),pointer++),pointer++}pointer++}}(diffs),diffs}function diff_bisectSplit_(text1,text2,x,y){var text1a=text1.substring(0,x),text2a=text2.substring(0,y),text1b=text1.substring(x),text2b=text2.substring(y),diffs=diff_main(text1a,text2a),diffsb=diff_main(text1b,text2b);return diffs.concat(diffsb)}function diff_commonPrefix(text1,text2){if(!text1||!text2||text1.charAt(0)!==text2.charAt(0))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerstart=0;pointermin<pointermid;)text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)?pointerstart=pointermin=pointermid:pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return is_surrogate_pair_start(text1.charCodeAt(pointermid-1))&&pointermid--,pointermid}function diff_commonOverlap_(text1,text2){var text1_length=text1.length,text2_length=text2.length;if(0==text1_length||0==text2_length)return 0;text1_length>text2_length?text1=text1.substring(text1_length-text2_length):text1_length<text2_length&&(text2=text2.substring(0,text1_length));var text_length=Math.min(text1_length,text2_length);if(text1==text2)return text_length;for(var best=0,length=1;;){var pattern=text1.substring(text_length-length),found=text2.indexOf(pattern);if(-1==found)return best;length+=found,0!=found&&text1.substring(text_length-length)!=text2.substring(0,length)||(best=length,length++)}}function diff_commonSuffix(text1,text2){if(!text1||!text2||text1.slice(-1)!==text2.slice(-1))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerend=0;pointermin<pointermid;)text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)?pointerend=pointermin=pointermid:pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return is_surrogate_pair_end(text1.charCodeAt(text1.length-pointermid))&&pointermid--,pointermid}var nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,whitespaceRegex_=/\s/,linebreakRegex_=/[\r\n]/,blanklineEndRegex_=/\n\r?\n$/,blanklineStartRegex_=/^\r?\n\r?\n/;function diff_cleanupMerge(diffs,fix_unicode){diffs.push([0,""]);for(var commonlength,pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";pointer<diffs.length;)if(pointer<diffs.length-1&&!diffs[pointer][1])diffs.splice(pointer,1);else switch(diffs[pointer][0]){case 1:count_insert++,text_insert+=diffs[pointer][1],pointer++;break;case-1:count_delete++,text_delete+=diffs[pointer][1],pointer++;break;case 0:var previous_equality=pointer-count_insert-count_delete-1;if(fix_unicode){if(previous_equality>=0&&ends_with_pair_start(diffs[previous_equality][1])){var stray=diffs[previous_equality][1].slice(-1);if(diffs[previous_equality][1]=diffs[previous_equality][1].slice(0,-1),text_delete=stray+text_delete,text_insert=stray+text_insert,!diffs[previous_equality][1]){diffs.splice(previous_equality,1),pointer--;var k=previous_equality-1;diffs[k]&&1===diffs[k][0]&&(count_insert++,text_insert=diffs[k][1]+text_insert,k--),diffs[k]&&-1===diffs[k][0]&&(count_delete++,text_delete=diffs[k][1]+text_delete,k--),previous_equality=k}}if(starts_with_pair_end(diffs[pointer][1])){stray=diffs[pointer][1].charAt(0);diffs[pointer][1]=diffs[pointer][1].slice(1),text_delete+=stray,text_insert+=stray}}if(pointer<diffs.length-1&&!diffs[pointer][1]){diffs.splice(pointer,1);break}if(text_delete.length>0||text_insert.length>0){text_delete.length>0&&text_insert.length>0&&(0!==(commonlength=diff_commonPrefix(text_insert,text_delete))&&(previous_equality>=0?diffs[previous_equality][1]+=text_insert.substring(0,commonlength):(diffs.splice(0,0,[0,text_insert.substring(0,commonlength)]),pointer++),text_insert=text_insert.substring(commonlength),text_delete=text_delete.substring(commonlength)),0!==(commonlength=diff_commonSuffix(text_insert,text_delete))&&(diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1],text_insert=text_insert.substring(0,text_insert.length-commonlength),text_delete=text_delete.substring(0,text_delete.length-commonlength)));var n=count_insert+count_delete;0===text_delete.length&&0===text_insert.length?(diffs.splice(pointer-n,n),pointer-=n):0===text_delete.length?(diffs.splice(pointer-n,n,[1,text_insert]),pointer=pointer-n+1):0===text_insert.length?(diffs.splice(pointer-n,n,[-1,text_delete]),pointer=pointer-n+1):(diffs.splice(pointer-n,n,[-1,text_delete],[1,text_insert]),pointer=pointer-n+2)}0!==pointer&&0===diffs[pointer-1][0]?(diffs[pointer-1][1]+=diffs[pointer][1],diffs.splice(pointer,1)):pointer++,count_insert=0,count_delete=0,text_delete="",text_insert=""}""===diffs[diffs.length-1][1]&&diffs.pop();var changes=!1;for(pointer=1;pointer<diffs.length-1;)0===diffs[pointer-1][0]&&0===diffs[pointer+1][0]&&(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)===diffs[pointer-1][1]?(diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length),diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1],diffs.splice(pointer-1,1),changes=!0):diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]&&(diffs[pointer-1][1]+=diffs[pointer+1][1],diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1],diffs.splice(pointer+1,1),changes=!0)),pointer++;changes&&diff_cleanupMerge(diffs,fix_unicode)}function is_surrogate_pair_start(charCode){return charCode>=55296&&charCode<=56319}function is_surrogate_pair_end(charCode){return charCode>=56320&&charCode<=57343}function starts_with_pair_end(str){return is_surrogate_pair_end(str.charCodeAt(0))}function ends_with_pair_start(str){return is_surrogate_pair_start(str.charCodeAt(str.length-1))}function make_edit_splice(before,oldMiddle,newMiddle,after){return ends_with_pair_start(before)||starts_with_pair_end(after)?null:function remove_empty_tuples(tuples){for(var ret=[],i=0;i<tuples.length;i++)tuples[i][1].length>0&&ret.push(tuples[i]);return ret}([[0,before],[-1,oldMiddle],[1,newMiddle],[0,after]])}function diff(text1,text2,cursor_pos,cleanup){return diff_main(text1,text2,cursor_pos,cleanup,!0)}diff.INSERT=1,diff.DELETE=-1,diff.EQUAL=0,module.exports=diff},"./node_modules/json-joy/lib/json-crdt-extensions/ModelWithExt.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelWithExt=exports.ext=void 0;const ext=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/ext.js"));exports.ext=ext;const Extensions_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/Extensions.js"),model_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/index.js"),extensions=new Extensions_1.Extensions;extensions.register(ext.cnt),extensions.register(ext.mval),extensions.register(ext.peritext),extensions.register(ext.quill);class ModelWithExt{}exports.ModelWithExt=ModelWithExt,ModelWithExt.ext=ext,ModelWithExt.create=(schema,sidOrClock=model_1.Model.sid())=>{const model=model_1.Model.create(schema,sidOrClock);return model.ext=extensions,model},ModelWithExt.load=(data,sid,schema)=>{const model=model_1.Model.load(data,sid,schema);return model.ext=extensions,model}},"./node_modules/json-joy/lib/json-crdt-extensions/cnt/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.cnt=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/constants.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/nodes.js"),ExtNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js"),Extension_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/Extension.js"),json_crdt_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/index.js"),MNEMONIC=constants_1.ExtensionName[1];class CntNode extends ExtNode_1.ExtNode{constructor(){super(...arguments),this.extId=1}name(){return MNEMONIC}view(){const obj=this.data.view();let sum=0;for(const key in obj)sum+=Number(obj[key]);return sum}}class CntApi extends nodes_1.NodeApi{inc(increment){const{api,node}=this,sidStr=api.model.clock.sid.toString(36),newValue=Number(node.data.get(sidStr)?.view()??0)+increment;return api.wrap(node.data).set({[sidStr]:newValue}),this}}exports.cnt=new Extension_1.Extension(1,MNEMONIC,CntNode,CntApi,(value,sid=0)=>new json_crdt_1.NodeBuilder(builder=>{sid||(sid=builder.clock.sid);return(void 0===value?json_crdt_1.s.map({}):json_crdt_1.s.map({[sid.toString(36)]:json_crdt_1.s.con(value??0)})).build(builder)}))},"./node_modules/json-joy/lib/json-crdt-extensions/constants.js":(__unused_webpack_module,exports)=>{"use strict";var ExtensionName;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExtensionName=void 0,function(ExtensionName){ExtensionName[ExtensionName.mval=0]="mval",ExtensionName[ExtensionName.cnt=1]="cnt",ExtensionName[ExtensionName.peritext=2]="peritext",ExtensionName[ExtensionName.quill=3]="quill"}(ExtensionName||(exports.ExtensionName=ExtensionName={}))},"./node_modules/json-joy/lib/json-crdt-extensions/ext.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.quill=exports.peritext=exports.mval=exports.cnt=void 0;const cnt_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/cnt/index.js");Object.defineProperty(exports,"cnt",{enumerable:!0,get:function(){return cnt_1.cnt}});const mval_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/mval/index.js");Object.defineProperty(exports,"mval",{enumerable:!0,get:function(){return mval_1.mval}});const peritext_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/index.js");Object.defineProperty(exports,"peritext",{enumerable:!0,get:function(){return peritext_1.peritext}});const quill_delta_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/index.js");Object.defineProperty(exports,"quill",{enumerable:!0,get:function(){return quill_delta_1.quill}})},"./node_modules/json-joy/lib/json-crdt-extensions/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/mval/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/cnt/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/ext.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/ModelWithExt.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/constants.js"),exports)},"./node_modules/json-joy/lib/json-crdt-extensions/mval/MvalApi.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MvalApi=void 0;const nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/nodes.js");class MvalApi extends nodes_1.NodeApi{set(json){const{api,node}=this,builder=api.builder,rgaApi=new nodes_1.ArrApi(node.data,api),length=rgaApi.length();return rgaApi.del(0,length),rgaApi.ins(0,[builder.json(json)]),rgaApi.node.removeTombstones(),this}}exports.MvalApi=MvalApi},"./node_modules/json-joy/lib/json-crdt-extensions/mval/MvalNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MvalNode=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/mval/constants.js"),ExtNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js");class MvalNode extends ExtNode_1.ExtNode{constructor(){super(...arguments),this.extId=0}name(){return constants_1.MNEMONIC}view(){return this.data.view()}}exports.MvalNode=MvalNode},"./node_modules/json-joy/lib/json-crdt-extensions/mval/constants.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MNEMONIC=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/constants.js");exports.MNEMONIC=constants_1.ExtensionName[0]},"./node_modules/json-joy/lib/json-crdt-extensions/mval/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mval=void 0;const MvalNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/mval/MvalNode.js"),MvalApi_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/mval/MvalApi.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/mval/constants.js"),json_crdt_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/index.js"),Extension_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/Extension.js");exports.mval=new Extension_1.Extension(0,constants_1.MNEMONIC,MvalNode_1.MvalNode,MvalApi_1.MvalApi,value=>json_crdt_1.s.arr(void 0===value?[]:[json_crdt_1.s.json(value)]))},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/Peritext.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Peritext=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),Point_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Point.js"),Range_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Range.js"),Editor_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/editor/Editor.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js"),Slices_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/Slices.js"),LocalSlices_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/LocalSlices.js"),Overlay_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/Overlay.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),model_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/index.js"),json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),json_crdt_patch_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/index.js"),ExtraSlices_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/ExtraSlices.js"),Blocks_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Blocks.js"),hash_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/hash.js"),EXTRA_SLICES_SCHEMA=json_crdt_patch_1.s.vec(json_crdt_patch_1.s.arr([]));exports.Peritext=class Peritext{constructor(model,str,slices,extraSlicesModel=model_1.Model.create(EXTRA_SLICES_SCHEMA,model.clock.sid-1),localSlicesModel=model_1.Model.create(EXTRA_SLICES_SCHEMA,3)){this.model=model,this.str=str,this.overlay=new Overlay_1.Overlay(this),this.hash=0,this.savedSlices=new Slices_1.Slices(this,slices),this.extraSlices=new ExtraSlices_1.ExtraSlices(this,extraSlicesModel.root.node().get(0));const localApi=localSlicesModel.api;localApi.onLocalChange.listen(()=>{localApi.flush()}),this.localSlices=new LocalSlices_1.LocalSlices(this,localSlicesModel.root.node().get(0)),this.editor=new Editor_1.Editor(this),this.blocks=new Blocks_1.Blocks(this)}strApi(){if(this.str instanceof nodes_1.StrNode)return this.model.api.wrap(this.str);throw new Error("INVALID_STR")}findCharBefore(point){if(1===point.anchor){const chunk=point.chunk();if(chunk&&!chunk.del)return this.range(this.point(point.id,0),point)}const id=point.prevId();if(id)return this.range(this.point(id,0),this.point(id,1))}point(id=this.str.id,anchor=1){return new Point_1.Point(this.str,id,anchor)}pointAt(pos,anchor=0){const str=this.str,id=str.find(pos);return id?this.point(id,anchor):this.point(str.id,1)}pointAbsStart(){return this.point(this.str.id,1)}pointAbsEnd(){return this.point(this.str.id,0)}pointStart(){if(!this.str.length())return;const point=this.pointAbsStart();return point.refBefore(),point}pointEnd(){if(!this.str.length())return;const point=this.pointAbsEnd();return point.refAfter(),point}rangeFromPoints(p1,p2){return Range_1.Range.from(this.str,p1,p2)}range(start,end){return new Range_1.Range(this.str,start,end)}rangeAt(start,length=0){return Range_1.Range.at(this.str,start,length)}rangeAll(){const start=this.pointStart(),end=this.pointEnd();if(start&&end)return this.range(start,end)}insAt(pos,text){this.strApi().ins(pos,text)}ins(after,text){if(!text)throw new Error("NO_TEXT");const api=this.model.api,textId=api.builder.insStr(this.str.id,after,text);return api.apply(),textId}delAt(pos,len){const range=this.rangeAt(pos,len);this.del(range)}del(range){this.delSlices(range),this.delStr(range)}delStr(range){if(range.isCollapsed())return!1;const{start,end}=range,delStartId=start.isAbsStart()?this.point().refStart().id:0===start.anchor?start.id:start.nextId(),delEndId=end.isAbsEnd()?this.point().refEnd().id:1===end.anchor?end.id:end.prevId();if(!delStartId||!delEndId)throw new Error("INVALID_RANGE");const rga=this.str,spans=rga.findInterval2(delStartId,delEndId),api=this.model.api;return api.builder.del(rga.id,spans),api.apply(),!0}delSlices(range){this.overlay.refresh(),(range=range.range()).expand();const slices=this.overlay.findContained(range);let deleted=!1;return slices.size?(this.savedSlices.delSlices(slices)&&(deleted=!0),this.extraSlices.delSlices(slices)&&(deleted=!0),this.localSlices.delSlices(slices)&&(deleted=!0),deleted):deleted}insMarker(after,type,data,char="\n"){return this.savedSlices.insMarkerAfter(after,type,data,char)}delMarker(split){const str=this.str,api=this.model.api,builder=api.builder,strChunk=split.start.chunk();strChunk&&builder.del(str.id,[(0,clock_1.interval)(strChunk.id,0,1)]),builder.del(this.savedSlices.set.id,[(0,clock_1.interval)(split.id,0,1)]),api.apply()}toString(tab=""){const nl=()=>"",{savedSlices,extraSlices,localSlices}=this;return"Peritext"+(0,printTree_1.printTree)(tab,[tab=>this.str.toString(tab),nl,savedSlices.size()?tab=>savedSlices.toString(tab):null,extraSlices.size()?tab=>extraSlices.toString(tab):null,localSlices.size()?tab=>localSlices.toString(tab):null,nl,tab=>this.overlay.toString(tab),nl,tab=>this.blocks.toString(tab)])}refresh(){let state=5381;return state=(0,hash_1.updateRga)(state,this.str),state=(0,json_hash_1.updateNum)(state,this.overlay.refresh()),state=(0,json_hash_1.updateNum)(state,this.blocks.refresh()),this.hash=state}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/PeritextApi.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PeritextApi=void 0;const nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/nodes.js"),Peritext_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/Peritext.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js");class PeritextApi extends nodes_1.NodeApi{constructor(node,api){super(node,api),this.node=node,this.api=api,this.txt=new Peritext_1.Peritext(api.model,node.text(),node.slices()),this.editor=this.txt.editor}text(){return this.api.wrap(this.node.text())}slices(){return this.api.wrap(this.node.slices())}toString(tab){return"PeritextApi"+(0,printTree_1.printTree)(tab,[tab=>this.node.toString(tab),()=>"",tab=>this.txt.toString(tab)])}}exports.PeritextApi=PeritextApi},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/PeritextNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PeritextNode=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/constants.js"),ExtNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js");class PeritextNode extends ExtNode_1.ExtNode{constructor(){super(...arguments),this.extId=2}text(){return this.data.get(0)}slices(){return this.data.get(1)}name(){return constants_1.MNEMONIC}view(){return this.text().view()}}exports.PeritextNode=PeritextNode},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Block.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Block=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),MarkerOverlayPoint_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/MarkerOverlayPoint.js"),iterator_1=__webpack_require__("./node_modules/json-joy/lib/util/iterator.js"),Inline_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Inline.js");exports.Block=class Block{constructor(txt,path,marker){this.txt=txt,this.path=path,this.marker=marker,this.parent=null,this.children=[],this.hash=0}key(){if(!this.marker)return this.tag();const id=this.marker.id;return id.sid.toString(36)+id.time.toString(36)}tag(){const path=this.path,length=path.length;return length?path[length-1]:""}attr(){return this.marker?.data()}points0(withMarker=!1){const overlay=this.txt.overlay,iterator=overlay.points0(this.marker);let closed=!1;return()=>{if(withMarker)return withMarker=!1,this.marker??overlay.START;if(closed)return;const point=iterator();if(point){if(!(point instanceof MarkerOverlayPoint_1.MarkerOverlayPoint))return point;closed=!0}}}points(withMarker){return new iterator_1.UndefEndIter(this.points0(withMarker))}tuples0(){const iterator=this.txt.overlay.tuples0(this.marker);let closed=!1;return()=>{if(closed)return;const pair=iterator();return pair?((!pair[1]||pair[1]instanceof MarkerOverlayPoint_1.MarkerOverlayPoint)&&(closed=!0),pair):void 0}}tuples(){return new iterator_1.UndefEndIter(this.tuples0())}texts0(){const txt=this.txt,iterator=this.tuples0();return()=>{const pair=iterator();return pair&&Inline_1.Inline.create(txt,pair[0],pair[1])}}texts(){return new iterator_1.UndefEndIter(this.texts0())}text(){let str="";const iterator=this.texts0();let text=iterator();for(;text;)str+=text.text(),text=iterator();return str}refresh(){const{path,children}=this;let state=5381;state=(0,json_hash_1.updateJson)(state,path);const marker=this.marker;marker?(state=(0,json_hash_1.updateNum)(state,marker.marker.refresh()),state=(0,json_hash_1.updateNum)(state,marker.textHash)):state=(0,json_hash_1.updateNum)(state,this.txt.overlay.leadingTextHash);for(let i=0;i<children.length;i++)state=(0,json_hash_1.updateNum)(state,children[i].refresh());return this.hash=state}toStringName(){return"Block"}toStringHeader(){const hash=`#${this.hash.toString(36).slice(-4)}`,tag=`<${this.path.join(".")}>`;return`${this.toStringName()} ${hash} ${tag}`}toString(tab=""){const header=this.toStringHeader(),hasChildren=!!this.children.length;return header+(0,printTree_1.printTree)(tab,[this.marker?tab=>this.marker.toString(tab):null,this.marker&&hasChildren?()=>"":null,hasChildren?tab=>"children"+(0,printTree_1.printTree)(tab,this.children.map((child,i)=>tab=>`${i+1}. `+child.toString(tab+"  "+" ".repeat(String(i+1).length)))):null])}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Blocks.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Blocks=void 0;const Block_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Block.js"),commonLength_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/util/commonLength.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),LeafBlock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/LeafBlock.js");exports.Blocks=class Blocks{constructor(txt){this.txt=txt,this.hash=0,this.root=new Block_1.Block(txt,[],void 0)}toString(tab=""){return"Blocks"+(0,printTree_1.printTree)(tab,[tab=>this.root.toString(tab)])}refresh(){return this.refreshBlocks(),this.hash=this.root.refresh()}insertBlock(parent,path,marker){const txt=this.txt,common=(0,commonLength_1.commonLength)(path,parent.path);for(;parent.path.length>common&&parent.parent;)parent=parent.parent;for(;parent.path.length+1<path.length;){const block=new Block_1.Block(txt,path.slice(0,parent.path.length+1),void 0);block.parent=parent,parent.children.push(block),parent=block}const block=new LeafBlock_1.LeafBlock(txt,path,marker);return block.parent=parent,parent.children.push(block),block}refreshBlocks(){this.root.children=[];let markerPoint,parent=this.root;const overlay=this.txt.overlay;this.insertBlock(parent,[0],void 0);const iterator=overlay.markers0(void 0);for(;markerPoint=iterator();){const type=markerPoint.type(),path=type instanceof Array?type:[type],block=this.insertBlock(parent,path,markerPoint);block.parent&&(parent=block.parent)}}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Inline.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Inline=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),stringify_1=__webpack_require__("./node_modules/json-joy/lib/json-text/stringify.js"),Range_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Range.js"),ChunkSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/util/ChunkSlice.js"),json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),MarkerOverlayPoint_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/MarkerOverlayPoint.js");class Inline extends Range_1.Range{static create(txt,start,end){const texts=[];return txt.overlay.chunkSlices0(void 0,start,end,(chunk,off,len)=>{txt.overlay.isMarker(chunk.id)||texts.push(new ChunkSlice_1.ChunkSlice(chunk,off,len))}),new Inline(txt.str,start,end,texts)}constructor(rga,start,end,texts){super(rga,start,end),this.start=start,this.end=end,this.texts=texts}key(){return(0,json_hash_1.updateNum)(this.start.refresh(),this.end.refresh())}pos(){const chunkSlice=this.texts[0];if(!chunkSlice)return-1;const chunk=chunkSlice.chunk;return this.rga.pos(chunk)+chunkSlice.off}getAttrPos(range){return range.start.cmp(range.end)?this.start.cmp(range.start)?this.end.cmp(range.end)?0:2:this.end.cmp(range.end)?1:3:4}stackAttr(attr,type,data,slice){let item=attr[type];item||(attr[type]=item=[[],this.getAttrPos(slice)]);(item[0]instanceof Array?item[0]:[]).push(data)}attr(){const attr={},point=this.start,slices1=point.layers,slices2=point.markers,length1=slices1.length,length3=length1+slices2.length;for(let i=0;i<length3;i++){const slice=i>=length1?slices2[i-length1]:slices1[i];if(slice instanceof Range_1.Range){const type=slice.type;switch(slice.behavior){case 4:this.stackAttr(attr,-1,[type,slice.data()],slice);break;case 1:this.stackAttr(attr,type,slice.data(),slice);break;case 2:{let data=slice.data();void 0===data&&(data=1),attr[type]=[data,this.getAttrPos(slice)];break}case 3:delete attr[type]}}}return attr}text(){const str=super.text();return this.start instanceof MarkerOverlayPoint_1.MarkerOverlayPoint?str.slice(1):str}toStringName(){return"Inline"}toString(tab=""){const str=this.text(),truncate=str.length>32,text=JSON.stringify(truncate?str.slice(0,32):str)+(truncate?" …":""),startFormatted=this.start.toString(tab,!0),header=`Inline ${0===this.start.cmp(this.end)?startFormatted:`${startFormatted} ↔ ${this.end.toString(tab,!0)}`} ${text}`,marks=this.attr(),markKeys=Object.keys(marks);return header+(0,printTree_1.printTree)(tab,[markKeys.length?tab=>"attributes"+(0,printTree_1.printTree)(tab,markKeys.map(key=>()=>key+" = "+(0,stringify_1.stringify)(marks[key]))):null,this.texts.length?tab=>"texts"+(0,printTree_1.printTree)(tab,this.texts.map(text=>tab=>text.toString(tab))):null])}}exports.Inline=Inline},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/LeafBlock.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LeafBlock=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),Block_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/block/Block.js");class LeafBlock extends Block_1.Block{toStringName(){return"LeafBlock"}toStringHeader(){const str=this.text(),truncate=str.length>32,text=JSON.stringify(truncate?str.slice(0,32):str)+(truncate?" …":"");return`${super.toStringHeader()} ${text}`}toString(tab=""){const header=this.toStringHeader(),texts=[...this.texts()],hasSlices=!!texts.length;return header+(0,printTree_1.printTree)(tab,[this.marker?tab=>this.marker.toString(tab):null,hasSlices?tab=>"nodes"+(0,printTree_1.printTree)(tab,texts.map(inline=>tab=>inline.toString(tab))):null])}}exports.LeafBlock=LeafBlock},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/constants.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SCHEMA=exports.MNEMONIC=void 0;const json_crdt_patch_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/index.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/constants.js");exports.MNEMONIC=constants_1.ExtensionName[2];exports.SCHEMA=text=>json_crdt_patch_1.s.vec(json_crdt_patch_1.s.str(text),json_crdt_patch_1.s.arr([]))},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/editor/Cursor.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Cursor=void 0;const json_crdt_patch_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/index.js"),PersistedSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js");class Cursor extends PersistedSlice_1.PersistedSlice{get anchorSide(){return this.type}set anchorSide(value){this.update({type:value})}anchor(){return 0===this.anchorSide?this.start:this.end}focus(){return 0===this.anchorSide?this.end:this.start}set(start,end=start,anchorSide=this.anchorSide){this.start=start,this.end=end===start?end.clone():end,this.update({range:this,type:anchorSide})}setEndpoint(point,endpoint=0){this.start===this.end&&(this.end=this.end.clone());let anchor=this.anchor(),focus=this.focus();0===endpoint?focus=point:anchor=point,focus.cmpSpatial(anchor)<0?this.set(focus,anchor,1):this.set(anchor,focus,0)}move(move){const{start,end}=this;start.move(move),start!==end&&end.move(move),this.set(start,end)}collapse(){if(this.txt.delStr(this)){const{start,rga}=this;1===start.anchor?this.setAfter(start.id):this.setAfter(start.prevId()||rga.id)}}insert(text){if(!text)return;this.collapse();const after=this.start.clone();after.refAfter();const textId=this.txt.ins(after.id,text),shift=text.length-1;this.setAfter(shift?(0,json_crdt_patch_1.tick)(textId,shift):textId)}delBwd(){if(this.isCollapsed()){const range=this.txt.findCharBefore(this.start);if(!range)return;this.set(range.start,range.end)}this.collapse()}toStringName(){return"Cursor"}toStringHeaderName(){const focusIcon=0===this.anchorSide?".→|":"|←.";return`${super.toStringHeaderName()}, ${focusIcon}`}}exports.Cursor=Cursor},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/editor/Editor.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Editor=void 0;const Cursor_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/editor/Cursor.js"),EditorSlices_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/editor/EditorSlices.js");exports.Editor=class Editor{constructor(txt){this.txt=txt,this.saved=new EditorSlices_1.EditorSlices(txt,txt.savedSlices),this.extra=new EditorSlices_1.EditorSlices(txt,txt.extraSlices),this.local=new EditorSlices_1.EditorSlices(txt,txt.localSlices)}firstCursor(){const iterator=this.txt.localSlices.iterator0();let cursor=iterator();for(;cursor;){if(cursor instanceof Cursor_1.Cursor)return cursor;cursor=iterator()}}get cursor(){const maybeCursor=this.firstCursor();if(maybeCursor)return maybeCursor;const txt=this.txt;return txt.localSlices.ins(txt.rangeAt(0),4,0,void 0,Cursor_1.Cursor)}cursors(callback){this.txt.localSlices.forEach(slice=>{slice instanceof Cursor_1.Cursor&&callback(slice)})}delCursors(){this.cursors(cursor=>this.local.del(cursor))}insert(text){let cnt=0;this.cursors(cursor=>{cnt++,cursor.insert(text)}),cnt||this.cursor.insert(text)}delBwd(){this.cursors(cursor=>cursor.delBwd())}selectAll(){const range=this.txt.rangeAll();return!!range&&(this.cursor.setRange(range),!0)}insStackSlice(type,data){const range=this.cursor.range();return this.txt.savedSlices.ins(range,1,type,data)}insOverwriteSlice(type,data){const range=this.cursor.range();return this.txt.savedSlices.ins(range,2,type,data)}insEraseSlice(type,data){const range=this.cursor.range();return this.txt.savedSlices.ins(range,3,type,data)}insMarker(type,data){return this.saved.insMarker(type,data,"\n")[0]}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/editor/EditorSlices.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EditorSlices=void 0;const PersistedSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js");exports.EditorSlices=class EditorSlices{constructor(txt,slices){this.txt=txt,this.slices=slices}insAtCursors(callback){const slices=[];return this.txt.editor.cursors(cursor=>{const slice=callback(cursor);slices.push(slice)}),slices}insStack(type,data){return this.insAtCursors(cursor=>this.slices.insStack(cursor.range(),type,data))}insOverwrite(type,data){return this.insAtCursors(cursor=>this.slices.insOverwrite(cursor.range(),type,data))}insErase(type,data){return this.insAtCursors(cursor=>this.slices.insErase(cursor.range(),type,data))}insMarker(type,data,separator){return this.insAtCursors(cursor=>{cursor.collapse();const after=cursor.start.clone();after.refAfter();return this.slices.insMarkerAfter(after.id,type,data,separator)})}del(sliceOrId){this.slices.del(sliceOrId instanceof PersistedSlice_1.PersistedSlice?sliceOrId.id:sliceOrId)}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.peritext=exports.Peritext=exports.PeritextApi=exports.PeritextNode=void 0;const PeritextNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/PeritextNode.js");Object.defineProperty(exports,"PeritextNode",{enumerable:!0,get:function(){return PeritextNode_1.PeritextNode}});const PeritextApi_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/PeritextApi.js");Object.defineProperty(exports,"PeritextApi",{enumerable:!0,get:function(){return PeritextApi_1.PeritextApi}});const Peritext_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/Peritext.js");Object.defineProperty(exports,"Peritext",{enumerable:!0,get:function(){return Peritext_1.Peritext}});const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/constants.js"),Extension_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/Extension.js");exports.peritext=new Extension_1.Extension(2,constants_1.MNEMONIC,PeritextNode_1.PeritextNode,PeritextApi_1.PeritextApi,text=>(0,constants_1.SCHEMA)(text))},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/MarkerOverlayPoint.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MarkerOverlayPoint=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),OverlayPoint_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/OverlayPoint.js");class MarkerOverlayPoint extends OverlayPoint_1.OverlayPoint{constructor(rga,id,anchor,marker){super(rga,id,anchor),this.rga=rga,this.marker=marker,this.textHash=0}type(){return this.marker&&this.marker.type}data(){return this.marker&&this.marker.data()}toStringName(){return"OverlayPoint"}toStringHeader(tab,lite){const hash=lite?"":`#${this.textHash.toString(36).slice(-4)}`,tag=lite?"":`, type = ${JSON.stringify(this.type())}`;return`${super.toStringHeader(tab,lite)}${lite?"":" "}${hash}${tag}`}toString(tab="",lite){return this.toStringHeader(tab,lite)+(lite?"":(0,printTree_1.printTree)(tab,[tab=>this.marker.toString(tab),...this.layers.map(slice=>tab=>slice.toString(tab)),...this.markers.map(slice=>tab=>slice.toString(tab))]))}}exports.MarkerOverlayPoint=MarkerOverlayPoint},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/Overlay.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Overlay=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),printBinary_1=__webpack_require__("./node_modules/tree-dump/lib/printBinary.js"),util_1=__webpack_require__("./node_modules/sonic-forest/lib/util/index.js"),util2_1=__webpack_require__("./node_modules/sonic-forest/lib/util2.js"),util_2=__webpack_require__("./node_modules/sonic-forest/lib/splay/util.js"),OverlayPoint_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/OverlayPoint.js"),MarkerOverlayPoint_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/MarkerOverlayPoint.js"),refs_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/refs.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),MarkerSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/MarkerSlice.js"),iterator_1=__webpack_require__("./node_modules/json-joy/lib/util/iterator.js"),spatialComparator=(a,b)=>a.cmpSpatial(b);exports.Overlay=class Overlay{constructor(txt){this.txt=txt,this.root=void 0,this.root2=void 0,this.hash=0,this.slices=new Map,this.leadingTextHash=0;const id=txt.str.id;this.START=this.point(id,1),this.END=this.point(id,0)}point(id,anchor){return new OverlayPoint_1.OverlayPoint(this.txt.str,id,anchor)}mPoint(marker,anchor){return new MarkerOverlayPoint_1.MarkerOverlayPoint(this.txt.str,marker.start.id,anchor,marker)}first(){return this.root?(0,util_1.first)(this.root):void 0}last(){return this.root?(0,util_1.last)(this.root):void 0}getOrNextLower(point){if(point.isAbsStart()){const first=this.first();if(!first)return;if(first.isAbsStart())return first;point=first}else if(point.isAbsEnd())return this.last();let result,curr=this.root;for(;curr;){const cmp=curr.cmpSpatial(point);if(0===cmp)return curr;if(cmp>0)curr=curr.l;else{const next=curr.r;if(result=curr,!next)return result;curr=next}}return result}getOrNextHigher(point){if(point.isAbsEnd()){const last=this.last();if(!last)return;if(last.isAbsEnd())return last;point=last}else if(point.isAbsStart())return this.first();let result,curr=this.root;for(;curr;){const cmp=curr.cmpSpatial(point);if(0===cmp)return curr;if(cmp<0)curr=curr.r;else{const next=curr.l;if(result=curr,!next)return result;curr=next}}return result}chunkSlices0(chunk,p1,p2,callback){const rga=this.txt.str,strId=rga.id;let checkFirstAnchor=1===p1.anchor;const adjustForLastAnchor=0===p2.anchor;let id1=p1.id;if(!(0,clock_1.compare)(id1,strId)){const first=rga.first();if(!first)return;id1=first.id,checkFirstAnchor=!1}const id2=p2.id;if(!checkFirstAnchor&&!adjustForLastAnchor)return rga.range0(chunk,id1,id2,callback);const sid1=id1.sid,time1=id1.time,sid2=id2.sid,time2=id2.time;return rga.range0(void 0,id1,id2,(chunk,off,len)=>{if(checkFirstAnchor){checkFirstAnchor=!1;const chunkId=chunk.id;if(chunkId.sid===sid1&&chunkId.time+off===time1){if(len<=1)return;off+=1,len-=1}}if(adjustForLastAnchor){const chunkId=chunk.id;if(chunkId.sid===sid2&&chunkId.time+off+len-1===time2){if(len<=1)return;len-=1}}callback(chunk,off,len)})}points0(after){let curr=after?(0,util_1.next)(after):this.first();return()=>{const ret=curr;return curr&&(curr=(0,util_1.next)(curr)),ret}}points(after){return new iterator_1.UndefEndIter(this.points0(after))}markers0(after){let curr=after?(0,util2_1.next2)(after):(0,util2_1.first2)(this.root2);return()=>{const ret=curr;return curr&&(curr=(0,util2_1.next2)(curr)),ret}}markers(){return new iterator_1.UndefEndIter(this.markers0(void 0))}pairs0(after){if(!this.root){const u=void 0;let closed=!1;return()=>closed?u:(closed=!0,[u,u])}let p1,p2=after;const iterator=this.points0(after);return()=>{const next=iterator();if(!next){if(!p2||p2.isAbsEnd())return;return p1=p2,p2=void 0,[p1,p2]}return p1=p2,p2=next,p1||p2&&p2.isAbsStart()&&(p1=p2,p2=iterator()),p1||p2?[p1,p2]:void 0}}pairs(after){return new iterator_1.UndefEndIter(this.pairs0(after))}tuples0(after){const iterator=this.pairs0(after);return()=>{const pair=iterator();if(pair)return pair[0]??(pair[0]=this.START),pair[1]??(pair[1]=this.END),pair}}tuples(after){return new iterator_1.UndefEndIter(this.tuples0(after))}find(predicate){let point=this.first();for(;point;){if(predicate(point))return point;point=(0,util_1.next)(point)}}findContained(range){const result=new Set;let point=this.getOrNextLower(range.start)??this.first();if(!point)return result;do{if(!range.containsPoint(point))continue;const slices=point.layers,length=slices.length;for(let i=0;i<length;i++){const slice=slices[i];!result.has(slice)&&range.contains(slice)&&result.add(slice)}if(point instanceof MarkerOverlayPoint_1.MarkerOverlayPoint){const marker=point.marker;marker&&!result.has(marker)&&range.contains(marker)&&result.add(marker)}}while(point&&(point=(0,util_1.next)(point))&&range.containsPoint(point));return result}findOverlapping(range){const result=new Set;let point=this.getOrNextLower(range.start)??this.first();if(!point)return result;do{const slices=point.layers,length=slices.length;for(let i=0;i<length;i++)result.add(slices[i]);if(point instanceof MarkerOverlayPoint_1.MarkerOverlayPoint){const marker=point.marker;marker&&result.add(marker)}}while(point&&(point=(0,util_1.next)(point))&&range.containsPoint(point));return result}isMarker(id){const p=this.txt.point(id,0),op=this.getOrNextLower(p);return op instanceof MarkerOverlayPoint_1.MarkerOverlayPoint&&op.id.time===id.time&&op.id.sid===id.sid}refresh(slicesOnly=!1){const txt=this.txt;let hash=5381;return hash=this.refreshSlices(hash,txt.savedSlices),hash=this.refreshSlices(hash,txt.extraSlices),hash=this.refreshSlices(hash,txt.localSlices),slicesOnly||(hash=this.refreshTextSlices(hash)),this.hash=hash}refreshSlices(state,slices){const changed=slices.hash!==slices.refresh(),sliceSet=this.slices;return state=(0,json_hash_1.updateNum)(state,slices.hash),changed&&(slices.forEach(slice=>{let tuple=sliceSet.get(slice);if(tuple){if(slice.isDel&&slice.isDel())return void this.delSlice(slice,tuple);if(!(0!==tuple[0].cmp(slice.start)||0!==tuple[1].cmp(slice.end)))return;this.delSlice(slice,tuple)}tuple=slice instanceof MarkerSlice_1.MarkerSlice?this.insMarker(slice):this.insSlice(slice),this.slices.set(slice,tuple)}),slices.size()<sliceSet.size&&sliceSet.forEach((tuple,slice)=>{const mutSlice=slice;if(mutSlice.isDel){if(!mutSlice.isDel())return;this.delSlice(slice,tuple)}})),state}insSlice(slice){const x0=slice.start,x1=slice.end,[start,isStartNew]=this.upsertPoint(x0),[end,isEndNew]=this.upsertPoint(x1),isCollapsed=0===x0.cmp(x1);if(start.refs.push(new refs_1.OverlayRefSliceStart(slice)),end.refs.push(new refs_1.OverlayRefSliceEnd(slice)),isStartNew){const beforeStartPoint=(0,util_1.prev)(start);beforeStartPoint&&start.layers.push(...beforeStartPoint.layers)}if(isCollapsed)start.addMarker(slice);else{if(isEndNew){const beforeEndPoint=(0,util_1.prev)(end);beforeEndPoint&&end.layers.push(...beforeEndPoint.layers)}let curr=start;do{curr.addLayer(slice)}while((curr=(0,util_1.next)(curr))&&curr!==end)}return[start,end]}insMarker(slice){const point=this.mPoint(slice,0);if(!this.insPoint(point)){point.refs.push(slice);const prevPoint=(0,util_1.prev)(point);prevPoint&&point.layers.push(...prevPoint.layers)}return[point,point]}delSlice(slice,[start,end]){this.slices.delete(slice);let curr=start;do{curr.removeLayer(slice),curr.removeMarker(slice),curr=(0,util_1.next)(curr)}while(curr&&curr!==end);start.removeRef(slice),end.removeRef(slice),start.refs.length||this.delPoint(start),end.refs.length||start===end||this.delPoint(end)}upsertPoint(point){const newPoint=this.point(point.id,point.anchor),pivot=this.insPoint(newPoint);return pivot?[pivot,!1]:[newPoint,!0]}insPoint(point){point instanceof MarkerOverlayPoint_1.MarkerOverlayPoint&&(this.root2=(0,util2_1.insert2)(this.root2,point,spatialComparator));let pivot=this.getOrNextLower(point);if(pivot||(pivot=(0,util_1.first)(this.root)),pivot){if(0===pivot.cmp(point))return pivot;pivot.cmpSpatial(point)<0?(0,util_1.insertRight)(point,pivot):(0,util_1.insertLeft)(point,pivot);this.root!==point&&(this.root=(0,util_2.splay)(this.root,point,10))}else this.root=point}delPoint(point){point instanceof MarkerOverlayPoint_1.MarkerOverlayPoint&&(this.root2=(0,util2_1.remove2)(this.root2,point)),this.root=(0,util_1.remove)(this.root,point)}refreshTextSlices(stateTotal){const firstChunk=this.txt.str.first();if(!firstChunk)return stateTotal;let marker,chunk=firstChunk;const i=this.tuples0(void 0);let state=5381;for(let pair=i();pair;pair=i()){const[p1,p2]=pair,id1=p1.id;state=(state<<5)+state+(id1.sid>>>0)+id1.time;let overlayPointHash=5381;chunk=this.chunkSlices0(chunk||firstChunk,p1,p2,(chunk,off,len)=>{const id=chunk.id;overlayPointHash=(overlayPointHash<<5)+overlayPointHash+(((id.sid>>>0)+id.time<<8)+(off<<4)+len)}),state=(0,json_hash_1.updateNum)(state,overlayPointHash),p1.hash=overlayPointHash,stateTotal=(0,json_hash_1.updateNum)(stateTotal,overlayPointHash),p2 instanceof MarkerOverlayPoint_1.MarkerOverlayPoint&&(marker?marker.textHash=state:this.leadingTextHash=state,stateTotal=(0,json_hash_1.updateNum)(stateTotal,state),state=5381,marker=p2)}return marker instanceof MarkerOverlayPoint_1.MarkerOverlayPoint?marker.textHash=state:this.leadingTextHash=state,stateTotal}toString(tab=""){const printPoint=(tab,point)=>point.toString(tab)+(0,printBinary_1.printBinary)(tab,[point.l?tab=>printPoint(tab,point.l):null,point.r?tab=>printPoint(tab,point.r):null]),printMarkerPoint=(tab,point)=>point.toString(tab)+(0,printBinary_1.printBinary)(tab,[point.l2?tab=>printMarkerPoint(tab,point.l2):null,point.r2?tab=>printMarkerPoint(tab,point.r2):null]);return`Overlay #${this.hash.toString(36)}`+(0,printTree_1.printTree)(tab,[this.root?tab=>printPoint(tab,this.root):null,this.root2?tab=>printMarkerPoint(tab,this.root2):null])}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/OverlayPoint.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OverlayPoint=void 0;const Point_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Point.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),refs_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/refs.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js");class OverlayPoint extends Point_1.Point{constructor(){super(...arguments),this.hash=0,this.layers=[],this.markers=[],this.refs=[],this.p=void 0,this.l=void 0,this.r=void 0}addLayer(slice){const layers=this.layers,length=layers.length;if(!length)return void layers.push(slice);const lastSlice=layers[length-1],sliceId=slice.id,cmp=(0,clock_1.compare)(lastSlice.id,sliceId);if(cmp<0)layers.push(slice);else if(cmp){for(let i=length-2;i>=0;i--){const currSlice=layers[i],cmp=(0,clock_1.compare)(currSlice.id,sliceId);if(cmp<0)return void layers.splice(i+1,0,slice);if(!cmp)return}layers.unshift(slice)}}removeLayer(slice){const layers=this.layers,length=layers.length;for(let i=0;i<length;i++)if(layers[i]===slice)return void layers.splice(i,1)}addMarker(slice){const markers=this.markers,length=markers.length;if(!length)return void markers.push(slice);const lastSlice=markers[length-1],sliceId=slice.id,cmp=(0,clock_1.compare)(lastSlice.id,sliceId);if(cmp<0)markers.push(slice);else if(cmp){for(let i=length-2;i>=0;i--){const currSlice=markers[i],cmp=(0,clock_1.compare)(currSlice.id,sliceId);if(cmp<0)return void markers.splice(i+1,0,slice);if(!cmp)return}markers.unshift(slice)}}removeMarker(slice){const markers=this.markers,length=markers.length;for(let i=0;i<length;i++)if(markers[i]===slice)return void markers.splice(i,1)}addMarkerRef(slice){this.refs.push(slice),this.addMarker(slice)}addLayerStartRef(slice){this.refs.push(new refs_1.OverlayRefSliceStart(slice)),this.addLayer(slice)}addLayerEndRef(slice){this.refs.push(new refs_1.OverlayRefSliceEnd(slice))}removeRef(slice){const refs=this.refs,length=refs.length;for(let i=0;i<length;i++){const ref=refs[i];if(ref===slice)return refs.splice(i,1),void this.removeMarker(slice);if(ref instanceof refs_1.OverlayRefSliceStart&&ref.slice===slice||ref instanceof refs_1.OverlayRefSliceEnd&&ref.slice===slice)return refs.splice(i,1),void this.removeLayer(slice)}}toStringName(){return"OverlayPoint"}toStringHeader(tab="",lite){return super.toString(tab,lite)}toString(tab="",lite){const refs=lite?"":`, refs = ${this.refs.length}`,header=this.toStringHeader(tab,lite)+refs;if(lite)return header;const children=[],layers=this.layers,layerLength=layers.length;for(let i=0;i<layerLength;i++)children.push(tab=>layers[i].toString(tab));const markers=this.markers,markerLength=markers.length;for(let i=0;i<markerLength;i++)children.push(tab=>markers[i].toString(tab));return header+(0,printTree_1.printTree)(tab,children)}}exports.OverlayPoint=OverlayPoint},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/overlay/refs.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OverlayRefSliceEnd=exports.OverlayRefSliceStart=void 0;exports.OverlayRefSliceStart=class OverlayRefSliceStart{constructor(slice){this.slice=slice}};exports.OverlayRefSliceEnd=class OverlayRefSliceEnd{constructor(slice){this.slice=slice}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Point.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Point=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),ChunkSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/util/ChunkSlice.js"),hash_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/hash.js");class Point{constructor(rga,id,anchor){this.rga=rga,this.id=id,this.anchor=anchor}set(point){this.id=point.id,this.anchor=point.anchor}clone(){return new Point(this.rga,this.id,this.anchor)}cmp(other){const cmp=(0,clock_1.compare)(this.id,other.id);return 0!==cmp?cmp:this.anchor-other.anchor}cmpSpatial(other){const thisId=this.id,otherId=other.id;if(this.isAbs()){return 1===this.anchor?other.isAbsStart()?0:-1:other.isAbsEnd()?0:1}if(other.isAbs()){return 1===other.anchor?this.isAbsStart()?0:1:this.isAbsEnd()?0:-1}const cmp0=(0,clock_1.compare)(thisId,otherId);if(!cmp0)return this.anchor-other.anchor;const cmp1=this.pos()-other.pos();if(cmp1)return cmp1;let chunk=this.chunk();if(!chunk)return cmp0;if((0,clock_1.containsId)(chunk.id,chunk.span,otherId))return thisId.time-otherId.time;const rga=this.rga;for(chunk=rga.next(chunk);chunk;){if((0,clock_1.containsId)(chunk.id,chunk.span,otherId))return-1;chunk=rga.next(chunk)}return 1}chunk(){let chunk=this._chunk;const id=this.id;if(chunk){const chunkId=chunk.id,chunkIdTime=chunkId.time,idTime=id.time;if(id.sid===chunkId.sid&&idTime>=chunkIdTime&&idTime<chunkIdTime+chunk.span)return chunk}return this._chunk=chunk=this.rga.findById(this.id),chunk}pos(){const chunk=this.chunk();if(!chunk)return this.isAbsEnd()?9007199254740991:-1;const pos=this.rga.pos(chunk);return chunk.del?pos:pos+this.id.time-chunk.id.time}viewPos(){const pos=this.pos();return(0,clock_1.equal)(this.rga.id,this.id)?1===this.anchor?0:this.rga.length():0===this.anchor?pos:pos+1}nextId(move=1){if(this.isAbsEnd())return;let remaining=move;const{id,rga}=this;let chunk,lastVisibleChunk;if(this.isAbsStart()){for(chunk=rga.first();chunk&&chunk.del;)chunk=rga.next(chunk);if(!chunk)return;const span=chunk.span;if(remaining<=span)return(0,clock_1.tick)(chunk.id,remaining-1);remaining-=span,chunk=rga.next(chunk)}else{if(chunk=this.chunk(),!chunk)return;if(!chunk.del){const offset=id.time-chunk.id.time,span=chunk.span;if(offset+remaining<span)return(0,clock_1.tick)(id,remaining);remaining-=span-offset-1}chunk=rga.next(chunk)}for(;chunk&&remaining>=0;){if(chunk.del){chunk=rga.next(chunk);continue}lastVisibleChunk=chunk;const span=chunk.span;if(remaining<=span)return remaining>1?(0,clock_1.tick)(chunk.id,remaining-1):chunk.id;remaining-=span,chunk=rga.next(chunk)}return remaining>0?void 0:lastVisibleChunk?(0,clock_1.tick)(lastVisibleChunk.id,lastVisibleChunk.span-1):void 0}prevId(move=1){if(this.isAbsStart())return;let remaining=move;const{id,rga}=this;let chunk=this.chunk();if(!chunk)return rga.id;if(!chunk.del){const offset=id.time-chunk.id.time;if(offset>=remaining)return(0,clock_1.tick)(id,-remaining);remaining-=offset}for(chunk=rga.prev(chunk);chunk;){if(chunk.del){chunk=rga.prev(chunk);continue}const span=chunk.span;if(remaining<=span)return(0,clock_1.tick)(chunk.id,span-remaining);remaining-=span,chunk=rga.prev(chunk)}}leftChar(){const rga=this.rga;if(this.isAbsEnd()){const res=rga.findChunk(rga.length()-1);if(!res)return;return new ChunkSlice_1.ChunkSlice(res[0],res[1],1)}const tmp=this.clone();if(tmp.refAfter(),tmp.isAbsStart())return;const chunk=tmp.chunk();if(!chunk||chunk.del)return;const off=tmp.id.time-chunk.id.time;return new ChunkSlice_1.ChunkSlice(chunk,off,1)}rightChar(){const rga=this.rga;if(this.isAbsStart()){const res=rga.findChunk(0);if(!res)return;return new ChunkSlice_1.ChunkSlice(res[0],res[1],1)}const tmp=this.clone();if(tmp.refBefore(),tmp.isAbsEnd())return;const chunk=tmp.chunk();if(!chunk||chunk.del)return;const off=tmp.id.time-chunk.id.time;return new ChunkSlice_1.ChunkSlice(chunk,off,1)}isAbs(){return(0,clock_1.equal)(this.id,this.rga.id)}isAbsStart(){return this.isAbs()&&1===this.anchor}isAbsEnd(){return this.isAbs()&&0===this.anchor}isRelStart(){if(0!==this.anchor)return!1;const id=this.rga.find(0);return!!id&&(0,clock_1.equal)(this.id,id)}isRelEnd(){if(1!==this.anchor)return!1;const rga=this.rga,length=rga.length();if(0===length)return!1;const id=rga.find(length-1);return!!id&&(0,clock_1.equal)(this.id,id)}refAbsStart(){this.id=this.rga.id,this.anchor=1}refAbsEnd(){this.id=this.rga.id,this.anchor=0}refStart(){return this.refAbsStart(),this.refBefore(),this}refEnd(){return this.refAbsEnd(),this.refAfter(),this}refBefore(){const chunk=this.chunk();if(!chunk){if(this.isAbsStart()){const id=this.rga.find(0);if(id)return this.id=id,void(this.anchor=0)}return this.refAbsEnd()}(chunk.del||0!==this.anchor)&&(this.anchor=0,this.id=this.nextId()||this.rga.id)}refAfter(){const chunk=this.chunk();if(!chunk){if(this.isAbsEnd()){const rga=this.rga,length=rga.length();if(0!==length){const id=rga.find(length-1);if(id)return this.id=id,void(this.anchor=1)}}return this.refAbsStart()}(chunk.del||1!==this.anchor)&&(this.anchor=1,this.id=this.prevId()||this.rga.id)}refVisible(){0===this.anchor?this.refBefore():this.refAfter()}move(skip){if(!skip)return;const anchor=this.anchor;if(1!==anchor&&this.refAfter(),skip>0){const nextId=this.nextId(skip);nextId?(this.id=nextId,1!==anchor&&this.refBefore()):this.refAbsEnd()}else{const prevId=this.prevId(-skip);prevId?(this.id=prevId,1!==anchor&&this.refBefore()):this.refAbsStart()}}refresh(){return(0,hash_1.updateId)(this.anchor,this.id)}toStringName(){return"Point"}toString(tab="",lite){const name=lite?"":this.toStringName()+" ",pos=this.pos();return`${name}{ ${9007199254740991===pos?"∞":pos}, ${(0,clock_1.printTs)(this.id)}, ${0===this.anchor?".▢":"▢."} }`}}exports.Point=Point},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Range.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Range=void 0;const Point_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Point.js"),json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js");class Range{static from(rga,p1,p2){return p1.cmpSpatial(p2)>0?new Range(rga,p2,p1):new Range(rga,p1,p2)}static at(rga,start,size=0){const length=rga.length();if(!size){start>length&&(start=length);const startId=start&&rga.find(start-1)||rga.id,point=new Point_1.Point(rga,startId,1);return new Range(rga,point,point.clone())}if(size<0&&(start-=size=-size),start<0&&(size+=start,start=0,size<0))return Range.at(rga,start,0);start>=length&&(start=length,size=0),start+size>length&&(size=length-start);const startId=rga.find(start)||rga.id,endId=rga.find(start+size-1)||startId,startEndpoint=new Point_1.Point(rga,startId,0),endEndpoint=new Point_1.Point(rga,endId,1);return new Range(rga,startEndpoint,endEndpoint)}constructor(rga,start,end){this.rga=rga,this.start=start,this.end=end}range(){return new Range(this.rga,this.start.clone(),this.end.clone())}cmp(range){return this.start.cmp(range.start)||this.end.cmp(range.end)}cmpSpatial(range){return this.start.cmpSpatial(range.start)||this.end.cmpSpatial(range.end)}isCollapsed(){const{start,end}=this;if(0===start.cmpSpatial(end))return!0;const start2=start.clone(),end2=end.clone();return start2.refAfter(),end2.refAfter(),0===start2.cmp(end2)}contains(range){return this.start.cmpSpatial(range.start)<=0&&this.end.cmpSpatial(range.end)>=0}containsPoint(point){return this.start.cmpSpatial(point)<=0&&this.end.cmpSpatial(point)>=0}set(start,end=start){this.start=start,this.end=end===start?end.clone():end}setRange(range){this.set(range.start,range.end)}setAt(start,length=0){const range=Range.at(this.rga,start,length);this.setRange(range)}setAfter(id){const point=new Point_1.Point(this.rga,id,1);this.set(point)}collapseToStart(){const start=this.start.clone();start.refAfter();const end=start.clone();this.set(start,end)}collapseToEnd(){const end=this.end.clone();end.refAfter();const start=this.end.clone();this.set(start,end)}expand(){this.start.refAfter(),this.end.refBefore()}view(){const start=this.start.viewPos();return[start,this.end.viewPos()-start]}length(){return this.end.viewPos()-this.start.viewPos()}text(){if(this.isCollapsed())return"";const{start,end}=this,rga=this.rga,startId=0===start.anchor?start.id:start.nextId(),endId=1===end.anchor?end.id:end.prevId();if(!startId||!endId)return"";let result="";return rga.range0(start.chunk(),startId,endId,(chunk,from,length)=>{const data=chunk.data;data&&(result+=data.slice(from,from+length))}),result}refresh(){let state=this.start.refresh();return state=(0,json_hash_1.updateNum)(state,this.end.refresh()),state}toStringName(){return"Range"}toString(tab="",lite=!0){const name=lite?"":this.toStringName(),start=this.start.toString(tab,lite),end=this.end.toString(tab,lite);let text=this.text();return text.length>16&&(text=text.slice(0,16)+"..."),`${JSON.stringify(text)} ${name}${start} ↔ ${end}`}}exports.Range=Range},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/ExtraSlices.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExtraSlices=void 0;const Slices_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/Slices.js");class ExtraSlices extends Slices_1.Slices{toStringName(){return"ExtraSlices"}}exports.ExtraSlices=ExtraSlices},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/LocalSlices.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.LocalSlices=void 0;const Slices_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/Slices.js");class LocalSlices extends Slices_1.Slices{del(id){super.del(id),Math.random()<.1&&this.set.removeTombstones()}toStringName(){return"LocalSlices"}}exports.LocalSlices=LocalSlices},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/MarkerSlice.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MarkerSlice=void 0;const PersistedSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js");class MarkerSlice extends PersistedSlice_1.PersistedSlice{}exports.MarkerSlice=MarkerSlice},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PersistedSlice=void 0;const hasOwnProperty_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/hasOwnProperty.js"),Point_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Point.js"),Range_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/rga/Range.js"),hash_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/hash.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/constants.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),json_pretty_1=__webpack_require__("./node_modules/json-joy/lib/json-pretty/index.js"),util_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/util.js"),json_crdt_patch_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/index.js");class PersistedSlice extends Range_1.Range{static deserialize(model,txt,chunk,tuple){const header=+tuple.get(0).view(),id1=tuple.get(1).view(),id2=tuple.get(2).view()||id1,type=tuple.get(3).view();if("number"!=typeof header)throw new Error("INVALID_HEADER");if(!(id1 instanceof clock_1.Timestamp))throw new Error("INVALID_ID");if(!(id2 instanceof clock_1.Timestamp))throw new Error("INVALID_ID");(0,util_1.validateType)(type);const anchor1=(1&header)>>>0,anchor2=(2&header)>>>1,behavior=(28&header)>>>2,rga=txt.str,p1=new Point_1.Point(rga,id1,anchor1),p2=new Point_1.Point(rga,id2,anchor2);return new PersistedSlice(model,txt,chunk,tuple,behavior,type,p1,p2)}constructor(model,txt,chunk,tuple,behavior,type,start,end){super(txt.str,start,end),this.model=model,this.txt=txt,this.chunk=chunk,this.tuple=tuple,this.start=start,this.end=end,this.hash=0,this.rga=txt.str,this.id=chunk.id,this.behavior=behavior,this.type=type}isSplit(){return 0===this.behavior}tupleApi(){return this.model.api.wrap(this.tuple)}set(start,end=start){super.set(start,end),this.update({range:this})}expand(){super.expand(),this.update({range:this})}update(params){let updateHeader=!1;const changes=[];if(void 0!==params.behavior&&(this.behavior=params.behavior,updateHeader=!0),params.range){const range=params.range;updateHeader=!0,changes.push([1,json_crdt_patch_1.s.con(range.start.id)],[2,json_crdt_patch_1.s.con(range.end.id)]),this.start=range.start,this.end=range.start===range.end?range.end.clone():range.end}if(void 0!==params.type&&(this.type=params.type,changes.push([3,json_crdt_patch_1.s.con(this.type)])),(0,hasOwnProperty_1.hasOwnProperty)(params,"data")&&changes.push([4,params.data]),updateHeader){const header=(this.behavior<<2)+(this.start.anchor|0)+(this.end.anchor<<1);changes.push([0,json_crdt_patch_1.s.con(header)])}this.tupleApi().set(changes)}data(){return this.tuple.get(4)?.view()}dataNode(){const node=this.tuple.get(4);return node&&this.model.api.wrap(node)}isDel(){return this.chunk.del}refresh(){let state=5381;state=(0,hash_1.updateNode)(state,this.tuple);const changed=state!==this.hash;if(this.hash=state,changed){const tuple=this.tuple,slice=PersistedSlice.deserialize(this.model,this.txt,this.chunk,tuple);this.behavior=slice.behavior,this.type=slice.type,this.start=slice.start,this.end=slice.end}return this.hash}toStringName(){return"Range"}toStringHeaderName(){const data=this.data(),dataFormatted=data?(0,json_pretty_1.prettyOneLine)(data):"∅";return`${this.toStringName()} ${super.toString("",!0)}, ${constants_1.SliceBehaviorName[this.behavior]}, ${JSON.stringify(this.type)}${dataFormatted.length<32?`, ${dataFormatted}`:""}`}toStringHeader(tab=""){const data=this.data(),dataFormatted=data?(0,json_pretty_1.prettyOneLine)(data):"";return this.toStringHeaderName()+(0,printTree_1.printTree)(tab,[dataFormatted.length<32?null:tab=>dataFormatted])}}exports.PersistedSlice=PersistedSlice},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/Slices.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Slices=void 0;const AvlMap_1=__webpack_require__("./node_modules/sonic-forest/lib/avl/AvlMap.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),PersistedSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),hash_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/hash.js"),json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),MarkerSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/MarkerSlice.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js");exports.Slices=class Slices{constructor(txt,set){this.txt=txt,this.set=set,this.list=new AvlMap_1.AvlMap(clock_1.compare),this._topologyHash=0,this.hash=0,this.rga=txt.str}ins(range,behavior,type,data,Klass=(0===behavior?MarkerSlice_1.MarkerSlice:PersistedSlice_1.PersistedSlice)){const slicesModel=this.set.doc,set=this.set,api=slicesModel.api,builder=api.builder,tupleId=builder.vec(),start=range.start.clone(),end=range.end.clone(),header=(behavior<<2)+(start.anchor|0)+(end.anchor<<1),tupleKeysUpdate=[[0,builder.const(header)],[1,builder.const(start.id)],[2,builder.const(0===(0,clock_1.compare)(start.id,end.id)?0:end.id)],[3,builder.const(type)]];void 0!==data&&tupleKeysUpdate.push([4,builder.json(data)]),builder.insVec(tupleId,tupleKeysUpdate);const chunkId=builder.insArr(set.id,set.id,[tupleId]);api.apply();const tuple=slicesModel.index.get(tupleId),chunk=set.findById(chunkId),slice=new Klass(slicesModel,this.txt,chunk,tuple,behavior,type,start,end);return this.list.set(chunk.id,slice),slice}insMarker(range,type,data){return this.ins(range,0,type,data)}insMarkerAfter(after,type,data,separator="\n"){const txt=this.txt,api=txt.model.api,builder=api.builder;builder.nop(1);const textId=builder.insStr(txt.str.id,after,separator);api.apply();const point=txt.point(textId,0),range=txt.range(point,point.clone());return this.insMarker(range,type,data)}insStack(range,type,data){return this.ins(range,1,type,data)}insOverwrite(range,type,data){return this.ins(range,2,type,data)}insErase(range,type,data){return this.ins(range,3,type,data)}unpack(chunk){const txt=this.txt,model=this.set.doc,tupleId=chunk.data?chunk.data[0]:void 0;if(!tupleId)throw new Error("SLICE_NOT_FOUND");const tuple=model.index.get(tupleId);if(!(tuple instanceof nodes_1.VecNode))throw new Error("NOT_TUPLE");let slice=PersistedSlice_1.PersistedSlice.deserialize(model,txt,chunk,tuple);return slice.isSplit()&&(slice=new MarkerSlice_1.MarkerSlice(model,txt,chunk,tuple,slice.behavior,slice.type,slice.start,slice.end)),slice}get(id){return this.list.get(id)}del(id){this.list.del(id);const set=this.set,api=set.doc.api;api.builder.del(set.id,[(0,clock_1.tss)(id.sid,id.time,1)]),api.apply()}delSlices(slices){const set=this.set,api=set.doc.api,spans=[];for(const slice of slices)if(slice instanceof PersistedSlice_1.PersistedSlice){const id=slice.id;if(!set.findById(id))continue;spans.push(new clock_1.Timespan(id.sid,id.time,1))}return!!spans.length&&(api.builder.del(this.set.id,spans),api.apply(),!0)}size(){return this.list._size}iterator0(){const iterator=this.list.iterator0();return()=>iterator()?.v}forEach(callback){this.list.forEach(node=>callback(node.v))}refresh(){const topologyHash=(0,hash_1.updateRga)(5381,this.set);if(topologyHash!==this._topologyHash){let chunk;this._topologyHash=topologyHash;for(const iterator=this.set.iterator();chunk=iterator();){const item=this.list.get(chunk.id);chunk.del?item&&this.list.del(chunk.id):item||this.list.set(chunk.id,this.unpack(chunk))}}let hash=topologyHash;return this.list.forEach(({v:item})=>{item.refresh(),hash=(0,json_hash_1.updateNum)(hash,item.hash)}),this.hash=hash}toStringName(){return"Slices"}toString(tab=""){return this.toString()+(0,printTree_1.printTree)(tab,[...this.list.entries()].map(({v})=>tab=>v.toString(tab)))}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/constants.js":(__unused_webpack_module,exports)=>{"use strict";var SliceBehaviorName;Object.defineProperty(exports,"__esModule",{value:!0}),exports.SliceBehaviorName=void 0,function(SliceBehaviorName){SliceBehaviorName[SliceBehaviorName.Marker=0]="Marker",SliceBehaviorName[SliceBehaviorName.Stack=1]="Stack",SliceBehaviorName[SliceBehaviorName.Overwrite=2]="Overwrite",SliceBehaviorName[SliceBehaviorName.Erase=3]="Erase",SliceBehaviorName[SliceBehaviorName.Cursor=4]="Cursor"}(SliceBehaviorName||(exports.SliceBehaviorName=SliceBehaviorName={}))},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.validateType=void 0;exports.validateType=type=>{switch(typeof type){case"string":case"number":return;case"object":{if(!(type instanceof Array))throw new Error("INVALID_TYPE");if(type.length>32)throw new Error("INVALID_TYPE");const length=type.length;LOOP:for(let i=0;i<length;i++){switch(typeof type[i]){case"string":case"number":continue LOOP;default:throw new Error("INVALID_TYPE")}}return}default:throw new Error("INVALID_TYPE")}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/util/ChunkSlice.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ChunkSlice=void 0;const json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),hash_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/hash.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.ChunkSlice=class ChunkSlice{constructor(chunk,off,len){this.off=off,this.len=len,this.hash=0,this.chunk=chunk}id(){const id=this.chunk.id,off=this.off;return off?new clock_1.Timestamp(id.sid,id.time+off):id}key(){const id=this.chunk.id,sid=id.sid,time=id.time+this.off;return sid.toString(36)+time.toString(36)}view(){const offset=this.off;return this.chunk.view().slice(offset,offset+this.len)}refresh(){const{chunk,off,len}=this,delOffLenState=((off<<16)+len<<1)+ +chunk.del;let state=5381;return state=(0,hash_1.updateId)(state,chunk.id),state=(0,json_hash_1.updateNum)(state,delOffLenState),this.hash=state}toString(tab=""){const off=this.off,len=this.len,str=this.view()+"",truncate=str.length>32,view=JSON.stringify(truncate?str.slice(0,32):str)+(truncate?" …":"");return`ChunkSlice ${(0,clock_1.printTs)(this.chunk.id)} [${off}..${off+len}) ${view}`}}},"./node_modules/json-joy/lib/json-crdt-extensions/peritext/util/commonLength.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.commonLength=void 0;exports.commonLength=(a,b)=>{let i=0;for(;i<a.length&&i<b.length&&a[i]===b[i];)i++;return i}},"./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/QuillDeltaApi.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.QuillDeltaApi=void 0;const nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/nodes.js"),Konst_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/Konst.js"),PersistedSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js"),util_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/util.js"),updateAttributes=(txt,attributes,pos,len)=>{if(!attributes)return;const range=txt.rangeAt(pos,len),keys=Object.keys(attributes),length=keys.length,savedSlices=txt.savedSlices;for(let i=0;i<length;i++){const key=keys[i],value=attributes[key];null===value?savedSlices.ins(range,3,key):savedSlices.ins(range,2,key,(0,Konst_1.konst)(value))}},rewriteAttributes=(txt,attributes,pos,len)=>{if("object"!=typeof attributes)return;const range=txt.rangeAt(pos,len);range.expand();const slices=txt.overlay.findOverlapping(range),length=slices.size,relevantOverlappingButNotContained=new Set;if(length){const savedSlices=txt.savedSlices;slices.forEach(slice=>{if(slice instanceof PersistedSlice_1.PersistedSlice){if(!range.contains(slice))return void relevantOverlappingButNotContained.add(slice.type);slice.type in attributes&&savedSlices.del(slice.id)}})}const keys=Object.keys(attributes),attributeLength=keys.length,attributesCopy={...attributes};for(let i=0;i<attributeLength;i++){const key=keys[i];null!==attributes[key]||relevantOverlappingButNotContained.has(key)||delete attributesCopy[key]}updateAttributes(txt,attributesCopy,pos,len)},maybeUpdateAttributes=(txt,attributes,pos,len)=>{const range=txt.rangeAt(pos,1),overlayPoint=txt.overlay.getOrNextLower(range.start);if(!overlayPoint&&!attributes)return;if(!overlayPoint)return void updateAttributes(txt,(0,util_1.removeErasures)(attributes),pos,len);const pointAttributes=(0,util_1.getAttributes)(overlayPoint),attributeDiff=(0,util_1.diffAttributes)(pointAttributes,attributes);attributeDiff&&updateAttributes(txt,attributeDiff,pos,len)};class QuillDeltaApi extends nodes_1.NodeApi{text(){return this.api.wrap(this.node.text())}slices(){return this.api.wrap(this.node.slices())}apply(ops){const txt=this.node.txt,overlay=txt.overlay,length=ops.length;let pos=0;for(let i=0;i<length;i++){overlay.refresh(!0);const op=ops[i];if("number"==typeof op.retain){const{retain,attributes}=op;attributes&&rewriteAttributes(txt,attributes,pos,retain),pos+=retain}else if("number"==typeof op.delete)txt.delAt(pos,op.delete);else if(op.insert){const{insert}=op;let{attributes}=op;if("string"==typeof insert){txt.insAt(pos,insert);const insertLength=insert.length;maybeUpdateAttributes(txt,attributes,pos,insertLength),pos+=insertLength}else txt.insAt(pos,"\n"),attributes||(attributes={}),attributes[0]=insert,maybeUpdateAttributes(txt,attributes,pos,1),pos+=1}}}}exports.QuillDeltaApi=QuillDeltaApi},"./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/QuillDeltaNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.QuillDeltaNode=void 0;const isEmpty_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/isEmpty.js"),deepEqual_1=__webpack_require__("./node_modules/json-joy/lib/json-equal/deepEqual/index.js"),peritext_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/index.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/constants.js"),ExtNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js"),util_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/util.js"),hash_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/hash.js");class QuillDeltaNode extends ExtNode_1.ExtNode{constructor(data){super(data),this.data=data,this.extId=3,this._view=[],this._viewHash=-1,this.txt=new peritext_1.Peritext(data.doc,this.text(),this.slices())}text(){return this.data.get(0)}slices(){return this.data.get(1)}name(){return constants_1.MNEMONIC}view(){const overlay=this.txt.overlay,hash=(0,hash_1.updateRga)(overlay.refresh(!0),this.txt.str);if(hash===this._viewHash)return this._view;const ops=[];let chunk;const nextTuple=overlay.tuples0(void 0);let tuple;for(;tuple=nextTuple();){const[p1,p2]=tuple,attributes=(0,util_1.getAttributes)(p1);let insert="";if(chunk=overlay.chunkSlices0(chunk,p1,p2,(chunk,off,len)=>{const data=chunk.data;data&&(insert+=data.slice(off,off+len))}),insert){if("\n"===insert&&attributes&&attributes[0]){const op={insert:attributes[0]};delete attributes[0],(0,isEmpty_1.isEmpty)(attributes)||(op.attributes=attributes),ops.push(op);continue}{const lastOp=ops[ops.length-1];if(lastOp&&"string"==typeof lastOp.insert&&(0,deepEqual_1.deepEqual)(lastOp.attributes,attributes)){lastOp.insert+=insert;continue}}const op={insert};attributes&&(op.attributes=attributes),ops.push(op)}}return this._viewHash=hash,this._view=ops,ops}}exports.QuillDeltaNode=QuillDeltaNode},"./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/constants.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MNEMONIC=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/constants.js");exports.MNEMONIC=constants_1.ExtensionName[3]},"./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.quill=exports.QuillDeltaApi=exports.QuillDeltaNode=void 0;const QuillDeltaNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/QuillDeltaNode.js");Object.defineProperty(exports,"QuillDeltaNode",{enumerable:!0,get:function(){return QuillDeltaNode_1.QuillDeltaNode}});const QuillDeltaApi_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/QuillDeltaApi.js");Object.defineProperty(exports,"QuillDeltaApi",{enumerable:!0,get:function(){return QuillDeltaApi_1.QuillDeltaApi}});const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/constants.js"),Extension_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/Extension.js"),constants_2=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/constants.js");exports.quill=new Extension_1.Extension(3,constants_1.MNEMONIC,QuillDeltaNode_1.QuillDeltaNode,QuillDeltaApi_1.QuillDeltaApi,text=>(0,constants_2.SCHEMA)(text))},"./node_modules/json-joy/lib/json-crdt-extensions/quill-delta/util.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.diffAttributes=exports.removeErasures=exports.getAttributes=void 0;const isEmpty_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/isEmpty.js"),PersistedSlice_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/peritext/slice/PersistedSlice.js");exports.getAttributes=overlayPoint=>{const layers=overlayPoint.layers,layerLength=layers.length;if(!layerLength)return;const attributes={};for(let i=0;i<layerLength;i++){const slice=layers[i];if(slice instanceof PersistedSlice_1.PersistedSlice)switch(slice.behavior){case 2:{const tag=slice.type;tag&&(attributes[tag]=slice.data());break}case 3:{const tag=slice.type;tag&&delete attributes[tag];break}}}return(0,isEmpty_1.isEmpty)(attributes)?void 0:attributes};exports.removeErasures=attr=>{if(!attr)return;const keys=Object.keys(attr),length=keys.length;if(!length)return;const cleaned={};for(let i=0;i<length;i++){const key=keys[i],value=attr[key];null!==value&&(cleaned[key]=value)}return(0,isEmpty_1.isEmpty)(cleaned)?void 0:cleaned};exports.diffAttributes=(oldAttributes,newAttributes)=>{if(!oldAttributes)return(0,exports.removeErasures)(newAttributes);if(!newAttributes)return(attr=>{if(!attr)return;const keys=Object.keys(attr),length=keys.length;if(!length)return;const erased={};for(let i=0;i<length;i++)erased[keys[i]]=null;return erased})(oldAttributes);const diff={},keys=Object.keys(newAttributes),length=keys.length;for(let i=0;i<length;i++){const key=keys[i],newValue=newAttributes[key];newValue!==oldAttributes[key]&&(diff[key]=newValue)}const oldKeys=Object.keys(oldAttributes),oldLength=oldKeys.length;for(let i=0;i<oldLength;i++){const key=oldKeys[i];null==newAttributes[key]&&(diff[key]=null)}return(0,isEmpty_1.isEmpty)(diff)?void 0:diff}},"./node_modules/json-joy/lib/json-crdt-patch/Patch.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Patch=void 0;const operations=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/operations.js")),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),binary_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/binary/index.js");class Patch{constructor(){this.ops=[],this.meta=void 0}static fromBinary(data){return(0,binary_1.decode)(data)}getId(){const op=this.ops[0];if(op)return op.id}span(){let span=0;for(const op of this.ops)span+=op.span();return span}nextTime(){const ops=this.ops,length=ops.length;if(!length)return 0;const lastOp=ops[length-1];return lastOp.id.time+lastOp.span()}rewriteTime(ts){const patch=new Patch,ops=this.ops,length=ops.length,patchOps=patch.ops;for(let i=0;i<length;i++){const op=ops[i];op instanceof operations.DelOp?patchOps.push(new operations.DelOp(ts(op.id),ts(op.obj),op.what)):op instanceof operations.NewConOp?patchOps.push(new operations.NewConOp(ts(op.id),op.val instanceof clock_1.Timestamp?ts(op.val):op.val)):op instanceof operations.NewVecOp?patchOps.push(new operations.NewVecOp(ts(op.id))):op instanceof operations.NewValOp?patchOps.push(new operations.NewValOp(ts(op.id))):op instanceof operations.NewObjOp?patchOps.push(new operations.NewObjOp(ts(op.id))):op instanceof operations.NewStrOp?patchOps.push(new operations.NewStrOp(ts(op.id))):op instanceof operations.NewBinOp?patchOps.push(new operations.NewBinOp(ts(op.id))):op instanceof operations.NewArrOp?patchOps.push(new operations.NewArrOp(ts(op.id))):op instanceof operations.InsArrOp?patchOps.push(new operations.InsArrOp(ts(op.id),ts(op.obj),ts(op.ref),op.data.map(ts))):op instanceof operations.InsStrOp?patchOps.push(new operations.InsStrOp(ts(op.id),ts(op.obj),ts(op.ref),op.data)):op instanceof operations.InsBinOp?patchOps.push(new operations.InsBinOp(ts(op.id),ts(op.obj),ts(op.ref),op.data)):op instanceof operations.InsValOp?patchOps.push(new operations.InsValOp(ts(op.id),ts(op.obj),ts(op.val))):op instanceof operations.InsObjOp?patchOps.push(new operations.InsObjOp(ts(op.id),ts(op.obj),op.data.map(([key,value])=>[key,ts(value)]))):op instanceof operations.InsVecOp?patchOps.push(new operations.InsVecOp(ts(op.id),ts(op.obj),op.data.map(([key,value])=>[key,ts(value)]))):op instanceof operations.NopOp&&patchOps.push(new operations.NopOp(ts(op.id),op.len))}return patch}rebase(newTime,transformAfter){const id=this.getId();if(!id)throw new Error("EMPTY_PATCH");const sid=id.sid,patchStartTime=id.time;if(transformAfter??(transformAfter=patchStartTime),patchStartTime===newTime)return this;const delta=newTime-patchStartTime;return this.rewriteTime(id=>{if(id.sid!==sid)return id;const time=id.time;return time<transformAfter?id:(0,clock_1.ts)(sid,time+delta)})}clone(){return this.rewriteTime(id=>id)}toBinary(){return(0,binary_1.encode)(this)}toString(tab=""){const id=this.getId();return`Patch ${id?(0,clock_1.printTs)(id):"(nil)"}!${this.span()}`+(0,printTree_1.printTree)(tab,this.ops.map(op=>tab=>op.toString(tab)))}}exports.Patch=Patch},"./node_modules/json-joy/lib/json-crdt-patch/PatchBuilder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PatchBuilder=void 0;const operations_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/operations.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),isUint8Array_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/buffers/isUint8Array.js"),Patch_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/Patch.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/constants.js"),Tuple_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/Tuple.js"),Konst_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/Konst.js"),DelayedValueBuilder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/DelayedValueBuilder.js"),maybeConst=x=>{switch(typeof x){case"number":case"boolean":return!0;default:return null===x}};exports.PatchBuilder=class PatchBuilder{constructor(clock){this.clock=clock,this.patch=new Patch_1.Patch}nextTime(){return this.patch.nextTime()||this.clock.time}flush(){const patch=this.patch;return this.patch=new Patch_1.Patch,patch}obj(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewObjOp(id)),id}arr(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewArrOp(id)),id}vec(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewVecOp(id)),id}str(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewStrOp(id)),id}bin(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewBinOp(id)),id}const(value){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewConOp(id,value)),id}val(){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.NewValOp(id)),id}root(val){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.InsValOp(id,constants_1.ORIGIN,val)),id}insObj(obj,data){if(this.pad(),!data.length)throw new Error("EMPTY_TUPLES");const id=this.clock.tick(1),op=new operations_1.InsObjOp(id,obj,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}insVec(obj,data){if(this.pad(),!data.length)throw new Error("EMPTY_TUPLES");const id=this.clock.tick(1),op=new operations_1.InsVecOp(id,obj,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}setVal(obj,val){this.pad();const id=this.clock.tick(1),op=new operations_1.InsValOp(id,obj,val);return this.patch.ops.push(op),id}insStr(obj,ref,data){if(this.pad(),!data.length)throw new Error("EMPTY_STRING");const id=this.clock.tick(1),op=new operations_1.InsStrOp(id,obj,ref,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}insBin(obj,ref,data){if(this.pad(),!data.length)throw new Error("EMPTY_BINARY");const id=this.clock.tick(1),op=new operations_1.InsBinOp(id,obj,ref,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}insArr(arr,ref,data){this.pad();const id=this.clock.tick(1),op=new operations_1.InsArrOp(id,arr,ref,data),span=op.span();return span>1&&this.clock.tick(span-1),this.patch.ops.push(op),id}del(obj,what){this.pad();const id=this.clock.tick(1);return this.patch.ops.push(new operations_1.DelOp(id,obj,what)),id}nop(span){this.pad();const id=this.clock.tick(span);return this.patch.ops.push(new operations_1.NopOp(id,span)),id}jsonObj(obj){const id=this.obj(),keys=Object.keys(obj);if(keys.length){const tuples=[];for(const k of keys){const value=obj[k],valueId=value instanceof clock_1.Timestamp?value:maybeConst(value)?this.const(value):this.json(value);tuples.push([k,valueId])}this.insObj(id,tuples)}return id}jsonArr(arr){const id=this.arr();if(arr.length){const values=[];for(const el of arr)values.push(this.json(el));this.insArr(id,id,values)}return id}jsonStr(str){const id=this.str();return str&&this.insStr(id,id,str),id}jsonBin(bin){const id=this.bin();return bin.length&&this.insBin(id,id,bin),id}jsonVal(value){const valId=this.val(),id=this.const(value);return this.setVal(valId,id),valId}jsonVec(vector){const id=this.vec(),length=vector.length;if(length){const writes=[];for(let i=0;i<length;i++)writes.push([i,this.constOrJson(vector[i])]);this.insVec(id,writes)}return id}json(json){if(json instanceof clock_1.Timestamp)return json;if(void 0===json)return this.const(json);if(json instanceof Array)return this.jsonArr(json);if((0,isUint8Array_1.isUint8Array)(json))return this.jsonBin(json);if(json instanceof Tuple_1.VectorDelayedValue)return this.jsonVec(json.slots);if(json instanceof Konst_1.Konst)return this.const(json.val);if(json instanceof DelayedValueBuilder_1.NodeBuilder)return json.build(this);switch(typeof json){case"object":return null===json?this.jsonVal(json):this.jsonObj(json);case"string":return this.jsonStr(json);case"number":case"boolean":return this.jsonVal(json)}throw new Error("INVALID_JSON")}constOrJson(value){return value instanceof clock_1.Timestamp?value:maybeConst(value)?this.const(value):this.json(value)}maybeConst(value){return value instanceof clock_1.Timestamp?value:this.const(value)}pad(){const nextTime=this.patch.nextTime();if(!nextTime)return;const drift=this.clock.time-nextTime;if(drift>0){const id=(0,clock_1.ts)(this.clock.sid,nextTime),padding=new operations_1.NopOp(id,drift);this.patch.ops.push(padding)}}}},"./node_modules/json-joy/lib/json-crdt-patch/builder/DelayedValueBuilder.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.delayed=exports.NodeBuilder=void 0;class NodeBuilder{constructor(build){this.build=build}}exports.NodeBuilder=NodeBuilder;exports.delayed=build=>new NodeBuilder(build)},"./node_modules/json-joy/lib/json-crdt-patch/builder/Konst.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.konst=exports.Konst=void 0;class Konst{constructor(val){this.val=val}}exports.Konst=Konst;exports.konst=val=>new Konst(val)},"./node_modules/json-joy/lib/json-crdt-patch/builder/Tuple.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.vec=exports.VectorDelayedValue=void 0;class VectorDelayedValue{constructor(slots){this.slots=slots}}exports.VectorDelayedValue=VectorDelayedValue;exports.vec=(...slots)=>new VectorDelayedValue(slots)},"./node_modules/json-joy/lib/json-crdt-patch/builder/schema.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.s=exports.schema=exports.nodes=void 0;const DelayedValueBuilder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/DelayedValueBuilder.js");var nodes;!function(nodes){class con extends DelayedValueBuilder_1.NodeBuilder{constructor(raw){super(builder=>builder.const(raw)),this.raw=raw,this.type="con"}}nodes.con=con;class str extends DelayedValueBuilder_1.NodeBuilder{constructor(raw){super(builder=>builder.json(raw)),this.raw=raw,this.type="str"}}nodes.str=str;class bin extends DelayedValueBuilder_1.NodeBuilder{constructor(raw){super(builder=>builder.json(raw)),this.raw=raw,this.type="bin"}}nodes.bin=bin;class val extends DelayedValueBuilder_1.NodeBuilder{constructor(value){super(builder=>{const valId=builder.val(),valueId=value.build(builder);return builder.setVal(valId,valueId),valId}),this.value=value,this.type="val"}}nodes.val=val;class vec extends DelayedValueBuilder_1.NodeBuilder{constructor(value){super(builder=>{const vecId=builder.vec(),length=value.length;if(length){const elementPairs=[];for(let i=0;i<length;i++){const elementId=value[i].build(builder);elementPairs.push([i,elementId])}builder.insVec(vecId,elementPairs)}return vecId}),this.value=value,this.type="vec"}}nodes.vec=vec;class obj extends DelayedValueBuilder_1.NodeBuilder{constructor(obj,opt){super(builder=>{const objId=builder.obj(),keyValuePairs=[],merged={...obj,...opt},keys=Object.keys(merged),length=keys.length;if(length){for(let i=0;i<length;i++){const key=keys[i],valueId=merged[key].build(builder);keyValuePairs.push([key,valueId])}builder.insObj(objId,keyValuePairs)}return objId}),this.obj=obj,this.opt=opt,this.type="obj"}optional(){return this}}nodes.obj=obj;class arr extends DelayedValueBuilder_1.NodeBuilder{constructor(arr){super(builder=>{const arrId=builder.arr(),length=arr.length;if(length){const valueIds=[];for(let i=0;i<length;i++)valueIds.push(arr[i].build(builder));builder.insArr(arrId,arrId,valueIds)}return arrId}),this.arr=arr,this.type="arr"}}nodes.arr=arr;class json extends DelayedValueBuilder_1.NodeBuilder{constructor(value){super(builder=>builder.json(value)),this.value=value,this.type="json"}}nodes.json=json;class jsonCon extends DelayedValueBuilder_1.NodeBuilder{constructor(value){super(builder=>builder.constOrJson(value)),this.value=value,this.type="jsonCon"}}nodes.jsonCon=jsonCon;class ext extends DelayedValueBuilder_1.NodeBuilder{constructor(id,data){super(builder=>{const buf=new Uint8Array([id,0,0]),tupleId=builder.vec();return buf[1]=tupleId.sid%256,buf[2]=tupleId.time%256,builder.insVec(tupleId,[[0,builder.constOrJson(exports.s.con(buf))],[1,data.build(builder)]]),tupleId}),this.id=id,this.data=data,this.type="ext"}}nodes.ext=ext}(nodes||(exports.nodes=nodes={})),exports.schema={con:raw=>new nodes.con(raw),str:str=>new nodes.str(str||""),bin:bin=>new nodes.bin(bin),val:val=>new nodes.val(val),vec:(...vec)=>new nodes.vec(vec),obj:(obj,opt)=>new nodes.obj(obj,opt),map:obj=>exports.schema.obj(obj),arr:arr=>new nodes.arr(arr),json:value=>new nodes.json(value),jsonCon:value=>new nodes.jsonCon(value),ext:(id,data)=>new nodes.ext(id,data)},exports.s=exports.schema},"./node_modules/json-joy/lib/json-crdt-patch/clock/clock.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ServerClockVector=exports.ClockVector=exports.LogicalClock=exports.interval=exports.printTs=exports.containsId=exports.contains=exports.compare=exports.equal=exports.tick=exports.tss=exports.ts=exports.Timespan=exports.Timestamp=void 0;class Timestamp{constructor(sid,time){this.sid=sid,this.time=time}}exports.Timestamp=Timestamp;class Timespan{constructor(sid,time,span){this.sid=sid,this.time=time,this.span=span}}exports.Timespan=Timespan;exports.ts=(sid,time)=>new Timestamp(sid,time);exports.tss=(sid,time,span)=>new Timespan(sid,time,span);exports.tick=(stamp,cycles)=>(0,exports.ts)(stamp.sid,stamp.time+cycles);exports.equal=(ts1,ts2)=>ts1.time===ts2.time&&ts1.sid===ts2.sid;exports.compare=(ts1,ts2)=>{const t1=ts1.time,t2=ts2.time;if(t1>t2)return 1;if(t1<t2)return-1;const s1=ts1.sid,s2=ts2.sid;return s1>s2?1:s1<s2?-1:0};exports.contains=(ts1,span1,ts2,span2)=>{if(ts1.sid!==ts2.sid)return!1;const t1=ts1.time,t2=ts2.time;return!(t1>t2)&&!(t1+span1<t2+span2)};exports.containsId=(ts1,span1,ts2)=>{if(ts1.sid!==ts2.sid)return!1;const t1=ts1.time,t2=ts2.time;return!(t1>t2)&&!(t1+span1<t2+1)};exports.printTs=id=>{if(1===id.sid)return"."+id.time;let session=""+id.sid;return session.length>4&&(session=".."+session.slice(session.length-4)),session+"."+id.time};exports.interval=(ts,tick,span)=>new Timespan(ts.sid,ts.time+tick,span);class LogicalClock extends Timestamp{tick(cycles){const timestamp=new Timestamp(this.sid,this.time);return this.time+=cycles,timestamp}}exports.LogicalClock=LogicalClock;class ClockVector extends LogicalClock{constructor(){super(...arguments),this.peers=new Map}observe(id,span){const edge=id.time+span-1,sid=id.sid;if(sid!==this.sid){const clock=this.peers.get(id.sid);clock?edge>clock.time&&(clock.time=edge):this.peers.set(id.sid,(0,exports.ts)(sid,edge))}edge>=this.time&&(this.time=edge+1)}clone(){return this.fork(this.sid)}fork(sessionId){const clock=new ClockVector(sessionId,this.time);return sessionId!==this.sid&&clock.observe((0,exports.tick)(this,-1),1),this.peers.forEach(peer=>{clock.observe(peer,1)}),clock}toString(tab=""){const last=this.peers.size;let i=1,lines="";return this.peers.forEach(clock=>{lines+=`\n${tab}${i===last?"└─":"├─"} ${clock.sid}.${clock.time}`,i++}),`clock ${this.sid}.${this.time}${lines}`}}exports.ClockVector=ClockVector;class ServerClockVector extends LogicalClock{constructor(){super(...arguments),this.peers=new Map}observe(ts,span){if(ts.sid>8)throw new Error("INVALID_SERVER_SESSION");if(this.time<ts.time)throw new Error("TIME_TRAVEL");const time=ts.time+span;time>this.time&&(this.time=time)}clone(){return this.fork()}fork(){return new ServerClockVector(1,this.time)}toString(){return`clock ${this.sid}.${this.time}`}}exports.ServerClockVector=ServerClockVector},"./node_modules/json-joy/lib/json-crdt-patch/clock/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/clock.js"),exports)},"./node_modules/json-joy/lib/json-crdt-patch/clock/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/lib/json-crdt-patch/codec/binary/Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Decoder=void 0;const CrdtReader_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtReader.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),PatchBuilder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/PatchBuilder.js"),CborDecoder_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborDecoder.js");class Decoder extends CborDecoder_1.CborDecoder{constructor(reader=new CrdtReader_1.CrdtReader){super(reader)}decode(data){return this.reader.reset(data),this.readPatch()}readPatch(){const reader=this.reader,sid=reader.vu57(),time=reader.vu57(),clock=1===sid?new clock_1.ServerClockVector(1,time):new clock_1.ClockVector(sid,time);this.patchSid=clock.sid;const builder=this.builder=new PatchBuilder_1.PatchBuilder(clock),map=this.val();return map instanceof Array&&(builder.patch.meta=map[0]),this.decodeOperations(),builder.patch}decodeId(){const reader=this.reader,[isSessionDifferent,x]=reader.b1vu56();return isSessionDifferent?new clock_1.Timestamp(reader.vu57(),x):new clock_1.Timestamp(this.patchSid,x)}decodeTss(){const id=this.decodeId(),span=this.reader.vu57();return(0,clock_1.interval)(id,0,span)}decodeOperations(){const length=this.reader.vu57();for(let i=0;i<length;i++)this.decodeOperation()}decodeOperation(){const builder=this.builder,reader=this.reader,octet=reader.u8();switch(octet>>3){case 0:{const length=7&octet;builder.const(length?this.decodeId():this.val());break}case 1:builder.val();break;case 2:builder.obj();break;case 3:builder.vec();break;case 4:builder.str();break;case 5:builder.bin();break;case 6:builder.arr();break;case 9:{const obj=this.decodeId(),val=this.decodeId();builder.setVal(obj,val);break}case 10:{const length=7&octet||reader.vu57(),obj=this.decodeId(),tuples=[];for(let i=0;i<length;i++){const key=this.val();if("string"!=typeof key)continue;const value=this.decodeId();tuples.push([key,value])}builder.insObj(obj,tuples);break}case 11:{const length=7&octet||reader.vu57(),obj=this.decodeId(),tuples=[];for(let i=0;i<length;i++){const index=this.val();if("number"!=typeof index)continue;const value=this.decodeId();tuples.push([index,value])}builder.insVec(obj,tuples);break}case 12:{const length=7&octet||reader.vu57(),obj=this.decodeId(),after=this.decodeId(),str=reader.utf8(length);builder.insStr(obj,after,str);break}case 13:{const length=7&octet||reader.vu57(),obj=this.decodeId(),after=this.decodeId(),buf=reader.buf(length);if(!(buf instanceof Uint8Array))return;builder.insBin(obj,after,buf);break}case 14:{const length=7&octet||reader.vu57(),obj=this.decodeId(),after=this.decodeId(),elements=[];for(let i=0;i<length;i++)elements.push(this.decodeId());builder.insArr(obj,after,elements);break}case 16:{const length=7&octet||reader.vu57(),obj=this.decodeId(),what=[];for(let i=0;i<length;i++)what.push(this.decodeTss());builder.del(obj,what);break}case 17:{const length=7&octet||reader.vu57();builder.nop(length);break}default:throw new Error("UNKNOWN_OP")}}}exports.Decoder=Decoder},"./node_modules/json-joy/lib/json-crdt-patch/codec/binary/Encoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Encoder=void 0;const operations=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/operations.js")),CrdtWriter_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtWriter.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),CborEncoder_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborEncoder.js");class Encoder extends CborEncoder_1.CborEncoder{constructor(writer=new CrdtWriter_1.CrdtWriter){super(writer),this.writer=writer,this.patchSid=0}encode(patch){this.writer.reset();const id=patch.getId(),sid=this.patchSid=id.sid,writer=this.writer;writer.vu57(sid),writer.vu57(id.time);const meta=patch.meta;return void 0===meta?this.writeUndef():this.writeArr([meta]),this.encodeOperations(patch),writer.flush()}encodeOperations(patch){const ops=patch.ops,length=ops.length;this.writer.vu57(length);for(let i=0;i<length;i++)this.encodeOperation(ops[i])}encodeId(id){const sessionId=id.sid,time=id.time,writer=this.writer;sessionId===this.patchSid?writer.b1vu56(0,time):(writer.b1vu56(1,time),writer.vu57(sessionId))}encodeTss(span){this.encodeId(span),this.writer.vu57(span.span)}writeInsStr(length,obj,ref,str){const writer=this.writer;return length<=7?writer.u8(96+length):(writer.u8(96),writer.vu57(length)),this.encodeId(obj),this.encodeId(ref),writer.utf8(str)}encodeOperation(op){const writer=this.writer;switch(op.constructor){case operations.NewConOp:{const val=op.val;val instanceof clock_1.Timestamp?(writer.u8(1),this.encodeId(val)):(writer.u8(0),this.writeAny(val));break}case operations.NewValOp:writer.u8(8);break;case operations.NewObjOp:writer.u8(16);break;case operations.NewVecOp:writer.u8(24);break;case operations.NewStrOp:writer.u8(32);break;case operations.NewBinOp:writer.u8(40);break;case operations.NewArrOp:writer.u8(48);break;case operations.InsValOp:{const operation=op;writer.u8(72),this.encodeId(operation.obj),this.encodeId(operation.val);break}case operations.InsObjOp:{const operation=op,data=operation.data,length=data.length;length<=7?writer.u8(80+length):(writer.u8(80),writer.vu57(length)),this.encodeId(operation.obj);for(let i=0;i<length;i++){const tuple=data[i];this.writeStr(tuple[0]),this.encodeId(tuple[1])}break}case operations.InsVecOp:{const operation=op,data=operation.data,length=data.length;length<=7?writer.u8(88+length):(writer.u8(88),writer.vu57(length)),this.encodeId(operation.obj);for(let i=0;i<length;i++){const tuple=data[i];writer.u8(tuple[0]),this.encodeId(tuple[1])}break}case operations.InsStrOp:{const operation=op,obj=operation.obj,ref=operation.ref,str=operation.data,len1=str.length;writer.ensureCapacity(24+4*len1);const x=writer.x,len2=this.writeInsStr(len1,obj,ref,str);len1!==len2&&(writer.x=x,this.writeInsStr(len2,obj,ref,str));break}case operations.InsBinOp:{const operation=op,buf=operation.data,length=buf.length;length<=7?writer.u8(104+length):(writer.u8(104),writer.vu57(length)),this.encodeId(operation.obj),this.encodeId(operation.ref),writer.buf(buf,length);break}case operations.InsArrOp:{const operation=op,elements=operation.data,length=elements.length;length<=7?writer.u8(112+length):(writer.u8(112),writer.vu57(length)),this.encodeId(operation.obj),this.encodeId(operation.ref);for(let i=0;i<length;i++)this.encodeId(elements[i]);break}case operations.DelOp:{const operation=op,what=operation.what,length=what.length;length<=7?writer.u8(128+length):(writer.u8(128),writer.vu57(length)),this.encodeId(operation.obj);for(let i=0;i<length;i++)this.encodeTss(what[i]);break}case operations.NopOp:{const length=op.len;length<=7?writer.u8(136+length):(writer.u8(136),writer.vu57(length));break}default:throw new Error("UNKNOWN_OP")}}}exports.Encoder=Encoder},"./node_modules/json-joy/lib/json-crdt-patch/codec/binary/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/binary/Encoder.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/binary/Decoder.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/binary/shared.js"),exports)},"./node_modules/json-joy/lib/json-crdt-patch/codec/binary/shared.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decode=exports.decoder=exports.encode=exports.encoder=void 0;const Encoder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/binary/Encoder.js"),Decoder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/binary/Decoder.js"),writer=new(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtWriter.js").CrdtWriter)(4096);exports.encoder=new Encoder_1.Encoder(writer);exports.encode=patch=>exports.encoder.encode(patch),exports.decoder=new Decoder_1.Decoder;exports.decode=buf=>exports.decoder.decode(buf)},"./node_modules/json-joy/lib/json-crdt-patch/codec/clock/ClockDecoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClockDecoder=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");class ClockDecoder{static fromArr(arr){const decoder=new ClockDecoder(arr[0],arr[1]),length=arr.length;for(let i=2;i<length;i+=2)decoder.pushTuple(arr[i],arr[i+1]);return decoder}constructor(sid,time){this.table=[],this.clock=new clock_1.ClockVector(sid,time+1),this.table.push((0,clock_1.ts)(sid,time))}pushTuple(sid,time){const id=(0,clock_1.ts)(sid,time);this.clock.observe(id,1),this.table.push(id)}decodeId(sessionIndex,timeDiff){if(!sessionIndex)return(0,clock_1.ts)(0,timeDiff);const clock=this.table[sessionIndex-1];if(!clock)throw new Error("INVALID_CLOCK_TABLE");return(0,clock_1.ts)(clock.sid,clock.time-timeDiff)}}exports.ClockDecoder=ClockDecoder},"./node_modules/json-joy/lib/json-crdt-patch/codec/clock/ClockEncoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ClockEncoder=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),RelativeTimestamp_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/clock/RelativeTimestamp.js");class ClockTableEntry{constructor(index,clock){this.index=index,this.clock=clock}}exports.ClockEncoder=class ClockEncoder{constructor(){this.table=new Map,this.index=1,this.clock=null}reset(clock){this.index=1,this.clock=clock;const entry=new ClockTableEntry(this.index++,(0,clock_1.tick)(clock,-1));this.table.clear(),this.table.set(clock.sid,entry)}append(ts){const time=ts.time,sid=ts.sid;let entry=this.table.get(sid);if(!entry){let clock=this.clock.peers.get(sid);clock||(clock=new clock_1.Timestamp(sid,this.clock.time-1)),entry=new ClockTableEntry(this.index++,clock),this.table.set(sid,entry)}const timeDiff=entry.clock.time-time;if(timeDiff<0)throw new Error("TIME_TRAVEL");return new RelativeTimestamp_1.RelativeTimestamp(entry.index,timeDiff)}toJson(){const out=[];return this.table.forEach(entry=>{const clock=entry.clock;out.push(clock.sid,clock.time)}),out}}},"./node_modules/json-joy/lib/json-crdt-patch/codec/clock/RelativeTimestamp.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RelativeTimestamp=void 0;exports.RelativeTimestamp=class RelativeTimestamp{constructor(sessionIndex,timeDiff){this.sessionIndex=sessionIndex,this.timeDiff=timeDiff}}},"./node_modules/json-joy/lib/json-crdt-patch/constants.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ORIGIN=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.ORIGIN=(0,clock_1.ts)(0,0)},"./node_modules/json-joy/lib/json-crdt-patch/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/operations.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/Patch.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/PatchBuilder.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/schema.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/Konst.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/Tuple.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/builder/DelayedValueBuilder.js"),exports)},"./node_modules/json-joy/lib/json-crdt-patch/operations.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NopOp=exports.DelOp=exports.InsArrOp=exports.InsBinOp=exports.InsStrOp=exports.InsVecOp=exports.InsObjOp=exports.InsValOp=exports.NewArrOp=exports.NewBinOp=exports.NewStrOp=exports.NewVecOp=exports.NewObjOp=exports.NewValOp=exports.NewConOp=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.NewConOp=class NewConOp{constructor(id,val){this.id=id,this.val=val}span(){return 1}name(){return"new_con"}toString(tab=""){const val=this.val,valFormatted=val instanceof clock_1.Timestamp?`{ ${(0,clock_1.printTs)(val)} }`:val instanceof Uint8Array?val.length<13?`Uint8Array { ${(""+val).replaceAll(",",", ")} }`:`Uint8Array(${val.length})`:`{ ${JSON.stringify(val)} }`;return`${this.name()} ${(0,clock_1.printTs)(this.id)} ${valFormatted}`}};exports.NewValOp=class NewValOp{constructor(id){this.id=id}span(){return 1}name(){return"new_val"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}`}};exports.NewObjOp=class NewObjOp{constructor(id){this.id=id}span(){return 1}name(){return"new_obj"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}`}};exports.NewVecOp=class NewVecOp{constructor(id){this.id=id}span(){return 1}name(){return"new_vec"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}`}};exports.NewStrOp=class NewStrOp{constructor(id){this.id=id}span(){return 1}name(){return"new_str"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}`}};exports.NewBinOp=class NewBinOp{constructor(id){this.id=id}span(){return 1}name(){return"new_bin"}toString(tab=""){return`${this.name()} ${(0,clock_1.printTs)(this.id)}`}};exports.NewArrOp=class NewArrOp{constructor(id){this.id=id}span(){return 1}name(){return"new_arr"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}`}};exports.InsValOp=class InsValOp{constructor(id,obj,val){this.id=id,this.obj=obj,this.val=val}span(){return 1}name(){return"ins_val"}toString(tab=""){return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.span()}, obj = ${(0,clock_1.printTs)(this.obj)}, val = ${(0,clock_1.printTs)(this.val)}`}};exports.InsObjOp=class InsObjOp{constructor(id,obj,data){this.id=id,this.obj=obj,this.data=data}span(){return 1}name(){return"ins_obj"}toString(tab=""){return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.span()}, obj = ${(0,clock_1.printTs)(this.obj)}`+(0,printTree_1.printTree)(tab,this.data.map(item=>tab=>`${JSON.stringify(item[0])}: ${(0,clock_1.printTs)(item[1])}`))}};exports.InsVecOp=class InsVecOp{constructor(id,obj,data){this.id=id,this.obj=obj,this.data=data}span(){return 1}name(){return"ins_vec"}toString(tab=""){return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.span()}, obj = ${(0,clock_1.printTs)(this.obj)}`+(0,printTree_1.printTree)(tab,this.data.map(item=>tab=>`${item[0]}: ${(0,clock_1.printTs)(item[1])}`))}};exports.InsStrOp=class InsStrOp{constructor(id,obj,ref,data){this.id=id,this.obj=obj,this.ref=ref,this.data=data}span(){return this.data.length}name(){return"ins_str"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.span()}, obj = ${(0,clock_1.printTs)(this.obj)} { ${(0,clock_1.printTs)(this.ref)} ← ${JSON.stringify(this.data)} }`}};exports.InsBinOp=class InsBinOp{constructor(id,obj,ref,data){this.id=id,this.obj=obj,this.ref=ref,this.data=data}span(){return this.data.length}name(){return"ins_bin"}toString(tab=""){const ref=(0,clock_1.printTs)(this.ref);return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.span()}, obj = ${(0,clock_1.printTs)(this.obj)} { ${ref} ← ${this.data} }`}};exports.InsArrOp=class InsArrOp{constructor(id,obj,ref,data){this.id=id,this.obj=obj,this.ref=ref,this.data=data}span(){return this.data.length}name(){return"ins_arr"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.span()}, obj = ${(0,clock_1.printTs)(this.obj)} { ${(0,clock_1.printTs)(this.ref)} ← ${this.data.map(clock_1.printTs).join(", ")} }`}};exports.DelOp=class DelOp{constructor(id,obj,what){this.id=id,this.obj=obj,this.what=what}span(){return 1}name(){return"del"}toString(){const spans=this.what.map(span=>(0,clock_1.printTs)(span)+"!"+span.span).join(", ");return`${this.name()} ${(0,clock_1.printTs)(this.id)}, obj = ${(0,clock_1.printTs)(this.obj)} { ${spans} }`}};exports.NopOp=class NopOp{constructor(id,len){this.id=id,this.len=len}span(){return this.len}name(){return"nop"}toString(){return`${this.name()} ${(0,clock_1.printTs)(this.id)}!${this.len}`}}},"./node_modules/json-joy/lib/json-crdt-patch/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtReader.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CrdtReader=void 0;const Reader_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/buffers/Reader.js");class CrdtReader extends Reader_1.Reader{id(){const byte=this.u8();return byte<=127?[byte>>>4,15&byte]:(this.x--,[this.b1vu56()[1],this.vu57()])}idSkip(){this.u8()<=127||(this.x--,this.b1vu56(),this.vu57Skip())}vu57(){const o1=this.u8();if(o1<=127)return o1;const o2=this.u8();if(o2<=127)return o2<<7|127&o1;const o3=this.u8();if(o3<=127)return o3<<14|(127&o2)<<7|127&o1;const o4=this.u8();if(o4<=127)return o4<<21|(127&o3)<<14|(127&o2)<<7|127&o1;const o5=this.u8();if(o5<=127)return 268435456*o5+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1);const o6=this.u8();if(o6<=127)return 34359738368*o6+(268435456*(127&o5)+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1));const o7=this.u8();if(o7<=127)return 4398046511104*o7+(34359738368*(127&o6)+(268435456*(127&o5)+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1)));return 562949953421312*this.u8()+(4398046511104*(127&o7)+(34359738368*(127&o6)+(268435456*(127&o5)+((127&o4)<<21|(127&o3)<<14|(127&o2)<<7|127&o1))))}vu57Skip(){if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;if(this.u8()<=127)return;this.u8()<=127||this.x++}b1vu56(){const byte=this.u8(),flag=128&byte?1:0,o1=127&byte;if(o1<=63)return[flag,o1];const o2=this.u8();if(o2<=127)return[flag,o2<<6|63&o1];const o3=this.u8();if(o3<=127)return[flag,o3<<13|(127&o2)<<6|63&o1];const o4=this.u8();if(o4<=127)return[flag,o4<<20|(127&o3)<<13|(127&o2)<<6|63&o1];const o5=this.u8();if(o5<=127)return[flag,134217728*o5+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1)];const o6=this.u8();if(o6<=127)return[flag,17179869184*o6+(134217728*(127&o5)+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1))];const o7=this.u8();if(o7<=127)return[flag,2199023255552*o7+(17179869184*(127&o6)+(134217728*(127&o5)+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1)))];return[flag,281474976710656*this.u8()+(2199023255552*(127&o7)+(17179869184*(127&o6)+(134217728*(127&o5)+((127&o4)<<20|(127&o3)<<13|(127&o2)<<6|63&o1))))]}}exports.CrdtReader=CrdtReader},"./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtWriter.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.CrdtWriter=void 0;const Writer_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/buffers/Writer.js");class CrdtWriter extends Writer_1.Writer{id(x,y){x<=7&&y<=15?this.u8(x<<4|y):(this.b1vu56(1,x),this.vu57(y))}vu57(num){if(num<=127)this.u8(num);else if(num<=16383){this.ensureCapacity(2);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=num>>>7}else if(num<=2097151){this.ensureCapacity(3);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=num>>>14}else if(num<=268435455){this.ensureCapacity(4);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=num>>>21}else{let lo32=0|num;lo32<0&&(lo32+=4294967296);const hi32=(num-lo32)/4294967296;if(num<=34359738367){this.ensureCapacity(5);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=hi32<<4|num>>>28}else if(num<=4398046511103){this.ensureCapacity(6);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=128|(7&hi32)<<4|num>>>28,uint8[this.x++]=hi32>>>3}else if(num<=562949953421311){this.ensureCapacity(7);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=128|(7&hi32)<<4|num>>>28,uint8[this.x++]=128|(1016&hi32)>>>3,uint8[this.x++]=hi32>>>10}else{this.ensureCapacity(8);const uint8=this.uint8;uint8[this.x++]=128|127&num,uint8[this.x++]=128|num>>>7&127,uint8[this.x++]=128|num>>>14&127,uint8[this.x++]=128|num>>>21&127,uint8[this.x++]=128|(7&hi32)<<4|num>>>28,uint8[this.x++]=128|(1016&hi32)>>>3,uint8[this.x++]=128|(130048&hi32)>>>10,uint8[this.x++]=hi32>>>17}}}b1vu56(flag,num){if(num<=63)this.u8(flag<<7|num);else{const firstByteMask=flag<<7|64;if(num<=8191){this.ensureCapacity(2);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=num>>>6}else if(num<=1048575){this.ensureCapacity(3);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=num>>>13}else if(num<=134217727){this.ensureCapacity(4);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=num>>>20}else{let lo32=0|num;lo32<0&&(lo32+=4294967296);const hi32=(num-lo32)/4294967296;if(num<=17179869183){this.ensureCapacity(5);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=hi32<<5|num>>>27}else if(num<=2199023255551){this.ensureCapacity(6);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=128|(3&hi32)<<5|num>>>27,uint8[this.x++]=hi32>>>2}else if(num<=0xffffffffffff){this.ensureCapacity(7);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=128|(3&hi32)<<5|num>>>27,uint8[this.x++]=128|(508&hi32)>>>2,uint8[this.x++]=hi32>>>9}else{this.ensureCapacity(8);const uint8=this.uint8;uint8[this.x++]=firstByteMask|63&num,uint8[this.x++]=128|num>>>6&127,uint8[this.x++]=128|num>>>13&127,uint8[this.x++]=128|num>>>20&127,uint8[this.x++]=128|(3&hi32)<<5|num>>>27,uint8[this.x++]=128|(508&hi32)>>>2,uint8[this.x++]=128|(65024&hi32)>>>9,uint8[this.x++]=hi32>>>16}}}}}exports.CrdtWriter=CrdtWriter},"./node_modules/json-joy/lib/json-crdt/codec/structural/binary/Decoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Decoder=void 0;const nodes=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js")),ClockDecoder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/clock/ClockDecoder.js"),CrdtReader_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtReader.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),Model_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/Model.js"),CborDecoderBase_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborDecoderBase.js");class Decoder extends CborDecoderBase_1.CborDecoderBase{constructor(){super(new CrdtReader_1.CrdtReader),this.time=-1,this.cStrChunk=()=>{const id=this.ts(),val=this.val();return"string"==typeof val?new nodes.StrChunk(id,val.length,val):new nodes.StrChunk(id,~~val,"")},this.cBinChunk=()=>{const id=this.ts(),reader=this.reader,[deleted,length]=reader.b1vu56();return deleted?new nodes.BinChunk(id,length,void 0):new nodes.BinChunk(id,length,reader.buf(length))},this.cArrChunk=()=>{const id=this.ts(),[deleted,length]=this.reader.b1vu56();if(deleted)return new nodes.ArrChunk(id,length,void 0);const ids=[];for(let i=0;i<length;i++)ids.push(this.cNode().id);return new nodes.ArrChunk(id,length,ids)}}decode(data,model){delete this.clockDecoder,this.time=-1;const reader=this.reader;reader.reset(data);if(128&reader.peak()){reader.x++;const time=this.time=reader.vu57();model||(model=Model_1.Model.withServerClock(time))}else if(this.decodeClockTable(),!model){const clock=this.clockDecoder.clock;model=Model_1.Model.withLogicalClock(clock)}return this.doc=model,model.root=new nodes.RootNode(this.doc,this.cRoot().id),delete this.clockDecoder,model}decodeClockTable(){const reader=this.reader,clockTableOffset=reader.u32(),offset=reader.x;reader.x+=clockTableOffset;const length=reader.vu57(),sessionId=reader.vu57(),time=reader.vu57();this.clockDecoder=new ClockDecoder_1.ClockDecoder(sessionId,time);for(let i=1;i<length;i++){const sid=reader.vu57(),time=reader.vu57();this.clockDecoder.pushTuple(sid,time)}reader.x=offset}ts(){if(this.time<0){const[sessionIndex,timeDiff]=this.reader.id();return this.clockDecoder.decodeId(sessionIndex,timeDiff)}return new clock_1.Timestamp(1,this.reader.vu57())}cRoot(){const reader=this.reader;return reader.uint8[reader.x]?this.cNode():Model_1.UNDEFINED}cNode(){const reader=this.reader,id=this.ts(),octet=reader.u8(),minor=31&octet;switch(octet>>5){case 0:return this.cCon(id,minor);case 1:return this.cVal(id);case 2:return this.cObj(id,31!==minor?minor:reader.vu57());case 3:return this.cVec(id,31!==minor?minor:reader.vu57());case 4:return this.cStr(id,31!==minor?minor:reader.vu57());case 5:return this.cBin(id,31!==minor?minor:reader.vu57());case 6:return this.cArr(id,31!==minor?minor:reader.vu57())}throw new Error("UNKNOWN_NODE")}cCon(id,length){const doc=this.doc,data=length?this.ts():this.val(),node=new nodes.ConNode(id,data);return doc.index.set(id,node),node}cVal(id){const child=this.cNode(),doc=this.doc,node=new nodes.ValNode(doc,id,child.id);return doc.index.set(id,node),node}cObj(id,length){const obj=new nodes.ObjNode(this.doc,id);for(let i=0;i<length;i++)this.cObjChunk(obj);return this.doc.index.set(id,obj),obj}cObjChunk(obj){const key=this.key();obj.keys.set(key,this.cNode().id)}cVec(id,length){const reader=this.reader,obj=new nodes.VecNode(this.doc,id),elements=obj.elements;for(let i=0;i<length;i++){reader.peak()?elements.push(this.cNode().id):(reader.x++,elements.push(void 0))}return this.doc.index.set(id,obj),obj}cStr(id,length){const node=new nodes.StrNode(id);return length&&node.ingest(length,this.cStrChunk),this.doc.index.set(id,node),node}cBin(id,length){const node=new nodes.BinNode(id);return length&&node.ingest(length,this.cBinChunk),this.doc.index.set(id,node),node}cArr(id,length){const obj=new nodes.ArrNode(this.doc,id);return length&&obj.ingest(length,this.cArrChunk),this.doc.index.set(id,obj),obj}}exports.Decoder=Decoder},"./node_modules/json-joy/lib/json-crdt/codec/structural/binary/Encoder.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Encoder=void 0;const nodes=__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js")),ClockEncoder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/codec/clock/ClockEncoder.js"),CrdtWriter_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/util/binary/CrdtWriter.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),CborEncoder_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pack/lib/cbor/CborEncoder.js");class Encoder extends CborEncoder_1.CborEncoder{constructor(writer){super(writer||new CrdtWriter_1.CrdtWriter),this.clockEncoder=new ClockEncoder_1.ClockEncoder,this.time=0,this.cTableEntry=entry=>{const clock=entry.clock,writer=this.writer;writer.vu57(clock.sid),writer.vu57(clock.time)},this.tsLogical=ts=>{const relativeId=this.clockEncoder.append(ts);this.writer.id(relativeId.sessionIndex,relativeId.timeDiff)},this.tsServer=ts=>{this.writer.vu57(ts.time)},this.ts=this.tsLogical,this.cKey=(val,key)=>{this.writeStr(key),this.cNode(this.doc.index.get(val))}}encode(doc){this.doc=doc;const writer=this.writer;return writer.reset(),1===doc.clock.sid?this.encodeServer(doc):this.encodeLogical(doc),writer.flush()}encodeLogical(model){const writer=this.writer;this.ts=this.tsLogical,this.clockEncoder.reset(model.clock),writer.ensureCapacity(4);const x0=writer.x0,x=writer.x;writer.x+=4,this.cRoot(model.root),this.encodeClockTable(x0,x)}encodeServer(model){this.ts=this.tsServer;const writer=this.writer;writer.u8(128),writer.vu57(this.time=model.clock.time),this.cRoot(model.root)}encodeClockTable(x0,x){const writer=this.writer,shift=writer.x0-x0;writer.view.setUint32(writer.x0+(x-x0),writer.x-x-shift-4);const table=this.clockEncoder.table,length=table.size;writer.vu57(length),table.forEach(this.cTableEntry)}cRoot(root){0===root.val.sid?this.writer.u8(0):this.cNode(root.node())}writeTL(majorOverlay,length){const writer=this.writer;length<31?writer.u8(majorOverlay|length):(writer.u8(31|majorOverlay),writer.vu57(length))}cNode(node){node instanceof nodes.ConNode?this.cCon(node):node instanceof nodes.ValNode?this.cVal(node):node instanceof nodes.StrNode?this.cStr(node):node instanceof nodes.ObjNode?this.cObj(node):node instanceof nodes.VecNode?this.cVec(node):node instanceof nodes.ArrNode?this.cArr(node):node instanceof nodes.BinNode&&this.cBin(node)}cCon(node){const val=node.val;this.ts(node.id),val instanceof clock_1.Timestamp?(this.writer.u8(1),this.ts(val)):(this.writer.u8(0),this.writeAny(val))}cVal(node){this.ts(node.id),this.writer.u8(32),this.cNode(node.node())}cObj(node){this.ts(node.id);const keys=node.keys;this.writeTL(64,keys.size),keys.forEach(this.cKey)}cVec(node){const elements=node.elements,length=elements.length;this.ts(node.id),this.writeTL(96,length);const index=this.doc.index;for(let i=0;i<length;i++){const elementId=elements[i];elementId?this.cNode(index.get(elementId)):this.writer.u8(0)}}cStr(node){const ts=this.ts;ts(node.id),this.writeTL(128,node.count);for(let chunk=node.first();chunk;chunk=node.next(chunk))ts(chunk.id),chunk.del?this.writeUInteger(chunk.span):this.writeStr(chunk.data)}cBin(node){const ts=this.ts,writer=this.writer;ts(node.id),this.writeTL(160,node.count);for(let chunk=node.first();chunk;chunk=node.next(chunk)){ts(chunk.id);const length=chunk.span,deleted=chunk.del;writer.b1vu56(~~deleted,length),deleted||writer.buf(chunk.data,length)}}cArr(node){const ts=this.ts,writer=this.writer;ts(node.id),this.writeTL(192,node.count);const index=this.doc.index;for(let chunk=node.first();chunk;chunk=node.next(chunk)){ts(chunk.id);const span=chunk.span,deleted=chunk.del;if(writer.b1vu56(~~deleted,span),deleted)continue;const nodes=chunk.data;for(let i=0;i<span;i++)this.cNode(index.get(nodes[i]))}}}exports.Encoder=Encoder},"./node_modules/json-joy/lib/json-crdt/codec/structural/binary/shared.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.decoder=exports.encoder=void 0;const Encoder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/codec/structural/binary/Encoder.js"),Decoder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/codec/structural/binary/Decoder.js");exports.encoder=new Encoder_1.Encoder,exports.decoder=new Decoder_1.Decoder},"./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExtNode=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.ExtNode=class ExtNode{constructor(data){this.data=data,this.api=void 0,this.id=data.id}children(callback){}child(){return this.data}container(){return this.data.container()}toString(tab,parentId){return this.name()+(parentId?" "+(0,clock_1.printTs)(parentId):"")+" "+this.data.toString(tab)}}},"./node_modules/json-joy/lib/json-crdt/extensions/Extension.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Extension=void 0;const json_crdt_patch_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/index.js");exports.Extension=class Extension{constructor(id,name,Node,Api,schema){this.id=id,this.name=name,this.Node=Node,this.Api=Api,this.schema=schema}new(...args){return json_crdt_patch_1.s.ext(this.id,this.schema(...args))}}},"./node_modules/json-joy/lib/json-crdt/extensions/Extensions.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Extensions=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js");class Extensions{constructor(){this.ext={}}register(extension){this.ext[extension.id]=extension}get(id){return this.ext[id]}size(){return Object.keys(this.ext).length}clone(){const clone=new Extensions;for(const ext of Object.values(this.ext))clone.register(ext);return clone}toString(tab=""){const keys=Object.keys(this.ext).map(k=>+k).sort();return"extensions"+(0,printTree_1.printTree)(tab,keys.map(k=>tab=>`${k}: ${this.ext[k].name}`))}}exports.Extensions=Extensions},"./node_modules/json-joy/lib/json-crdt/extensions/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/lib/json-crdt/hash.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hashModel=exports.hashNode=exports.updateNode=exports.updateRga=exports.updateId=void 0;const json_hash_1=__webpack_require__("./node_modules/json-joy/lib/json-hash/index.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js"),rga_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/rga/index.js"),util2_1=__webpack_require__("./node_modules/sonic-forest/lib/util2.js");exports.updateId=(state,id)=>{const time=id.time;return state=(0,json_hash_1.updateNum)(state,state^time),state=(0,json_hash_1.updateNum)(state,id.sid^time)};exports.updateRga=(state,node)=>{state=(0,json_hash_1.updateNum)(state,node.length()),state=(0,json_hash_1.updateNum)(state,node.size());const maxIdChunk=(0,util2_1.last2)(node.ids);return maxIdChunk&&(state=(0,exports.updateId)(state,maxIdChunk.id)),(0,exports.updateId)(state,node.id)};exports.updateNode=(state,node)=>{if(node instanceof nodes_1.ConNode)return(0,exports.updateId)(state,node.id);if(node instanceof nodes_1.ValNode){const child=node.child();return child&&(state=(0,exports.updateNode)(state,child)),(0,exports.updateId)(state,node.id)}if(node instanceof nodes_1.ObjNode||node instanceof nodes_1.VecNode)return node.children(child=>{state=(0,exports.updateNode)(state,child)}),(0,exports.updateId)(state,node.id);if(node instanceof nodes_1.ArrNode&&node.children(child=>{state=(0,exports.updateNode)(state,child)}),node instanceof rga_1.AbstractRga)return(0,exports.updateRga)(state,node);throw new Error("UNKNOWN_NODE")};exports.hashNode=node=>(0,exports.updateNode)(5381,node)>>>0;exports.hashModel=model=>(0,exports.hashNode)(model.root)},"./node_modules/json-joy/lib/json-crdt/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/index.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/index.js"),exports)},"./node_modules/json-joy/lib/json-crdt/model/Model.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=exports.UNDEFINED=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs"),operations=tslib_1.__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/operations.js")),clock=tslib_1.__importStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js")),ConNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/const/ConNode.js"),shared_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/codec/structural/binary/shared.js"),ModelApi_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/ModelApi.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/constants.js"),util_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/util.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),Extensions_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/Extensions.js"),AvlMap_1=__webpack_require__("./node_modules/sonic-forest/lib/avl/AvlMap.js");exports.UNDEFINED=new ConNode_1.ConNode(constants_1.ORIGIN,void 0);class Model{rndSid(){const clock=this.clock,sid=clock.sid,peers=clock.peers;for(;;){const candidate=(0,util_1.randomSessionId)();if(sid!==candidate&&!peers.has(candidate))return candidate}}static fromPatches(patches){if(!patches.length)throw new Error("NO_PATCHES");const sid=patches[0].getId().sid;if(!sid)throw new Error("NO_SID");const model=Model.create(void 0,sid);return model.applyBatch(patches),model}constructor(clockVector){this.root=new nodes_1.RootNode(this,constants_1.ORIGIN),this.index=new AvlMap_1.AvlMap(clock.compare),this.ext=new Extensions_1.Extensions,this.tick=0,this.onbeforepatch=void 0,this.onpatch=void 0,this.onbeforereset=void 0,this.onreset=void 0,this.clock=clockVector,clockVector.time||(clockVector.time=1)}get api(){return this._api||(this._api=new ModelApi_1.ModelApi(this)),this._api}get find(){return this.api.r.proxy()}get s(){return this.api.r.proxy().val}applyBatch(patches){const length=patches.length;for(let i=0;i<length;i++)this.applyPatch(patches[i])}applyLocalPatch(patch){const id=patch.getId();if(id){const clock=this.clock;if(clock.sid===id.sid){const time=clock.time;time>id.time&&(patch=patch.rebase(time))}}this.applyPatch(patch)}applyPatch(patch){this.onbeforepatch?.(patch);const ops=patch.ops,{length}=ops;for(let i=0;i<length;i++)this.applyOperation(ops[i]);this.tick++,this.onpatch?.(patch)}applyOperation(op){this.clock.observe(op.id,op.span());const index=this.index;if(op instanceof operations.InsStrOp){const node=index.get(op.obj);node instanceof nodes_1.StrNode&&node.ins(op.ref,op.id,op.data)}else if(op instanceof operations.NewObjOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.ObjNode(this,id))}else if(op instanceof operations.NewArrOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.ArrNode(this,id))}else if(op instanceof operations.NewStrOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.StrNode(id))}else if(op instanceof operations.NewValOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.ValNode(this,id,constants_1.ORIGIN))}else if(op instanceof operations.NewConOp){const id=op.id;index.get(id)||index.set(id,new ConNode_1.ConNode(id,op.val))}else if(op instanceof operations.InsObjOp){const node=index.get(op.obj),tuples=op.data,length=tuples.length;if(node instanceof nodes_1.ObjNode)for(let i=0;i<length;i++){const tuple=tuples[i],valueNode=index.get(tuple[1]);if(!valueNode)continue;if(node.id.time>=tuple[1].time)continue;const old=node.put(tuple[0]+"",valueNode.id);old&&this.deleteNodeTree(old)}}else if(op instanceof operations.InsVecOp){const node=index.get(op.obj),tuples=op.data,length=tuples.length;if(node instanceof nodes_1.VecNode)for(let i=0;i<length;i++){const tuple=tuples[i],valueNode=index.get(tuple[1]);if(!valueNode)continue;if(node.id.time>=tuple[1].time)continue;const old=node.put(Number(tuple[0]),valueNode.id);old&&this.deleteNodeTree(old)}}else if(op instanceof operations.InsValOp){const obj=op.obj,node=0===obj.sid&&0===obj.time?this.root:index.get(obj);if(node instanceof nodes_1.ValNode){if(index.get(op.val)){const old=node.set(op.val);old&&this.deleteNodeTree(old)}}}else if(op instanceof operations.InsArrOp){const node=index.get(op.obj);if(node instanceof nodes_1.ArrNode){const nodes=[],data=op.data,length=data.length;for(let i=0;i<length;i++){const stamp=data[i];index.get(stamp)&&(node.id.time>=stamp.time||nodes.push(stamp))}nodes.length&&node.ins(op.ref,op.id,nodes)}}else if(op instanceof operations.DelOp){const node=index.get(op.obj);if(node instanceof nodes_1.ArrNode){const length=op.what.length;for(let i=0;i<length;i++){const span=op.what[i];for(let j=0;j<span.span;j++){const id=node.getById(new clock.Timestamp(span.sid,span.time+j));id&&this.deleteNodeTree(id)}}node.delete(op.what)}else(node instanceof nodes_1.StrNode||node instanceof nodes_1.BinNode)&&node.delete(op.what)}else if(op instanceof operations.NewBinOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.BinNode(id))}else if(op instanceof operations.InsBinOp){const node=index.get(op.obj);node instanceof nodes_1.BinNode&&node.ins(op.ref,op.id,op.data)}else if(op instanceof operations.NewVecOp){const id=op.id;index.get(id)||index.set(id,new nodes_1.VecNode(this,id))}}deleteNodeTree(value){if(0===value.sid)return;const node=this.index.get(value);if(!node)return;const api=node.api;api&&api.events.handleDelete(),node.children(child=>this.deleteNodeTree(child.id)),this.index.del(value)}fork(sessionId=this.rndSid()){const copy=Model.fromBinary(this.toBinary());return copy.clock.sid!==sessionId&&copy.clock instanceof clock.ClockVector&&(copy.clock=copy.clock.fork(sessionId)),copy.ext=this.ext,copy}clone(){return this.fork(this.clock.sid)}reset(to){this.onbeforereset?.();const index=this.index;this.index=new AvlMap_1.AvlMap(clock.compare);const blob=to.toBinary();shared_1.decoder.decode(blob,this),this.clock=to.clock.clone(),this.ext=to.ext.clone();const api=this._api;api&&(api.flush(),api.builder.clock=this.clock),index.forEach(({v:node})=>{const api=node.api;if(!api)return;const newNode=this.index.get(node.id);newNode?(api.node=newNode,newNode.api=api):api.events.handleDelete()}),this.tick++,this.onreset?.()}view(){return this.root.view()}toBinary(){return shared_1.encoder.encode(this)}setSchema(schema,useGlobalSession=!0){const c=this.clock;if(1===c.time){const oldSid=c.sid;useGlobalSession&&(c.sid=2),this.api.root(schema),useGlobalSession&&this.setSid(oldSid)}return this}setSid(sid){const cl=this.clock,oldSid=cl.sid;oldSid!==sid&&(cl.sid=sid,cl.observe(new clock.Timestamp(oldSid,cl.time-1),1))}toString(tab=""){const nl=()=>"",hasExtensions=this.ext.size()>0;return"model"+(0,printTree_1.printTree)(tab,[tab=>this.root.toString(tab),nl,tab=>{const nodes=[];return this.index.forEach(item=>nodes.push(item.v)),`index (${nodes.length} nodes)`+(nodes.length?(0,printTree_1.printTree)(tab,nodes.map(node=>tab=>`${node.name()} ${clock.printTs(node.id)}`)):"")},nl,tab=>`view${(0,printTree_1.printTree)(tab,[tab=>String(JSON.stringify(this.view(),null,2)).replace(/\n/g,"\n"+tab)])}`,nl,tab=>this.clock.toString(tab),hasExtensions?nl:null,hasExtensions?tab=>this.ext.toString(tab):null])}}exports.Model=Model,Model.sid=util_1.randomSessionId,Model.withLogicalClock=clockOrSessionId=>Model.create(void 0,clockOrSessionId),Model.withServerClock=(time=1)=>Model.create(void 0,new clock.ServerClockVector(1,time)),Model.create=(schema,sidOrClock=Model.sid())=>{const cl="number"==typeof sidOrClock?1===sidOrClock?new clock.ServerClockVector(1,1):new clock.ClockVector(sidOrClock,1):sidOrClock,model=new Model(cl);return schema&&model.setSchema(schema,!0),model},Model.fromBinary=data=>shared_1.decoder.decode(data),Model.load=(data,sid,schema)=>{const model=shared_1.decoder.decode(data);return schema&&model.setSchema(schema,!0),"number"==typeof sid&&model.setSid(sid),model}},"./node_modules/json-joy/lib/json-crdt/model/api/ModelApi.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelApi=void 0;const fanout_1=__webpack_require__("./node_modules/thingies/lib/fanout.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js"),nodes_2=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/nodes.js"),PatchBuilder_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/PatchBuilder.js"),fanout_2=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/fanout.js"),ExtNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js");exports.ModelApi=class ModelApi{constructor(model){this.model=model,this.next=0,this.onBeforeReset=new fanout_1.FanOut,this.onReset=new fanout_1.FanOut,this.onBeforePatch=new fanout_1.FanOut,this.onPatch=new fanout_1.FanOut,this.onBeforeLocalChange=new fanout_1.FanOut,this.onLocalChange=new fanout_1.FanOut,this.onLocalChanges=new fanout_2.MicrotaskBufferFanOut(this.onLocalChange),this.onBeforeTransaction=new fanout_1.FanOut,this.onTransaction=new fanout_1.FanOut,this.onChange=new fanout_2.MergeFanOut([this.onReset,this.onPatch,this.onLocalChange]),this.onChanges=new fanout_2.MicrotaskBufferFanOut(this.onChange),this.onFlush=new fanout_1.FanOut,this.inTx=!1,this.stopAutoFlush=void 0,this.subscribe=callback=>this.onChanges.listen(()=>callback()),this.getSnapshot=()=>this.view(),this.builder=new PatchBuilder_1.PatchBuilder(model.clock),model.onbeforereset=()=>this.onBeforeReset.emit(),model.onreset=()=>this.onReset.emit(),model.onbeforepatch=patch=>this.onBeforePatch.emit(patch),model.onpatch=patch=>this.onPatch.emit(patch)}wrap(node){if(node instanceof nodes_1.ValNode)return node.api||(node.api=new nodes_2.ValApi(node,this));if(node instanceof nodes_1.StrNode)return node.api||(node.api=new nodes_2.StrApi(node,this));if(node instanceof nodes_1.BinNode)return node.api||(node.api=new nodes_2.BinApi(node,this));if(node instanceof nodes_1.ArrNode)return node.api||(node.api=new nodes_2.ArrApi(node,this));if(node instanceof nodes_1.ObjNode)return node.api||(node.api=new nodes_2.ObjApi(node,this));if(node instanceof nodes_1.ConNode)return node.api||(node.api=new nodes_2.ConApi(node,this));if(node instanceof nodes_1.VecNode)return node.api||(node.api=new nodes_2.VecApi(node,this));if(node instanceof ExtNode_1.ExtNode){if(node.api)return node.api;const extension=this.model.ext.get(node.extId);return node.api=new extension.Api(node,this)}throw new Error("UNKNOWN_NODE")}get r(){return new nodes_2.ValApi(this.model.root,this)}get node(){return this.r.get()}in(path){return this.r.in(path)}find(path){return this.node.find(path)}con(path){return this.node.con(path)}val(path){return this.node.val(path)}vec(path){return this.node.vec(path)}obj(path){return this.node.obj(path)}str(path){return this.node.str(path)}bin(path){return this.node.bin(path)}arr(path){return this.node.arr(path)}root(json){const builder=this.builder;return builder.root(builder.json(json)),this.apply(),this}apply(){const ops=this.builder.patch.ops,length=ops.length,model=this.model,from=this.next;this.onBeforeLocalChange.emit(from);for(let i=this.next;i<length;i++)model.applyOperation(ops[i]);this.next=length,model.tick++,this.onLocalChange.emit(from)}advance(){const from=this.next;this.next=this.builder.patch.ops.length,this.model.tick++,this.onLocalChange.emit(from)}view(){return this.model.view()}transaction(callback){if(this.inTx)callback();else{this.inTx=!0;try{this.onBeforeTransaction.emit(),callback(),this.onTransaction.emit()}finally{this.inTx=!1}}}flush(){const patch=this.builder.flush();return this.next=0,patch.ops.length&&this.onFlush.emit(patch),patch}autoFlush(){const drain=()=>this.builder.patch.ops.length&&this.flush(),onLocalChangesUnsubscribe=this.onLocalChanges.listen(drain),onBeforeTransactionUnsubscribe=this.onBeforeTransaction.listen(drain),onTransactionUnsubscribe=this.onTransaction.listen(drain);return this.stopAutoFlush=()=>{this.stopAutoFlush=void 0,onLocalChangesUnsubscribe(),onBeforeTransactionUnsubscribe(),onTransactionUnsubscribe()}}}},"./node_modules/json-joy/lib/json-crdt/model/api/NodeEvents.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NodeEvents=void 0;const fanout_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/fanout.js");exports.NodeEvents=class NodeEvents{constructor(api){this.api=api,this.subscribe=callback=>this.onViewChanges.listen(()=>callback()),this.getSnapshot=()=>this.api.view(),this.onChanges=new fanout_1.MapFanOut(this.api.api.onChanges,this.getSnapshot),this.onViewChanges=new fanout_1.OnNewFanOut(this.onChanges,this.api.view())}handleDelete(){this.onViewChanges.clear(),this.onChanges.clear()}}},"./node_modules/json-joy/lib/json-crdt/model/api/fanout.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.OnNewFanOut=exports.MapFanOut=exports.MicrotaskBufferFanOut=exports.MergeFanOut=void 0;const fanout_1=__webpack_require__("./node_modules/thingies/lib/fanout.js");class MergeFanOut extends fanout_1.FanOut{constructor(fanouts){super(),this.fanouts=fanouts,this.unsubs=[]}listen(listener){this.listeners.size||(this.unsubs=this.fanouts.map(fanout=>fanout.listen(data=>this.emit(data))));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||(this.unsubs.forEach(unsub=>unsub()),this.unsubs=[])}}}exports.MergeFanOut=MergeFanOut;class MicrotaskBufferFanOut extends fanout_1.FanOut{constructor(source){super(),this.source=source,this.buffer=[],this.unsub=void 0}listen(listener){this.unsub||(this.unsub=this.source.listen(data=>{const buffer=this.buffer;buffer.length||queueMicrotask(()=>{this.emit(buffer),this.buffer=[]}),buffer.push(data)}));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.buffer=[],this.unsub?.(),this.unsub=void 0}}exports.MicrotaskBufferFanOut=MicrotaskBufferFanOut;class MapFanOut extends fanout_1.FanOut{constructor(source,mapper){super(),this.source=source,this.mapper=mapper,this.unsub=void 0}listen(listener){this.unsub||(this.unsub=this.source.listen(data=>this.emit(this.mapper(data))));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.unsub?.(),this.unsub=void 0}}exports.MapFanOut=MapFanOut;class OnNewFanOut extends fanout_1.FanOut{constructor(source,last=void 0){super(),this.source=source,this.last=last,this.unsub=void 0}listen(listener){this.unsub||(this.unsub=this.source.listen(data=>{this.last!==data&&this.emit(this.last=data)}));const unsub=super.listen(listener);return()=>{unsub(),this.listeners.size||this.clear()}}clear(){this.listeners.clear(),this.last=void 0,this.unsub?.(),this.unsub=void 0}}exports.OnNewFanOut=OnNewFanOut},"./node_modules/json-joy/lib/json-crdt/model/api/find.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.find=void 0;const json_pointer_1=__webpack_require__("./node_modules/@jsonjoy.com/json-pointer/lib/index.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js");exports.find=(startNode,path)=>{const steps=(0,json_pointer_1.toPath)(path);let node=startNode;const length=steps.length;if(!length)return node;let i=0;for(;i<length&&node;){const step=steps[i++];if(node=node.container(),!node)throw new Error("NOT_CONTAINER");if(node instanceof nodes_1.ObjNode){const nextNode=node.get(String(step));if(!nextNode)throw new Error("NOT_FOUND");node=nextNode}else if(node instanceof nodes_1.ArrNode){const nextNode=node.getNode(Number(step));if(!nextNode)throw new Error("NOT_FOUND");node=nextNode}else if(node instanceof nodes_1.VecNode){const nextNode=node.get(Number(step));if(!nextNode)throw new Error("NOT_FOUND");node=nextNode}}return node}},"./node_modules/json-joy/lib/json-crdt/model/api/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ModelApi=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var ModelApi_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/ModelApi.js");Object.defineProperty(exports,"ModelApi",{enumerable:!0,get:function(){return ModelApi_1.ModelApi}}),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/nodes.js"),exports)},"./node_modules/json-joy/lib/json-crdt/model/api/nodes.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrApi=exports.BinApi=exports.StrApi=exports.ObjApi=exports.VecApi=exports.ValApi=exports.ConApi=exports.NodeApi=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),find_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/find.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),nodes_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/index.js"),NodeEvents_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/NodeEvents.js"),ExtNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/extensions/ExtNode.js");class NodeApi{constructor(node,api){this.node=node,this.api=api,this.ev=void 0}get events(){return this.ev||(this.ev=new NodeEvents_1.NodeEvents(this))}find(path){const node=this.node;if(void 0===path){if("function"==typeof node.child){const child=node.child();if(!child){if(node instanceof nodes_1.RootNode)return node;throw new Error("NO_CHILD")}return child}throw new Error("CANNOT_IN")}return"string"==typeof path&&path&&"/"!==path[0]&&(path="/"+path),"number"==typeof path&&(path=[path]),(0,find_1.find)(this.node,path)}in(path){const node=this.find(path);return this.api.wrap(node)}asVal(){if(this.node instanceof nodes_1.ValNode)return this.api.wrap(this.node);throw new Error("NOT_VAL")}asStr(){if(this.node instanceof nodes_1.StrNode)return this.api.wrap(this.node);throw new Error("NOT_STR")}asBin(){if(this.node instanceof nodes_1.BinNode)return this.api.wrap(this.node);throw new Error("NOT_BIN")}asArr(){if(this.node instanceof nodes_1.ArrNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asVec(){if(this.node instanceof nodes_1.VecNode)return this.api.wrap(this.node);throw new Error("NOT_ARR")}asObj(){if(this.node instanceof nodes_1.ObjNode)return this.api.wrap(this.node);throw new Error("NOT_OBJ")}asCon(){if(this.node instanceof nodes_1.ConNode)return this.api.wrap(this.node);throw new Error("NOT_CONST")}asExt(ext){let extNode;const node=this.node;if(node instanceof ExtNode_1.ExtNode&&(extNode=node),node instanceof nodes_1.VecNode&&(extNode=node.ext()),!extNode)throw new Error("NOT_EXT");const api=this.api.wrap(extNode);if(!ext)return api;if(api instanceof ext.Api)return api;throw new Error("NOT_EXT")}val(path){return this.in(path).asVal()}str(path){return this.in(path).asStr()}bin(path){return this.in(path).asBin()}arr(path){return this.in(path).asArr()}vec(path){return this.in(path).asVec()}obj(path){return this.in(path).asObj()}con(path){return this.in(path).asCon()}view(){return this.node.view()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}toString(tab=""){return"api"+(0,printTree_1.printTree)(tab,[tab=>this.node.toString(tab)])}}exports.NodeApi=NodeApi;exports.ConApi=class ConApi extends NodeApi{proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}};exports.ValApi=class ValApi extends NodeApi{get(){return this.in()}set(json){const{api,node}=this,val=api.builder.constOrJson(json);api.builder.setVal(node.id,val),api.apply()}proxy(){const self=this;return{toApi:()=>this,toView:()=>this.node.view(),get val(){const childNode=self.node.node();return self.api.wrap(childNode).proxy()}}}};exports.VecApi=class VecApi extends NodeApi{get(key){return this.in(key)}set(entries){const{api,node}=this,{builder}=api;builder.insVec(node.id,entries.map(([index,json])=>[index,builder.constOrJson(json)])),api.apply()}push(...values){const length=this.length();this.set(values.map((value,index)=>[length+index,value]))}length(){return this.node.elements.length}proxy(){return new Proxy({},{get:(target,prop,receiver)=>{if("toApi"===prop)return()=>this;if("toView"===prop)return()=>this.view();if("toExt"===prop)return()=>this.asExt();const index=Number(prop);if(Number.isNaN(index))throw new Error("INVALID_INDEX");const child=this.node.get(index);if(!child)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(child).proxy()}})}};exports.ObjApi=class ObjApi extends NodeApi{get(key){return this.in(key)}set(entries){const{api,node}=this,{builder}=api;builder.insObj(node.id,Object.entries(entries).map(([key,json])=>[key,builder.constOrJson(json)])),api.apply()}del(keys){const{api,node}=this,{builder}=api;api.builder.insObj(node.id,keys.map(key=>[key,builder.const(void 0)])),api.apply()}proxy(){return new Proxy({},{get:(target,prop,receiver)=>{if("toApi"===prop)return()=>this;if("toView"===prop)return()=>this.view();const key=String(prop),child=this.node.get(key);if(!child)throw new Error("NO_SUCH_KEY");return this.api.wrap(child).proxy()}})}};exports.StrApi=class StrApi extends NodeApi{ins(index,text){const{api,node}=this;api.onBeforeLocalChange.emit(api.next);const builder=api.builder;builder.pad();const nextTime=api.builder.nextTime(),id=new clock_1.Timestamp(builder.clock.sid,nextTime),after=node.insAt(index,id,text);if(!after)throw new Error("OUT_OF_BOUNDS");builder.insStr(node.id,after,text),api.advance()}del(index,length){const{api,node}=this;api.onBeforeLocalChange.emit(api.next);const builder=api.builder;builder.pad();const spans=node.findInterval(index,length);if(!spans)throw new Error("OUT_OF_BOUNDS");node.delete(spans),builder.del(node.id,spans),api.advance()}findId(index){const node=this.node,max=node.length()-1;if(index>max&&(index=max),index<0)return node.id;return node.find(index)||node.id}findPos(id){const node=this.node,nodeId=node.id;if(nodeId.sid===id.sid&&nodeId.time===id.time)return-1;const chunk=node.findById(id);if(!chunk)return-1;return node.pos(chunk)+(chunk.del?0:id.time-chunk.id.time)}length(){return this.node.length()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}};exports.BinApi=class BinApi extends NodeApi{ins(index,data){const{api,node}=this,after=index?node.find(index-1):node.id;if(!after)throw new Error("OUT_OF_BOUNDS");api.builder.insBin(node.id,after,data),api.apply()}del(index,length){const{api,node}=this,spans=node.findInterval(index,length);if(!spans)throw new Error("OUT_OF_BOUNDS");api.builder.del(node.id,spans),api.apply()}length(){return this.node.length()}proxy(){return{toApi:()=>this,toView:()=>this.node.view()}}};exports.ArrApi=class ArrApi extends NodeApi{get(index){return this.in(index)}ins(index,values){const{api,node}=this,{builder}=api,after=index?node.find(index-1):node.id;if(!after)throw new Error("OUT_OF_BOUNDS");const valueIds=[];for(let i=0;i<values.length;i++)valueIds.push(builder.json(values[i]));builder.insArr(node.id,after,valueIds),api.apply()}del(index,length){const{api,node}=this,spans=node.findInterval(index,length);if(!spans)throw new Error("OUT_OF_BOUNDS");api.builder.del(node.id,spans),api.apply()}length(){return this.node.length()}proxy(){return new Proxy({},{get:(target,prop,receiver)=>{if("toApi"===prop)return()=>this;if("toView"===prop)return()=>this.view();const index=Number(prop);if(Number.isNaN(index))throw new Error("INVALID_INDEX");const child=this.node.getNode(index);if(!child)throw new Error("OUT_OF_BOUNDS");return this.api.wrap(child).proxy()}})}}},"./node_modules/json-joy/lib/json-crdt/model/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Model=void 0;const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");var Model_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/Model.js");Object.defineProperty(exports,"Model",{enumerable:!0,get:function(){return Model_1.Model}}),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/api/index.js"),exports)},"./node_modules/json-joy/lib/json-crdt/model/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.randomSessionId=void 0;exports.randomSessionId=()=>Math.floor(9007199254675456*Math.random()+65535)},"./node_modules/json-joy/lib/json-crdt/nodes/arr/ArrNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ArrNode=exports.ArrChunk=void 0;const AbstractRga_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/rga/AbstractRga.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),printBinary_1=__webpack_require__("./node_modules/tree-dump/lib/printBinary.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js");class ArrChunk{constructor(id,span,data){this.id=id,this.span=span,this.len=data?span:0,this.del=!data,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=data}merge(data){this.data.push(...data),this.span=this.data.length}split(ticks){const span=this.span;if(this.span=ticks,!this.del){const rightData=this.data.splice(ticks);return new ArrChunk((0,clock_1.tick)(this.id,ticks),span-ticks,rightData)}return new ArrChunk((0,clock_1.tick)(this.id,ticks),span-ticks,void 0)}delete(){this.del=!0,this.data=void 0}clone(){return new ArrChunk(this.id,this.span,this.data?[...this.data]:void 0)}view(){return this.data?[...this.data]:[]}}exports.ArrChunk=ArrChunk;class ArrNode extends AbstractRga_1.AbstractRga{constructor(doc,id){super(id),this.doc=doc,this._tick=0,this._view=[],this.api=void 0}get(position){const pair=this.findChunk(position);if(pair)return pair[0].data[pair[1]]}getNode(position){const id=this.get(position);if(id)return this.doc.index.get(id)}getById(id){const chunk=this.findById(id);if(!chunk||chunk.del)return;const offset=id.time-chunk.id.time;return chunk.data[offset]}createChunk(id,data){return new ArrChunk(id,data?data.length:0,data)}onChange(){}toStringName(){return this.name()}child(){}container(){return this}view(){const doc=this.doc,tick=doc.clock.time+doc.tick,_view=this._view;if(this._tick===tick)return _view;const view=[],index=doc.index;let useCache=!0;for(let chunk=this.first();chunk;chunk=this.next(chunk))if(!chunk.del)for(const node of chunk.data){const elementNode=index.get(node);if(!elementNode){useCache=!1;continue}const element=elementNode.view();_view[view.length]!==element&&(useCache=!1),view.push(element)}_view.length!==view.length&&(useCache=!1);return useCache?_view:(this._tick=tick,this._view=view)}children(callback){const index=this.doc.index;for(let chunk=this.first();chunk;chunk=this.next(chunk))if(!chunk.del)for(const node of chunk.data)callback(index.get(node))}name(){return"arr"}printChunk(tab,chunk){const pos=this.pos(chunk);let valueTree="";if(!chunk.del){const index=this.doc.index;valueTree=(0,printTree_1.printTree)(tab,chunk.data.map(id=>index.get(id)).filter(node=>!!node).map((node,i)=>tab=>`[${pos+i}]: ${node.toString(tab+"    "+" ".repeat(String(i).length))}`))}return this.formatChunk(chunk)+valueTree+(0,printBinary_1.printBinary)(tab,[chunk.l?tab=>this.printChunk(tab,chunk.l):null,chunk.r?tab=>this.printChunk(tab,chunk.r):null])}}exports.ArrNode=ArrNode},"./node_modules/json-joy/lib/json-crdt/nodes/bin/BinNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BinNode=exports.BinChunk=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),AbstractRga_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/rga/AbstractRga.js");class BinChunk{constructor(id,span,buf){this.id=id,this.span=span,this.len=buf?span:0,this.del=!buf,this.p=void 0,this.l=void 0,this.r=void 0,this.s=void 0,this.data=buf}merge(data){const length=this.data.length,combined=new Uint8Array(length+data.length);combined.set(this.data),combined.set(data,length),this.data=combined,this.span=combined.length}split(ticks){if(!this.del){const data=this.data,rightBuffer=data.subarray(ticks),chunk=new BinChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,rightBuffer);return this.data=data.subarray(0,ticks),this.span=ticks,chunk}const chunk=new BinChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,void 0);return this.span=ticks,chunk}delete(){this.del=!0,this.data=void 0}clone(){return new BinChunk(this.id,this.span,this.data)}view(){return this.data||new Uint8Array(0)}}exports.BinChunk=BinChunk;class BinNode extends AbstractRga_1.AbstractRga{constructor(){super(...arguments),this._view=null,this.api=void 0}view(){if(this._view)return this._view;const res=new Uint8Array(this.length());let offset=0,chunk=this.first();for(;chunk;){if(!chunk.del){const buf=chunk.data;res.set(buf,offset),offset+=buf.length}chunk=this.next(chunk)}return this._view=res}children(){}child(){}container(){}name(){return"bin"}createChunk(id,buf){return new BinChunk(id,buf?buf.length:0,buf)}onChange(){this._view=null}toStringName(){return this.name()}}exports.BinNode=BinNode},"./node_modules/json-joy/lib/json-crdt/nodes/const/ConNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ConNode=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.ConNode=class ConNode{constructor(id,val){this.id=id,this.val=val,this.api=void 0}children(){}child(){}container(){}view(){return this.val}name(){return"con"}toString(tab){const val=this.val,valFormatted=val instanceof Uint8Array?`Uint8Array { ${(""+val).replaceAll(",",", ")} }`:`{ ${val instanceof clock_1.Timestamp?(0,clock_1.printTs)(val):JSON.stringify(val)} }`;return`${this.name()} ${(0,clock_1.printTs)(this.id)} ${valFormatted}`}}},"./node_modules/json-joy/lib/json-crdt/nodes/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const tslib_1=__webpack_require__("./node_modules/tslib/tslib.es6.mjs");tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/types.js"),exports),tslib_1.__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/nodes.js"),exports)},"./node_modules/json-joy/lib/json-crdt/nodes/nodes.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrChunk=exports.StrNode=exports.BinChunk=exports.BinNode=exports.ArrChunk=exports.ArrNode=exports.ObjNode=exports.VecNode=exports.RootNode=exports.ValNode=exports.ConNode=void 0;var ConNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/const/ConNode.js");Object.defineProperty(exports,"ConNode",{enumerable:!0,get:function(){return ConNode_1.ConNode}});var ValNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/val/ValNode.js");Object.defineProperty(exports,"ValNode",{enumerable:!0,get:function(){return ValNode_1.ValNode}});var RootNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/root/RootNode.js");Object.defineProperty(exports,"RootNode",{enumerable:!0,get:function(){return RootNode_1.RootNode}});var VecNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/vec/VecNode.js");Object.defineProperty(exports,"VecNode",{enumerable:!0,get:function(){return VecNode_1.VecNode}});var ObjNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/obj/ObjNode.js");Object.defineProperty(exports,"ObjNode",{enumerable:!0,get:function(){return ObjNode_1.ObjNode}});var ArrNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/arr/ArrNode.js");Object.defineProperty(exports,"ArrNode",{enumerable:!0,get:function(){return ArrNode_1.ArrNode}}),Object.defineProperty(exports,"ArrChunk",{enumerable:!0,get:function(){return ArrNode_1.ArrChunk}});var BinNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/bin/BinNode.js");Object.defineProperty(exports,"BinNode",{enumerable:!0,get:function(){return BinNode_1.BinNode}}),Object.defineProperty(exports,"BinChunk",{enumerable:!0,get:function(){return BinNode_1.BinChunk}});var StrNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/str/StrNode.js");Object.defineProperty(exports,"StrNode",{enumerable:!0,get:function(){return StrNode_1.StrNode}}),Object.defineProperty(exports,"StrChunk",{enumerable:!0,get:function(){return StrNode_1.StrChunk}})},"./node_modules/json-joy/lib/json-crdt/nodes/obj/ObjNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ObjNode=void 0;const printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.ObjNode=class ObjNode{constructor(doc,id){this.doc=doc,this.id=id,this.keys=new Map,this._tick=0,this._view={},this.api=void 0}get(key){const id=this.keys.get(key);if(id)return this.doc.index.get(id)}put(key,id){const currentId=this.keys.get(key);if(!(currentId&&(0,clock_1.compare)(currentId,id)>=0))return this.keys.set(key,id),currentId}nodes(callback){const index=this.doc.index;this.keys.forEach((id,key)=>callback(index.get(id),key))}children(callback){const index=this.doc.index;this.keys.forEach((id,key)=>callback(index.get(id)))}child(){}container(){return this}view(){const doc=this.doc,tick=doc.clock.time+doc.tick,_view=this._view;if(this._tick===tick)return _view;const view={},index=doc.index;let useCache=!0;return this.keys.forEach((id,key)=>{const valueNode=index.get(id);if(!valueNode)return void(useCache=!1);const value=valueNode.view();void 0!==value?(_view[key]!==value&&(useCache=!1),view[key]=value):void 0!==_view[key]&&(useCache=!1)}),useCache?_view:(this._tick=tick,this._view=view)}name(){return"obj"}toString(tab=""){return this.name()+" "+(0,clock_1.printTs)(this.id)+(0,printTree_1.printTree)(tab,[...this.keys.entries()].filter(([,id])=>!!this.doc.index.get(id)).map(([key,id])=>tab=>JSON.stringify(key)+(0,printTree_1.printTree)(tab+" ",[tab=>this.doc.index.get(id).toString(tab)])))}}},"./node_modules/json-joy/lib/json-crdt/nodes/rga/AbstractRga.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbstractRga=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),isUint8Array_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/buffers/isUint8Array.js"),util_1=__webpack_require__("./node_modules/sonic-forest/lib/splay/util.js"),util2_1=__webpack_require__("./node_modules/sonic-forest/lib/splay/util2.js"),util2_2=__webpack_require__("./node_modules/sonic-forest/lib/util2.js"),constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/constants.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),printBinary_1=__webpack_require__("./node_modules/tree-dump/lib/printBinary.js"),printOctets_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/buffers/printOctets.js"),compareById=(c1,c2)=>{const ts1=c1.id,ts2=c2.id;return ts1.sid-ts2.sid||ts1.time-ts2.time},updateLenOne=chunk=>{const l=chunk.l,r=chunk.r;chunk.len=(chunk.del?0:chunk.span)+(l?l.len:0)+(r?r.len:0)},updateLenOneLive=chunk=>{const l=chunk.l,r=chunk.r;chunk.len=chunk.span+(l?l.len:0)+(r?r.len:0)},dLen=(chunk,delta)=>{for(;chunk;)chunk.len+=delta,chunk=chunk.p},next=curr=>{const r=curr.r;if(r){let tmp;for(curr=r;tmp=curr.l;)curr=tmp;return curr}let p=curr.p;for(;p&&p.r===curr;)curr=p,p=p.p;return p},prev=curr=>{const l=curr.l;if(l){let tmp;for(curr=l;tmp=curr.r;)curr=tmp;return curr}let p=curr.p;for(;p&&p.l===curr;)curr=p,p=p.p;return p};exports.AbstractRga=class AbstractRga{constructor(id){this.id=id,this.root=void 0,this.ids=void 0,this.count=0}ins(after,id,content){const rootId=this.id,afterTime=after.time,afterSid=after.sid;if(rootId.time===afterTime&&rootId.sid===afterSid)return void this.insAfterRoot(after,id,content);let curr=this.ids,chunk=curr;for(;curr;){const currId=curr.id,currIdSid=currId.sid;if(currIdSid>afterSid)curr=curr.l2;else if(currIdSid<afterSid)chunk=curr,curr=curr.r2;else{const currIdTime=currId.time;if(currIdTime>afterTime)curr=curr.l2;else{if(!(currIdTime<afterTime)){chunk=curr;break}chunk=curr,curr=curr.r2}}}if(!chunk)return;const atId=chunk.id,atIdTime=atId.time,atIdSid=atId.sid,atSpan=chunk.span;if(atIdSid!==afterSid)return;if(afterTime-atIdTime>=atSpan)return;const offsetInInsertAtChunk=afterTime-atIdTime;this.insAfterChunk(after,chunk,offsetInInsertAtChunk,id,content)}insAt(position,id,content){if(!position){const rootId=this.id;return this.insAfterRoot(rootId,id,content),rootId}const found=this.findChunk(position-1);if(!found)return;const[at,offset]=found,atId=at.id,after=0===offset?atId:new clock_1.Timestamp(atId.sid,atId.time+offset);return this.insAfterChunk(after,at,offset,id,content),after}insAfterRoot(after,id,content){const chunk=this.createChunk(id,content),first=this.first();if(first)if((0,clock_1.compare)(first.id,id)<0)this.insertBefore(chunk,first);else{if((0,clock_1.containsId)(first.id,first.span,id))return;this.insertAfterRef(chunk,after,first)}else this.setRoot(chunk)}insAfterChunk(after,chunk,chunkOffset,id,content){const atId=chunk.id,atIdTime=atId.time,atIdSid=atId.sid,atSpan=chunk.span,newChunk=this.createChunk(id,content);if(chunkOffset+1<atSpan){const idSid=id.sid,idTime=id.time;if(atIdSid===idSid&&atIdTime<=idTime&&atIdTime+atSpan-1>=idTime)return;if(idTime>after.time+1||idSid>after.sid)return this.insertInside(newChunk,chunk,chunkOffset+1),void this.splay(newChunk)}this.insertAfterRef(newChunk,after,chunk),this.splay(newChunk)}delete(spans){const length=spans.length;for(let i=0;i<length;i++)this.deleteSpan(spans[i]);this.onChange()}deleteSpan(span){const len=span.span,t1=span.time,t2=t1+len-1,start=this.findById(span);if(!start)return;let chunk=start,last=chunk;for(;chunk;){last=chunk;const id=chunk.id,chunkSpan=chunk.span,c1=id.time,c2=c1+chunkSpan-1;if(chunk.del){if(c2>=t2)break;chunk=chunk.s;continue}const deleteStartsInTheMiddle=t1<=c2;if(t1<=c1){if(!(t2>=c2)){const range=t2-c1+1,newChunk=this.split(chunk,range);chunk.delete(),updateLenOne(newChunk),dLen(chunk,-chunk.span);break}if(chunk.delete(),dLen(chunk,-chunk.span),t2<=c2)break}else if(deleteStartsInTheMiddle){if(!(t2>=c2)){const right=this.split(chunk,t2-c1+1),mid=this.split(chunk,t1-c1);mid.delete(),updateLenOne(right),updateLenOne(mid),dLen(chunk,-mid.span);break}{const offset=t1-c1,newChunk=this.split(chunk,offset);if(newChunk.delete(),newChunk.len=newChunk.r?newChunk.r.len:0,dLen(chunk,-newChunk.span),t2<=c2)break}}chunk=chunk.s}last&&this.mergeTombstones2(start,last)}find(position){let curr=this.root;for(;curr;){const l=curr.l,leftLength=l?l.len:0;let span;if(position<leftLength)curr=l;else if(curr.del)position-=leftLength,curr=curr.r;else{if(position<leftLength+(span=curr.span)){const ticks=position-leftLength,id=curr.id;return ticks?new clock_1.Timestamp(id.sid,id.time+ticks):id}position-=leftLength+span,curr=curr.r}}}findChunk(position){let curr=this.root;for(;curr;){const l=curr.l,leftLength=l?l.len:0;let span;if(position<leftLength)curr=l;else if(curr.del)position-=leftLength,curr=curr.r;else{if(position<leftLength+(span=curr.span))return[curr,position-leftLength];position-=leftLength+span,curr=curr.r}}}findInterval(position,length){const ranges=[];if(!length)return ranges;let curr=this.root,offset=0;for(;curr;){const leftLength=curr.l?curr.l.len:0;if(position<leftLength)curr=curr.l;else if(curr.del)position-=leftLength,curr=curr.r;else{if(position<leftLength+curr.span){offset=position-leftLength;break}position-=leftLength+curr.span,curr=curr.r}}if(!curr)return ranges;if(curr.span>=length+offset){const id=curr.id;return ranges.push((0,clock_1.tss)(id.sid,id.time+offset,length)),ranges}const len=curr.span-offset,id=curr.id;if(ranges.push((0,clock_1.tss)(id.sid,id.time+offset,len)),length-=len,curr=next(curr),!curr)return ranges;do{if(curr.del)continue;const id=curr.id,span=curr.span;if(length<=span)return ranges.push((0,clock_1.tss)(id.sid,id.time,length)),ranges;ranges.push((0,clock_1.tss)(id.sid,id.time,span)),length-=span}while((curr=next(curr))&&length>0);return ranges}findInterval2(from,to){const ranges=[];return this.range0(void 0,from,to,(chunk,off,len)=>{const id=chunk.id;ranges.push((0,clock_1.tss)(id.sid,id.time+off,len))}),ranges}range0(startChunk,from,to,callback){let chunk=startChunk||this.findById(from);if(startChunk)for(;chunk&&!(0,clock_1.containsId)(chunk.id,chunk.span,from);)chunk=next(chunk);if(chunk){if(chunk.del){if((0,clock_1.containsId)(chunk.id,chunk.span,to))return}else{const off=from.time-chunk.id.time;if((0,clock_1.containsId)(chunk.id,chunk.span,to)){return callback(chunk,off,to.time-from.time+1),chunk}callback(chunk,off,chunk.span-off)}for(chunk=next(chunk);chunk;){if((0,clock_1.containsId)(chunk.id,chunk.span,to))return chunk.del||callback(chunk,0,to.time-chunk.id.time+1),chunk;chunk.del||callback(chunk,0,chunk.span),chunk=next(chunk)}return chunk}}first(){let curr=this.root;for(;curr;){const l=curr.l;if(!l)return curr;curr=l}return curr}last(){let curr=this.root;for(;curr;){const r=curr.r;if(!r)return curr;curr=r}return curr}lastId(){const chunk=this.last();if(!chunk)return;const id=chunk.id,span=chunk.span;return 1===span?id:new clock_1.Timestamp(id.sid,id.time+span-1)}next(curr){return next(curr)}prev(curr){return prev(curr)}length(){const root=this.root;return root?root.len:0}size(){return this.count}pos(chunk){const p=chunk.p,l=chunk.l;if(!p)return l?l.len:0;const parentPos=this.pos(p);if(p.r===chunk)return parentPos+(p.del?0:p.span)+(l?l.len:0);const r=chunk.r;return parentPos-(chunk.del?0:chunk.span)-(r?r.len:0)}setRoot(chunk){this.root=chunk,this.insertId(chunk),this.onChange()}insertBefore(chunk,before){const l=before.l;before.l=chunk,chunk.l=l,chunk.p=before;let lLen=0;l&&(l.p=chunk,lLen=l.len),chunk.len=chunk.span+lLen,dLen(before,chunk.span),this.insertId(chunk),this.onChange()}insertAfter(chunk,after){const r=after.r;after.r=chunk,chunk.r=r,chunk.p=after;let rLen=0;r&&(r.p=chunk,rLen=r.len),chunk.len=chunk.span+rLen,dLen(after,chunk.span),this.insertId(chunk),this.onChange()}insertAfterRef(chunk,ref,left){const id=chunk.id,sid=id.sid,time=id.time;let isSplit=!1;for(;;){const leftId=left.id,leftNextTick=leftId.time+left.span;left.s||(isSplit=leftId.sid===sid&&leftNextTick===time&&leftNextTick-1===ref.time,isSplit&&(left.s=chunk));const right=next(left);if(!right)break;const rightId=right.id,rightIdTime=rightId.time,rightIdSid=rightId.sid;if(rightIdTime<time)break;if(rightIdTime===time){if(rightIdSid===sid)return;if(rightIdSid<sid)break}left=right}isSplit&&!left.del?(this.mergeContent(left,chunk.data),left.s=void 0):this.insertAfter(chunk,left)}mergeContent(chunk,content){const span1=chunk.span;chunk.merge(content),dLen(chunk,chunk.span-span1),this.onChange()}insertInside(chunk,at,offset){const p=at.p,l=at.l,r=at.r,s=at.s,len=at.len,at2=at.split(offset);if(at.s=at2,at2.s=s,at.l=at.r=at2.l=at2.r=void 0,at2.l=void 0,chunk.p=p,l){chunk.l=l,l.p=chunk;const a=l.r;l.r=at,at.p=l,at.l=a,a&&(a.p=at)}else chunk.l=at,at.p=chunk;if(r){chunk.r=r,r.p=chunk;const b=r.l;r.l=at2,at2.p=r,at2.r=b,b&&(b.p=at2)}else chunk.r=at2,at2.p=chunk;p?p.l===at?p.l=chunk:p.r=chunk:this.root=chunk,updateLenOne(at),updateLenOne(at2),l&&(l.len=(l.l?l.l.len:0)+at.len+(l.del?0:l.span)),r&&(r.len=(r.r?r.r.len:0)+at2.len+(r.del?0:r.span)),chunk.len=len+chunk.span;const span=chunk.span;let curr=chunk.p;for(;curr;)curr.len+=span,curr=curr.p;this.insertId(at2),this.insertIdFast(chunk),this.onChange()}split(chunk,ticks){const s=chunk.s,newChunk=chunk.split(ticks),r=chunk.r;return chunk.s=newChunk,newChunk.r=r,newChunk.s=s,chunk.r=newChunk,newChunk.p=chunk,this.insertId(newChunk),r&&(r.p=newChunk),newChunk}mergeTombstones(ch1,ch2){if(!ch1.del||!ch2.del)return!1;const id1=ch1.id,id2=ch2.id;return id1.sid===id2.sid&&(id1.time+ch1.span===id2.time&&(ch1.s=ch2.s,ch1.span+=ch2.span,this.deleteChunk(ch2),!0))}mergeTombstones2(start,end){let curr=start;for(;curr;){const nextCurr=next(curr);if(!nextCurr)break;if(!this.mergeTombstones(curr,nextCurr)){if(nextCurr===end){if(nextCurr){const n=next(nextCurr);n&&this.mergeTombstones(nextCurr,n)}break}curr=curr.s}}const left=prev(start);left&&this.mergeTombstones(left,start)}removeTombstones(){let curr=this.first();const list=[];for(;curr;)curr.del&&list.push(curr),curr=next(curr);for(let i=0;i<list.length;i++)this.deleteChunk(list[i])}deleteChunk(chunk){this.deleteId(chunk);const p=chunk.p,l=chunk.l,r=chunk.r;if(chunk.id=constants_1.ORIGIN,l||r)if(l&&r){let mostRightChildFromLeft=l;for(;mostRightChildFromLeft.r;)mostRightChildFromLeft=mostRightChildFromLeft.r;mostRightChildFromLeft.r=r,r.p=mostRightChildFromLeft;const rLen=r.len;let curr;for(curr=mostRightChildFromLeft,p?(p.l===chunk?p.l=l:p.r=l,l.p=p):(this.root=l,l.p=void 0);curr&&curr!==p;)curr.len+=rLen,curr=curr.p}else{const child=l||r;child.p=p,p?p.l===chunk?p.l=child:p.r=child:this.root=child}else p?p.l===chunk?p.l=void 0:p.r=void 0:this.root=void 0}insertId(chunk){this.ids=(0,util2_2.insert2)(this.ids,chunk,compareById),this.count++,this.ids=(0,util2_1.splay2)(this.ids,chunk)}insertIdFast(chunk){this.ids=(0,util2_2.insert2)(this.ids,chunk,compareById),this.count++}deleteId(chunk){this.ids=(0,util2_2.remove2)(this.ids,chunk),this.count--}findById(after){const afterSid=after.sid,afterTime=after.time;let curr=this.ids,chunk=curr;for(;curr;){const currId=curr.id,currIdSid=currId.sid;if(currIdSid>afterSid)curr=curr.l2;else if(currIdSid<afterSid)chunk=curr,curr=curr.r2;else{const currIdTime=currId.time;if(currIdTime>afterTime)curr=curr.l2;else{if(!(currIdTime<afterTime)){chunk=curr;break}chunk=curr,curr=curr.r2}}}if(!chunk)return;const atId=chunk.id,atIdTime=atId.time,atIdSid=atId.sid,atSpan=chunk.span;if(atIdSid!==afterSid)return;if(afterTime<atIdTime)return;return afterTime-atIdTime>=atSpan?void 0:chunk}splay(chunk){const p=chunk.p;if(!p)return;const pp=p.p,l2=p.l===chunk;if(!pp)return l2?(0,util_1.rSplay)(chunk,p):(0,util_1.lSplay)(chunk,p),this.root=chunk,updateLenOne(p),void updateLenOneLive(chunk);const l1=pp.l===p;this.root=l1?l2?(0,util_1.llSplay)(this.root,chunk,p,pp):(0,util_1.lrSplay)(this.root,chunk,p,pp):l2?(0,util_1.rlSplay)(this.root,chunk,p,pp):(0,util_1.rrSplay)(this.root,chunk,p,pp),updateLenOne(pp),updateLenOne(p),updateLenOneLive(chunk),this.splay(chunk)}iterator(){let curr=this.first();return()=>{const res=curr;return curr&&(curr=next(curr)),res}}ingest(size,next){if(size<1)return;const splitLeftChunks=new Map;this.root=this._ingest(size,()=>{const chunk=next(),id=chunk.id,key=id.sid+"."+id.time,split=splitLeftChunks.get(key);split&&(split.s=chunk,splitLeftChunks.delete(key));const nextStampAfterSpan=(0,clock_1.tick)(id,chunk.span);return splitLeftChunks.set(nextStampAfterSpan.sid+"."+nextStampAfterSpan.time,chunk),chunk})}_ingest(size,next){const leftSize=size>>1,rightSize=size-leftSize-1,c1=leftSize>0?this._ingest(leftSize,next):void 0,c2=next();c1&&(c2.l=c1,c1.p=c2);const c3=rightSize>0?this._ingest(rightSize,next):void 0;return c3&&(c2.r=c3,c3.p=c2),updateLenOne(c2),this.insertId(c2),c2}toStringName(){return"AbstractRga"}toString(tab=""){const view=this.view();let value="";(0,isUint8Array_1.isUint8Array)(view)?value+=` { ${(0,printOctets_1.printOctets)(view)||"∅"} }`:"string"==typeof view&&(value+=`{ ${view.length>32?JSON.stringify(view.substring(0,32))+" …":JSON.stringify(view)} }`);return`${this.toStringName()} ${(0,clock_1.printTs)(this.id)} ${value}`+(0,printTree_1.printTree)(tab,[tab=>this.root?this.printChunk(tab,this.root):"∅"])}printChunk(tab,chunk){return this.formatChunk(chunk)+(0,printBinary_1.printBinary)(tab,[chunk.l?tab=>this.printChunk(tab,chunk.l):null,chunk.r?tab=>this.printChunk(tab,chunk.r):null])}formatChunk(chunk){let str=`chunk ${(0,clock_1.printTs)(chunk.id)}!${chunk.span} len:${chunk.len}`;if(chunk.del)str+=` [${chunk.span}]`;else if((0,isUint8Array_1.isUint8Array)(chunk.data))str+=` { ${(0,printOctets_1.printOctets)(chunk.data)||"∅"} }`;else if("string"==typeof chunk.data){str+=` { ${chunk.data.length>32?JSON.stringify(chunk.data.substring(0,32))+" …":JSON.stringify(chunk.data)} }`}return str}}},"./node_modules/json-joy/lib/json-crdt/nodes/rga/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/rga/AbstractRga.js"),exports)},"./node_modules/json-joy/lib/json-crdt/nodes/root/RootNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RootNode=void 0;const constants_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/constants.js"),ValNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/val/ValNode.js");class RootNode extends ValNode_1.ValNode{constructor(doc,val){super(doc,constants_1.ORIGIN,val)}name(){return"root"}}exports.RootNode=RootNode},"./node_modules/json-joy/lib/json-crdt/nodes/str/StrNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StrNode=exports.StrChunk=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),AbstractRga_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/rga/AbstractRga.js"),util_1=__webpack_require__("./node_modules/sonic-forest/lib/util/index.js");class StrChunk{constructor(id,span,str){this.id=id,this.span=span,this.len=str?span:0,this.del=!str,this.p=void 0,this.l=void 0,this.r=void 0,this.p2=void 0,this.l2=void 0,this.r2=void 0,this.s=void 0,this.data=str}merge(str){this.data+=str,this.span=this.data.length}split(ticks){if(!this.del){const chunk=new StrChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,this.data.slice(ticks));return this.data=this.data.slice(0,ticks),this.span=ticks,chunk}const chunk=new StrChunk((0,clock_1.tick)(this.id,ticks),this.span-ticks,"");return this.span=ticks,chunk}delete(){this.del=!0,this.data=""}clone(){return new StrChunk(this.id,this.span,this.data)}view(){return this.data}}exports.StrChunk=StrChunk;class StrNode extends AbstractRga_1.AbstractRga{constructor(){super(...arguments),this._view="",this.api=void 0}children(){}child(){}container(){}view(){if(this._view)return this._view;let str="";for(let chunk=this.first();chunk;chunk=(0,util_1.next)(chunk))str+=chunk.data;return this._view=str}name(){return"str"}createChunk(id,str){return new StrChunk(id,str?str.length:0,str||"")}onChange(){this._view=""}toStringName(){return this.name()}}exports.StrNode=StrNode},"./node_modules/json-joy/lib/json-crdt/nodes/types.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},"./node_modules/json-joy/lib/json-crdt/nodes/val/ValNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ValNode=void 0;const clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),Model_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/model/Model.js");exports.ValNode=class ValNode{constructor(doc,id,val){this.doc=doc,this.id=id,this.val=val,this.api=void 0}set(val){if((0,clock_1.compare)(val,this.val)<=0&&0!==this.val.sid)return;if((0,clock_1.compare)(val,this.id)<=0)return;const oldVal=this.val;return this.val=val,oldVal}node(){return 0===this.val.sid?Model_1.UNDEFINED:this.child()}view(){return this.node()?.view()}children(callback){callback(this.node())}child(){return this.doc.index.get(this.val)}container(){const child=this.node();return child?child.container():void 0}name(){return"val"}toString(tab=""){const node=this.node();return this.name()+" "+(0,clock_1.printTs)(this.id)+(0,printTree_1.printTree)(tab,[tab=>node?node.toString(tab):(0,clock_1.printTs)(this.val)])}}},"./node_modules/json-joy/lib/json-crdt/nodes/vec/VecNode.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.VecNode=void 0;const ConNode_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt/nodes/const/ConNode.js"),printTree_1=__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),clock_1=__webpack_require__("./node_modules/json-joy/lib/json-crdt-patch/clock/index.js");exports.VecNode=class VecNode{constructor(doc,id){this.doc=doc,this.id=id,this.elements=[],this.__extNode=void 0,this._view=[],this.api=void 0}val(index){return this.elements[index]}get(index){const id=this.elements[index];if(id)return this.doc.index.get(id)}put(index,id){if(index>255)throw new Error("OUT_OF_BOUNDS");const currentId=this.val(index);if(!(currentId&&(0,clock_1.compare)(currentId,id)>=0)){if(index>this.elements.length)for(let i=this.elements.length;i<index;i++)this.elements.push(void 0);return index<this.elements.length?this.elements[index]=id:this.elements.push(id),currentId}}ext(){if(this.__extNode)return this.__extNode;const extensionId=this.getExtId();if(!(extensionId>=0))return;const extension=this.doc.ext.get(extensionId);return extension?(this.__extNode=new extension.Node(this.get(1)),this.__extNode):void 0}isExt(){return!!this.ext()}getExtId(){if(2!==this.elements.length)return-1;const type=this.get(0);if(!(type instanceof ConNode_1.ConNode))return-1;const buf=type.val,id=this.id;return buf instanceof Uint8Array&&3===buf.length&&buf[1]===id.sid%256&&buf[2]===id.time%256?buf[0]:-1}child(){return this.ext()}container(){return this}children(callback){const elements=this.elements,length=elements.length,index=this.doc.index;for(let i=0;i<length;i++){const id=elements[i];if(!id)continue;const node=index.get(id);node&&callback(node)}}view(){const extNode=this.ext();if(extNode)return extNode.view();let useCache=!0;const _view=this._view,arr=[],index=this.doc.index,elements=this.elements,length=elements.length;for(let i=0;i<length;i++){const id=elements[i],node=id?index.get(id):void 0,value=node?node.view():void 0;_view[i]!==value&&(useCache=!1),arr.push(value)}return useCache?_view:this._view=arr}name(){return"vec"}toString(tab=""){const extNode=this.ext(),header=this.name()+" "+(0,clock_1.printTs)(this.id)+(extNode?` { extension = ${this.getExtId()} }`:"");if(extNode)return this.child().toString(tab,this.id);const index=this.doc.index;return header+(0,printTree_1.printTree)(tab,[...this.elements.map((id,i)=>tab=>`${i}: ${id&&index.get(id)?index.get(id).toString(tab+"  "+" ".repeat((""+i).length)):"nil"}`),...extNode?[tab=>`${this.child().toString(tab)}`]:[]])}}},"./node_modules/json-joy/lib/json-equal/deepEqual/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/json-joy/lib/json-equal/deepEqual/v5.js"),exports)},"./node_modules/json-joy/lib/json-equal/deepEqual/v5.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.deepEqual=void 0;const isArray=Array.isArray;exports.deepEqual=(a,b)=>{if(a===b)return!0;let length,i,keys;if(isArray(a)){if(!isArray(b))return!1;if(length=a.length,length!==b.length)return!1;for(i=length;0!==i--;)if(!(0,exports.deepEqual)(a[i],b[i]))return!1;return!0}if(a&&b&&"object"==typeof a&&"object"==typeof b){if(keys=Object.keys(a),length=keys.length,length!==Object.keys(b).length)return!1;if(isArray(b))return!1;for(i=length;0!==i--;){const key=keys[i];if(!(0,exports.deepEqual)(a[key],b[key]))return!1}return!0}return!1}},"./node_modules/json-joy/lib/json-hash/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.hash=exports.updateJson=exports.updateStr=exports.updateNum=void 0;const insertion_1=__webpack_require__("./node_modules/@jsonjoy.com/util/lib/sort/insertion.js");exports.updateNum=(state,num)=>(state<<5)+state+num;exports.updateStr=(state,str)=>{let i=str.length;for(;i;)state=(state<<5)+state+str.charCodeAt(--i);return state};exports.updateJson=(state,json)=>{switch(typeof json){case"number":return(0,exports.updateNum)(state,json);case"string":return state=(0,exports.updateNum)(state,982453601),(0,exports.updateStr)(state,json);case"object":{if(null===json)return(0,exports.updateNum)(state,982452847);if(json instanceof Array){const length=json.length;state=(0,exports.updateNum)(state,982452259);for(let i=0;i<length;i++)state=(0,exports.updateJson)(state,json[i]);return state}state=(0,exports.updateNum)(state,982454533);const keys=(0,insertion_1.sort)(Object.keys(json)),length=keys.length;for(let i=0;i<length;i++){const key=keys[i];state=(0,exports.updateStr)(state,key),state=(0,exports.updateJson)(state,json[key])}return state}case"boolean":return(0,exports.updateNum)(state,json?982453247:982454243)}return state};exports.hash=json=>(0,exports.updateJson)(5381,json)>>>0},"./node_modules/json-joy/lib/json-pretty/index.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.prettyOneLine=void 0;exports.prettyOneLine=value=>{let json=JSON.stringify(value);return json=json.replace(/([\{\[\:\,])/g,"$1 ").replace(/([\}\]])/g," $1"),json}},"./node_modules/json-joy/lib/json-text/stringify.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.stringify=void 0;exports.stringify=(value,spacing=" ")=>{switch(value){case null:return"!n";case void 0:return"!u";case!0:return"!t";case!1:return"!f"}if(Array.isArray(value))return`[${spacing}${value.map(v=>(0,exports.stringify)(v,spacing)).join(","+spacing)}${spacing}]`;if(value instanceof Uint8Array)return`${value}`;switch(typeof value){case"number":return`${value}`;case"string":return JSON.stringify(value);case"object":{const keys=Object.keys(value);return`{${spacing}${keys.map(k=>`${k}${spacing}=${spacing}${(0,exports.stringify)(value[k],spacing)}`).join(","+spacing)}${spacing}}`}}return"?"}},"./node_modules/json-joy/lib/util/iterator.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.iter=exports.IterRes=exports.UndefEndIter=void 0;class UndefEndIter{constructor(i){this.i=i}next(){const value=this.i();return new IterRes(value,void 0===value)}[Symbol.iterator](){return this}}exports.UndefEndIter=UndefEndIter;class IterRes{constructor(value,done){this.value=value,this.done=done}}exports.IterRes=IterRes;exports.iter=i=>new UndefEndIter(i)},"./node_modules/lodash-es/_cloneBuffer.js":(module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _root_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash-es/_root.js");module=__webpack_require__.hmd(module);var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,Buffer=freeModule&&freeModule.exports===freeExports?_root_js__WEBPACK_IMPORTED_MODULE_0__.A.Buffer:void 0,allocUnsafe=Buffer?Buffer.allocUnsafe:void 0;const __WEBPACK_DEFAULT_EXPORT__=function cloneBuffer(buffer,isDeep){if(isDeep)return buffer.slice();var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);return buffer.copy(result),result}},"./node_modules/lodash-es/_freeGlobal.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g},"./node_modules/lodash-es/_nodeUtil.js":(module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _freeGlobal_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash-es/_freeGlobal.js");module=__webpack_require__.hmd(module);var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,freeProcess=freeModule&&freeModule.exports===freeExports&&_freeGlobal_js__WEBPACK_IMPORTED_MODULE_0__.A.process;const __WEBPACK_DEFAULT_EXPORT__=function(){try{var types=freeModule&&freeModule.require&&freeModule.require("util").types;return types||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}()},"./node_modules/lodash-es/_root.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _freeGlobal_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/lodash-es/_freeGlobal.js"),freeSelf="object"==typeof self&&self&&self.Object===Object&&self;const __WEBPACK_DEFAULT_EXPORT__=_freeGlobal_js__WEBPACK_IMPORTED_MODULE_0__.A||freeSelf||Function("return this")()},"./node_modules/lodash-es/isBuffer.js":(module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>lodash_es_isBuffer});var _root=__webpack_require__("./node_modules/lodash-es/_root.js");const lodash_es_stubFalse=function stubFalse(){return!1};module=__webpack_require__.hmd(module);var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,Buffer=freeModule&&freeModule.exports===freeExports?_root.A.Buffer:void 0;const lodash_es_isBuffer=(Buffer?Buffer.isBuffer:void 0)||lodash_es_stubFalse},"./node_modules/lodash.clonedeep/index.js":(module,exports,__webpack_require__)=>{module=__webpack_require__.nmd(module);var argsTag="[object Arguments]",boolTag="[object Boolean]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",setTag="[object Set]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reFlags=/\w*$/,reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,cloneableTags={};cloneableTags[argsTag]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object DataView]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags[mapTag]=cloneableTags["[object Number]"]=cloneableTags["[object Object]"]=cloneableTags["[object RegExp]"]=cloneableTags[setTag]=cloneableTags["[object String]"]=cloneableTags["[object Symbol]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object WeakMap]"]=!1;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports;function addMapEntry(map,pair){return map.set(pair[0],pair[1]),map}function addSetEntry(set,value){return set.add(value),set}function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array?array.length:0;for(initAccum&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function isHostObject(value){var result=!1;if(null!=value&&"function"!=typeof value.toString)try{result=!!(value+"")}catch(e){}return result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}function overArg(func,transform){return function(arg){return func(transform(arg))}}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?root.Buffer:void 0,Symbol=root.Symbol,Uint8Array=root.Uint8Array,getPrototype=overArg(Object.getPrototypeOf,Object),objectCreate=Object.create,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,nativeKeys=overArg(Object.keys,Object),DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function Hash(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=entries?entries.length:0;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function Stack(entries){this.__data__=new ListCache(entries)}function arrayLikeKeys(value,inherited){var result=isArray(value)||function isArguments(value){return function isArrayLikeObject(value){return function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&isArrayLike(value)}(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}(value)?function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}(value.length,String):[],length=result.length,skipIndexes=!!length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isIndex(key,length))||result.push(key);return result}function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||(object[key]=value)}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseClone(value,isDeep,isFull,customizer,key,object,stack){var result;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),void 0!==result)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=function initCloneArray(array){var length=array.length,result=array.constructor(length);length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input);return result}(value),!isDeep)return function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));for(;++index<length;)array[index]=source[index];return array}(value,result)}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value))return function cloneBuffer(buffer,isDeep){if(isDeep)return buffer.slice();var result=new buffer.constructor(buffer.length);return buffer.copy(result),result}(value,isDeep);if("[object Object]"==tag||tag==argsTag||isFunc&&!object){if(isHostObject(value))return object?value:{};if(result=function initCloneObject(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:function baseCreate(proto){return isObject(proto)?objectCreate(proto):{}}(getPrototype(object))}(isFunc?{}:value),!isDeep)return function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}(value,function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=function initCloneByTag(object,tag,cloneFunc,isDeep){var Ctor=object.constructor;switch(tag){case"[object ArrayBuffer]":return cloneArrayBuffer(object);case boolTag:case"[object Date]":return new Ctor(+object);case dataViewTag:return function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case"[object Uint8ClampedArray]":case uint16Tag:case uint32Tag:return function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}(object,isDeep);case mapTag:return function cloneMap(map,isDeep,cloneFunc){var array=isDeep?cloneFunc(mapToArray(map),!0):mapToArray(map);return arrayReduce(array,addMapEntry,new map.constructor)}(object,isDeep,cloneFunc);case"[object Number]":case"[object String]":return new Ctor(object);case"[object RegExp]":return function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result}(object);case setTag:return function cloneSet(set,isDeep,cloneFunc){var array=isDeep?cloneFunc(setToArray(set),!0):setToArray(set);return arrayReduce(array,addSetEntry,new set.constructor)}(object,isDeep,cloneFunc);case"[object Symbol]":return function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}(object)}}(value,tag,baseClone,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked)return stacked;if(stack.set(value,result),!isArr)var props=isFull?function getAllKeys(object){return function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}(result,symbolsFunc(object))}(object,keys,getSymbols)}(value):keys(value);return function arrayEach(array,iteratee){for(var index=-1,length=array?array.length:0;++index<length&&!1!==iteratee(array[index],index,array););return array}(props||value,function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,isDeep,isFull,customizer,key,value,stack))}),result}function baseIsNative(value){return!(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))&&(isFunction(value)||isHostObject(value)?reIsNative:reIsHostCtor).test(toSource(value))}function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array(result).set(new Uint8Array(arrayBuffer)),result}function copyObject(source,props,object,customizer){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;assignValue(object,key,void 0===newValue?source[key]:newValue)}return object}function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{}},Hash.prototype.delete=function hashDelete(key){return this.has(key)&&delete this.__data__[key]},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){return this.__data__[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[]},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?data.push([key,value]):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){return getMapData(this,key).delete(key)},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){return getMapData(this,key).set(key,value),this},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache},Stack.prototype.delete=function stackDelete(key){return this.__data__.delete(key)},Stack.prototype.get=function stackGet(key){return this.__data__.get(key)},Stack.prototype.has=function stackHas(key){return this.__data__.has(key)},Stack.prototype.set=function stackSet(key,value){var cache=this.__data__;if(cache instanceof ListCache){var pairs=cache.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this;cache=this.__data__=new MapCache(pairs)}return cache.set(key,value),this};var getSymbols=nativeGetSymbols?overArg(nativeGetSymbols,Object):function stubArray(){return[]},getTag=function baseGetTag(value){return objectToString.call(value)};function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto)}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function eq(value,other){return value===other||value!=value&&other!=other}(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&"[object WeakMap]"!=getTag(new WeakMap))&&(getTag=function(value){var result=objectToString.call(value),Ctor="[object Object]"==result?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):void 0;if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return"[object WeakMap]"}return result});var isArray=Array.isArray;function isArrayLike(value){return null!=value&&function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991}(value.length)&&!isFunction(value)}var isBuffer=nativeIsBuffer||function stubFalse(){return!1};function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function keys(object){return isArrayLike(object)?arrayLikeKeys(object):function baseKeys(object){if(!isPrototype(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}(object)}module.exports=function cloneDeep(value){return baseClone(value,!0,!0)}},"./node_modules/lodash.isequal/index.js":(module,exports,__webpack_require__)=>{module=__webpack_require__.nmd(module);var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",mapTag="[object Map]",objectTag="[object Object]",setTag="[object Set]",dataViewTag="[object DataView]",reIsHostCtor=/^\[object .+?Constructor\]$/,reIsUint=/^(?:0|[1-9]\d*)$/,typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags[argsTag]=typedArrayTags["[object Array]"]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags["[object Boolean]"]=typedArrayTags["[object DataView]"]=typedArrayTags["[object Date]"]=typedArrayTags["[object Error]"]=typedArrayTags["[object Function]"]=typedArrayTags[mapTag]=typedArrayTags["[object Number]"]=typedArrayTags[objectTag]=typedArrayTags["[object RegExp]"]=typedArrayTags[setTag]=typedArrayTags["[object String]"]=typedArrayTags["[object WeakMap]"]=!1;var freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),freeExports=exports&&!exports.nodeType&&exports,freeModule=freeExports&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,freeProcess=moduleExports&&freeGlobal.process,nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}var uid,arrayProto=Array.prototype,funcProto=Function.prototype,objectProto=Object.prototype,coreJsData=root["__core-js_shared__"],funcToString=funcProto.toString,hasOwnProperty=objectProto.hasOwnProperty,maskSrcKey=(uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"",nativeObjectToString=objectProto.toString,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Buffer=moduleExports?root.Buffer:void 0,Symbol=root.Symbol,Uint8Array=root.Uint8Array,propertyIsEnumerable=objectProto.propertyIsEnumerable,splice=arrayProto.splice,symToStringTag=Symbol?Symbol.toStringTag:void 0,nativeGetSymbols=Object.getOwnPropertySymbols,nativeIsBuffer=Buffer?Buffer.isBuffer:void 0,nativeKeys=function overArg(func,transform){return function(arg){return func(transform(arg))}}(Object.keys,Object),DataView=getNative(root,"DataView"),Map=getNative(root,"Map"),Promise=getNative(root,"Promise"),Set=getNative(root,"Set"),WeakMap=getNative(root,"WeakMap"),nativeCreate=getNative(Object,"create"),dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),symbolProto=Symbol?Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}(value.length,String):[],length=result.length;for(var key in value)!inherited&&!hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}function baseGetTag(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]);return result}(value):function objectToString(value){return nativeObjectToString.call(value)}(value)}function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!=value&&other!=other:function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other),objIsObj=(objTag=objTag==argsTag?objectTag:objTag)==objectTag,othIsObj=(othTag=othTag==argsTag?objectTag:othTag)==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new Stack),objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case"[object ArrayBuffer]":return!(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other)));case boolTag:case"[object Date]":case"[object Number]":return eq(+object,+other);case"[object Error]":return object.name==other.name&&object.message==other.message;case"[object RegExp]":case"[object String]":return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=1&bitmask;if(convert||(convert=setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=2,stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case"[object Symbol]":if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(1&bitmask)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag)return!1;return stack||(stack=new Stack),function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial)return!1;var index=objLength;for(;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key)))return!1}var stacked=stack.get(object);if(stacked&&stack.get(other))return stacked==other;var result=!0;stack.set(object,other),stack.set(other,object);var skipCtor=isPartial;for(;++index<objLength;){var objValue=object[key=objProps[index]],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor==othCtor||!("constructor"in object)||!("constructor"in other)||"function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor||(result=!1)}return stack.delete(object),stack.delete(other),result}(object,other,bitmask,customizer,equalFunc,stack)}(value,other,bitmask,customizer,baseIsEqual,stack))}function baseIsNative(value){return!(!isObject(value)||function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}(value))&&(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}function baseKeys(object){if(!function isPrototype(value){var Ctor=value&&value.constructor,proto="function"==typeof Ctor&&Ctor.prototype||objectProto;return value===proto}(object))return nativeKeys(object);var result=[];for(var key in Object(object))hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result}function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var stacked=stack.get(array);if(stacked&&stack.get(other))return stacked==other;var index=-1,result=!0,seen=2&bitmask?new SetCache:void 0;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(seen){if(!arraySome(other,function(othValue,othIndex){if(key=othIndex,!seen.has(key)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex);var key})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}function getAllKeys(object){return function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}(result,symbolsFunc(object))}(object,keys,getSymbols)}function getMapData(map,key){var data=map.__data__;return function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value}(key)?data["string"==typeof key?"string":"hash"]:data.map}function getNative(object,key){var value=function getValue(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(value)?value:void 0}Hash.prototype.clear=function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0},Hash.prototype.delete=function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result},Hash.prototype.get=function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return hasOwnProperty.call(data,key)?data[key]:void 0},Hash.prototype.has=function hashHas(key){var data=this.__data__;return nativeCreate?void 0!==data[key]:hasOwnProperty.call(data,key)},Hash.prototype.set=function hashSet(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this},ListCache.prototype.clear=function listCacheClear(){this.__data__=[],this.size=0},ListCache.prototype.delete=function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)},ListCache.prototype.get=function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?void 0:data[index][1]},ListCache.prototype.has=function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1},ListCache.prototype.set=function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this},MapCache.prototype.clear=function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}},MapCache.prototype.delete=function mapCacheDelete(key){var result=getMapData(this,key).delete(key);return this.size-=result?1:0,result},MapCache.prototype.get=function mapCacheGet(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function mapCacheHas(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this},SetCache.prototype.add=SetCache.prototype.push=function setCacheAdd(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function setCacheHas(value){return this.__data__.has(value)},Stack.prototype.clear=function stackClear(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function stackDelete(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result},Stack.prototype.get=function stackGet(key){return this.__data__.get(key)},Stack.prototype.has=function stackHas(key){return this.__data__.has(key)},Stack.prototype.set=function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this};var getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}(nativeGetSymbols(object),function(symbol){return propertyIsEnumerable.call(object,symbol)}))}:function stubArray(){return[]},getTag=baseGetTag;function isIndex(value,length){return!!(length=null==length?9007199254740991:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}function eq(value,other){return value===other||value!=value&&other!=other}(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&"[object Promise]"!=getTag(Promise.resolve())||Set&&getTag(new Set)!=setTag||WeakMap&&"[object WeakMap]"!=getTag(new WeakMap))&&(getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:void 0,ctorString=Ctor?toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return"[object Promise]";case setCtorString:return setTag;case weakMapCtorString:return"[object WeakMap]"}return result});var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")},isArray=Array.isArray;var isBuffer=nativeIsBuffer||function stubFalse(){return!1};function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return"[object Function]"==tag||"[object GeneratorFunction]"==tag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function isObjectLike(value){return null!=value&&"object"==typeof value}var isTypedArray=nodeIsTypedArray?function baseUnary(func){return function(value){return func(value)}}(nodeIsTypedArray):function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]};function keys(object){return function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}(object)?arrayLikeKeys(object):baseKeys(object)}module.exports=function isEqual(value,other){return baseIsEqual(value,other)}},"./node_modules/quill-delta/dist/AttributeMap.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const cloneDeep=__webpack_require__("./node_modules/lodash.clonedeep/index.js"),isEqual=__webpack_require__("./node_modules/lodash.isequal/index.js");var AttributeMap;!function(AttributeMap){AttributeMap.compose=function compose(a={},b={},keepNull=!1){"object"!=typeof a&&(a={}),"object"!=typeof b&&(b={});let attributes=cloneDeep(b);keepNull||(attributes=Object.keys(attributes).reduce((copy,key)=>(null!=attributes[key]&&(copy[key]=attributes[key]),copy),{}));for(const key in a)void 0!==a[key]&&void 0===b[key]&&(attributes[key]=a[key]);return Object.keys(attributes).length>0?attributes:void 0},AttributeMap.diff=function diff(a={},b={}){"object"!=typeof a&&(a={}),"object"!=typeof b&&(b={});const attributes=Object.keys(a).concat(Object.keys(b)).reduce((attrs,key)=>(isEqual(a[key],b[key])||(attrs[key]=void 0===b[key]?null:b[key]),attrs),{});return Object.keys(attributes).length>0?attributes:void 0},AttributeMap.invert=function invert(attr={},base={}){attr=attr||{};const baseInverted=Object.keys(base).reduce((memo,key)=>(base[key]!==attr[key]&&void 0!==attr[key]&&(memo[key]=base[key]),memo),{});return Object.keys(attr).reduce((memo,key)=>(attr[key]!==base[key]&&void 0===base[key]&&(memo[key]=null),memo),baseInverted)},AttributeMap.transform=function transform(a,b,priority=!1){if("object"!=typeof a)return b;if("object"!=typeof b)return;if(!priority)return b;const attributes=Object.keys(b).reduce((attrs,key)=>(void 0===a[key]&&(attrs[key]=b[key]),attrs),{});return Object.keys(attributes).length>0?attributes:void 0}}(AttributeMap||(AttributeMap={})),exports.default=AttributeMap},"./node_modules/quill-delta/dist/Delta.js":(module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AttributeMap=exports.OpIterator=exports.Op=void 0;const diff=__webpack_require__("./node_modules/fast-diff/diff.js"),cloneDeep=__webpack_require__("./node_modules/lodash.clonedeep/index.js"),isEqual=__webpack_require__("./node_modules/lodash.isequal/index.js"),AttributeMap_1=__webpack_require__("./node_modules/quill-delta/dist/AttributeMap.js");exports.AttributeMap=AttributeMap_1.default;const Op_1=__webpack_require__("./node_modules/quill-delta/dist/Op.js");exports.Op=Op_1.default;const OpIterator_1=__webpack_require__("./node_modules/quill-delta/dist/OpIterator.js");exports.OpIterator=OpIterator_1.default;const NULL_CHARACTER=String.fromCharCode(0),getEmbedTypeAndData=(a,b)=>{if("object"!=typeof a||null===a)throw new Error("cannot retain a "+typeof a);if("object"!=typeof b||null===b)throw new Error("cannot retain a "+typeof b);const embedType=Object.keys(a)[0];if(!embedType||embedType!==Object.keys(b)[0])throw new Error(`embed types not matched: ${embedType} != ${Object.keys(b)[0]}`);return[embedType,a[embedType],b[embedType]]};class Delta{constructor(ops){Array.isArray(ops)?this.ops=ops:null!=ops&&Array.isArray(ops.ops)?this.ops=ops.ops:this.ops=[]}static registerEmbed(embedType,handler){this.handlers[embedType]=handler}static unregisterEmbed(embedType){delete this.handlers[embedType]}static getHandler(embedType){const handler=this.handlers[embedType];if(!handler)throw new Error(`no handlers for embed type "${embedType}"`);return handler}insert(arg,attributes){const newOp={};return"string"==typeof arg&&0===arg.length?this:(newOp.insert=arg,null!=attributes&&"object"==typeof attributes&&Object.keys(attributes).length>0&&(newOp.attributes=attributes),this.push(newOp))}delete(length){return length<=0?this:this.push({delete:length})}retain(length,attributes){if("number"==typeof length&&length<=0)return this;const newOp={retain:length};return null!=attributes&&"object"==typeof attributes&&Object.keys(attributes).length>0&&(newOp.attributes=attributes),this.push(newOp)}push(newOp){let index=this.ops.length,lastOp=this.ops[index-1];if(newOp=cloneDeep(newOp),"object"==typeof lastOp){if("number"==typeof newOp.delete&&"number"==typeof lastOp.delete)return this.ops[index-1]={delete:lastOp.delete+newOp.delete},this;if("number"==typeof lastOp.delete&&null!=newOp.insert&&(index-=1,lastOp=this.ops[index-1],"object"!=typeof lastOp))return this.ops.unshift(newOp),this;if(isEqual(newOp.attributes,lastOp.attributes)){if("string"==typeof newOp.insert&&"string"==typeof lastOp.insert)return this.ops[index-1]={insert:lastOp.insert+newOp.insert},"object"==typeof newOp.attributes&&(this.ops[index-1].attributes=newOp.attributes),this;if("number"==typeof newOp.retain&&"number"==typeof lastOp.retain)return this.ops[index-1]={retain:lastOp.retain+newOp.retain},"object"==typeof newOp.attributes&&(this.ops[index-1].attributes=newOp.attributes),this}}return index===this.ops.length?this.ops.push(newOp):this.ops.splice(index,0,newOp),this}chop(){const lastOp=this.ops[this.ops.length-1];return lastOp&&"number"==typeof lastOp.retain&&!lastOp.attributes&&this.ops.pop(),this}filter(predicate){return this.ops.filter(predicate)}forEach(predicate){this.ops.forEach(predicate)}map(predicate){return this.ops.map(predicate)}partition(predicate){const passed=[],failed=[];return this.forEach(op=>{(predicate(op)?passed:failed).push(op)}),[passed,failed]}reduce(predicate,initialValue){return this.ops.reduce(predicate,initialValue)}changeLength(){return this.reduce((length,elem)=>elem.insert?length+Op_1.default.length(elem):elem.delete?length-elem.delete:length,0)}length(){return this.reduce((length,elem)=>length+Op_1.default.length(elem),0)}slice(start=0,end=1/0){const ops=[],iter=new OpIterator_1.default(this.ops);let index=0;for(;index<end&&iter.hasNext();){let nextOp;index<start?nextOp=iter.next(start-index):(nextOp=iter.next(end-index),ops.push(nextOp)),index+=Op_1.default.length(nextOp)}return new Delta(ops)}compose(other){const thisIter=new OpIterator_1.default(this.ops),otherIter=new OpIterator_1.default(other.ops),ops=[],firstOther=otherIter.peek();if(null!=firstOther&&"number"==typeof firstOther.retain&&null==firstOther.attributes){let firstLeft=firstOther.retain;for(;"insert"===thisIter.peekType()&&thisIter.peekLength()<=firstLeft;)firstLeft-=thisIter.peekLength(),ops.push(thisIter.next());firstOther.retain-firstLeft>0&&otherIter.next(firstOther.retain-firstLeft)}const delta=new Delta(ops);for(;thisIter.hasNext()||otherIter.hasNext();)if("insert"===otherIter.peekType())delta.push(otherIter.next());else if("delete"===thisIter.peekType())delta.push(thisIter.next());else{const length=Math.min(thisIter.peekLength(),otherIter.peekLength()),thisOp=thisIter.next(length),otherOp=otherIter.next(length);if(otherOp.retain){const newOp={};if("number"==typeof thisOp.retain)newOp.retain="number"==typeof otherOp.retain?length:otherOp.retain;else if("number"==typeof otherOp.retain)null==thisOp.retain?newOp.insert=thisOp.insert:newOp.retain=thisOp.retain;else{const action=null==thisOp.retain?"insert":"retain",[embedType,thisData,otherData]=getEmbedTypeAndData(thisOp[action],otherOp.retain),handler=Delta.getHandler(embedType);newOp[action]={[embedType]:handler.compose(thisData,otherData,"retain"===action)}}const attributes=AttributeMap_1.default.compose(thisOp.attributes,otherOp.attributes,"number"==typeof thisOp.retain);if(attributes&&(newOp.attributes=attributes),delta.push(newOp),!otherIter.hasNext()&&isEqual(delta.ops[delta.ops.length-1],newOp)){const rest=new Delta(thisIter.rest());return delta.concat(rest).chop()}}else"number"==typeof otherOp.delete&&("number"==typeof thisOp.retain||"object"==typeof thisOp.retain&&null!==thisOp.retain)&&delta.push(otherOp)}return delta.chop()}concat(other){const delta=new Delta(this.ops.slice());return other.ops.length>0&&(delta.push(other.ops[0]),delta.ops=delta.ops.concat(other.ops.slice(1))),delta}diff(other,cursor){if(this.ops===other.ops)return new Delta;const strings=[this,other].map(delta=>delta.map(op=>{if(null!=op.insert)return"string"==typeof op.insert?op.insert:NULL_CHARACTER;throw new Error("diff() called "+(delta===other?"on":"with")+" non-document")}).join("")),retDelta=new Delta,diffResult=diff(strings[0],strings[1],cursor,!0),thisIter=new OpIterator_1.default(this.ops),otherIter=new OpIterator_1.default(other.ops);return diffResult.forEach(component=>{let length=component[1].length;for(;length>0;){let opLength=0;switch(component[0]){case diff.INSERT:opLength=Math.min(otherIter.peekLength(),length),retDelta.push(otherIter.next(opLength));break;case diff.DELETE:opLength=Math.min(length,thisIter.peekLength()),thisIter.next(opLength),retDelta.delete(opLength);break;case diff.EQUAL:opLength=Math.min(thisIter.peekLength(),otherIter.peekLength(),length);const thisOp=thisIter.next(opLength),otherOp=otherIter.next(opLength);isEqual(thisOp.insert,otherOp.insert)?retDelta.retain(opLength,AttributeMap_1.default.diff(thisOp.attributes,otherOp.attributes)):retDelta.push(otherOp).delete(opLength)}length-=opLength}}),retDelta.chop()}eachLine(predicate,newline="\n"){const iter=new OpIterator_1.default(this.ops);let line=new Delta,i=0;for(;iter.hasNext();){if("insert"!==iter.peekType())return;const thisOp=iter.peek(),start=Op_1.default.length(thisOp)-iter.peekLength(),index="string"==typeof thisOp.insert?thisOp.insert.indexOf(newline,start)-start:-1;if(index<0)line.push(iter.next());else if(index>0)line.push(iter.next(index));else{if(!1===predicate(line,iter.next(1).attributes||{},i))return;i+=1,line=new Delta}}line.length()>0&&predicate(line,{},i)}invert(base){const inverted=new Delta;return this.reduce((baseIndex,op)=>{if(op.insert)inverted.delete(Op_1.default.length(op));else{if("number"==typeof op.retain&&null==op.attributes)return inverted.retain(op.retain),baseIndex+op.retain;if(op.delete||"number"==typeof op.retain){const length=op.delete||op.retain;return base.slice(baseIndex,baseIndex+length).forEach(baseOp=>{op.delete?inverted.push(baseOp):op.retain&&op.attributes&&inverted.retain(Op_1.default.length(baseOp),AttributeMap_1.default.invert(op.attributes,baseOp.attributes))}),baseIndex+length}if("object"==typeof op.retain&&null!==op.retain){const slice=base.slice(baseIndex,baseIndex+1),baseOp=new OpIterator_1.default(slice.ops).next(),[embedType,opData,baseOpData]=getEmbedTypeAndData(op.retain,baseOp.insert),handler=Delta.getHandler(embedType);return inverted.retain({[embedType]:handler.invert(opData,baseOpData)},AttributeMap_1.default.invert(op.attributes,baseOp.attributes)),baseIndex+1}}return baseIndex},0),inverted.chop()}transform(arg,priority=!1){if(priority=!!priority,"number"==typeof arg)return this.transformPosition(arg,priority);const other=arg,thisIter=new OpIterator_1.default(this.ops),otherIter=new OpIterator_1.default(other.ops),delta=new Delta;for(;thisIter.hasNext()||otherIter.hasNext();)if("insert"!==thisIter.peekType()||!priority&&"insert"===otherIter.peekType())if("insert"===otherIter.peekType())delta.push(otherIter.next());else{const length=Math.min(thisIter.peekLength(),otherIter.peekLength()),thisOp=thisIter.next(length),otherOp=otherIter.next(length);if(thisOp.delete)continue;if(otherOp.delete)delta.push(otherOp);else{const thisData=thisOp.retain,otherData=otherOp.retain;let transformedData="object"==typeof otherData&&null!==otherData?otherData:length;if("object"==typeof thisData&&null!==thisData&&"object"==typeof otherData&&null!==otherData){const embedType=Object.keys(thisData)[0];if(embedType===Object.keys(otherData)[0]){const handler=Delta.getHandler(embedType);handler&&(transformedData={[embedType]:handler.transform(thisData[embedType],otherData[embedType],priority)})}}delta.retain(transformedData,AttributeMap_1.default.transform(thisOp.attributes,otherOp.attributes,priority))}}else delta.retain(Op_1.default.length(thisIter.next()));return delta.chop()}transformPosition(index,priority=!1){priority=!!priority;const thisIter=new OpIterator_1.default(this.ops);let offset=0;for(;thisIter.hasNext()&&offset<=index;){const length=thisIter.peekLength(),nextType=thisIter.peekType();thisIter.next(),"delete"!==nextType?("insert"===nextType&&(offset<index||!priority)&&(index+=length),offset+=length):index-=Math.min(length,index-offset)}return index}}Delta.Op=Op_1.default,Delta.OpIterator=OpIterator_1.default,Delta.AttributeMap=AttributeMap_1.default,Delta.handlers={},exports.default=Delta,module.exports=Delta,module.exports.default=Delta},"./node_modules/quill-delta/dist/Op.js":(__unused_webpack_module,exports)=>{"use strict";var Op;Object.defineProperty(exports,"__esModule",{value:!0}),function(Op){Op.length=function length(op){return"number"==typeof op.delete?op.delete:"number"==typeof op.retain?op.retain:"object"==typeof op.retain&&null!==op.retain?1:"string"==typeof op.insert?op.insert.length:1}}(Op||(Op={})),exports.default=Op},"./node_modules/quill-delta/dist/OpIterator.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Op_1=__webpack_require__("./node_modules/quill-delta/dist/Op.js");exports.default=class Iterator{constructor(ops){this.ops=ops,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(length){length||(length=1/0);const nextOp=this.ops[this.index];if(nextOp){const offset=this.offset,opLength=Op_1.default.length(nextOp);if(length>=opLength-offset?(length=opLength-offset,this.index+=1,this.offset=0):this.offset+=length,"number"==typeof nextOp.delete)return{delete:length};{const retOp={};return nextOp.attributes&&(retOp.attributes=nextOp.attributes),"number"==typeof nextOp.retain?retOp.retain=length:"object"==typeof nextOp.retain&&null!==nextOp.retain?retOp.retain=nextOp.retain:"string"==typeof nextOp.insert?retOp.insert=nextOp.insert.substr(offset,length):retOp.insert=nextOp.insert,retOp}}return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?Op_1.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const op=this.ops[this.index];return op?"number"==typeof op.delete?"delete":"number"==typeof op.retain||"object"==typeof op.retain&&null!==op.retain?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(0===this.offset)return this.ops.slice(this.index);{const offset=this.offset,index=this.index,next=this.next(),rest=this.ops.slice(this.index);return this.offset=offset,this.index=index,[next].concat(rest)}}return[]}}},"./node_modules/quill/quill.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>quill});var parchment_namespaceObject={};__webpack_require__.r(parchment_namespaceObject),__webpack_require__.d(parchment_namespaceObject,{Attributor:()=>Attributor,AttributorStore:()=>AttributorStore$1,BlockBlot:()=>BlockBlot$1,ClassAttributor:()=>ClassAttributor$1,ContainerBlot:()=>ContainerBlot$1,EmbedBlot:()=>EmbedBlot$1,InlineBlot:()=>InlineBlot$1,LeafBlot:()=>LeafBlot$1,ParentBlot:()=>ParentBlot$1,Registry:()=>Registry,Scope:()=>Scope,ScrollBlot:()=>ScrollBlot$1,StyleAttributor:()=>StyleAttributor$1,TextBlot:()=>TextBlot$1});const _listCacheClear=function listCacheClear(){this.__data__=[],this.size=0};const lodash_es_eq=function eq(value,other){return value===other||value!=value&&other!=other};const _assocIndexOf=function assocIndexOf(array,key){for(var length=array.length;length--;)if(lodash_es_eq(array[length][0],key))return length;return-1};var splice=Array.prototype.splice;const _listCacheDelete=function listCacheDelete(key){var data=this.__data__,index=_assocIndexOf(data,key);return!(index<0)&&(index==data.length-1?data.pop():splice.call(data,index,1),--this.size,!0)};const _listCacheGet=function listCacheGet(key){var data=this.__data__,index=_assocIndexOf(data,key);return index<0?void 0:data[index][1]};const _listCacheHas=function listCacheHas(key){return _assocIndexOf(this.__data__,key)>-1};const _listCacheSet=function listCacheSet(key,value){var data=this.__data__,index=_assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this};function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}ListCache.prototype.clear=_listCacheClear,ListCache.prototype.delete=_listCacheDelete,ListCache.prototype.get=_listCacheGet,ListCache.prototype.has=_listCacheHas,ListCache.prototype.set=_listCacheSet;const _ListCache=ListCache;const _stackClear=function stackClear(){this.__data__=new _ListCache,this.size=0};const _stackDelete=function stackDelete(key){var data=this.__data__,result=data.delete(key);return this.size=data.size,result};const _stackGet=function stackGet(key){return this.__data__.get(key)};const _stackHas=function stackHas(key){return this.__data__.has(key)};var _root=__webpack_require__("./node_modules/lodash-es/_root.js");const _Symbol=_root.A.Symbol;var objectProto=Object.prototype,_getRawTag_hasOwnProperty=objectProto.hasOwnProperty,nativeObjectToString=objectProto.toString,symToStringTag=_Symbol?_Symbol.toStringTag:void 0;const _getRawTag=function getRawTag(value){var isOwn=_getRawTag_hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString.call(value);return unmasked&&(isOwn?value[symToStringTag]=tag:delete value[symToStringTag]),result};var _objectToString_nativeObjectToString=Object.prototype.toString;const _objectToString=function objectToString(value){return _objectToString_nativeObjectToString.call(value)};var _baseGetTag_symToStringTag=_Symbol?_Symbol.toStringTag:void 0;const _baseGetTag=function baseGetTag(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":_baseGetTag_symToStringTag&&_baseGetTag_symToStringTag in Object(value)?_getRawTag(value):_objectToString(value)};const lodash_es_isObject=function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)};const lodash_es_isFunction=function isFunction(value){if(!lodash_es_isObject(value))return!1;var tag=_baseGetTag(value);return"[object Function]"==tag||"[object GeneratorFunction]"==tag||"[object AsyncFunction]"==tag||"[object Proxy]"==tag};const _coreJsData=_root.A["__core-js_shared__"];var uid,maskSrcKey=(uid=/[^.]+$/.exec(_coreJsData&&_coreJsData.keys&&_coreJsData.keys.IE_PROTO||""))?"Symbol(src)_1."+uid:"";const _isMasked=function isMasked(func){return!!maskSrcKey&&maskSrcKey in func};var funcToString=Function.prototype.toString;const _toSource=function toSource(func){if(null!=func){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""};var reIsHostCtor=/^\[object .+?Constructor\]$/,_baseIsNative_funcProto=Function.prototype,_baseIsNative_objectProto=Object.prototype,_baseIsNative_funcToString=_baseIsNative_funcProto.toString,_baseIsNative_hasOwnProperty=_baseIsNative_objectProto.hasOwnProperty,reIsNative=RegExp("^"+_baseIsNative_funcToString.call(_baseIsNative_hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const _baseIsNative=function baseIsNative(value){return!(!lodash_es_isObject(value)||_isMasked(value))&&(lodash_es_isFunction(value)?reIsNative:reIsHostCtor).test(_toSource(value))};const _getValue=function getValue(object,key){return null==object?void 0:object[key]};const _getNative=function getNative(object,key){var value=_getValue(object,key);return _baseIsNative(value)?value:void 0};const _Map=_getNative(_root.A,"Map");const _nativeCreate=_getNative(Object,"create");const _hashClear=function hashClear(){this.__data__=_nativeCreate?_nativeCreate(null):{},this.size=0};const _hashDelete=function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];return this.size-=result?1:0,result};var _hashGet_hasOwnProperty=Object.prototype.hasOwnProperty;const _hashGet=function hashGet(key){var data=this.__data__;if(_nativeCreate){var result=data[key];return"__lodash_hash_undefined__"===result?void 0:result}return _hashGet_hasOwnProperty.call(data,key)?data[key]:void 0};var _hashHas_hasOwnProperty=Object.prototype.hasOwnProperty;const _hashHas=function hashHas(key){var data=this.__data__;return _nativeCreate?void 0!==data[key]:_hashHas_hasOwnProperty.call(data,key)};const _hashSet=function hashSet(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=_nativeCreate&&void 0===value?"__lodash_hash_undefined__":value,this};function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}Hash.prototype.clear=_hashClear,Hash.prototype.delete=_hashDelete,Hash.prototype.get=_hashGet,Hash.prototype.has=_hashHas,Hash.prototype.set=_hashSet;const _Hash=Hash;const _mapCacheClear=function mapCacheClear(){this.size=0,this.__data__={hash:new _Hash,map:new(_Map||_ListCache),string:new _Hash}};const _isKeyable=function isKeyable(value){var type=typeof value;return"string"==type||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value};const _getMapData=function getMapData(map,key){var data=map.__data__;return _isKeyable(key)?data["string"==typeof key?"string":"hash"]:data.map};const _mapCacheDelete=function mapCacheDelete(key){var result=_getMapData(this,key).delete(key);return this.size-=result?1:0,result};const _mapCacheGet=function mapCacheGet(key){return _getMapData(this,key).get(key)};const _mapCacheHas=function mapCacheHas(key){return _getMapData(this,key).has(key)};const _mapCacheSet=function mapCacheSet(key,value){var data=_getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this};function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}MapCache.prototype.clear=_mapCacheClear,MapCache.prototype.delete=_mapCacheDelete,MapCache.prototype.get=_mapCacheGet,MapCache.prototype.has=_mapCacheHas,MapCache.prototype.set=_mapCacheSet;const _MapCache=MapCache;const _stackSet=function stackSet(key,value){var data=this.__data__;if(data instanceof _ListCache){var pairs=data.__data__;if(!_Map||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new _MapCache(pairs)}return data.set(key,value),this.size=data.size,this};function Stack(entries){var data=this.__data__=new _ListCache(entries);this.size=data.size}Stack.prototype.clear=_stackClear,Stack.prototype.delete=_stackDelete,Stack.prototype.get=_stackGet,Stack.prototype.has=_stackHas,Stack.prototype.set=_stackSet;const _Stack=Stack;const _defineProperty=function(){try{var func=_getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}();const _baseAssignValue=function baseAssignValue(object,key,value){"__proto__"==key&&_defineProperty?_defineProperty(object,key,{configurable:!0,enumerable:!0,value,writable:!0}):object[key]=value};const _assignMergeValue=function assignMergeValue(object,key,value){(void 0!==value&&!lodash_es_eq(object[key],value)||void 0===value&&!(key in object))&&_baseAssignValue(object,key,value)};const _baseFor=function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object}}();var _cloneBuffer=__webpack_require__("./node_modules/lodash-es/_cloneBuffer.js");const _Uint8Array=_root.A.Uint8Array;const _cloneArrayBuffer=function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new _Uint8Array(result).set(new _Uint8Array(arrayBuffer)),result};const _cloneTypedArray=function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?_cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)};const _copyArray=function copyArray(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array};var objectCreate=Object.create;const _baseCreate=function(){function object(){}return function(proto){if(!lodash_es_isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;var result=new object;return object.prototype=void 0,result}}();const _overArg=function overArg(func,transform){return function(arg){return func(transform(arg))}};const _getPrototype=_overArg(Object.getPrototypeOf,Object);var _isPrototype_objectProto=Object.prototype;const _isPrototype=function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||_isPrototype_objectProto)};const _initCloneObject=function initCloneObject(object){return"function"!=typeof object.constructor||_isPrototype(object)?{}:_baseCreate(_getPrototype(object))};const lodash_es_isObjectLike=function isObjectLike(value){return null!=value&&"object"==typeof value};const _baseIsArguments=function baseIsArguments(value){return lodash_es_isObjectLike(value)&&"[object Arguments]"==_baseGetTag(value)};var isArguments_objectProto=Object.prototype,isArguments_hasOwnProperty=isArguments_objectProto.hasOwnProperty,propertyIsEnumerable=isArguments_objectProto.propertyIsEnumerable;const lodash_es_isArguments=_baseIsArguments(function(){return arguments}())?_baseIsArguments:function(value){return lodash_es_isObjectLike(value)&&isArguments_hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};const lodash_es_isArray=Array.isArray;const lodash_es_isLength=function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=9007199254740991};const lodash_es_isArrayLike=function isArrayLike(value){return null!=value&&lodash_es_isLength(value.length)&&!lodash_es_isFunction(value)};const lodash_es_isArrayLikeObject=function isArrayLikeObject(value){return lodash_es_isObjectLike(value)&&lodash_es_isArrayLike(value)};var isBuffer=__webpack_require__("./node_modules/lodash-es/isBuffer.js"),isPlainObject_funcProto=Function.prototype,isPlainObject_objectProto=Object.prototype,isPlainObject_funcToString=isPlainObject_funcProto.toString,isPlainObject_hasOwnProperty=isPlainObject_objectProto.hasOwnProperty,objectCtorString=isPlainObject_funcToString.call(Object);const lodash_es_isPlainObject=function isPlainObject(value){if(!lodash_es_isObjectLike(value)||"[object Object]"!=_baseGetTag(value))return!1;var proto=_getPrototype(value);if(null===proto)return!0;var Ctor=isPlainObject_hasOwnProperty.call(proto,"constructor")&&proto.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor&&isPlainObject_funcToString.call(Ctor)==objectCtorString};var typedArrayTags={};typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags["[object Arguments]"]=typedArrayTags["[object Array]"]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags["[object Boolean]"]=typedArrayTags["[object DataView]"]=typedArrayTags["[object Date]"]=typedArrayTags["[object Error]"]=typedArrayTags["[object Function]"]=typedArrayTags["[object Map]"]=typedArrayTags["[object Number]"]=typedArrayTags["[object Object]"]=typedArrayTags["[object RegExp]"]=typedArrayTags["[object Set]"]=typedArrayTags["[object String]"]=typedArrayTags["[object WeakMap]"]=!1;const _baseIsTypedArray=function baseIsTypedArray(value){return lodash_es_isObjectLike(value)&&lodash_es_isLength(value.length)&&!!typedArrayTags[_baseGetTag(value)]};const _baseUnary=function baseUnary(func){return function(value){return func(value)}};var _nodeUtil=__webpack_require__("./node_modules/lodash-es/_nodeUtil.js"),nodeIsTypedArray=_nodeUtil.A&&_nodeUtil.A.isTypedArray;const lodash_es_isTypedArray=nodeIsTypedArray?_baseUnary(nodeIsTypedArray):_baseIsTypedArray;const _safeGet=function safeGet(object,key){if(("constructor"!==key||"function"!=typeof object[key])&&"__proto__"!=key)return object[key]};var _assignValue_hasOwnProperty=Object.prototype.hasOwnProperty;const _assignValue=function assignValue(object,key,value){var objValue=object[key];_assignValue_hasOwnProperty.call(object,key)&&lodash_es_eq(objValue,value)&&(void 0!==value||key in object)||_baseAssignValue(object,key,value)};const _copyObject=function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;void 0===newValue&&(newValue=source[key]),isNew?_baseAssignValue(object,key,newValue):_assignValue(object,key,newValue)}return object};const _baseTimes=function baseTimes(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result};var reIsUint=/^(?:0|[1-9]\d*)$/;const _isIndex=function isIndex(value,length){var type=typeof value;return!!(length=null==length?9007199254740991:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&value>-1&&value%1==0&&value<length};var _arrayLikeKeys_hasOwnProperty=Object.prototype.hasOwnProperty;const _arrayLikeKeys=function arrayLikeKeys(value,inherited){var isArr=lodash_es_isArray(value),isArg=!isArr&&lodash_es_isArguments(value),isBuff=!isArr&&!isArg&&(0,isBuffer.A)(value),isType=!isArr&&!isArg&&!isBuff&&lodash_es_isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?_baseTimes(value.length,String):[],length=result.length;for(var key in value)!inherited&&!_arrayLikeKeys_hasOwnProperty.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||_isIndex(key,length))||result.push(key);return result};const _nativeKeysIn=function nativeKeysIn(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result};var _baseKeysIn_hasOwnProperty=Object.prototype.hasOwnProperty;const _baseKeysIn=function baseKeysIn(object){if(!lodash_es_isObject(object))return _nativeKeysIn(object);var isProto=_isPrototype(object),result=[];for(var key in object)("constructor"!=key||!isProto&&_baseKeysIn_hasOwnProperty.call(object,key))&&result.push(key);return result};const lodash_es_keysIn=function keysIn(object){return lodash_es_isArrayLike(object)?_arrayLikeKeys(object,!0):_baseKeysIn(object)};const lodash_es_toPlainObject=function toPlainObject(value){return _copyObject(value,lodash_es_keysIn(value))};const _baseMergeDeep=function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=_safeGet(object,key),srcValue=_safeGet(source,key),stacked=stack.get(srcValue);if(stacked)_assignMergeValue(object,key,stacked);else{var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):void 0,isCommon=void 0===newValue;if(isCommon){var isArr=lodash_es_isArray(srcValue),isBuff=!isArr&&(0,isBuffer.A)(srcValue),isTyped=!isArr&&!isBuff&&lodash_es_isTypedArray(srcValue);newValue=srcValue,isArr||isBuff||isTyped?lodash_es_isArray(objValue)?newValue=objValue:lodash_es_isArrayLikeObject(objValue)?newValue=_copyArray(objValue):isBuff?(isCommon=!1,newValue=(0,_cloneBuffer.A)(srcValue,!0)):isTyped?(isCommon=!1,newValue=_cloneTypedArray(srcValue,!0)):newValue=[]:lodash_es_isPlainObject(srcValue)||lodash_es_isArguments(srcValue)?(newValue=objValue,lodash_es_isArguments(objValue)?newValue=lodash_es_toPlainObject(objValue):lodash_es_isObject(objValue)&&!lodash_es_isFunction(objValue)||(newValue=_initCloneObject(srcValue))):isCommon=!1}isCommon&&(stack.set(srcValue,newValue),mergeFunc(newValue,srcValue,srcIndex,customizer,stack),stack.delete(srcValue)),_assignMergeValue(object,key,newValue)}};const _baseMerge=function baseMerge(object,source,srcIndex,customizer,stack){object!==source&&_baseFor(source,function(srcValue,key){if(stack||(stack=new _Stack),lodash_es_isObject(srcValue))_baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack);else{var newValue=customizer?customizer(_safeGet(object,key),srcValue,key+"",object,source,stack):void 0;void 0===newValue&&(newValue=srcValue),_assignMergeValue(object,key,newValue)}},lodash_es_keysIn)};const lodash_es_identity=function identity(value){return value};const _apply=function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)};var nativeMax=Math.max;const _overRest=function overRest(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),_apply(func,this,otherArgs)}};const lodash_es_constant=function constant(value){return function(){return value}};const _baseSetToString=_defineProperty?function(func,string){return _defineProperty(func,"toString",{configurable:!0,enumerable:!1,value:lodash_es_constant(string),writable:!0})}:lodash_es_identity;var nativeNow=Date.now;const _setToString=function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=800)return arguments[0]}else count=0;return func.apply(void 0,arguments)}}(_baseSetToString);const _baseRest=function baseRest(func,start){return _setToString(_overRest(func,start,lodash_es_identity),func+"")};const _isIterateeCall=function isIterateeCall(value,index,object){if(!lodash_es_isObject(object))return!1;var type=typeof index;return!!("number"==type?lodash_es_isArrayLike(object)&&_isIndex(index,object.length):"string"==type&&index in object)&&lodash_es_eq(object[index],value)};const lodash_es_merge=function createAssigner(assigner){return _baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:void 0,guard=length>2?sources[2]:void 0;for(customizer=assigner.length>3&&"function"==typeof customizer?(length--,customizer):void 0,guard&&_isIterateeCall(sources[0],sources[1],guard)&&(customizer=length<3?void 0:customizer,length=1),object=Object(object);++index<length;){var source=sources[index];source&&assigner(object,source,index,customizer)}return object})}(function(object,source,srcIndex){_baseMerge(object,source,srcIndex)});var Scope=(Scope2=>(Scope2[Scope2.TYPE=3]="TYPE",Scope2[Scope2.LEVEL=12]="LEVEL",Scope2[Scope2.ATTRIBUTE=13]="ATTRIBUTE",Scope2[Scope2.BLOT=14]="BLOT",Scope2[Scope2.INLINE=7]="INLINE",Scope2[Scope2.BLOCK=11]="BLOCK",Scope2[Scope2.BLOCK_BLOT=10]="BLOCK_BLOT",Scope2[Scope2.INLINE_BLOT=6]="INLINE_BLOT",Scope2[Scope2.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",Scope2[Scope2.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",Scope2[Scope2.ANY=15]="ANY",Scope2))(Scope||{});class Attributor{constructor(attrName,keyName,options={}){this.attrName=attrName,this.keyName=keyName;const attributeBit=Scope.TYPE&Scope.ATTRIBUTE;this.scope=null!=options.scope?options.scope&Scope.LEVEL|attributeBit:Scope.ATTRIBUTE,null!=options.whitelist&&(this.whitelist=options.whitelist)}static keys(node){return Array.from(node.attributes).map(item=>item.name)}add(node,value){return!!this.canAdd(node,value)&&(node.setAttribute(this.keyName,value),!0)}canAdd(_node,value){return null==this.whitelist||("string"==typeof value?this.whitelist.indexOf(value.replace(/["']/g,""))>-1:this.whitelist.indexOf(value)>-1)}remove(node){node.removeAttribute(this.keyName)}value(node){const value=node.getAttribute(this.keyName);return this.canAdd(node,value)&&value?value:""}}class ParchmentError extends Error{constructor(message){super(message="[Parchment] "+message),this.message=message,this.name=this.constructor.name}}const _Registry=class _Registry{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(node,bubble=!1){if(null==node)return null;if(this.blots.has(node))return this.blots.get(node)||null;if(bubble){let parentNode=null;try{parentNode=node.parentNode}catch{return null}return this.find(parentNode,bubble)}return null}create(scroll,input,value){const match2=this.query(input);if(null==match2)throw new ParchmentError(`Unable to create ${input} blot`);const blotClass=match2,node=input instanceof Node||input.nodeType===Node.TEXT_NODE?input:blotClass.create(value),blot=new blotClass(scroll,node,value);return _Registry.blots.set(blot.domNode,blot),blot}find(node,bubble=!1){return _Registry.find(node,bubble)}query(query,scope=Scope.ANY){let match2;return"string"==typeof query?match2=this.types[query]||this.attributes[query]:query instanceof Text||query.nodeType===Node.TEXT_NODE?match2=this.types.text:"number"==typeof query?query&Scope.LEVEL&Scope.BLOCK?match2=this.types.block:query&Scope.LEVEL&Scope.INLINE&&(match2=this.types.inline):query instanceof Element&&((query.getAttribute("class")||"").split(/\s+/).some(name=>(match2=this.classes[name],!!match2)),match2=match2||this.tags[query.tagName]),null==match2?null:"scope"in match2&&scope&Scope.LEVEL&match2.scope&&scope&Scope.TYPE&match2.scope?match2:null}register(...definitions){return definitions.map(definition=>{const isBlot="blotName"in definition,isAttr="attrName"in definition;if(!isBlot&&!isAttr)throw new ParchmentError("Invalid definition");if(isBlot&&"abstract"===definition.blotName)throw new ParchmentError("Cannot register abstract class");const key=isBlot?definition.blotName:isAttr?definition.attrName:void 0;return this.types[key]=definition,isAttr?"string"==typeof definition.keyName&&(this.attributes[definition.keyName]=definition):isBlot&&(definition.className&&(this.classes[definition.className]=definition),definition.tagName&&(Array.isArray(definition.tagName)?definition.tagName=definition.tagName.map(tagName=>tagName.toUpperCase()):definition.tagName=definition.tagName.toUpperCase(),(Array.isArray(definition.tagName)?definition.tagName:[definition.tagName]).forEach(tag=>{(null==this.tags[tag]||null==definition.className)&&(this.tags[tag]=definition)}))),definition})}};_Registry.blots=new WeakMap;let Registry=_Registry;function match(node,prefix){return(node.getAttribute("class")||"").split(/\s+/).filter(name=>0===name.indexOf(`${prefix}-`))}const ClassAttributor$1=class ClassAttributor extends Attributor{static keys(node){return(node.getAttribute("class")||"").split(/\s+/).map(name=>name.split("-").slice(0,-1).join("-"))}add(node,value){return!!this.canAdd(node,value)&&(this.remove(node),node.classList.add(`${this.keyName}-${value}`),!0)}remove(node){match(node,this.keyName).forEach(name=>{node.classList.remove(name)}),0===node.classList.length&&node.removeAttribute("class")}value(node){const value=(match(node,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(node,value)?value:""}};function camelize(name){const parts=name.split("-"),rest=parts.slice(1).map(part=>part[0].toUpperCase()+part.slice(1)).join("");return parts[0]+rest}const StyleAttributor$1=class StyleAttributor extends Attributor{static keys(node){return(node.getAttribute("style")||"").split(";").map(value=>value.split(":")[0].trim())}add(node,value){return!!this.canAdd(node,value)&&(node.style[camelize(this.keyName)]=value,!0)}remove(node){node.style[camelize(this.keyName)]="",node.getAttribute("style")||node.removeAttribute("style")}value(node){const value=node.style[camelize(this.keyName)];return this.canAdd(node,value)?value:""}};const AttributorStore$1=class AttributorStore{constructor(domNode){this.attributes={},this.domNode=domNode,this.build()}attribute(attribute,value){value?attribute.add(this.domNode,value)&&(null!=attribute.value(this.domNode)?this.attributes[attribute.attrName]=attribute:delete this.attributes[attribute.attrName]):(attribute.remove(this.domNode),delete this.attributes[attribute.attrName])}build(){this.attributes={};const blot=Registry.find(this.domNode);if(null==blot)return;const attributes=Attributor.keys(this.domNode),classes=ClassAttributor$1.keys(this.domNode),styles=StyleAttributor$1.keys(this.domNode);attributes.concat(classes).concat(styles).forEach(name=>{const attr=blot.scroll.query(name,Scope.ATTRIBUTE);attr instanceof Attributor&&(this.attributes[attr.attrName]=attr)})}copy(target){Object.keys(this.attributes).forEach(key=>{const value=this.attributes[key].value(this.domNode);target.format(key,value)})}move(target){this.copy(target),Object.keys(this.attributes).forEach(key=>{this.attributes[key].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((attributes,name)=>(attributes[name]=this.attributes[name].value(this.domNode),attributes),{})}},_ShadowBlot=class _ShadowBlot{constructor(scroll,domNode){this.scroll=scroll,this.domNode=domNode,Registry.blots.set(domNode,this),this.prev=null,this.next=null}static create(rawValue){if(null==this.tagName)throw new ParchmentError("Blot definition missing tagName");let node,value;return Array.isArray(this.tagName)?("string"==typeof rawValue?(value=rawValue.toUpperCase(),parseInt(value,10).toString()===value&&(value=parseInt(value,10))):"number"==typeof rawValue&&(value=rawValue),node="number"==typeof value?document.createElement(this.tagName[value-1]):value&&this.tagName.indexOf(value)>-1?document.createElement(value):document.createElement(this.tagName[0])):node=document.createElement(this.tagName),this.className&&node.classList.add(this.className),node}get statics(){return this.constructor}attach(){}clone(){const domNode=this.domNode.cloneNode(!1);return this.scroll.create(domNode)}detach(){null!=this.parent&&this.parent.removeChild(this),Registry.blots.delete(this.domNode)}deleteAt(index,length){this.isolate(index,length).remove()}formatAt(index,length,name,value){const blot=this.isolate(index,length);if(null!=this.scroll.query(name,Scope.BLOT)&&value)blot.wrap(name,value);else if(null!=this.scroll.query(name,Scope.ATTRIBUTE)){const parent=this.scroll.create(this.statics.scope);blot.wrap(parent),parent.format(name,value)}}insertAt(index,value,def){const blot=null==def?this.scroll.create("text",value):this.scroll.create(value,def),ref=this.split(index);this.parent.insertBefore(blot,ref||void 0)}isolate(index,length){const target=this.split(index);if(null==target)throw new Error("Attempt to isolate at end");return target.split(length),target}length(){return 1}offset(root=this.parent){return null==this.parent||this===root?0:this.parent.children.offset(this)+this.parent.offset(root)}optimize(_context){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){null!=this.domNode.parentNode&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(name,value){const replacement="string"==typeof name?this.scroll.create(name,value):name;return null!=this.parent&&(this.parent.insertBefore(replacement,this.next||void 0),this.remove()),replacement}split(index,_force){return 0===index?this:this.next}update(_mutations,_context){}wrap(name,value){const wrapper="string"==typeof name?this.scroll.create(name,value):name;if(null!=this.parent&&this.parent.insertBefore(wrapper,this.next||void 0),"function"!=typeof wrapper.appendChild)throw new ParchmentError(`Cannot wrap ${name}`);return wrapper.appendChild(this),wrapper}};_ShadowBlot.blotName="abstract";let ShadowBlot=_ShadowBlot;const _LeafBlot=class _LeafBlot extends ShadowBlot{static value(_domNode){return!0}index(node,offset){return this.domNode===node||this.domNode.compareDocumentPosition(node)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(offset,1):-1}position(index,_inclusive){let offset=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return index>0&&(offset+=1),[this.parent.domNode,offset]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};_LeafBlot.scope=Scope.INLINE_BLOT;const LeafBlot$1=_LeafBlot;class LinkedList{constructor(){this.head=null,this.tail=null,this.length=0}append(...nodes){if(this.insertBefore(nodes[0],null),nodes.length>1){const rest=nodes.slice(1);this.append(...rest)}}at(index){const next=this.iterator();let cur=next();for(;cur&&index>0;)index-=1,cur=next();return cur}contains(node){const next=this.iterator();let cur=next();for(;cur;){if(cur===node)return!0;cur=next()}return!1}indexOf(node){const next=this.iterator();let cur=next(),index=0;for(;cur;){if(cur===node)return index;index+=1,cur=next()}return-1}insertBefore(node,refNode){null!=node&&(this.remove(node),node.next=refNode,null!=refNode?(node.prev=refNode.prev,null!=refNode.prev&&(refNode.prev.next=node),refNode.prev=node,refNode===this.head&&(this.head=node)):null!=this.tail?(this.tail.next=node,node.prev=this.tail,this.tail=node):(node.prev=null,this.head=this.tail=node),this.length+=1)}offset(target){let index=0,cur=this.head;for(;null!=cur;){if(cur===target)return index;index+=cur.length(),cur=cur.next}return-1}remove(node){this.contains(node)&&(null!=node.prev&&(node.prev.next=node.next),null!=node.next&&(node.next.prev=node.prev),node===this.head&&(this.head=node.next),node===this.tail&&(this.tail=node.prev),this.length-=1)}iterator(curNode=this.head){return()=>{const ret=curNode;return null!=curNode&&(curNode=curNode.next),ret}}find(index,inclusive=!1){const next=this.iterator();let cur=next();for(;cur;){const length=cur.length();if(index<length||inclusive&&index===length&&(null==cur.next||0!==cur.next.length()))return[cur,index];index-=length,cur=next()}return[null,0]}forEach(callback){const next=this.iterator();let cur=next();for(;cur;)callback(cur),cur=next()}forEachAt(index,length,callback){if(length<=0)return;const[startNode,offset]=this.find(index);let curIndex=index-offset;const next=this.iterator(startNode);let cur=next();for(;cur&&curIndex<index+length;){const curLength=cur.length();index>curIndex?callback(cur,index-curIndex,Math.min(length,curIndex+curLength-index)):callback(cur,0,Math.min(curLength,index+length-curIndex)),curIndex+=curLength,cur=next()}}map(callback){return this.reduce((memo,cur)=>(memo.push(callback(cur)),memo),[])}reduce(callback,memo){const next=this.iterator();let cur=next();for(;cur;)memo=callback(memo,cur),cur=next();return memo}}function makeAttachedBlot(node,scroll){const found=scroll.find(node);if(found)return found;try{return scroll.create(node)}catch{const blot=scroll.create(Scope.INLINE);return Array.from(node.childNodes).forEach(child=>{blot.domNode.appendChild(child)}),node.parentNode&&node.parentNode.replaceChild(blot.domNode,node),blot.attach(),blot}}const _ParentBlot=class _ParentBlot extends ShadowBlot{constructor(scroll,domNode){super(scroll,domNode),this.uiNode=null,this.build()}appendChild(other){this.insertBefore(other)}attach(){super.attach(),this.children.forEach(child=>{child.attach()})}attachUI(node){null!=this.uiNode&&this.uiNode.remove(),this.uiNode=node,_ParentBlot.uiClass&&this.uiNode.classList.add(_ParentBlot.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new LinkedList,Array.from(this.domNode.childNodes).filter(node=>node!==this.uiNode).reverse().forEach(node=>{try{const child=makeAttachedBlot(node,this.scroll);this.insertBefore(child,this.children.head||void 0)}catch(err){if(err instanceof ParchmentError)return;throw err}})}deleteAt(index,length){if(0===index&&length===this.length())return this.remove();this.children.forEachAt(index,length,(child,offset,childLength)=>{child.deleteAt(offset,childLength)})}descendant(criteria,index=0){const[child,offset]=this.children.find(index);return null==criteria.blotName&&criteria(child)||null!=criteria.blotName&&child instanceof criteria?[child,offset]:child instanceof _ParentBlot?child.descendant(criteria,offset):[null,-1]}descendants(criteria,index=0,length=Number.MAX_VALUE){let descendants=[],lengthLeft=length;return this.children.forEachAt(index,length,(child,childIndex,childLength)=>{(null==criteria.blotName&&criteria(child)||null!=criteria.blotName&&child instanceof criteria)&&descendants.push(child),child instanceof _ParentBlot&&(descendants=descendants.concat(child.descendants(criteria,childIndex,lengthLeft))),lengthLeft-=childLength}),descendants}detach(){this.children.forEach(child=>{child.detach()}),super.detach()}enforceAllowedChildren(){let done=!1;this.children.forEach(child=>{done||this.statics.allowedChildren.some(def=>child instanceof def)||(child.statics.scope===Scope.BLOCK_BLOT?(null!=child.next&&this.splitAfter(child),null!=child.prev&&this.splitAfter(child.prev),child.parent.unwrap(),done=!0):child instanceof _ParentBlot?child.unwrap():child.remove())})}formatAt(index,length,name,value){this.children.forEachAt(index,length,(child,offset,childLength)=>{child.formatAt(offset,childLength,name,value)})}insertAt(index,value,def){const[child,offset]=this.children.find(index);if(child)child.insertAt(offset,value,def);else{const blot=null==def?this.scroll.create("text",value):this.scroll.create(value,def);this.appendChild(blot)}}insertBefore(childBlot,refBlot){null!=childBlot.parent&&childBlot.parent.children.remove(childBlot);let refDomNode=null;this.children.insertBefore(childBlot,refBlot||null),childBlot.parent=this,null!=refBlot&&(refDomNode=refBlot.domNode),(this.domNode.parentNode!==childBlot.domNode||this.domNode.nextSibling!==refDomNode)&&this.domNode.insertBefore(childBlot.domNode,refDomNode),childBlot.attach()}length(){return this.children.reduce((memo,child)=>memo+child.length(),0)}moveChildren(targetParent,refNode){this.children.forEach(child=>{targetParent.insertBefore(child,refNode)})}optimize(context){if(super.optimize(context),this.enforceAllowedChildren(),null!=this.uiNode&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),0===this.children.length)if(null!=this.statics.defaultChild){const child=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(child)}else this.remove()}path(index,inclusive=!1){const[child,offset]=this.children.find(index,inclusive),position=[[this,index]];return child instanceof _ParentBlot?position.concat(child.path(offset,inclusive)):(null!=child&&position.push([child,offset]),position)}removeChild(child){this.children.remove(child)}replaceWith(name,value){const replacement="string"==typeof name?this.scroll.create(name,value):name;return replacement instanceof _ParentBlot&&this.moveChildren(replacement),super.replaceWith(replacement)}split(index,force=!1){if(!force){if(0===index)return this;if(index===this.length())return this.next}const after=this.clone();return this.parent&&this.parent.insertBefore(after,this.next||void 0),this.children.forEachAt(index,this.length(),(child,offset,_length)=>{const split=child.split(offset,force);null!=split&&after.appendChild(split)}),after}splitAfter(child){const after=this.clone();for(;null!=child.next;)after.appendChild(child.next);return this.parent&&this.parent.insertBefore(after,this.next||void 0),after}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(mutations,_context){const addedNodes=[],removedNodes=[];mutations.forEach(mutation=>{mutation.target===this.domNode&&"childList"===mutation.type&&(addedNodes.push(...mutation.addedNodes),removedNodes.push(...mutation.removedNodes))}),removedNodes.forEach(node=>{if(null!=node.parentNode&&"IFRAME"!==node.tagName&&document.body.compareDocumentPosition(node)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const blot=this.scroll.find(node);null!=blot&&(null==blot.domNode.parentNode||blot.domNode.parentNode===this.domNode)&&blot.detach()}),addedNodes.filter(node=>node.parentNode===this.domNode&&node!==this.uiNode).sort((a,b)=>a===b?0:a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(node=>{let refBlot=null;null!=node.nextSibling&&(refBlot=this.scroll.find(node.nextSibling));const blot=makeAttachedBlot(node,this.scroll);(blot.next!==refBlot||null==blot.next)&&(null!=blot.parent&&blot.parent.removeChild(this),this.insertBefore(blot,refBlot||void 0))}),this.enforceAllowedChildren()}};_ParentBlot.uiClass="";const ParentBlot$1=_ParentBlot;const _InlineBlot=class _InlineBlot extends ParentBlot$1{static create(value){return super.create(value)}static formats(domNode,scroll){const match2=scroll.query(_InlineBlot.blotName);if(null==match2||domNode.tagName!==match2.tagName){if("string"==typeof this.tagName)return!0;if(Array.isArray(this.tagName))return domNode.tagName.toLowerCase()}}constructor(scroll,domNode){super(scroll,domNode),this.attributes=new AttributorStore$1(this.domNode)}format(name,value){if(name!==this.statics.blotName||value){const format=this.scroll.query(name,Scope.INLINE);if(null==format)return;format instanceof Attributor?this.attributes.attribute(format,value):value&&(name!==this.statics.blotName||this.formats()[name]!==value)&&this.replaceWith(name,value)}else this.children.forEach(child=>{child instanceof _InlineBlot||(child=child.wrap(_InlineBlot.blotName,!0)),this.attributes.copy(child)}),this.unwrap()}formats(){const formats=this.attributes.values(),format=this.statics.formats(this.domNode,this.scroll);return null!=format&&(formats[this.statics.blotName]=format),formats}formatAt(index,length,name,value){null!=this.formats()[name]||this.scroll.query(name,Scope.ATTRIBUTE)?this.isolate(index,length).format(name,value):super.formatAt(index,length,name,value)}optimize(context){super.optimize(context);const formats=this.formats();if(0===Object.keys(formats).length)return this.unwrap();const next=this.next;next instanceof _InlineBlot&&next.prev===this&&function isEqual(obj1,obj2){if(Object.keys(obj1).length!==Object.keys(obj2).length)return!1;for(const prop in obj1)if(obj1[prop]!==obj2[prop])return!1;return!0}(formats,next.formats())&&(next.moveChildren(this),next.remove())}replaceWith(name,value){const replacement=super.replaceWith(name,value);return this.attributes.copy(replacement),replacement}update(mutations,context){super.update(mutations,context),mutations.some(mutation=>mutation.target===this.domNode&&"attributes"===mutation.type)&&this.attributes.build()}wrap(name,value){const wrapper=super.wrap(name,value);return wrapper instanceof _InlineBlot&&this.attributes.move(wrapper),wrapper}};_InlineBlot.allowedChildren=[_InlineBlot,LeafBlot$1],_InlineBlot.blotName="inline",_InlineBlot.scope=Scope.INLINE_BLOT,_InlineBlot.tagName="SPAN";const InlineBlot$1=_InlineBlot,_BlockBlot=class _BlockBlot extends ParentBlot$1{static create(value){return super.create(value)}static formats(domNode,scroll){const match2=scroll.query(_BlockBlot.blotName);if(null==match2||domNode.tagName!==match2.tagName){if("string"==typeof this.tagName)return!0;if(Array.isArray(this.tagName))return domNode.tagName.toLowerCase()}}constructor(scroll,domNode){super(scroll,domNode),this.attributes=new AttributorStore$1(this.domNode)}format(name,value){const format=this.scroll.query(name,Scope.BLOCK);null!=format&&(format instanceof Attributor?this.attributes.attribute(format,value):name!==this.statics.blotName||value?value&&(name!==this.statics.blotName||this.formats()[name]!==value)&&this.replaceWith(name,value):this.replaceWith(_BlockBlot.blotName))}formats(){const formats=this.attributes.values(),format=this.statics.formats(this.domNode,this.scroll);return null!=format&&(formats[this.statics.blotName]=format),formats}formatAt(index,length,name,value){null!=this.scroll.query(name,Scope.BLOCK)?this.format(name,value):super.formatAt(index,length,name,value)}insertAt(index,value,def){if(null==def||null!=this.scroll.query(value,Scope.INLINE))super.insertAt(index,value,def);else{const after=this.split(index);if(null==after)throw new Error("Attempt to insertAt after block boundaries");{const blot=this.scroll.create(value,def);after.parent.insertBefore(blot,after)}}}replaceWith(name,value){const replacement=super.replaceWith(name,value);return this.attributes.copy(replacement),replacement}update(mutations,context){super.update(mutations,context),mutations.some(mutation=>mutation.target===this.domNode&&"attributes"===mutation.type)&&this.attributes.build()}};_BlockBlot.blotName="block",_BlockBlot.scope=Scope.BLOCK_BLOT,_BlockBlot.tagName="P",_BlockBlot.allowedChildren=[InlineBlot$1,_BlockBlot,LeafBlot$1];const BlockBlot$1=_BlockBlot,_ContainerBlot=class _ContainerBlot extends ParentBlot$1{checkMerge(){return null!==this.next&&this.next.statics.blotName===this.statics.blotName}deleteAt(index,length){super.deleteAt(index,length),this.enforceAllowedChildren()}formatAt(index,length,name,value){super.formatAt(index,length,name,value),this.enforceAllowedChildren()}insertAt(index,value,def){super.insertAt(index,value,def),this.enforceAllowedChildren()}optimize(context){super.optimize(context),this.children.length>0&&null!=this.next&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};_ContainerBlot.blotName="container",_ContainerBlot.scope=Scope.BLOCK_BLOT;const ContainerBlot$1=_ContainerBlot;const EmbedBlot$1=class EmbedBlot extends LeafBlot$1{static formats(_domNode,_scroll){}format(name,value){super.formatAt(0,this.length(),name,value)}formatAt(index,length,name,value){0===index&&length===this.length()?this.format(name,value):super.formatAt(index,length,name,value)}formats(){return this.statics.formats(this.domNode,this.scroll)}},OBSERVER_CONFIG={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},_ScrollBlot=class _ScrollBlot extends ParentBlot$1{constructor(registry,node){super(null,node),this.registry=registry,this.scroll=this,this.build(),this.observer=new MutationObserver(mutations=>{this.update(mutations)}),this.observer.observe(this.domNode,OBSERVER_CONFIG),this.attach()}create(input,value){return this.registry.create(this,input,value)}find(node,bubble=!1){const blot=this.registry.find(node,bubble);return blot?blot.scroll===this?blot:bubble?this.find(blot.scroll.domNode.parentNode,!0):null:null}query(query,scope=Scope.ANY){return this.registry.query(query,scope)}register(...definitions){return this.registry.register(...definitions)}build(){null!=this.scroll&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(index,length){this.update(),0===index&&length===this.length()?this.children.forEach(child=>{child.remove()}):super.deleteAt(index,length)}formatAt(index,length,name,value){this.update(),super.formatAt(index,length,name,value)}insertAt(index,value,def){this.update(),super.insertAt(index,value,def)}optimize(mutations=[],context={}){super.optimize(context);const mutationsMap=context.mutationsMap||new WeakMap;let records=Array.from(this.observer.takeRecords());for(;records.length>0;)mutations.push(records.pop());const mark=(blot,markParent=!0)=>{null==blot||blot===this||null!=blot.domNode.parentNode&&(mutationsMap.has(blot.domNode)||mutationsMap.set(blot.domNode,[]),markParent&&mark(blot.parent))},optimize=blot=>{mutationsMap.has(blot.domNode)&&(blot instanceof ParentBlot$1&&blot.children.forEach(optimize),mutationsMap.delete(blot.domNode),blot.optimize(context))};let remaining=mutations;for(let i=0;remaining.length>0;i+=1){if(i>=100)throw new Error("[Parchment] Maximum optimize iterations reached");for(remaining.forEach(mutation=>{const blot=this.find(mutation.target,!0);null!=blot&&(blot.domNode===mutation.target&&("childList"===mutation.type?(mark(this.find(mutation.previousSibling,!1)),Array.from(mutation.addedNodes).forEach(node=>{const child=this.find(node,!1);mark(child,!1),child instanceof ParentBlot$1&&child.children.forEach(grandChild=>{mark(grandChild,!1)})})):"attributes"===mutation.type&&mark(blot.prev)),mark(blot))}),this.children.forEach(optimize),remaining=Array.from(this.observer.takeRecords()),records=remaining.slice();records.length>0;)mutations.push(records.pop())}}update(mutations,context={}){mutations=mutations||this.observer.takeRecords();const mutationsMap=new WeakMap;mutations.map(mutation=>{const blot=this.find(mutation.target,!0);return null==blot?null:mutationsMap.has(blot.domNode)?(mutationsMap.get(blot.domNode).push(mutation),null):(mutationsMap.set(blot.domNode,[mutation]),blot)}).forEach(blot=>{null!=blot&&blot!==this&&mutationsMap.has(blot.domNode)&&blot.update(mutationsMap.get(blot.domNode)||[],context)}),context.mutationsMap=mutationsMap,mutationsMap.has(this.domNode)&&super.update(mutationsMap.get(this.domNode),context),this.optimize(mutations,context)}};_ScrollBlot.blotName="scroll",_ScrollBlot.defaultChild=BlockBlot$1,_ScrollBlot.allowedChildren=[BlockBlot$1,ContainerBlot$1],_ScrollBlot.scope=Scope.BLOCK_BLOT,_ScrollBlot.tagName="DIV";const ScrollBlot$1=_ScrollBlot,_TextBlot=class _TextBlot extends LeafBlot$1{static create(value){return document.createTextNode(value)}static value(domNode){return domNode.data}constructor(scroll,node){super(scroll,node),this.text=this.statics.value(this.domNode)}deleteAt(index,length){this.domNode.data=this.text=this.text.slice(0,index)+this.text.slice(index+length)}index(node,offset){return this.domNode===node?offset:-1}insertAt(index,value,def){null==def?(this.text=this.text.slice(0,index)+value+this.text.slice(index),this.domNode.data=this.text):super.insertAt(index,value,def)}length(){return this.text.length}optimize(context){super.optimize(context),this.text=this.statics.value(this.domNode),0===this.text.length?this.remove():this.next instanceof _TextBlot&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(index,_inclusive=!1){return[this.domNode,index]}split(index,force=!1){if(!force){if(0===index)return this;if(index===this.length())return this.next}const after=this.scroll.create(this.domNode.splitText(index));return this.parent.insertBefore(after,this.next||void 0),this.text=this.statics.value(this.domNode),after}update(mutations,_context){mutations.some(mutation=>"characterData"===mutation.type&&mutation.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};_TextBlot.blotName="text",_TextBlot.scope=Scope.INLINE_BLOT;const TextBlot$1=_TextBlot;var Delta=__webpack_require__("./node_modules/quill-delta/dist/Delta.js"),Delta_default=__webpack_require__.n(Delta);const _arrayEach=function arrayEach(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););return array};const _nativeKeys=_overArg(Object.keys,Object);var _baseKeys_hasOwnProperty=Object.prototype.hasOwnProperty;const _baseKeys=function baseKeys(object){if(!_isPrototype(object))return _nativeKeys(object);var result=[];for(var key in Object(object))_baseKeys_hasOwnProperty.call(object,key)&&"constructor"!=key&&result.push(key);return result};const lodash_es_keys=function keys(object){return lodash_es_isArrayLike(object)?_arrayLikeKeys(object):_baseKeys(object)};const _baseAssign=function baseAssign(object,source){return object&&_copyObject(source,lodash_es_keys(source),object)};const _baseAssignIn=function baseAssignIn(object,source){return object&&_copyObject(source,lodash_es_keysIn(source),object)};const _arrayFilter=function arrayFilter(array,predicate){for(var index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result};const lodash_es_stubArray=function stubArray(){return[]};var _getSymbols_propertyIsEnumerable=Object.prototype.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols;const _getSymbols=nativeGetSymbols?function(object){return null==object?[]:(object=Object(object),_arrayFilter(nativeGetSymbols(object),function(symbol){return _getSymbols_propertyIsEnumerable.call(object,symbol)}))}:lodash_es_stubArray;const _copySymbols=function copySymbols(source,object){return _copyObject(source,_getSymbols(source),object)};const _arrayPush=function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array};const _getSymbolsIn=Object.getOwnPropertySymbols?function(object){for(var result=[];object;)_arrayPush(result,_getSymbols(object)),object=_getPrototype(object);return result}:lodash_es_stubArray;const _copySymbolsIn=function copySymbolsIn(source,object){return _copyObject(source,_getSymbolsIn(source),object)};const _baseGetAllKeys=function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return lodash_es_isArray(object)?result:_arrayPush(result,symbolsFunc(object))};const _getAllKeys=function getAllKeys(object){return _baseGetAllKeys(object,lodash_es_keys,_getSymbols)};const _getAllKeysIn=function getAllKeysIn(object){return _baseGetAllKeys(object,lodash_es_keysIn,_getSymbolsIn)};const _DataView=_getNative(_root.A,"DataView");const _Promise=_getNative(_root.A,"Promise");const _Set=_getNative(_root.A,"Set");const _WeakMap=_getNative(_root.A,"WeakMap");var dataViewCtorString=_toSource(_DataView),mapCtorString=_toSource(_Map),promiseCtorString=_toSource(_Promise),setCtorString=_toSource(_Set),weakMapCtorString=_toSource(_WeakMap),getTag=_baseGetTag;(_DataView&&"[object DataView]"!=getTag(new _DataView(new ArrayBuffer(1)))||_Map&&"[object Map]"!=getTag(new _Map)||_Promise&&"[object Promise]"!=getTag(_Promise.resolve())||_Set&&"[object Set]"!=getTag(new _Set)||_WeakMap&&"[object WeakMap]"!=getTag(new _WeakMap))&&(getTag=function(value){var result=_baseGetTag(value),Ctor="[object Object]"==result?value.constructor:void 0,ctorString=Ctor?_toSource(Ctor):"";if(ctorString)switch(ctorString){case dataViewCtorString:return"[object DataView]";case mapCtorString:return"[object Map]";case promiseCtorString:return"[object Promise]";case setCtorString:return"[object Set]";case weakMapCtorString:return"[object WeakMap]"}return result});const _getTag=getTag;var _initCloneArray_hasOwnProperty=Object.prototype.hasOwnProperty;const _initCloneArray=function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&_initCloneArray_hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result};const _cloneDataView=function cloneDataView(dataView,isDeep){var buffer=isDeep?_cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)};var reFlags=/\w*$/;const _cloneRegExp=function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));return result.lastIndex=regexp.lastIndex,result};var symbolProto=_Symbol?_Symbol.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;const _cloneSymbol=function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}};const _initCloneByTag=function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case"[object ArrayBuffer]":return _cloneArrayBuffer(object);case"[object Boolean]":case"[object Date]":return new Ctor(+object);case"[object DataView]":return _cloneDataView(object,isDeep);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return _cloneTypedArray(object,isDeep);case"[object Map]":case"[object Set]":return new Ctor;case"[object Number]":case"[object String]":return new Ctor(object);case"[object RegExp]":return _cloneRegExp(object);case"[object Symbol]":return _cloneSymbol(object)}};const _baseIsMap=function baseIsMap(value){return lodash_es_isObjectLike(value)&&"[object Map]"==_getTag(value)};var nodeIsMap=_nodeUtil.A&&_nodeUtil.A.isMap;const lodash_es_isMap=nodeIsMap?_baseUnary(nodeIsMap):_baseIsMap;const _baseIsSet=function baseIsSet(value){return lodash_es_isObjectLike(value)&&"[object Set]"==_getTag(value)};var nodeIsSet=_nodeUtil.A&&_nodeUtil.A.isSet;const lodash_es_isSet=nodeIsSet?_baseUnary(nodeIsSet):_baseIsSet;var cloneableTags={};cloneableTags["[object Arguments]"]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object DataView]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags["[object Map]"]=cloneableTags["[object Number]"]=cloneableTags["[object Object]"]=cloneableTags["[object RegExp]"]=cloneableTags["[object Set]"]=cloneableTags["[object String]"]=cloneableTags["[object Symbol]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags["[object Function]"]=cloneableTags["[object WeakMap]"]=!1;const _baseClone=function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=1&bitmask,isFlat=2&bitmask,isFull=4&bitmask;if(customizer&&(result=object?customizer(value,key,object,stack):customizer(value)),void 0!==result)return result;if(!lodash_es_isObject(value))return value;var isArr=lodash_es_isArray(value);if(isArr){if(result=_initCloneArray(value),!isDeep)return _copyArray(value,result)}else{var tag=_getTag(value),isFunc="[object Function]"==tag||"[object GeneratorFunction]"==tag;if((0,isBuffer.A)(value))return(0,_cloneBuffer.A)(value,isDeep);if("[object Object]"==tag||"[object Arguments]"==tag||isFunc&&!object){if(result=isFlat||isFunc?{}:_initCloneObject(value),!isDeep)return isFlat?_copySymbolsIn(value,_baseAssignIn(result,value)):_copySymbols(value,_baseAssign(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=_initCloneByTag(value,tag,isDeep)}}stack||(stack=new _Stack);var stacked=stack.get(value);if(stacked)return stacked;stack.set(value,result),lodash_es_isSet(value)?value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))}):lodash_es_isMap(value)&&value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))});var props=isArr?void 0:(isFull?isFlat?_getAllKeysIn:_getAllKeys:isFlat?lodash_es_keysIn:lodash_es_keys)(value);return _arrayEach(props||value,function(subValue,key){props&&(subValue=value[key=subValue]),_assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result};const lodash_es_cloneDeep=function cloneDeep(value){return _baseClone(value,5)};const _setCacheAdd=function setCacheAdd(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this};const _setCacheHas=function setCacheHas(value){return this.__data__.has(value)};function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new _MapCache;++index<length;)this.add(values[index])}SetCache.prototype.add=SetCache.prototype.push=_setCacheAdd,SetCache.prototype.has=_setCacheHas;const _SetCache=SetCache;const _arraySome=function arraySome(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1};const _cacheHas=function cacheHas(cache,key){return cache.has(key)};const _equalArrays=function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength))return!1;var arrStacked=stack.get(array),othStacked=stack.get(other);if(arrStacked&&othStacked)return arrStacked==other&&othStacked==array;var index=-1,result=!0,seen=2&bitmask?new _SetCache:void 0;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var arrValue=array[index],othValue=other[index];if(customizer)var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack);if(void 0!==compared){if(compared)continue;result=!1;break}if(seen){if(!_arraySome(other,function(othValue,othIndex){if(!_cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack)))return seen.push(othIndex)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result};const _mapToArray=function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result};const _setToArray=function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result};var _equalByTag_symbolProto=_Symbol?_Symbol.prototype:void 0,_equalByTag_symbolValueOf=_equalByTag_symbolProto?_equalByTag_symbolProto.valueOf:void 0;const _equalByTag=function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case"[object DataView]":if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case"[object ArrayBuffer]":return!(object.byteLength!=other.byteLength||!equalFunc(new _Uint8Array(object),new _Uint8Array(other)));case"[object Boolean]":case"[object Date]":case"[object Number]":return lodash_es_eq(+object,+other);case"[object Error]":return object.name==other.name&&object.message==other.message;case"[object RegExp]":case"[object String]":return object==other+"";case"[object Map]":var convert=_mapToArray;case"[object Set]":var isPartial=1&bitmask;if(convert||(convert=_setToArray),object.size!=other.size&&!isPartial)return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=2,stack.set(object,other);var result=_equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),result;case"[object Symbol]":if(_equalByTag_symbolValueOf)return _equalByTag_symbolValueOf.call(object)==_equalByTag_symbolValueOf.call(other)}return!1};var _equalObjects_hasOwnProperty=Object.prototype.hasOwnProperty;const _equalObjects=function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,objProps=_getAllKeys(object),objLength=objProps.length;if(objLength!=_getAllKeys(other).length&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:_equalObjects_hasOwnProperty.call(other,key)))return!1}var objStacked=stack.get(object),othStacked=stack.get(other);if(objStacked&&othStacked)return objStacked==other&&othStacked==object;var result=!0;stack.set(object,other),stack.set(other,object);for(var skipCtor=isPartial;++index<objLength;){var objValue=object[key=objProps[index]],othValue=other[key];if(customizer)var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack);if(!(void 0===compared?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor||(skipCtor="constructor"==key)}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;objCtor==othCtor||!("constructor"in object)||!("constructor"in other)||"function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor||(result=!1)}return stack.delete(object),stack.delete(other),result};var _baseIsEqualDeep_hasOwnProperty=Object.prototype.hasOwnProperty;const _baseIsEqualDeep=function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=lodash_es_isArray(object),othIsArr=lodash_es_isArray(other),objTag=objIsArr?"[object Array]":_getTag(object),othTag=othIsArr?"[object Array]":_getTag(other),objIsObj="[object Object]"==(objTag="[object Arguments]"==objTag?"[object Object]":objTag),othIsObj="[object Object]"==(othTag="[object Arguments]"==othTag?"[object Object]":othTag),isSameTag=objTag==othTag;if(isSameTag&&(0,isBuffer.A)(object)){if(!(0,isBuffer.A)(other))return!1;objIsArr=!0,objIsObj=!1}if(isSameTag&&!objIsObj)return stack||(stack=new _Stack),objIsArr||lodash_es_isTypedArray(object)?_equalArrays(object,other,bitmask,customizer,equalFunc,stack):_equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(1&bitmask)){var objIsWrapped=objIsObj&&_baseIsEqualDeep_hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&_baseIsEqualDeep_hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;return stack||(stack=new _Stack),equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}return!!isSameTag&&(stack||(stack=new _Stack),_equalObjects(object,other,bitmask,customizer,equalFunc,stack))};const _baseIsEqual=function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!lodash_es_isObjectLike(value)&&!lodash_es_isObjectLike(other)?value!=value&&other!=other:_baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack))};const lodash_es_isEqual=function isEqual_isEqual(value,other){return _baseIsEqual(value,other)};class Break extends EmbedBlot$1{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}Break.blotName="break",Break.tagName="BR";const blots_break=Break;class text_Text extends TextBlot$1{}const entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function escapeText(text){return text.replace(/[&<>"']/g,s=>entityMap[s])}class Inline extends InlineBlot$1{static allowedChildren=[Inline,blots_break,EmbedBlot$1,text_Text];static order=["cursor","inline","link","underline","strike","italic","bold","script","code"];static compare(self,other){const selfIndex=Inline.order.indexOf(self),otherIndex=Inline.order.indexOf(other);return selfIndex>=0||otherIndex>=0?selfIndex-otherIndex:self===other?0:self<other?-1:1}formatAt(index,length,name,value){if(Inline.compare(this.statics.blotName,name)<0&&this.scroll.query(name,Scope.BLOT)){const blot=this.isolate(index,length);value&&blot.wrap(name,value)}else super.formatAt(index,length,name,value)}optimize(context){if(super.optimize(context),this.parent instanceof Inline&&Inline.compare(this.statics.blotName,this.parent.statics.blotName)>0){const parent=this.parent.isolate(this.offset(),this.length());this.moveChildren(parent),parent.wrap(this)}}}const inline=Inline;class Block extends BlockBlot$1{cache={};delta(){return null==this.cache.delta&&(this.cache.delta=blockDelta(this)),this.cache.delta}deleteAt(index,length){super.deleteAt(index,length),this.cache={}}formatAt(index,length,name,value){length<=0||(this.scroll.query(name,Scope.BLOCK)?index+length===this.length()&&this.format(name,value):super.formatAt(index,Math.min(length,this.length()-index-1),name,value),this.cache={})}insertAt(index,value,def){if(null!=def)return super.insertAt(index,value,def),void(this.cache={});if(0===value.length)return;const lines=value.split("\n"),text=lines.shift();text.length>0&&(index<this.length()-1||null==this.children.tail?super.insertAt(Math.min(index,this.length()-1),text):this.children.tail.insertAt(this.children.tail.length(),text),this.cache={});let block=this;lines.reduce((lineIndex,line)=>(block=block.split(lineIndex,!0),block.insertAt(0,line),line.length),index+text.length)}insertBefore(blot,ref){const{head}=this.children;super.insertBefore(blot,ref),head instanceof blots_break&&head.remove(),this.cache={}}length(){return null==this.cache.length&&(this.cache.length=super.length()+1),this.cache.length}moveChildren(target,ref){super.moveChildren(target,ref),this.cache={}}optimize(context){super.optimize(context),this.cache={}}path(index){return super.path(index,!0)}removeChild(child){super.removeChild(child),this.cache={}}split(index){let force=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(force&&(0===index||index>=this.length()-1)){const clone=this.clone();return 0===index?(this.parent.insertBefore(clone,this),this):(this.parent.insertBefore(clone,this.next),clone)}const next=super.split(index,force);return this.cache={},next}}Block.blotName="block",Block.tagName="P",Block.defaultChild=blots_break,Block.allowedChildren=[blots_break,inline,EmbedBlot$1,text_Text];class BlockEmbed extends EmbedBlot$1{attach(){super.attach(),this.attributes=new AttributorStore$1(this.domNode)}delta(){return(new(Delta_default())).insert(this.value(),{...this.formats(),...this.attributes.values()})}format(name,value){const attribute=this.scroll.query(name,Scope.BLOCK_ATTRIBUTE);null!=attribute&&this.attributes.attribute(attribute,value)}formatAt(index,length,name,value){this.format(name,value)}insertAt(index,value,def){if(null!=def)return void super.insertAt(index,value,def);const lines=value.split("\n"),text=lines.pop(),blocks=lines.map(line=>{const block=this.scroll.create(Block.blotName);return block.insertAt(0,line),block}),ref=this.split(index);blocks.forEach(block=>{this.parent.insertBefore(block,ref)}),text&&this.parent.insertBefore(this.scroll.create("text",text),ref)}}function blockDelta(blot){let filter=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return blot.descendants(LeafBlot$1).reduce((delta,leaf)=>0===leaf.length()?delta:delta.insert(leaf.value(),bubbleFormats(leaf,{},filter)),new(Delta_default())).insert("\n",bubbleFormats(blot))}function bubbleFormats(blot){let formats=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},filter=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return null==blot?formats:("formats"in blot&&"function"==typeof blot.formats&&(formats={...formats,...blot.formats()},filter&&delete formats["code-token"]),null==blot.parent||"scroll"===blot.parent.statics.blotName||blot.parent.statics.scope!==blot.statics.scope?formats:bubbleFormats(blot.parent,formats,filter))}BlockEmbed.scope=Scope.BLOCK_BLOT;class Cursor extends EmbedBlot$1{static blotName="cursor";static className="ql-cursor";static tagName="span";static CONTENTS="\ufeff";static value(){}constructor(scroll,domNode,selection){super(scroll,domNode),this.selection=selection,this.textNode=document.createTextNode(Cursor.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){null!=this.parent&&this.parent.removeChild(this)}format(name,value){if(0!==this.savedLength)return void super.format(name,value);let target=this,index=0;for(;null!=target&&target.statics.scope!==Scope.BLOCK_BLOT;)index+=target.offset(target.parent),target=target.parent;null!=target&&(this.savedLength=Cursor.CONTENTS.length,target.optimize(),target.formatAt(index,Cursor.CONTENTS.length,name,value),this.savedLength=0)}index(node,offset){return node===this.textNode?0:super.index(node,offset)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||null==this.parent)return null;const range=this.selection.getNativeRange();for(;null!=this.domNode.lastChild&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const prevTextBlot=this.prev instanceof text_Text?this.prev:null,prevTextLength=prevTextBlot?prevTextBlot.length():0,nextTextBlot=this.next instanceof text_Text?this.next:null,nextText=nextTextBlot?nextTextBlot.text:"",{textNode}=this,newText=textNode.data.split(Cursor.CONTENTS).join("");let mergedTextBlot;if(textNode.data=Cursor.CONTENTS,prevTextBlot)mergedTextBlot=prevTextBlot,(newText||nextTextBlot)&&(prevTextBlot.insertAt(prevTextBlot.length(),newText+nextText),nextTextBlot&&nextTextBlot.remove());else if(nextTextBlot)mergedTextBlot=nextTextBlot,nextTextBlot.insertAt(0,newText);else{const newTextNode=document.createTextNode(newText);mergedTextBlot=this.scroll.create(newTextNode),this.parent.insertBefore(mergedTextBlot,this)}if(this.remove(),range){const remapOffset=(node,offset)=>prevTextBlot&&node===prevTextBlot.domNode?offset:node===textNode?prevTextLength+offset-1:nextTextBlot&&node===nextTextBlot.domNode?prevTextLength+newText.length+offset:null,start=remapOffset(range.start.node,range.start.offset),end=remapOffset(range.end.node,range.end.offset);if(null!==start&&null!==end)return{startNode:mergedTextBlot.domNode,startOffset:start,endNode:mergedTextBlot.domNode,endOffset:end}}return null}update(mutations,context){if(mutations.some(mutation=>"characterData"===mutation.type&&mutation.target===this.textNode)){const range=this.restore();range&&(context.range=range)}}optimize(context){super.optimize(context);let{parent}=this;for(;parent;){if("A"===parent.domNode.tagName){this.savedLength=Cursor.CONTENTS.length,parent.isolate(this.offset(parent),this.length()).unwrap(),this.savedLength=0;break}parent=parent.parent}}value(){return""}}const cursor=Cursor;var eventemitter3=__webpack_require__("./node_modules/eventemitter3/index.js"),eventemitter3_default=__webpack_require__.n(eventemitter3);const instances=new WeakMap,levels=["error","warn","log","info"];let level="warn";function debug(method){if(level&&levels.indexOf(method)<=levels.indexOf(level)){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];console[method](...args)}}function namespace(ns){return levels.reduce((logger,method)=>(logger[method]=debug.bind(console,method,ns),logger),{})}namespace.level=newLevel=>{level=newLevel},debug.level=namespace.level;const logger=namespace,emitter_debug=logger("quill:events");["selectionchange","mousedown","mouseup","click"].forEach(eventName=>{document.addEventListener(eventName,function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];Array.from(document.querySelectorAll(".ql-container")).forEach(node=>{const quill=instances.get(node);quill&&quill.emitter&&quill.emitter.handleDOM(...args)})})});class Emitter extends(eventemitter3_default()){static events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"};static sources={API:"api",SILENT:"silent",USER:"user"};constructor(){super(),this.domListeners={},this.on("error",emitter_debug.error)}emit(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return emitter_debug.log.call(emitter_debug,...args),super.emit(...args)}handleDOM(event){for(var _len3=arguments.length,args=new Array(_len3>1?_len3-1:0),_key3=1;_key3<_len3;_key3++)args[_key3-1]=arguments[_key3];(this.domListeners[event.type]||[]).forEach(_ref=>{let{node,handler}=_ref;(event.target===node||node.contains(event.target))&&handler(event,...args)})}listenDOM(eventName,node,handler){this.domListeners[eventName]||(this.domListeners[eventName]=[]),this.domListeners[eventName].push({node,handler})}}const core_emitter=Emitter,selection_debug=logger("quill:selection");class Range{constructor(index){let length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.index=index,this.length=length}}function contains(parent,descendant){try{descendant.parentNode}catch(e){return!1}return parent.contains(descendant)}const selection=class Selection{constructor(scroll,emitter){this.emitter=emitter,this.scroll=scroll,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new Range(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{this.mouseDown||this.composing||setTimeout(this.update.bind(this,core_emitter.sources.USER),1)}),this.emitter.on(core_emitter.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const native=this.getNativeRange();null!=native&&native.start.node!==this.cursor.textNode&&this.emitter.once(core_emitter.events.SCROLL_UPDATE,(source,mutations)=>{try{this.root.contains(native.start.node)&&this.root.contains(native.end.node)&&this.setNativeRange(native.start.node,native.start.offset,native.end.node,native.end.offset);const triggeredByTyping=mutations.some(mutation=>"characterData"===mutation.type||"childList"===mutation.type||"attributes"===mutation.type&&mutation.target===this.root);this.update(triggeredByTyping?core_emitter.sources.SILENT:source)}catch(ignored){}})}),this.emitter.on(core_emitter.events.SCROLL_OPTIMIZE,(mutations,context)=>{if(context.range){const{startNode,startOffset,endNode,endOffset}=context.range;this.setNativeRange(startNode,startOffset,endNode,endOffset),this.update(core_emitter.sources.SILENT)}}),this.update(core_emitter.sources.SILENT)}handleComposition(){this.emitter.on(core_emitter.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(core_emitter.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const range=this.cursor.restore();if(!range)return;setTimeout(()=>{this.setNativeRange(range.startNode,range.startOffset,range.endNode,range.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(core_emitter.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(format,value){this.scroll.update();const nativeRange=this.getNativeRange();if(null!=nativeRange&&nativeRange.native.collapsed&&!this.scroll.query(format,Scope.BLOCK)){if(nativeRange.start.node!==this.cursor.textNode){const blot=this.scroll.find(nativeRange.start.node,!1);if(null==blot)return;if(blot instanceof LeafBlot$1){const after=blot.split(nativeRange.start.offset);blot.parent.insertBefore(this.cursor,after)}else blot.insertBefore(this.cursor,nativeRange.start.node);this.cursor.attach()}this.cursor.format(format,value),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(index){let length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const scrollLength=this.scroll.length();let node;index=Math.min(index,scrollLength-1),length=Math.min(index+length,scrollLength-1)-index;let[leaf,offset]=this.scroll.leaf(index);if(null==leaf)return null;if(length>0&&offset===leaf.length()){const[next]=this.scroll.leaf(index+1);if(next){const[line]=this.scroll.line(index),[nextLine]=this.scroll.line(index+1);line===nextLine&&(leaf=next,offset=0)}}[node,offset]=leaf.position(offset,!0);const range=document.createRange();if(length>0)return range.setStart(node,offset),[leaf,offset]=this.scroll.leaf(index+length),null==leaf?null:([node,offset]=leaf.position(offset,!0),range.setEnd(node,offset),range.getBoundingClientRect());let rect,side="left";if(node instanceof Text){if(!node.data.length)return null;offset<node.data.length?(range.setStart(node,offset),range.setEnd(node,offset+1)):(range.setStart(node,offset-1),range.setEnd(node,offset),side="right"),rect=range.getBoundingClientRect()}else{if(!(leaf.domNode instanceof Element))return null;rect=leaf.domNode.getBoundingClientRect(),offset>0&&(side="right")}return{bottom:rect.top+rect.height,height:rect.height,left:rect[side],right:rect[side],top:rect.top,width:0}}getNativeRange(){const selection=document.getSelection();if(null==selection||selection.rangeCount<=0)return null;const nativeRange=selection.getRangeAt(0);if(null==nativeRange)return null;const range=this.normalizeNative(nativeRange);return selection_debug.info("getNativeRange",range),range}getRange(){const root=this.scroll.domNode;if("isConnected"in root&&!root.isConnected)return[null,null];const normalized=this.getNativeRange();if(null==normalized)return[null,null];return[this.normalizedToRange(normalized),normalized]}hasFocus(){return document.activeElement===this.root||null!=document.activeElement&&contains(this.root,document.activeElement)}normalizedToRange(range){const positions=[[range.start.node,range.start.offset]];range.native.collapsed||positions.push([range.end.node,range.end.offset]);const indexes=positions.map(position=>{const[node,offset]=position,blot=this.scroll.find(node,!0),index=blot.offset(this.scroll);return 0===offset?index:blot instanceof LeafBlot$1?index+blot.index(node,offset):index+blot.length()}),end=Math.min(Math.max(...indexes),this.scroll.length()-1),start=Math.min(end,...indexes);return new Range(start,end-start)}normalizeNative(nativeRange){if(!contains(this.root,nativeRange.startContainer)||!nativeRange.collapsed&&!contains(this.root,nativeRange.endContainer))return null;const range={start:{node:nativeRange.startContainer,offset:nativeRange.startOffset},end:{node:nativeRange.endContainer,offset:nativeRange.endOffset},native:nativeRange};return[range.start,range.end].forEach(position=>{let{node,offset}=position;for(;!(node instanceof Text)&&node.childNodes.length>0;)if(node.childNodes.length>offset)node=node.childNodes[offset],offset=0;else{if(node.childNodes.length!==offset)break;node=node.lastChild,offset=node instanceof Text?node.data.length:node.childNodes.length>0?node.childNodes.length:node.childNodes.length+1}position.node=node,position.offset=offset}),range}rangeToNative(range){const scrollLength=this.scroll.length(),getPosition=(index,inclusive)=>{index=Math.min(scrollLength-1,index);const[leaf,leafOffset]=this.scroll.leaf(index);return leaf?leaf.position(leafOffset,inclusive):[null,-1]};return[...getPosition(range.index,!1),...getPosition(range.index+range.length,!0)]}setNativeRange(startNode,startOffset){let endNode=arguments.length>2&&void 0!==arguments[2]?arguments[2]:startNode,endOffset=arguments.length>3&&void 0!==arguments[3]?arguments[3]:startOffset,force=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(selection_debug.info("setNativeRange",startNode,startOffset,endNode,endOffset),null!=startNode&&(null==this.root.parentNode||null==startNode.parentNode||null==endNode.parentNode))return;const selection=document.getSelection();if(null!=selection)if(null!=startNode){this.hasFocus()||this.root.focus({preventScroll:!0});const{native}=this.getNativeRange()||{};if(null==native||force||startNode!==native.startContainer||startOffset!==native.startOffset||endNode!==native.endContainer||endOffset!==native.endOffset){startNode instanceof Element&&"BR"===startNode.tagName&&(startOffset=Array.from(startNode.parentNode.childNodes).indexOf(startNode),startNode=startNode.parentNode),endNode instanceof Element&&"BR"===endNode.tagName&&(endOffset=Array.from(endNode.parentNode.childNodes).indexOf(endNode),endNode=endNode.parentNode);const range=document.createRange();range.setStart(startNode,startOffset),range.setEnd(endNode,endOffset),selection.removeAllRanges(),selection.addRange(range)}}else selection.removeAllRanges(),this.root.blur()}setRange(range){let force=arguments.length>1&&void 0!==arguments[1]&&arguments[1],source=arguments.length>2&&void 0!==arguments[2]?arguments[2]:core_emitter.sources.API;if("string"==typeof force&&(source=force,force=!1),selection_debug.info("setRange",range),null!=range){const args=this.rangeToNative(range);this.setNativeRange(...args,force)}else this.setNativeRange(null);this.update(source)}update(){let source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core_emitter.sources.USER;const oldRange=this.lastRange,[lastRange,nativeRange]=this.getRange();if(this.lastRange=lastRange,this.lastNative=nativeRange,null!=this.lastRange&&(this.savedRange=this.lastRange),!lodash_es_isEqual(oldRange,this.lastRange)){if(!this.composing&&null!=nativeRange&&nativeRange.native.collapsed&&nativeRange.start.node!==this.cursor.textNode){const range=this.cursor.restore();range&&this.setNativeRange(range.startNode,range.startOffset,range.endNode,range.endOffset)}const args=[core_emitter.events.SELECTION_CHANGE,lodash_es_cloneDeep(this.lastRange),lodash_es_cloneDeep(oldRange),source];this.emitter.emit(core_emitter.events.EDITOR_CHANGE,...args),source!==core_emitter.sources.SILENT&&this.emitter.emit(...args)}}},ASCII=/^[ -~]*$/;function convertListHTML(items,lastIndent,types){if(0===items.length){const[endTag]=getListType(types.pop());return lastIndent<=0?`</li></${endTag}>`:`</li></${endTag}>${convertListHTML([],lastIndent-1,types)}`}const[{child,offset,length,indent,type},...rest]=items,[tag,attribute]=getListType(type);if(indent>lastIndent)return types.push(type),indent===lastIndent+1?`<${tag}><li${attribute}>${convertHTML(child,offset,length)}${convertListHTML(rest,indent,types)}`:`<${tag}><li>${convertListHTML(items,lastIndent+1,types)}`;const previousType=types[types.length-1];if(indent===lastIndent&&type===previousType)return`</li><li${attribute}>${convertHTML(child,offset,length)}${convertListHTML(rest,indent,types)}`;const[endTag]=getListType(types.pop());return`</li></${endTag}>${convertListHTML(items,lastIndent-1,types)}`}function convertHTML(blot,index,length){let isRoot=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("html"in blot&&"function"==typeof blot.html)return blot.html(index,length);if(blot instanceof text_Text){return escapeText(blot.value().slice(index,index+length)).replaceAll(" ","&nbsp;")}if(blot instanceof ParentBlot$1){if("list-container"===blot.statics.blotName){const items=[];return blot.children.forEachAt(index,length,(child,offset,childLength)=>{const formats="formats"in child&&"function"==typeof child.formats?child.formats():{};items.push({child,offset,length:childLength,indent:formats.indent||0,type:formats.list})}),convertListHTML(items,-1,[])}const parts=[];if(blot.children.forEachAt(index,length,(child,offset,childLength)=>{parts.push(convertHTML(child,offset,childLength))}),isRoot||"list"===blot.statics.blotName)return parts.join("");const{outerHTML,innerHTML}=blot.domNode,[start,end]=outerHTML.split(`>${innerHTML}<`);return"<table"===start?`<table style="border: 1px solid #000;">${parts.join("")}<${end}`:`${start}>${parts.join("")}<${end}`}return blot.domNode instanceof Element?blot.domNode.outerHTML:""}function combineFormats(formats,combined){return Object.keys(combined).reduce((merged,name)=>{if(null==formats[name])return merged;const combinedValue=combined[name];return combinedValue===formats[name]?merged[name]=combinedValue:Array.isArray(combinedValue)?combinedValue.indexOf(formats[name])<0?merged[name]=combinedValue.concat([formats[name]]):merged[name]=combinedValue:merged[name]=[combinedValue,formats[name]],merged},{})}function getListType(type){const tag="ordered"===type?"ol":"ul";switch(type){case"checked":return[tag,' data-list="checked"'];case"unchecked":return[tag,' data-list="unchecked"'];default:return[tag,""]}}function normalizeDelta(delta){return delta.reduce((normalizedDelta,op)=>{if("string"==typeof op.insert){const text=op.insert.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return normalizedDelta.insert(text,op.attributes)}return normalizedDelta.push(op)},new(Delta_default()))}function shiftRange(_ref,amount){let{index,length}=_ref;return new Range(index+amount,length)}const editor=class Editor{constructor(scroll){this.scroll=scroll,this.delta=this.getDelta()}applyDelta(delta){this.scroll.update();let scrollLength=this.scroll.length();this.scroll.batchStart();const normalizedDelta=normalizeDelta(delta),deleteDelta=new(Delta_default());return function splitOpLines(ops){const split=[];return ops.forEach(op=>{if("string"==typeof op.insert){op.insert.split("\n").forEach((line,index)=>{index&&split.push({insert:"\n",attributes:op.attributes}),line&&split.push({insert:line,attributes:op.attributes})})}else split.push(op)}),split}(normalizedDelta.ops.slice()).reduce((index,op)=>{const length=Delta.Op.length(op);let attributes=op.attributes||{},isImplicitNewlinePrepended=!1,isImplicitNewlineAppended=!1;if(null!=op.insert){if(deleteDelta.retain(length),"string"==typeof op.insert){const text=op.insert;isImplicitNewlineAppended=!text.endsWith("\n")&&(scrollLength<=index||!!this.scroll.descendant(BlockEmbed,index)[0]),this.scroll.insertAt(index,text);const[line,offset]=this.scroll.line(index);let formats=lodash_es_merge({},bubbleFormats(line));if(line instanceof Block){const[leaf]=line.descendant(LeafBlot$1,offset);leaf&&(formats=lodash_es_merge(formats,bubbleFormats(leaf)))}attributes=Delta.AttributeMap.diff(formats,attributes)||{}}else if("object"==typeof op.insert){const key=Object.keys(op.insert)[0];if(null==key)return index;const isInlineEmbed=null!=this.scroll.query(key,Scope.INLINE);if(isInlineEmbed)(scrollLength<=index||this.scroll.descendant(BlockEmbed,index)[0])&&(isImplicitNewlineAppended=!0);else if(index>0){const[leaf,offset]=this.scroll.descendant(LeafBlot$1,index-1);if(leaf instanceof text_Text){"\n"!==leaf.value()[offset]&&(isImplicitNewlinePrepended=!0)}else leaf instanceof EmbedBlot$1&&leaf.statics.scope===Scope.INLINE_BLOT&&(isImplicitNewlinePrepended=!0)}if(this.scroll.insertAt(index,key,op.insert[key]),isInlineEmbed){const[leaf]=this.scroll.descendant(LeafBlot$1,index);if(leaf){const formats=lodash_es_merge({},bubbleFormats(leaf));attributes=Delta.AttributeMap.diff(formats,attributes)||{}}}}scrollLength+=length}else if(deleteDelta.push(op),null!==op.retain&&"object"==typeof op.retain){const key=Object.keys(op.retain)[0];if(null==key)return index;this.scroll.updateEmbedAt(index,key,op.retain[key])}Object.keys(attributes).forEach(name=>{this.scroll.formatAt(index,length,name,attributes[name])});const prependedLength=isImplicitNewlinePrepended?1:0,addedLength=isImplicitNewlineAppended?1:0;return scrollLength+=prependedLength+addedLength,deleteDelta.retain(prependedLength),deleteDelta.delete(addedLength),index+length+prependedLength+addedLength},0),deleteDelta.reduce((index,op)=>"number"==typeof op.delete?(this.scroll.deleteAt(index,op.delete),index):index+Delta.Op.length(op),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(normalizedDelta)}deleteText(index,length){return this.scroll.deleteAt(index,length),this.update((new(Delta_default())).retain(index).delete(length))}formatLine(index,length){let formats=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.scroll.update(),Object.keys(formats).forEach(format=>{this.scroll.lines(index,Math.max(length,1)).forEach(line=>{line.format(format,formats[format])})}),this.scroll.optimize();const delta=(new(Delta_default())).retain(index).retain(length,lodash_es_cloneDeep(formats));return this.update(delta)}formatText(index,length){let formats=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.keys(formats).forEach(format=>{this.scroll.formatAt(index,length,format,formats[format])});const delta=(new(Delta_default())).retain(index).retain(length,lodash_es_cloneDeep(formats));return this.update(delta)}getContents(index,length){return this.delta.slice(index,index+length)}getDelta(){return this.scroll.lines().reduce((delta,line)=>delta.concat(line.delta()),new(Delta_default()))}getFormat(index){let length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,lines=[],leaves=[];0===length?this.scroll.path(index).forEach(path=>{const[blot]=path;blot instanceof Block?lines.push(blot):blot instanceof LeafBlot$1&&leaves.push(blot)}):(lines=this.scroll.lines(index,length),leaves=this.scroll.descendants(LeafBlot$1,index,length));const[lineFormats,leafFormats]=[lines,leaves].map(blots=>{const blot=blots.shift();if(null==blot)return{};let formats=bubbleFormats(blot);for(;Object.keys(formats).length>0;){const blot=blots.shift();if(null==blot)return formats;formats=combineFormats(bubbleFormats(blot),formats)}return formats});return{...lineFormats,...leafFormats}}getHTML(index,length){const[line,lineOffset]=this.scroll.line(index);if(line){const lineLength=line.length();return!(line.length()>=lineOffset+length)||0===lineOffset&&length===lineLength?convertHTML(this.scroll,index,length,!0):convertHTML(line,lineOffset,length,!0)}return""}getText(index,length){return this.getContents(index,length).filter(op=>"string"==typeof op.insert).map(op=>op.insert).join("")}insertContents(index,contents){const normalizedDelta=normalizeDelta(contents),change=(new(Delta_default())).retain(index).concat(normalizedDelta);return this.scroll.insertContents(index,normalizedDelta),this.update(change)}insertEmbed(index,embed,value){return this.scroll.insertAt(index,embed,value),this.update((new(Delta_default())).retain(index).insert({[embed]:value}))}insertText(index,text){let formats=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return text=text.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),this.scroll.insertAt(index,text),Object.keys(formats).forEach(format=>{this.scroll.formatAt(index,text.length,format,formats[format])}),this.update((new(Delta_default())).retain(index).insert(text,lodash_es_cloneDeep(formats)))}isBlank(){if(0===this.scroll.children.length)return!0;if(this.scroll.children.length>1)return!1;const blot=this.scroll.children.head;if(blot?.statics.blotName!==Block.blotName)return!1;const block=blot;return!(block.children.length>1)&&block.children.head instanceof blots_break}removeFormat(index,length){const text=this.getText(index,length),[line,offset]=this.scroll.line(index+length);let suffixLength=0,suffix=new(Delta_default());null!=line&&(suffixLength=line.length()-offset,suffix=line.delta().slice(offset,offset+suffixLength-1).insert("\n"));const diff=this.getContents(index,length+suffixLength).diff((new(Delta_default())).insert(text).concat(suffix)),delta=(new(Delta_default())).retain(index).concat(diff);return this.applyDelta(delta)}update(change){let mutations=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],selectionInfo=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;const oldDelta=this.delta;if(1===mutations.length&&"characterData"===mutations[0].type&&mutations[0].target.data.match(ASCII)&&this.scroll.find(mutations[0].target)){const textBlot=this.scroll.find(mutations[0].target),formats=bubbleFormats(textBlot),index=textBlot.offset(this.scroll),oldValue=mutations[0].oldValue.replace(cursor.CONTENTS,""),oldText=(new(Delta_default())).insert(oldValue),newText=(new(Delta_default())).insert(textBlot.value()),relativeSelectionInfo=selectionInfo&&{oldRange:shiftRange(selectionInfo.oldRange,-index),newRange:shiftRange(selectionInfo.newRange,-index)};change=(new(Delta_default())).retain(index).concat(oldText.diff(newText,relativeSelectionInfo)).reduce((delta,op)=>op.insert?delta.insert(op.insert,formats):delta.push(op),new(Delta_default())),this.delta=oldDelta.compose(change)}else this.delta=this.getDelta(),change&&lodash_es_isEqual(oldDelta.compose(change),this.delta)||(change=oldDelta.diff(this.delta,selectionInfo));return change}};const core_module=class Module{static DEFAULTS={};constructor(quill){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.quill=quill,this.options=options}};const blots_embed=class Embed extends EmbedBlot$1{constructor(scroll,node){super(scroll,node),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(childNode=>{this.contentNode.appendChild(childNode)}),this.leftGuard=document.createTextNode("\ufeff"),this.rightGuard=document.createTextNode("\ufeff"),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(node,offset){return node===this.leftGuard?0:node===this.rightGuard?1:super.index(node,offset)}restore(node){let textNode,range=null;const text=node.data.split("\ufeff").join("");if(node===this.leftGuard)if(this.prev instanceof text_Text){const prevLength=this.prev.length();this.prev.insertAt(prevLength,text),range={startNode:this.prev.domNode,startOffset:prevLength+text.length}}else textNode=document.createTextNode(text),this.parent.insertBefore(this.scroll.create(textNode),this),range={startNode:textNode,startOffset:text.length};else node===this.rightGuard&&(this.next instanceof text_Text?(this.next.insertAt(0,text),range={startNode:this.next.domNode,startOffset:text.length}):(textNode=document.createTextNode(text),this.parent.insertBefore(this.scroll.create(textNode),this.next),range={startNode:textNode,startOffset:text.length}));return node.data="\ufeff",range}update(mutations,context){mutations.forEach(mutation=>{if("characterData"===mutation.type&&(mutation.target===this.leftGuard||mutation.target===this.rightGuard)){const range=this.restore(mutation.target);range&&(context.range=range)}})}};const composition=class Composition{isComposing=!1;constructor(scroll,emitter){this.scroll=scroll,this.emitter=emitter,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",event=>{this.isComposing||this.handleCompositionStart(event)}),this.scroll.domNode.addEventListener("compositionend",event=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(event)})})}handleCompositionStart(event){const blot=event.target instanceof Node?this.scroll.find(event.target,!0):null;!blot||blot instanceof blots_embed||(this.emitter.emit(core_emitter.events.COMPOSITION_BEFORE_START,event),this.scroll.batchStart(),this.emitter.emit(core_emitter.events.COMPOSITION_START,event),this.isComposing=!0)}handleCompositionEnd(event){this.emitter.emit(core_emitter.events.COMPOSITION_BEFORE_END,event),this.scroll.batchEnd(),this.emitter.emit(core_emitter.events.COMPOSITION_END,event),this.isComposing=!1}};class Theme{static DEFAULTS={modules:{}};static themes={default:Theme};modules={};constructor(quill,options){this.quill=quill,this.options=options}init(){Object.keys(this.options.modules).forEach(name=>{null==this.modules[name]&&this.addModule(name)})}addModule(name){const ModuleClass=this.quill.constructor.import(`modules/${name}`);return this.modules[name]=new ModuleClass(this.quill,this.options.modules[name]||{}),this.modules[name]}}const core_theme=Theme,getParentElement=element=>element.parentElement||element.getRootNode().host||null,getElementRect=element=>{const rect=element.getBoundingClientRect(),scaleX="offsetWidth"in element&&Math.abs(rect.width)/element.offsetWidth||1,scaleY="offsetHeight"in element&&Math.abs(rect.height)/element.offsetHeight||1;return{top:rect.top,right:rect.left+element.clientWidth*scaleX,bottom:rect.top+element.clientHeight*scaleY,left:rect.left}},paddingValueToInt=value=>{const number=parseInt(value,10);return Number.isNaN(number)?0:number},getScrollDistance=(targetStart,targetEnd,scrollStart,scrollEnd,scrollPaddingStart,scrollPaddingEnd)=>targetStart<scrollStart&&targetEnd>scrollEnd?0:targetStart<scrollStart?-(scrollStart-targetStart+scrollPaddingStart):targetEnd>scrollEnd?targetEnd-targetStart>scrollEnd-scrollStart?targetStart+scrollPaddingStart-scrollStart:targetEnd-scrollEnd+scrollPaddingEnd:0,utils_scrollRectIntoView=(root,targetRect)=>{const document=root.ownerDocument;let rect=targetRect,current=root;for(;current;){const isDocumentBody=current===document.body,bounding=isDocumentBody?{top:0,right:window.visualViewport?.width??document.documentElement.clientWidth,bottom:window.visualViewport?.height??document.documentElement.clientHeight,left:0}:getElementRect(current),style=getComputedStyle(current),scrollDistanceX=getScrollDistance(rect.left,rect.right,bounding.left,bounding.right,paddingValueToInt(style.scrollPaddingLeft),paddingValueToInt(style.scrollPaddingRight)),scrollDistanceY=getScrollDistance(rect.top,rect.bottom,bounding.top,bounding.bottom,paddingValueToInt(style.scrollPaddingTop),paddingValueToInt(style.scrollPaddingBottom));if(scrollDistanceX||scrollDistanceY)if(isDocumentBody)document.defaultView?.scrollBy(scrollDistanceX,scrollDistanceY);else{const{scrollLeft,scrollTop}=current;scrollDistanceY&&(current.scrollTop+=scrollDistanceY),scrollDistanceX&&(current.scrollLeft+=scrollDistanceX);const scrolledLeft=current.scrollLeft-scrollLeft,scrolledTop=current.scrollTop-scrollTop;rect={left:rect.left-scrolledLeft,top:rect.top-scrolledTop,right:rect.right-scrolledLeft,bottom:rect.bottom-scrolledTop}}current=isDocumentBody||"fixed"===style.position?null:getParentElement(current)}},CORE_FORMATS=["block","break","cursor","inline","scroll","text"],utils_createRegistryWithFormats=(formats,sourceRegistry,debug)=>{const registry=new Registry;return CORE_FORMATS.forEach(name=>{const coreBlot=sourceRegistry.query(name);coreBlot&&registry.register(coreBlot)}),formats.forEach(name=>{let format=sourceRegistry.query(name);format||debug.error(`Cannot register "${name}" specified in "formats" config. Are you sure it was registered?`);let iterations=0;for(;format;)if(registry.register(format),format="blotName"in format?format.requiredContainer??null:null,iterations+=1,iterations>100){debug.error(`Cycle detected in registering blot requiredContainer: "${name}"`);break}}),registry},quill_debug=logger("quill"),globalRegistry=new Registry;ParentBlot$1.uiClass="ql-ui";class Quill{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:globalRegistry,theme:"default"};static events=core_emitter.events;static sources=core_emitter.sources;static version="2.0.3";static imports={delta:Delta_default(),parchment:parchment_namespaceObject,"core/module":core_module,"core/theme":core_theme};static debug(limit){!0===limit&&(limit="log"),logger.level(limit)}static find(node){let bubble=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return instances.get(node)||globalRegistry.find(node,bubble)}static import(name){return null==this.imports[name]&&quill_debug.error(`Cannot import ${name}. Are you sure it was registered?`),this.imports[name]}static register(){if("string"!=typeof(arguments.length<=0?void 0:arguments[0])){const target=arguments.length<=0?void 0:arguments[0],overwrite=!!(arguments.length<=1?void 0:arguments[1]),name="attrName"in target?target.attrName:target.blotName;"string"==typeof name?this.register(`formats/${name}`,target,overwrite):Object.keys(target).forEach(key=>{this.register(key,target[key],overwrite)})}else{const path=arguments.length<=0?void 0:arguments[0],target=arguments.length<=1?void 0:arguments[1],overwrite=!!(arguments.length<=2?void 0:arguments[2]);null==this.imports[path]||overwrite||quill_debug.warn(`Overwriting ${path} with`,target),this.imports[path]=target,(path.startsWith("blots/")||path.startsWith("formats/"))&&target&&"boolean"!=typeof target&&"abstract"!==target.blotName&&globalRegistry.register(target),"function"==typeof target.register&&target.register(globalRegistry)}}constructor(container){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.options=function expandConfig(containerOrSelector,options){const container=resolveSelector(containerOrSelector);if(!container)throw new Error("Invalid Quill container");const shouldUseDefaultTheme=!options.theme||options.theme===Quill.DEFAULTS.theme,theme=shouldUseDefaultTheme?core_theme:Quill.import(`themes/${options.theme}`);if(!theme)throw new Error(`Invalid theme ${options.theme}. Did you register it?`);const{modules:quillModuleDefaults,...quillDefaults}=Quill.DEFAULTS,{modules:themeModuleDefaults,...themeDefaults}=theme.DEFAULTS;let userModuleOptions=expandModuleConfig(options.modules);null!=userModuleOptions&&userModuleOptions.toolbar&&userModuleOptions.toolbar.constructor!==Object&&(userModuleOptions={...userModuleOptions,toolbar:{container:userModuleOptions.toolbar}});const modules=lodash_es_merge({},expandModuleConfig(quillModuleDefaults),expandModuleConfig(themeModuleDefaults),userModuleOptions),config={...quillDefaults,...omitUndefinedValuesFromOptions(themeDefaults),...omitUndefinedValuesFromOptions(options)};let registry=options.registry;registry?options.formats&&quill_debug.warn('Ignoring "formats" option because "registry" is specified'):registry=options.formats?utils_createRegistryWithFormats(options.formats,config.registry,quill_debug):config.registry;return{...config,registry,container,theme,modules:Object.entries(modules).reduce((modulesWithDefaults,_ref2)=>{let[name,value]=_ref2;if(!value)return modulesWithDefaults;const moduleClass=Quill.import(`modules/${name}`);return null==moduleClass?(quill_debug.error(`Cannot load ${name} module. Are you sure you registered it?`),modulesWithDefaults):{...modulesWithDefaults,[name]:lodash_es_merge({},moduleClass.DEFAULTS||{},value)}},{}),bounds:resolveSelector(config.bounds)}}(container,options),this.container=this.options.container,null==this.container)return void quill_debug.error("Invalid Quill container",container);this.options.debug&&Quill.debug(this.options.debug);const html=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",instances.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new core_emitter;const scrollBlotName=ScrollBlot$1.blotName,ScrollBlot=this.options.registry.query(scrollBlotName);if(!ScrollBlot||!("blotName"in ScrollBlot))throw new Error(`Cannot initialize Quill without "${scrollBlotName}" blot`);if(this.scroll=new ScrollBlot(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new editor(this.scroll),this.selection=new selection(this.scroll,this.emitter),this.composition=new composition(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(core_emitter.events.EDITOR_CHANGE,type=>{type===core_emitter.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(core_emitter.events.SCROLL_UPDATE,(source,mutations)=>{const oldRange=this.selection.lastRange,[newRange]=this.selection.getRange(),selectionInfo=oldRange&&newRange?{oldRange,newRange}:void 0;modify.call(this,()=>this.editor.update(null,mutations,selectionInfo),source)}),this.emitter.on(core_emitter.events.SCROLL_EMBED_UPDATE,(blot,delta)=>{const oldRange=this.selection.lastRange,[newRange]=this.selection.getRange(),selectionInfo=oldRange&&newRange?{oldRange,newRange}:void 0;modify.call(this,()=>{const change=(new(Delta_default())).retain(blot.offset(this)).retain({[blot.statics.blotName]:delta});return this.editor.update(change,[],selectionInfo)},Quill.sources.USER)}),html){const contents=this.clipboard.convert({html:`${html}<p><br></p>`,text:"\n"});this.setContents(contents)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(container){let refNode=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"==typeof container){const className=container;(container=document.createElement("div")).classList.add(className)}return this.container.insertBefore(container,refNode),container}blur(){this.selection.setRange(null)}deleteText(index,length,source){return[index,length,,source]=overload(index,length,source),modify.call(this,()=>this.editor.deleteText(index,length),source,index,-1*length)}disable(){this.enable(!1)}editReadOnly(modifier){this.allowReadOnlyEdits=!0;const value=modifier();return this.allowReadOnlyEdits=!1,value}enable(){let enabled=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.scroll.enable(enabled),this.container.classList.toggle("ql-disabled",!enabled)}focus(){let options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.selection.focus(),options.preventScroll||this.scrollSelectionIntoView()}format(name,value){let source=arguments.length>2&&void 0!==arguments[2]?arguments[2]:core_emitter.sources.API;return modify.call(this,()=>{const range=this.getSelection(!0);let change=new(Delta_default());if(null==range)return change;if(this.scroll.query(name,Scope.BLOCK))change=this.editor.formatLine(range.index,range.length,{[name]:value});else{if(0===range.length)return this.selection.format(name,value),change;change=this.editor.formatText(range.index,range.length,{[name]:value})}return this.setSelection(range,core_emitter.sources.SILENT),change},source)}formatLine(index,length,name,value,source){let formats;return[index,length,formats,source]=overload(index,length,name,value,source),modify.call(this,()=>this.editor.formatLine(index,length,formats),source,index,0)}formatText(index,length,name,value,source){let formats;return[index,length,formats,source]=overload(index,length,name,value,source),modify.call(this,()=>this.editor.formatText(index,length,formats),source,index,0)}getBounds(index){let length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,bounds=null;if(bounds="number"==typeof index?this.selection.getBounds(index,length):this.selection.getBounds(index.index,index.length),!bounds)return null;const containerBounds=this.container.getBoundingClientRect();return{bottom:bounds.bottom-containerBounds.top,height:bounds.height,left:bounds.left-containerBounds.left,right:bounds.right-containerBounds.left,top:bounds.top-containerBounds.top,width:bounds.width}}getContents(){let index=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getLength()-index;return[index,length]=overload(index,length),this.editor.getContents(index,length)}getFormat(){let index=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelection(!0),length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"number"==typeof index?this.editor.getFormat(index,length):this.editor.getFormat(index.index,index.length)}getIndex(blot){return blot.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(index){return this.scroll.leaf(index)}getLine(index){return this.scroll.line(index)}getLines(){let index=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return"number"!=typeof index?this.scroll.lines(index.index,index.length):this.scroll.lines(index,length)}getModule(name){return this.theme.modules[name]}getSelection(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let index=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,length=arguments.length>1?arguments[1]:void 0;return"number"==typeof index&&(length=length??this.getLength()-index),[index,length]=overload(index,length),this.editor.getHTML(index,length)}getText(){let index=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,length=arguments.length>1?arguments[1]:void 0;return"number"==typeof index&&(length=length??this.getLength()-index),[index,length]=overload(index,length),this.editor.getText(index,length)}hasFocus(){return this.selection.hasFocus()}insertEmbed(index,embed,value){let source=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Quill.sources.API;return modify.call(this,()=>this.editor.insertEmbed(index,embed,value),source,index)}insertText(index,text,name,value,source){let formats;return[index,,formats,source]=overload(index,0,name,value,source),modify.call(this,()=>this.editor.insertText(index,text,formats),source,index,text.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(index,length,source){return[index,length,,source]=overload(index,length,source),modify.call(this,()=>this.editor.removeFormat(index,length),source,index)}scrollRectIntoView(rect){utils_scrollRectIntoView(this.root,rect)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const range=this.selection.lastRange,bounds=range&&this.selection.getBounds(range.index,range.length);bounds&&this.scrollRectIntoView(bounds)}setContents(delta){let source=arguments.length>1&&void 0!==arguments[1]?arguments[1]:core_emitter.sources.API;return modify.call(this,()=>{delta=new(Delta_default())(delta);const length=this.getLength(),delete1=this.editor.deleteText(0,length),applied=this.editor.insertContents(0,delta),delete2=this.editor.deleteText(this.getLength()-1,1);return delete1.compose(applied).compose(delete2)},source)}setSelection(index,length,source){null==index?this.selection.setRange(null,length||Quill.sources.API):([index,length,,source]=overload(index,length,source),this.selection.setRange(new Range(Math.max(0,index),length),source),source!==core_emitter.sources.SILENT&&this.scrollSelectionIntoView())}setText(text){let source=arguments.length>1&&void 0!==arguments[1]?arguments[1]:core_emitter.sources.API;const delta=(new(Delta_default())).insert(text);return this.setContents(delta,source)}update(){let source=arguments.length>0&&void 0!==arguments[0]?arguments[0]:core_emitter.sources.USER;const change=this.scroll.update(source);return this.selection.update(source),change}updateContents(delta){let source=arguments.length>1&&void 0!==arguments[1]?arguments[1]:core_emitter.sources.API;return modify.call(this,()=>(delta=new(Delta_default())(delta),this.editor.applyDelta(delta)),source,!0)}}function resolveSelector(selector){return"string"==typeof selector?document.querySelector(selector):selector}function expandModuleConfig(config){return Object.entries(config??{}).reduce((expanded,_ref)=>{let[key,value]=_ref;return{...expanded,[key]:!0===value?{}:value}},{})}function omitUndefinedValuesFromOptions(obj){return Object.fromEntries(Object.entries(obj).filter(entry=>void 0!==entry[1]))}function modify(modifier,source,index,shift){if(!this.isEnabled()&&source===core_emitter.sources.USER&&!this.allowReadOnlyEdits)return new(Delta_default());let range=null==index?null:this.getSelection();const oldDelta=this.editor.delta,change=modifier();if(null!=range&&(!0===index&&(index=range.index),null==shift?range=quill_shiftRange(range,change,source):0!==shift&&(range=quill_shiftRange(range,index,shift,source)),this.setSelection(range,core_emitter.sources.SILENT)),change.length()>0){const args=[core_emitter.events.TEXT_CHANGE,change,oldDelta,source];this.emitter.emit(core_emitter.events.EDITOR_CHANGE,...args),source!==core_emitter.sources.SILENT&&this.emitter.emit(...args)}return change}function overload(index,length,name,value,source){let formats={};return"number"==typeof index.index&&"number"==typeof index.length?"number"!=typeof length?(source=value,value=name,name=length,length=index.length,index=index.index):(length=index.length,index=index.index):"number"!=typeof length&&(source=value,value=name,name=length,length=0),"object"==typeof name?(formats=name,source=value):"string"==typeof name&&(null!=value?formats[name]=value:source=name),[index,length,formats,source=source||core_emitter.sources.API]}function quill_shiftRange(range,index,lengthOrSource,source){const length="number"==typeof lengthOrSource?lengthOrSource:0;if(null==range)return null;let start,end;return index&&"function"==typeof index.transformPosition?[start,end]=[range.index,range.index+range.length].map(pos=>index.transformPosition(pos,source!==core_emitter.sources.USER)):[start,end]=[range.index,range.index+range.length].map(pos=>pos<index||pos===index&&source===core_emitter.sources.USER?pos:length>=0?pos+length:Math.max(index,pos+length)),new Range(start,end-start)}const container=class Container extends ContainerBlot$1{};function isLine(blot){return blot instanceof Block||blot instanceof BlockEmbed}function isUpdatable(blot){return"function"==typeof blot.updateContent}function insertInlineContents(parent,index,inlineContents){inlineContents.reduce((index,op)=>{const length=Delta.Op.length(op);let attributes=op.attributes||{};if(null!=op.insert)if("string"==typeof op.insert){const text=op.insert;parent.insertAt(index,text);const[leaf]=parent.descendant(LeafBlot$1,index),formats=bubbleFormats(leaf);attributes=Delta.AttributeMap.diff(formats,attributes)||{}}else if("object"==typeof op.insert){const key=Object.keys(op.insert)[0];if(null==key)return index;parent.insertAt(index,key,op.insert[key]);if(null!=parent.scroll.query(key,Scope.INLINE)){const[leaf]=parent.descendant(LeafBlot$1,index),formats=bubbleFormats(leaf);attributes=Delta.AttributeMap.diff(formats,attributes)||{}}}return Object.keys(attributes).forEach(key=>{parent.formatAt(index,length,key,attributes[key])}),index+length},index)}const blots_scroll=class Scroll extends ScrollBlot$1{static blotName="scroll";static className="ql-editor";static tagName="DIV";static defaultChild=Block;static allowedChildren=[Block,BlockEmbed,container];constructor(registry,domNode,_ref){let{emitter}=_ref;super(registry,domNode),this.emitter=emitter,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",e=>this.handleDragStart(e))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const mutations=this.batch;this.batch=!1,this.update(mutations)}emitMount(blot){this.emitter.emit(core_emitter.events.SCROLL_BLOT_MOUNT,blot)}emitUnmount(blot){this.emitter.emit(core_emitter.events.SCROLL_BLOT_UNMOUNT,blot)}emitEmbedUpdate(blot,change){this.emitter.emit(core_emitter.events.SCROLL_EMBED_UPDATE,blot,change)}deleteAt(index,length){const[first,offset]=this.line(index),[last]=this.line(index+length);if(super.deleteAt(index,length),null!=last&&first!==last&&offset>0){if(first instanceof BlockEmbed||last instanceof BlockEmbed)return void this.optimize();const ref=last.children.head instanceof blots_break?null:last.children.head;first.moveChildren(last,ref),first.remove()}this.optimize()}enable(){let enabled=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.domNode.setAttribute("contenteditable",enabled?"true":"false")}formatAt(index,length,format,value){super.formatAt(index,length,format,value),this.optimize()}insertAt(index,value,def){if(index>=this.length())if(null==def||null==this.scroll.query(value,Scope.BLOCK)){const blot=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(blot),null==def&&value.endsWith("\n")?blot.insertAt(0,value.slice(0,-1),def):blot.insertAt(0,value,def)}else{const embed=this.scroll.create(value,def);this.appendChild(embed)}else super.insertAt(index,value,def);this.optimize()}insertBefore(blot,ref){if(blot.statics.scope===Scope.INLINE_BLOT){const wrapper=this.scroll.create(this.statics.defaultChild.blotName);wrapper.appendChild(blot),super.insertBefore(wrapper,ref)}else super.insertBefore(blot,ref)}insertContents(index,delta){const renderBlocks=this.deltaToRenderBlocks(delta.concat((new(Delta_default())).insert("\n"))),last=renderBlocks.pop();if(null==last)return;this.batchStart();const first=renderBlocks.shift();if(first){const shouldInsertNewlineChar="block"===first.type&&(0===first.delta.length()||!this.descendant(BlockEmbed,index)[0]&&index<this.length()),delta="block"===first.type?first.delta:(new(Delta_default())).insert({[first.key]:first.value});insertInlineContents(this,index,delta);const newlineCharLength="block"===first.type?1:0,lineEndIndex=index+delta.length()+newlineCharLength;shouldInsertNewlineChar&&this.insertAt(lineEndIndex-1,"\n");const formats=bubbleFormats(this.line(index)[0]),attributes=Delta.AttributeMap.diff(formats,first.attributes)||{};Object.keys(attributes).forEach(name=>{this.formatAt(lineEndIndex-1,1,name,attributes[name])}),index=lineEndIndex}let[refBlot,refBlotOffset]=this.children.find(index);if(renderBlocks.length&&(refBlot&&(refBlot=refBlot.split(refBlotOffset),refBlotOffset=0),renderBlocks.forEach(renderBlock=>{if("block"===renderBlock.type){insertInlineContents(this.createBlock(renderBlock.attributes,refBlot||void 0),0,renderBlock.delta)}else{const blockEmbed=this.create(renderBlock.key,renderBlock.value);this.insertBefore(blockEmbed,refBlot||void 0),Object.keys(renderBlock.attributes).forEach(name=>{blockEmbed.format(name,renderBlock.attributes[name])})}})),"block"===last.type&&last.delta.length()){insertInlineContents(this,refBlot?refBlot.offset(refBlot.scroll)+refBlotOffset:this.length(),last.delta)}this.batchEnd(),this.optimize()}isEnabled(){return"true"===this.domNode.getAttribute("contenteditable")}leaf(index){const last=this.path(index).pop();if(!last)return[null,-1];const[blot,offset]=last;return blot instanceof LeafBlot$1?[blot,offset]:[null,-1]}line(index){return index===this.length()?this.line(index-1):this.descendant(isLine,index)}lines(){let index=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,length=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;const getLines=(blot,blotIndex,blotLength)=>{let lines=[],lengthLeft=blotLength;return blot.children.forEachAt(blotIndex,blotLength,(child,childIndex,childLength)=>{isLine(child)?lines.push(child):child instanceof ContainerBlot$1&&(lines=lines.concat(getLines(child,childIndex,lengthLeft))),lengthLeft-=childLength}),lines};return getLines(this,index,length)}optimize(){let mutations=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],context=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.batch||(super.optimize(mutations,context),mutations.length>0&&this.emitter.emit(core_emitter.events.SCROLL_OPTIMIZE,mutations,context))}path(index){return super.path(index).slice(1)}remove(){}update(mutations){if(this.batch)return void(Array.isArray(mutations)&&(this.batch=this.batch.concat(mutations)));let source=core_emitter.sources.USER;"string"==typeof mutations&&(source=mutations),Array.isArray(mutations)||(mutations=this.observer.takeRecords()),(mutations=mutations.filter(_ref2=>{let{target}=_ref2;const blot=this.find(target,!0);return blot&&!isUpdatable(blot)})).length>0&&this.emitter.emit(core_emitter.events.SCROLL_BEFORE_UPDATE,source,mutations),super.update(mutations.concat([])),mutations.length>0&&this.emitter.emit(core_emitter.events.SCROLL_UPDATE,source,mutations)}updateEmbedAt(index,key,change){const[blot]=this.descendant(b=>b instanceof BlockEmbed,index);blot&&blot.statics.blotName===key&&isUpdatable(blot)&&blot.updateContent(change)}handleDragStart(event){event.preventDefault()}deltaToRenderBlocks(delta){const renderBlocks=[];let currentBlockDelta=new(Delta_default());return delta.forEach(op=>{const insert=op?.insert;if(insert)if("string"==typeof insert){const splitted=insert.split("\n");splitted.slice(0,-1).forEach(text=>{currentBlockDelta.insert(text,op.attributes),renderBlocks.push({type:"block",delta:currentBlockDelta,attributes:op.attributes??{}}),currentBlockDelta=new(Delta_default())});const last=splitted[splitted.length-1];last&&currentBlockDelta.insert(last,op.attributes)}else{const key=Object.keys(insert)[0];if(!key)return;this.query(key,Scope.INLINE)?currentBlockDelta.push(op):(currentBlockDelta.length()&&renderBlocks.push({type:"block",delta:currentBlockDelta,attributes:{}}),currentBlockDelta=new(Delta_default()),renderBlocks.push({type:"blockEmbed",key,value:insert[key],attributes:op.attributes??{}}))}}),currentBlockDelta.length()&&renderBlocks.push({type:"block",delta:currentBlockDelta,attributes:{}}),renderBlocks}createBlock(attributes,refBlot){let blotName;const formats={};Object.entries(attributes).forEach(_ref3=>{let[key,value]=_ref3;null!=this.query(key,Scope.BLOCK&Scope.BLOT)?blotName=key:formats[key]=value});const block=this.create(blotName||this.statics.defaultChild.blotName,blotName?attributes[blotName]:void 0);this.insertBefore(block,refBlot||void 0);const length=block.length();return Object.entries(formats).forEach(_ref4=>{let[key,value]=_ref4;block.formatAt(0,length,key,value)}),block}},config={scope:Scope.BLOCK,whitelist:["right","center","justify"]},AlignAttribute=new Attributor("align","align",config),AlignClass=new ClassAttributor$1("align","ql-align",config),AlignStyle=new StyleAttributor$1("align","text-align",config);class ColorAttributor extends StyleAttributor$1{value(domNode){let value=super.value(domNode);if(!value.startsWith("rgb("))return value;value=value.replace(/^[^\d]+/,"").replace(/[^\d]+$/,"");return`#${value.split(",").map(component=>`00${parseInt(component,10).toString(16)}`.slice(-2)).join("")}`}}const ColorClass=new ClassAttributor$1("color","ql-color",{scope:Scope.INLINE}),ColorStyle=new ColorAttributor("color","color",{scope:Scope.INLINE}),BackgroundClass=new ClassAttributor$1("background","ql-bg",{scope:Scope.INLINE}),BackgroundStyle=new ColorAttributor("background","background-color",{scope:Scope.INLINE});class CodeBlockContainer extends container{static create(value){const domNode=super.create(value);return domNode.setAttribute("spellcheck","false"),domNode}code(index,length){return this.children.map(child=>child.length()<=1?"":child.domNode.innerText).join("\n").slice(index,index+length)}html(index,length){return`<pre>\n${escapeText(this.code(index,length))}\n</pre>`}}class CodeBlock extends Block{static TAB="  ";static register(){Quill.register(CodeBlockContainer)}}class Code extends inline{}Code.blotName="code",Code.tagName="CODE",CodeBlock.blotName="code-block",CodeBlock.className="ql-code-block",CodeBlock.tagName="DIV",CodeBlockContainer.blotName="code-block-container",CodeBlockContainer.className="ql-code-block-container",CodeBlockContainer.tagName="DIV",CodeBlockContainer.allowedChildren=[CodeBlock],CodeBlock.allowedChildren=[text_Text,blots_break,cursor],CodeBlock.requiredContainer=CodeBlockContainer;const direction_config={scope:Scope.BLOCK,whitelist:["rtl"]},DirectionAttribute=new Attributor("direction","dir",direction_config),DirectionClass=new ClassAttributor$1("direction","ql-direction",direction_config),DirectionStyle=new StyleAttributor$1("direction","direction",direction_config),font_config={scope:Scope.INLINE,whitelist:["serif","monospace"]},FontClass=new ClassAttributor$1("font","ql-font",font_config);const FontStyle=new class FontStyleAttributor extends StyleAttributor$1{value(node){return super.value(node).replace(/["']/g,"")}}("font","font-family",font_config),SizeClass=new ClassAttributor$1("size","ql-size",{scope:Scope.INLINE,whitelist:["small","large","huge"]}),SizeStyle=new StyleAttributor$1("size","font-size",{scope:Scope.INLINE,whitelist:["10px","18px","32px"]}),keyboard_debug=logger("quill:keyboard"),SHORTKEY=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class Keyboard extends core_module{static match(evt,binding){return!["altKey","ctrlKey","metaKey","shiftKey"].some(key=>!!binding[key]!==evt[key]&&null!==binding[key])&&(binding.key===evt.key||binding.key===evt.which)}constructor(quill,options){super(quill,options),this.bindings={},Object.keys(this.options.bindings).forEach(name=>{this.options.bindings[name]&&this.addBinding(this.options.bindings[name])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(keyBinding){let context=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},handler=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const binding=function normalize(binding){if("string"==typeof binding||"number"==typeof binding)binding={key:binding};else{if("object"!=typeof binding)return null;binding=lodash_es_cloneDeep(binding)}binding.shortKey&&(binding[SHORTKEY]=binding.shortKey,delete binding.shortKey);return binding}(keyBinding);if(null==binding)return void keyboard_debug.warn("Attempted to add invalid keyboard binding",binding);"function"==typeof context&&(context={handler:context}),"function"==typeof handler&&(handler={handler});(Array.isArray(binding.key)?binding.key:[binding.key]).forEach(key=>{const singleBinding={...binding,key,...context,...handler};this.bindings[singleBinding.key]=this.bindings[singleBinding.key]||[],this.bindings[singleBinding.key].push(singleBinding)})}listen(){this.quill.root.addEventListener("keydown",evt=>{if(evt.defaultPrevented||evt.isComposing)return;if(229===evt.keyCode&&("Enter"===evt.key||"Backspace"===evt.key))return;const matches=(this.bindings[evt.key]||[]).concat(this.bindings[evt.which]||[]).filter(binding=>Keyboard.match(evt,binding));if(0===matches.length)return;const blot=Quill.find(evt.target,!0);if(blot&&blot.scroll!==this.quill.scroll)return;const range=this.quill.getSelection();if(null==range||!this.quill.hasFocus())return;const[line,offset]=this.quill.getLine(range.index),[leafStart,offsetStart]=this.quill.getLeaf(range.index),[leafEnd,offsetEnd]=0===range.length?[leafStart,offsetStart]:this.quill.getLeaf(range.index+range.length),prefixText=leafStart instanceof TextBlot$1?leafStart.value().slice(0,offsetStart):"",suffixText=leafEnd instanceof TextBlot$1?leafEnd.value().slice(offsetEnd):"",curContext={collapsed:0===range.length,empty:0===range.length&&line.length()<=1,format:this.quill.getFormat(range),line,offset,prefix:prefixText,suffix:suffixText,event:evt};matches.some(binding=>{if(null!=binding.collapsed&&binding.collapsed!==curContext.collapsed)return!1;if(null!=binding.empty&&binding.empty!==curContext.empty)return!1;if(null!=binding.offset&&binding.offset!==curContext.offset)return!1;if(Array.isArray(binding.format)){if(binding.format.every(name=>null==curContext.format[name]))return!1}else if("object"==typeof binding.format&&!Object.keys(binding.format).every(name=>!0===binding.format[name]?null!=curContext.format[name]:!1===binding.format[name]?null==curContext.format[name]:lodash_es_isEqual(binding.format[name],curContext.format[name])))return!1;return!(null!=binding.prefix&&!binding.prefix.test(curContext.prefix))&&(!(null!=binding.suffix&&!binding.suffix.test(curContext.suffix))&&!0!==binding.handler.call(this,range,curContext,binding))})&&evt.preventDefault()})}handleBackspace(range,context){const length=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(context.prefix)?2:1;if(0===range.index||this.quill.getLength()<=1)return;let formats={};const[line]=this.quill.getLine(range.index);let delta=(new(Delta_default())).retain(range.index-length).delete(length);if(0===context.offset){const[prev]=this.quill.getLine(range.index-1);if(prev){if(!("block"===prev.statics.blotName&&prev.length()<=1)){const curFormats=line.formats(),prevFormats=this.quill.getFormat(range.index-1,1);if(formats=Delta.AttributeMap.diff(curFormats,prevFormats)||{},Object.keys(formats).length>0){const formatDelta=(new(Delta_default())).retain(range.index+line.length()-2).retain(1,formats);delta=delta.compose(formatDelta)}}}}this.quill.updateContents(delta,Quill.sources.USER),this.quill.focus()}handleDelete(range,context){const length=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(context.suffix)?2:1;if(range.index>=this.quill.getLength()-length)return;let formats={};const[line]=this.quill.getLine(range.index);let delta=(new(Delta_default())).retain(range.index).delete(length);if(context.offset>=line.length()-1){const[next]=this.quill.getLine(range.index+1);if(next){const curFormats=line.formats(),nextFormats=this.quill.getFormat(range.index,1);formats=Delta.AttributeMap.diff(curFormats,nextFormats)||{},Object.keys(formats).length>0&&(delta=delta.retain(next.length()-1).retain(1,formats))}}this.quill.updateContents(delta,Quill.sources.USER),this.quill.focus()}handleDeleteRange(range){deleteRange({range,quill:this.quill}),this.quill.focus()}handleEnter(range,context){const lineFormats=Object.keys(context.format).reduce((formats,format)=>(this.quill.scroll.query(format,Scope.BLOCK)&&!Array.isArray(context.format[format])&&(formats[format]=context.format[format]),formats),{}),delta=(new(Delta_default())).retain(range.index).delete(range.length).insert("\n",lineFormats);this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(range.index+1,Quill.sources.SILENT),this.quill.focus()}}const defaultOptions={bindings:{bold:makeFormatHandler("bold"),italic:makeFormatHandler("italic"),underline:makeFormatHandler("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(range,context){return!(!context.collapsed||0===context.offset)||(this.quill.format("indent","+1",Quill.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(range,context){return!(!context.collapsed||0===context.offset)||(this.quill.format("indent","-1",Quill.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(range,context){null!=context.format.indent?this.quill.format("indent","-1",Quill.sources.USER):null!=context.format.list&&this.quill.format("list",!1,Quill.sources.USER)}},"indent code-block":makeCodeBlockHandler(!0),"outdent code-block":makeCodeBlockHandler(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(range){this.quill.deleteText(range.index-1,1,Quill.sources.USER)}},tab:{key:"Tab",handler(range,context){if(context.format.table)return!0;this.quill.history.cutoff();const delta=(new(Delta_default())).retain(range.index).delete(range.length).insert("\t");return this.quill.updateContents(delta,Quill.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(range.index+1,Quill.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,Quill.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(range,context){const formats={list:!1};context.format.indent&&(formats.indent=!1),this.quill.formatLine(range.index,range.length,formats,Quill.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(range){const[line,offset]=this.quill.getLine(range.index),formats={...line.formats(),list:"checked"},delta=(new(Delta_default())).retain(range.index).insert("\n",formats).retain(line.length()-offset-1).retain(1,{list:"unchecked"});this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(range.index+1,Quill.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(range,context){const[line,offset]=this.quill.getLine(range.index),delta=(new(Delta_default())).retain(range.index).insert("\n",context.format).retain(line.length()-offset-1).retain(1,{header:null});this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(range.index+1,Quill.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(range){const module=this.quill.getModule("table");if(module){const[table,row,cell,offset]=module.getTable(range),shift=function tableSide(_table,row,cell,offset){if(null==row.prev&&null==row.next)return null==cell.prev&&null==cell.next?0===offset?-1:1:null==cell.prev?-1:1;if(null==row.prev)return-1;if(null==row.next)return 1;return null}(0,row,cell,offset);if(null==shift)return;let index=table.offset();if(shift<0){const delta=(new(Delta_default())).retain(index).insert("\n");this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(range.index+1,range.length,Quill.sources.SILENT)}else if(shift>0){index+=table.length();const delta=(new(Delta_default())).retain(index).insert("\n");this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(index,Quill.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(range,context){const{event,line:cell}=context,offset=cell.offset(this.quill.scroll);event.shiftKey?this.quill.setSelection(offset-1,Quill.sources.USER):this.quill.setSelection(offset+cell.length(),Quill.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(range,context){if(null==this.quill.scroll.query("list"))return!0;const{length}=context.prefix,[line,offset]=this.quill.getLine(range.index);if(offset>length)return!0;let value;switch(context.prefix.trim()){case"[]":case"[ ]":value="unchecked";break;case"[x]":value="checked";break;case"-":case"*":value="bullet";break;default:value="ordered"}this.quill.insertText(range.index," ",Quill.sources.USER),this.quill.history.cutoff();const delta=(new(Delta_default())).retain(range.index-offset).delete(length+1).retain(line.length()-2-offset).retain(1,{list:value});return this.quill.updateContents(delta,Quill.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(range.index-length,Quill.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(range){const[line,offset]=this.quill.getLine(range.index);let numLines=2,cur=line;for(;null!=cur&&cur.length()<=1&&cur.formats()["code-block"];)if(cur=cur.prev,numLines-=1,numLines<=0){const delta=(new(Delta_default())).retain(range.index+line.length()-offset-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(range.index-1,Quill.sources.SILENT),!1}return!0}},"embed left":makeEmbedArrowHandler("ArrowLeft",!1),"embed left shift":makeEmbedArrowHandler("ArrowLeft",!0),"embed right":makeEmbedArrowHandler("ArrowRight",!1),"embed right shift":makeEmbedArrowHandler("ArrowRight",!0),"table down":makeTableArrowHandler(!1),"table up":makeTableArrowHandler(!0)}};function makeCodeBlockHandler(indent){return{key:"Tab",shiftKey:!indent,format:{"code-block":!0},handler(range,_ref){let{event}=_ref;const CodeBlock=this.quill.scroll.query("code-block"),{TAB}=CodeBlock;if(0===range.length&&!event.shiftKey)return this.quill.insertText(range.index,TAB,Quill.sources.USER),void this.quill.setSelection(range.index+TAB.length,Quill.sources.SILENT);const lines=0===range.length?this.quill.getLines(range.index,1):this.quill.getLines(range);let{index,length}=range;lines.forEach((line,i)=>{indent?(line.insertAt(0,TAB),0===i?index+=TAB.length:length+=TAB.length):line.domNode.textContent.startsWith(TAB)&&(line.deleteAt(0,TAB.length),0===i?index-=TAB.length:length-=TAB.length)}),this.quill.update(Quill.sources.USER),this.quill.setSelection(index,length,Quill.sources.SILENT)}}}function makeEmbedArrowHandler(key,shiftKey){const where="ArrowLeft"===key?"prefix":"suffix";return{key,shiftKey,altKey:null,[where]:/^$/,handler(range){let{index}=range;"ArrowRight"===key&&(index+=range.length+1);const[leaf]=this.quill.getLeaf(index);return!(leaf instanceof EmbedBlot$1)||("ArrowLeft"===key?shiftKey?this.quill.setSelection(range.index-1,range.length+1,Quill.sources.USER):this.quill.setSelection(range.index-1,Quill.sources.USER):shiftKey?this.quill.setSelection(range.index,range.length+1,Quill.sources.USER):this.quill.setSelection(range.index+range.length+1,Quill.sources.USER),!1)}}}function makeFormatHandler(format){return{key:format[0],shortKey:!0,handler(range,context){this.quill.format(format,!context.format[format],Quill.sources.USER)}}}function makeTableArrowHandler(up){return{key:up?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(range,context){const key=up?"prev":"next",cell=context.line,targetRow=cell.parent[key];if(null!=targetRow){if("table-row"===targetRow.statics.blotName){let targetCell=targetRow.children.head,cur=cell;for(;null!=cur.prev;)cur=cur.prev,targetCell=targetCell.next;const index=targetCell.offset(this.quill.scroll)+Math.min(context.offset,targetCell.length()-1);this.quill.setSelection(index,0,Quill.sources.USER)}}else{const targetLine=cell.table()[key];null!=targetLine&&(up?this.quill.setSelection(targetLine.offset(this.quill.scroll)+targetLine.length()-1,0,Quill.sources.USER):this.quill.setSelection(targetLine.offset(this.quill.scroll),0,Quill.sources.USER))}return!1}}}function deleteRange(_ref2){let{quill,range}=_ref2;const lines=quill.getLines(range);let formats={};if(lines.length>1){const firstFormats=lines[0].formats(),lastFormats=lines[lines.length-1].formats();formats=Delta.AttributeMap.diff(lastFormats,firstFormats)||{}}quill.deleteText(range,Quill.sources.USER),Object.keys(formats).length>0&&quill.formatLine(range.index,1,formats,Quill.sources.USER),quill.setSelection(range.index,Quill.sources.SILENT)}Keyboard.DEFAULTS=defaultOptions;const normalWeightRegexp=/font-weight:\s*normal/,blockTagNames=["P","OL","UL"],isBlockElement=element=>element&&blockTagNames.includes(element.tagName);const ignoreRegexp=/\bmso-list:[^;]*ignore/i,idRegexp=/\bmso-list:[^;]*\bl(\d+)/i,indentRegexp=/\bmso-list:[^;]*\blevel(\d+)/i,normalizeListItem=doc=>{const msoList=Array.from(doc.querySelectorAll("[style*=mso-list]")),ignored=[],others=[];msoList.forEach(node=>{(node.getAttribute("style")||"").match(ignoreRegexp)?ignored.push(node):others.push(node)}),ignored.forEach(node=>node.parentNode?.removeChild(node));const html=doc.documentElement.innerHTML,listItems=others.map(element=>((element,html)=>{const style=element.getAttribute("style"),idMatch=style?.match(idRegexp);if(!idMatch)return null;const id=Number(idMatch[1]),indentMatch=style?.match(indentRegexp),indent=indentMatch?Number(indentMatch[1]):1,typeRegexp=new RegExp(`@list l${id}:level${indent}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),typeMatch=html.match(typeRegexp);return{id,indent,type:typeMatch&&"bullet"===typeMatch[1]?"bullet":"ordered",element}})(element,html)).filter(parsed=>parsed);for(;listItems.length;){const childListItems=[];let current=listItems.shift();for(;current;)childListItems.push(current),current=listItems.length&&listItems[0]?.element===current.element.nextElementSibling&&listItems[0].id===current.id?listItems.shift():null;const ul=document.createElement("ul");childListItems.forEach(listItem=>{const li=document.createElement("li");li.setAttribute("data-list",listItem.type),listItem.indent>1&&li.setAttribute("class","ql-indent-"+(listItem.indent-1)),li.innerHTML=listItem.element.innerHTML,ul.appendChild(li)});const element=childListItems[0]?.element,{parentNode}=element??{};element&&parentNode?.replaceChild(ul,element),childListItems.slice(1).forEach(_ref=>{let{element:e}=_ref;parentNode?.removeChild(e)})}};const NORMALIZERS=[function msWord_normalize(doc){"urn:schemas-microsoft-com:office:word"===doc.documentElement.getAttribute("xmlns:w")&&normalizeListItem(doc)},function googleDocs_normalize(doc){doc.querySelector('[id^="docs-internal-guid-"]')&&((doc=>{Array.from(doc.querySelectorAll('b[style*="font-weight"]')).filter(node=>node.getAttribute("style")?.match(normalWeightRegexp)).forEach(node=>{const fragment=doc.createDocumentFragment();fragment.append(...node.childNodes),node.parentNode?.replaceChild(fragment,node)})})(doc),(doc=>{Array.from(doc.querySelectorAll("br")).filter(br=>isBlockElement(br.previousElementSibling)&&isBlockElement(br.nextElementSibling)).forEach(br=>{br.parentNode?.removeChild(br)})})(doc))}],modules_normalizeExternalHTML=doc=>{doc.documentElement&&NORMALIZERS.forEach(normalize=>{normalize(doc)})},clipboard_debug=logger("quill:clipboard"),CLIPBOARD_CONFIG=[[Node.TEXT_NODE,function matchText(node,delta,scroll){let text=node.data;if("O:P"===node.parentElement?.tagName)return delta.insert(text.trim());if(!isPre(node)){if(0===text.trim().length&&text.includes("\n")&&!function isBetweenInlineElements(node,scroll){return node.previousElementSibling&&node.nextElementSibling&&!clipboard_isLine(node.previousElementSibling,scroll)&&!clipboard_isLine(node.nextElementSibling,scroll)}(node,scroll))return delta;text=text.replace(/[^\S\u00a0]/g," "),text=text.replace(/ {2,}/g," "),(null==node.previousSibling&&null!=node.parentElement&&clipboard_isLine(node.parentElement,scroll)||node.previousSibling instanceof Element&&clipboard_isLine(node.previousSibling,scroll))&&(text=text.replace(/^ /,"")),(null==node.nextSibling&&null!=node.parentElement&&clipboard_isLine(node.parentElement,scroll)||node.nextSibling instanceof Element&&clipboard_isLine(node.nextSibling,scroll))&&(text=text.replace(/ $/,"")),text=text.replaceAll(" "," ")}return delta.insert(text)}],[Node.TEXT_NODE,matchNewline],["br",function matchBreak(node,delta){deltaEndsWith(delta,"\n")||delta.insert("\n");return delta}],[Node.ELEMENT_NODE,matchNewline],[Node.ELEMENT_NODE,function matchBlot(node,delta,scroll){const match=scroll.query(node);if(null==match)return delta;if(match.prototype instanceof EmbedBlot$1){const embed={},value=match.value(node);if(null!=value)return embed[match.blotName]=value,(new(Delta_default())).insert(embed,match.formats(node,scroll))}else if(match.prototype instanceof BlockBlot$1&&!deltaEndsWith(delta,"\n")&&delta.insert("\n"),"blotName"in match&&"formats"in match&&"function"==typeof match.formats)return applyFormat(delta,match.blotName,match.formats(node,scroll),scroll);return delta}],[Node.ELEMENT_NODE,function matchAttributor(node,delta,scroll){const attributes=Attributor.keys(node),classes=ClassAttributor$1.keys(node),styles=StyleAttributor$1.keys(node),formats={};return attributes.concat(classes).concat(styles).forEach(name=>{let attr=scroll.query(name,Scope.ATTRIBUTE);null!=attr&&(formats[attr.attrName]=attr.value(node),formats[attr.attrName])||(attr=ATTRIBUTE_ATTRIBUTORS[name],null==attr||attr.attrName!==name&&attr.keyName!==name||(formats[attr.attrName]=attr.value(node)||void 0),attr=STYLE_ATTRIBUTORS[name],null==attr||attr.attrName!==name&&attr.keyName!==name||(attr=STYLE_ATTRIBUTORS[name],formats[attr.attrName]=attr.value(node)||void 0))}),Object.entries(formats).reduce((newDelta,_ref4)=>{let[name,value]=_ref4;return applyFormat(newDelta,name,value,scroll)},delta)}],[Node.ELEMENT_NODE,function matchStyles(node,delta,scroll){const formats={},style=node.style||{};"italic"===style.fontStyle&&(formats.italic=!0);"underline"===style.textDecoration&&(formats.underline=!0);"line-through"===style.textDecoration&&(formats.strike=!0);(style.fontWeight?.startsWith("bold")||parseInt(style.fontWeight,10)>=700)&&(formats.bold=!0);if(delta=Object.entries(formats).reduce((newDelta,_ref5)=>{let[name,value]=_ref5;return applyFormat(newDelta,name,value,scroll)},delta),parseFloat(style.textIndent||0)>0)return(new(Delta_default())).insert("\t").concat(delta);return delta}],["li",function matchIndent(node,delta,scroll){const match=scroll.query(node);if(null==match||"list"!==match.blotName||!deltaEndsWith(delta,"\n"))return delta;let indent=-1,parent=node.parentNode;for(;null!=parent;)["OL","UL"].includes(parent.tagName)&&(indent+=1),parent=parent.parentNode;return indent<=0?delta:delta.reduce((composed,op)=>op.insert?op.attributes&&"number"==typeof op.attributes.indent?composed.push(op):composed.insert(op.insert,{indent,...op.attributes||{}}):composed,new(Delta_default()))}],["ol, ul",function matchList(node,delta,scroll){const element=node;let list="OL"===element.tagName?"ordered":"bullet";const checkedAttr=element.getAttribute("data-checked");checkedAttr&&(list="true"===checkedAttr?"checked":"unchecked");return applyFormat(delta,"list",list,scroll)}],["pre",function matchCodeBlock(node,delta,scroll){const match=scroll.query("code-block"),language=!match||!("formats"in match)||"function"!=typeof match.formats||match.formats(node,scroll);return applyFormat(delta,"code-block",language,scroll)}],["tr",function matchTable(node,delta,scroll){const table="TABLE"===node.parentElement?.tagName?node.parentElement:node.parentElement?.parentElement;if(null!=table){return applyFormat(delta,"table",Array.from(table.querySelectorAll("tr")).indexOf(node)+1,scroll)}return delta}],["b",createMatchAlias("bold")],["i",createMatchAlias("italic")],["strike",createMatchAlias("strike")],["style",function matchIgnore(){return new(Delta_default())}]],ATTRIBUTE_ATTRIBUTORS=[AlignAttribute,DirectionAttribute].reduce((memo,attr)=>(memo[attr.keyName]=attr,memo),{}),STYLE_ATTRIBUTORS=[AlignStyle,BackgroundStyle,ColorStyle,DirectionStyle,FontStyle,SizeStyle].reduce((memo,attr)=>(memo[attr.keyName]=attr,memo),{});function applyFormat(delta,format,value,scroll){return scroll.query(format)?delta.reduce((newDelta,op)=>{if(!op.insert)return newDelta;if(op.attributes&&op.attributes[format])return newDelta.push(op);const formats=value?{[format]:value}:{};return newDelta.insert(op.insert,{...formats,...op.attributes})},new(Delta_default())):delta}function deltaEndsWith(delta,text){let endText="";for(let i=delta.ops.length-1;i>=0&&endText.length<text.length;--i){const op=delta.ops[i];if("string"!=typeof op.insert)break;endText=op.insert+endText}return endText.slice(-1*text.length)===text}function clipboard_isLine(node,scroll){if(!(node instanceof Element))return!1;const match=scroll.query(node);return!(match&&match.prototype instanceof EmbedBlot$1)&&["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(node.tagName.toLowerCase())}const preNodes=new WeakMap;function isPre(node){return null!=node&&(preNodes.has(node)||("PRE"===node.tagName?preNodes.set(node,!0):preNodes.set(node,isPre(node.parentNode))),preNodes.get(node))}function traverse(scroll,node,elementMatchers,textMatchers,nodeMatches){return node.nodeType===node.TEXT_NODE?textMatchers.reduce((delta,matcher)=>matcher(node,delta,scroll),new(Delta_default())):node.nodeType===node.ELEMENT_NODE?Array.from(node.childNodes||[]).reduce((delta,childNode)=>{let childrenDelta=traverse(scroll,childNode,elementMatchers,textMatchers,nodeMatches);return childNode.nodeType===node.ELEMENT_NODE&&(childrenDelta=elementMatchers.reduce((reducedDelta,matcher)=>matcher(childNode,reducedDelta,scroll),childrenDelta),childrenDelta=(nodeMatches.get(childNode)||[]).reduce((reducedDelta,matcher)=>matcher(childNode,reducedDelta,scroll),childrenDelta)),delta.concat(childrenDelta)},new(Delta_default())):new(Delta_default())}function createMatchAlias(format){return(_node,delta,scroll)=>applyFormat(delta,format,!0,scroll)}function matchNewline(node,delta,scroll){if(!deltaEndsWith(delta,"\n")){if(clipboard_isLine(node,scroll)&&(node.childNodes.length>0||node instanceof HTMLParagraphElement))return delta.insert("\n");if(delta.length()>0&&node.nextSibling){let nextSibling=node.nextSibling;for(;null!=nextSibling;){if(clipboard_isLine(nextSibling,scroll))return delta.insert("\n");const match=scroll.query(nextSibling);if(match&&match.prototype instanceof BlockEmbed)return delta.insert("\n");nextSibling=nextSibling.firstChild}}}return delta}function transformStack(stack,delta){let remoteDelta=delta;for(let i=stack.length-1;i>=0;i-=1){const oldItem=stack[i];stack[i]={delta:remoteDelta.transform(oldItem.delta,!0),range:oldItem.range&&transformRange(oldItem.range,remoteDelta)},remoteDelta=oldItem.delta.transform(remoteDelta),0===stack[i].delta.length()&&stack.splice(i,1)}}function transformRange(range,delta){if(!range)return range;const start=delta.transformPosition(range.index);return{index:start,length:delta.transformPosition(range.index+range.length)-start}}class Uploader extends core_module{constructor(quill,options){super(quill,options),quill.root.addEventListener("drop",e=>{e.preventDefault();let native=null;if(document.caretRangeFromPoint)native=document.caretRangeFromPoint(e.clientX,e.clientY);else if(document.caretPositionFromPoint){const position=document.caretPositionFromPoint(e.clientX,e.clientY);native=document.createRange(),native.setStart(position.offsetNode,position.offset),native.setEnd(position.offsetNode,position.offset)}const normalized=native&&quill.selection.normalizeNative(native);if(normalized){const range=quill.selection.normalizedToRange(normalized);e.dataTransfer?.files&&this.upload(range,e.dataTransfer.files)}})}upload(range,files){const uploads=[];Array.from(files).forEach(file=>{file&&this.options.mimetypes?.includes(file.type)&&uploads.push(file)}),uploads.length>0&&this.options.handler.call(this,range,uploads)}}Uploader.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(range,files){if(!this.quill.scroll.query("image"))return;const promises=files.map(file=>new Promise(resolve=>{const reader=new FileReader;reader.onload=()=>{resolve(reader.result)},reader.readAsDataURL(file)}));Promise.all(promises).then(images=>{const update=images.reduce((delta,image)=>delta.insert({image}),(new(Delta_default())).retain(range.index).delete(range.length));this.quill.updateContents(update,core_emitter.sources.USER),this.quill.setSelection(range.index+images.length,core_emitter.sources.SILENT)})}};const uploader=Uploader,INSERT_TYPES=["insertText","insertReplacementText"];const input=class Input extends core_module{constructor(quill,options){super(quill,options),quill.root.addEventListener("beforeinput",event=>{this.handleBeforeInput(event)}),/Android/i.test(navigator.userAgent)||quill.on(Quill.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(range){deleteRange({range,quill:this.quill})}replaceText(range){let text=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(0===range.length)return!1;if(text){const formats=this.quill.getFormat(range.index,1);this.deleteRange(range),this.quill.updateContents((new(Delta_default())).retain(range.index).insert(text,formats),Quill.sources.USER)}else this.deleteRange(range);return this.quill.setSelection(range.index+text.length,0,Quill.sources.SILENT),!0}handleBeforeInput(event){if(this.quill.composition.isComposing||event.defaultPrevented||!INSERT_TYPES.includes(event.inputType))return;const staticRange=event.getTargetRanges?event.getTargetRanges()[0]:null;if(!staticRange||!0===staticRange.collapsed)return;const text=function getPlainTextFromInputEvent(event){if("string"==typeof event.data)return event.data;if(event.dataTransfer?.types.includes("text/plain"))return event.dataTransfer.getData("text/plain");return null}(event);if(null==text)return;const normalized=this.quill.selection.normalizeNative(staticRange),range=normalized?this.quill.selection.normalizedToRange(normalized):null;range&&this.replaceText(range,text)&&event.preventDefault()}handleCompositionStart(){const range=this.quill.getSelection();range&&this.replaceText(range)}},isMac=/Mac/i.test(navigator.platform);const uiNode=class UINode extends core_module{isListening=!1;selectionChangeDeadline=0;constructor(quill,options){super(quill,options),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(range,_ref){let{line,event}=_ref;if(!(line instanceof ParentBlot$1&&line.uiNode))return!0;const isRTL="rtl"===getComputedStyle(line.domNode).direction;return!!(isRTL&&"ArrowRight"!==event.key||!isRTL&&"ArrowLeft"!==event.key)||(this.quill.setSelection(range.index-1,range.length+(event.shiftKey?1:0),Quill.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",event=>{!event.defaultPrevented&&(event=>"ArrowLeft"===event.key||"ArrowRight"===event.key||"ArrowUp"===event.key||"ArrowDown"===event.key||"Home"===event.key||!(!isMac||"a"!==event.key||!0!==event.ctrlKey))(event)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+100,this.isListening)return;this.isListening=!0;document.addEventListener("selectionchange",()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()},{once:!0})}handleSelectionChange(){const selection=document.getSelection();if(!selection)return;const range=selection.getRangeAt(0);if(!0!==range.collapsed||0!==range.startOffset)return;const line=this.quill.scroll.find(range.startContainer);if(!(line instanceof ParentBlot$1&&line.uiNode))return;const newRange=document.createRange();newRange.setStartAfter(line.uiNode),newRange.setEndAfter(line.uiNode),selection.removeAllRanges(),selection.addRange(newRange)}};Quill.register({"blots/block":Block,"blots/block/embed":BlockEmbed,"blots/break":blots_break,"blots/container":container,"blots/cursor":cursor,"blots/embed":blots_embed,"blots/inline":inline,"blots/scroll":blots_scroll,"blots/text":text_Text,"modules/clipboard":class Clipboard extends core_module{static DEFAULTS={matchers:[]};constructor(quill,options){super(quill,options),this.quill.root.addEventListener("copy",e=>this.onCaptureCopy(e,!1)),this.quill.root.addEventListener("cut",e=>this.onCaptureCopy(e,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],CLIPBOARD_CONFIG.concat(this.options.matchers??[]).forEach(_ref=>{let[selector,matcher]=_ref;this.addMatcher(selector,matcher)})}addMatcher(selector,matcher){this.matchers.push([selector,matcher])}convert(_ref2){let{html,text}=_ref2,formats=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(formats[CodeBlock.blotName])return(new(Delta_default())).insert(text||"",{[CodeBlock.blotName]:formats[CodeBlock.blotName]});if(!html)return(new(Delta_default())).insert(text||"",formats);const delta=this.convertHTML(html);return deltaEndsWith(delta,"\n")&&(null==delta.ops[delta.ops.length-1].attributes||formats.table)?delta.compose((new(Delta_default())).retain(delta.length()-1).delete(1)):delta}normalizeHTML(doc){modules_normalizeExternalHTML(doc)}convertHTML(html){const doc=(new DOMParser).parseFromString(html,"text/html");this.normalizeHTML(doc);const container=doc.body,nodeMatches=new WeakMap,[elementMatchers,textMatchers]=this.prepareMatching(container,nodeMatches);return traverse(this.quill.scroll,container,elementMatchers,textMatchers,nodeMatches)}dangerouslyPasteHTML(index,html){let source=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Quill.sources.API;if("string"==typeof index){const delta=this.convert({html:index,text:""});this.quill.setContents(delta,html),this.quill.setSelection(0,Quill.sources.SILENT)}else{const paste=this.convert({html,text:""});this.quill.updateContents((new(Delta_default())).retain(index).concat(paste),source),this.quill.setSelection(index+paste.length(),Quill.sources.SILENT)}}onCaptureCopy(e){let isCut=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.defaultPrevented)return;e.preventDefault();const[range]=this.quill.selection.getRange();if(null==range)return;const{html,text}=this.onCopy(range,isCut);e.clipboardData?.setData("text/plain",text),e.clipboardData?.setData("text/html",html),isCut&&deleteRange({range,quill:this.quill})}normalizeURIList(urlList){return urlList.split(/\r?\n/).filter(url=>"#"!==url[0]).join("\n")}onCapturePaste(e){if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const range=this.quill.getSelection(!0);if(null==range)return;const html=e.clipboardData?.getData("text/html");let text=e.clipboardData?.getData("text/plain");if(!html&&!text){const urlList=e.clipboardData?.getData("text/uri-list");urlList&&(text=this.normalizeURIList(urlList))}const files=Array.from(e.clipboardData?.files||[]);if(!html&&files.length>0)this.quill.uploader.upload(range,files);else{if(html&&files.length>0){const doc=(new DOMParser).parseFromString(html,"text/html");if(1===doc.body.childElementCount&&"IMG"===doc.body.firstElementChild?.tagName)return void this.quill.uploader.upload(range,files)}this.onPaste(range,{html,text})}}onCopy(range){const text=this.quill.getText(range);return{html:this.quill.getSemanticHTML(range),text}}onPaste(range,_ref3){let{text,html}=_ref3;const formats=this.quill.getFormat(range.index),pastedDelta=this.convert({text,html},formats);clipboard_debug.log("onPaste",pastedDelta,{text,html});const delta=(new(Delta_default())).retain(range.index).delete(range.length).concat(pastedDelta);this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(delta.length()-range.length,Quill.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(container,nodeMatches){const elementMatchers=[],textMatchers=[];return this.matchers.forEach(pair=>{const[selector,matcher]=pair;switch(selector){case Node.TEXT_NODE:textMatchers.push(matcher);break;case Node.ELEMENT_NODE:elementMatchers.push(matcher);break;default:Array.from(container.querySelectorAll(selector)).forEach(node=>{if(nodeMatches.has(node)){const matches=nodeMatches.get(node);matches?.push(matcher)}else nodeMatches.set(node,[matcher])})}}),[elementMatchers,textMatchers]}},"modules/history":class History extends core_module{static DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};lastRecorded=0;ignoreChange=!1;stack={undo:[],redo:[]};currentRange=null;constructor(quill,options){super(quill,options),this.quill.on(Quill.events.EDITOR_CHANGE,(eventName,value,oldValue,source)=>{eventName===Quill.events.SELECTION_CHANGE?value&&source!==Quill.sources.SILENT&&(this.currentRange=value):eventName===Quill.events.TEXT_CHANGE&&(this.ignoreChange||(this.options.userOnly&&source!==Quill.sources.USER?this.transform(value):this.record(value,oldValue)),this.currentRange=transformRange(this.currentRange,value))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",event=>{"historyUndo"===event.inputType?(this.undo(),event.preventDefault()):"historyRedo"===event.inputType&&(this.redo(),event.preventDefault())})}change(source,dest){if(0===this.stack[source].length)return;const item=this.stack[source].pop();if(!item)return;const base=this.quill.getContents(),inverseDelta=item.delta.invert(base);this.stack[dest].push({delta:inverseDelta,range:transformRange(item.range,inverseDelta)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(item.delta,Quill.sources.USER),this.ignoreChange=!1,this.restoreSelection(item)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(changeDelta,oldDelta){if(0===changeDelta.ops.length)return;this.stack.redo=[];let undoDelta=changeDelta.invert(oldDelta),undoRange=this.currentRange;const timestamp=Date.now();if(this.lastRecorded+this.options.delay>timestamp&&this.stack.undo.length>0){const item=this.stack.undo.pop();item&&(undoDelta=undoDelta.compose(item.delta),undoRange=item.range)}else this.lastRecorded=timestamp;0!==undoDelta.length()&&(this.stack.undo.push({delta:undoDelta,range:undoRange}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(delta){transformStack(this.stack.undo,delta),transformStack(this.stack.redo,delta)}undo(){this.change("undo","redo")}restoreSelection(stackItem){if(stackItem.range)this.quill.setSelection(stackItem.range,Quill.sources.USER);else{const index=function getLastChangeIndex(scroll,delta){const deleteLength=delta.reduce((length,op)=>length+(op.delete||0),0);let changeIndex=delta.length()-deleteLength;(function endsWithNewlineChange(scroll,delta){const lastOp=delta.ops[delta.ops.length-1];if(null==lastOp)return!1;if(null!=lastOp.insert)return"string"==typeof lastOp.insert&&lastOp.insert.endsWith("\n");if(null!=lastOp.attributes)return Object.keys(lastOp.attributes).some(attr=>null!=scroll.query(attr,Scope.BLOCK));return!1})(scroll,delta)&&(changeIndex-=1);return changeIndex}(this.quill.scroll,stackItem.delta);this.quill.setSelection(index,Quill.sources.USER)}}},"modules/keyboard":Keyboard,"modules/uploader":uploader,"modules/input":input,"modules/uiNode":uiNode});const core=Quill;const IndentClass=new class IndentAttributor extends ClassAttributor$1{add(node,value){let normalizedValue=0;if("+1"===value||"-1"===value){const indent=this.value(node)||0;normalizedValue="+1"===value?indent+1:indent-1}else"number"==typeof value&&(normalizedValue=value);return 0===normalizedValue?(this.remove(node),!0):super.add(node,normalizedValue.toString())}canAdd(node,value){return super.canAdd(node,value)||super.canAdd(node,parseInt(value,10))}value(node){return parseInt(super.value(node),10)||void 0}}("indent","ql-indent",{scope:Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]}),indent=IndentClass;const blockquote=class Blockquote extends Block{static blotName="blockquote";static tagName="blockquote"};const header=class Header extends Block{static blotName="header";static tagName=["H1","H2","H3","H4","H5","H6"];static formats(domNode){return this.tagName.indexOf(domNode.tagName)+1}};class ListContainer extends container{}ListContainer.blotName="list-container",ListContainer.tagName="OL";class ListItem extends Block{static create(value){const node=super.create();return node.setAttribute("data-list",value),node}static formats(domNode){return domNode.getAttribute("data-list")||void 0}static register(){Quill.register(ListContainer)}constructor(scroll,domNode){super(scroll,domNode);const ui=domNode.ownerDocument.createElement("span"),listEventHandler=e=>{if(!scroll.isEnabled())return;const format=this.statics.formats(domNode,scroll);"checked"===format?(this.format("list","unchecked"),e.preventDefault()):"unchecked"===format&&(this.format("list","checked"),e.preventDefault())};ui.addEventListener("mousedown",listEventHandler),ui.addEventListener("touchstart",listEventHandler),this.attachUI(ui)}format(name,value){name===this.statics.blotName&&value?this.domNode.setAttribute("data-list",value):super.format(name,value)}}ListItem.blotName="list",ListItem.tagName="LI",ListContainer.allowedChildren=[ListItem],ListItem.requiredContainer=ListContainer;const bold=class Bold extends inline{static blotName="bold";static tagName=["STRONG","B"];static create(){return super.create()}static formats(){return!0}optimize(context){super.optimize(context),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}};const italic=class Italic extends bold{static blotName="italic";static tagName=["EM","I"]};class Link extends inline{static blotName="link";static tagName="A";static SANITIZED_URL="about:blank";static PROTOCOL_WHITELIST=["http","https","mailto","tel","sms"];static create(value){const node=super.create(value);return node.setAttribute("href",this.sanitize(value)),node.setAttribute("rel","noopener noreferrer"),node.setAttribute("target","_blank"),node}static formats(domNode){return domNode.getAttribute("href")}static sanitize(url){return sanitize(url,this.PROTOCOL_WHITELIST)?url:this.SANITIZED_URL}format(name,value){name===this.statics.blotName&&value?this.domNode.setAttribute("href",this.constructor.sanitize(value)):super.format(name,value)}}function sanitize(url,protocols){const anchor=document.createElement("a");anchor.href=url;const protocol=anchor.href.slice(0,anchor.href.indexOf(":"));return protocols.indexOf(protocol)>-1}const script=class Script extends inline{static blotName="script";static tagName=["SUB","SUP"];static create(value){return"super"===value?document.createElement("sup"):"sub"===value?document.createElement("sub"):super.create(value)}static formats(domNode){return"SUB"===domNode.tagName?"sub":"SUP"===domNode.tagName?"super":void 0}};const strike=class Strike extends bold{static blotName="strike";static tagName=["S","STRIKE"]};const underline=class Underline extends inline{static blotName="underline";static tagName="U"};const formula=class Formula extends blots_embed{static blotName="formula";static className="ql-formula";static tagName="SPAN";static create(value){if(null==window.katex)throw new Error("Formula module requires KaTeX.");const node=super.create(value);return"string"==typeof value&&(window.katex.render(value,node,{throwOnError:!1,errorColor:"#f00"}),node.setAttribute("data-value",value)),node}static value(domNode){return domNode.getAttribute("data-value")}html(){const{formula}=this.value();return`<span>${formula}</span>`}},ATTRIBUTES=["alt","height","width"];const formats_image=class Image extends EmbedBlot$1{static blotName="image";static tagName="IMG";static create(value){const node=super.create(value);return"string"==typeof value&&node.setAttribute("src",this.sanitize(value)),node}static formats(domNode){return ATTRIBUTES.reduce((formats,attribute)=>(domNode.hasAttribute(attribute)&&(formats[attribute]=domNode.getAttribute(attribute)),formats),{})}static match(url){return/\.(jpe?g|gif|png)$/.test(url)||/^data:image\/.+;base64/.test(url)}static sanitize(url){return sanitize(url,["http","https","data"])?url:"//:0"}static value(domNode){return domNode.getAttribute("src")}format(name,value){ATTRIBUTES.indexOf(name)>-1?value?this.domNode.setAttribute(name,value):this.domNode.removeAttribute(name):super.format(name,value)}},video_ATTRIBUTES=["height","width"];const video=class Video extends BlockEmbed{static blotName="video";static className="ql-video";static tagName="IFRAME";static create(value){const node=super.create(value);return node.setAttribute("frameborder","0"),node.setAttribute("allowfullscreen","true"),node.setAttribute("src",this.sanitize(value)),node}static formats(domNode){return video_ATTRIBUTES.reduce((formats,attribute)=>(domNode.hasAttribute(attribute)&&(formats[attribute]=domNode.getAttribute(attribute)),formats),{})}static sanitize(url){return Link.sanitize(url)}static value(domNode){return domNode.getAttribute("src")}format(name,value){video_ATTRIBUTES.indexOf(name)>-1?value?this.domNode.setAttribute(name,value):this.domNode.removeAttribute(name):super.format(name,value)}html(){const{video}=this.value();return`<a href="${video}">${video}</a>`}},TokenAttributor=new ClassAttributor$1("code-token","hljs",{scope:Scope.INLINE});class CodeToken extends inline{static formats(node,scroll){for(;null!=node&&node!==scroll.domNode;){if(node.classList&&node.classList.contains(CodeBlock.className))return super.formats(node,scroll);node=node.parentNode}}constructor(scroll,domNode,value){super(scroll,domNode,value),TokenAttributor.add(this.domNode,value)}format(format,value){format!==CodeToken.blotName?super.format(format,value):value?TokenAttributor.add(this.domNode,value):(TokenAttributor.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),TokenAttributor.value(this.domNode)||this.unwrap()}}CodeToken.blotName="code-token",CodeToken.className="ql-token";class SyntaxCodeBlock extends CodeBlock{static create(value){const domNode=super.create(value);return"string"==typeof value&&domNode.setAttribute("data-language",value),domNode}static formats(domNode){return domNode.getAttribute("data-language")||"plain"}static register(){}format(name,value){name===this.statics.blotName&&value?this.domNode.setAttribute("data-language",value):super.format(name,value)}replaceWith(name,value){return this.formatAt(0,this.length(),CodeToken.blotName,!1),super.replaceWith(name,value)}}class SyntaxCodeBlockContainer extends CodeBlockContainer{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(name,value){name===SyntaxCodeBlock.blotName&&(this.forceNext=!0,this.children.forEach(child=>{child.format(name,value)}))}formatAt(index,length,name,value){name===SyntaxCodeBlock.blotName&&(this.forceNext=!0),super.formatAt(index,length,name,value)}highlight(highlight){let forced=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null==this.children.head)return;const text=`${Array.from(this.domNode.childNodes).filter(node=>node!==this.uiNode).map(node=>node.textContent).join("\n")}\n`,language=SyntaxCodeBlock.formats(this.children.head.domNode);if(forced||this.forceNext||this.cachedText!==text){if(text.trim().length>0||null==this.cachedText){const oldDelta=this.children.reduce((delta,child)=>delta.concat(blockDelta(child,!1)),new(Delta_default())),delta=highlight(text,language);oldDelta.diff(delta).reduce((index,_ref)=>{let{retain,attributes}=_ref;return retain?(attributes&&Object.keys(attributes).forEach(format=>{[SyntaxCodeBlock.blotName,CodeToken.blotName].includes(format)&&this.formatAt(index,retain,format,attributes[format])}),index+retain):index},0)}this.cachedText=text,this.forceNext=!1}}html(index,length){const[codeBlock]=this.children.find(index);return`<pre data-language="${codeBlock?SyntaxCodeBlock.formats(codeBlock.domNode):"plain"}">\n${escapeText(this.code(index,length))}\n</pre>`}optimize(context){if(super.optimize(context),null!=this.parent&&null!=this.children.head&&null!=this.uiNode){const language=SyntaxCodeBlock.formats(this.children.head.domNode);language!==this.uiNode.value&&(this.uiNode.value=language)}}}SyntaxCodeBlockContainer.allowedChildren=[SyntaxCodeBlock],SyntaxCodeBlock.requiredContainer=SyntaxCodeBlockContainer,SyntaxCodeBlock.allowedChildren=[CodeToken,cursor,text_Text,blots_break];class Syntax extends core_module{static register(){Quill.register(CodeToken,!0),Quill.register(SyntaxCodeBlock,!0),Quill.register(SyntaxCodeBlockContainer,!0)}constructor(quill,options){if(super(quill,options),null==this.options.hljs)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((memo,_ref2)=>{let{key}=_ref2;return memo[key]=!0,memo},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(Quill.events.SCROLL_BLOT_MOUNT,blot=>{if(!(blot instanceof SyntaxCodeBlockContainer))return;const select=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(_ref3=>{let{key,label}=_ref3;const option=select.ownerDocument.createElement("option");option.textContent=label,option.setAttribute("value",key),select.appendChild(option)}),select.addEventListener("change",()=>{blot.format(SyntaxCodeBlock.blotName,select.value),this.quill.root.focus(),this.highlight(blot,!0)}),null==blot.uiNode&&(blot.attachUI(select),blot.children.head&&(select.value=SyntaxCodeBlock.formats(blot.children.head.domNode)))})}initTimer(){let timer=null;this.quill.on(Quill.events.SCROLL_OPTIMIZE,()=>{timer&&clearTimeout(timer),timer=setTimeout(()=>{this.highlight(),timer=null},this.options.interval)})}highlight(){let blot=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,force=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.quill.selection.composing)return;this.quill.update(Quill.sources.USER);const range=this.quill.getSelection();(null==blot?this.quill.scroll.descendants(SyntaxCodeBlockContainer):[blot]).forEach(container=>{container.highlight(this.highlightBlot,force)}),this.quill.update(Quill.sources.SILENT),null!=range&&this.quill.setSelection(range,Quill.sources.SILENT)}highlightBlot(text){let language=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"plain";if(language=this.languages[language]?language:"plain","plain"===language)return escapeText(text).split("\n").reduce((delta,line,i)=>(0!==i&&delta.insert("\n",{[CodeBlock.blotName]:language}),delta.insert(line)),new(Delta_default()));const container=this.quill.root.ownerDocument.createElement("div");return container.classList.add(CodeBlock.className),container.innerHTML=((lib,language,text)=>{if("string"==typeof lib.versionString){const majorVersion=lib.versionString.split(".")[0];if(parseInt(majorVersion,10)>=11)return lib.highlight(text,{language}).value}return lib.highlight(language,text).value})(this.options.hljs,language,text),traverse(this.quill.scroll,container,[(node,delta)=>{const value=TokenAttributor.value(node);return value?delta.compose((new(Delta_default())).retain(delta.length(),{[CodeToken.blotName]:value})):delta}],[(node,delta)=>node.data.split("\n").reduce((memo,nodeText,i)=>(0!==i&&memo.insert("\n",{[CodeBlock.blotName]:language}),memo.insert(nodeText)),delta)],new WeakMap)}}Syntax.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};class TableCell extends Block{static blotName="table";static tagName="TD";static create(value){const node=super.create();return value?node.setAttribute("data-row",value):node.setAttribute("data-row",tableId()),node}static formats(domNode){if(domNode.hasAttribute("data-row"))return domNode.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(name,value){name===TableCell.blotName&&value?this.domNode.setAttribute("data-row",value):super.format(name,value)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}class TableRow extends container{static blotName="table-row";static tagName="TR";checkMerge(){if(super.checkMerge()&&null!=this.next.children.head){const thisHead=this.children.head.formats(),thisTail=this.children.tail.formats(),nextHead=this.next.children.head.formats(),nextTail=this.next.children.tail.formats();return thisHead.table===thisTail.table&&thisHead.table===nextHead.table&&thisHead.table===nextTail.table}return!1}optimize(context){super.optimize(context),this.children.forEach(child=>{if(null==child.next)return;const childFormats=child.formats(),nextFormats=child.next.formats();if(childFormats.table!==nextFormats.table){const next=this.splitAfter(child);next&&next.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}class TableBody extends container{static blotName="table-body";static tagName="TBODY"}class TableContainer extends container{static blotName="table-container";static tagName="TABLE";balanceCells(){const rows=this.descendants(TableRow),maxColumns=rows.reduce((max,row)=>Math.max(row.children.length,max),0);rows.forEach(row=>{new Array(maxColumns-row.children.length).fill(0).forEach(()=>{let value;null!=row.children.head&&(value=TableCell.formats(row.children.head.domNode));const blot=this.scroll.create(TableCell.blotName,value);row.appendChild(blot),blot.optimize()})})}cells(column){return this.rows().map(row=>row.children.at(column))}deleteColumn(index){const[body]=this.descendant(TableBody);null!=body&&null!=body.children.head&&body.children.forEach(row=>{const cell=row.children.at(index);null!=cell&&cell.remove()})}insertColumn(index){const[body]=this.descendant(TableBody);null!=body&&null!=body.children.head&&body.children.forEach(row=>{const ref=row.children.at(index),value=TableCell.formats(row.children.head.domNode),cell=this.scroll.create(TableCell.blotName,value);row.insertBefore(cell,ref)})}insertRow(index){const[body]=this.descendant(TableBody);if(null==body||null==body.children.head)return;const id=tableId(),row=this.scroll.create(TableRow.blotName);body.children.head.children.forEach(()=>{const cell=this.scroll.create(TableCell.blotName,id);row.appendChild(cell)});const ref=body.children.at(index);body.insertBefore(row,ref)}rows(){const body=this.children.head;return null==body?[]:body.children.map(row=>row)}}function tableId(){return`row-${Math.random().toString(36).slice(2,6)}`}TableContainer.allowedChildren=[TableBody],TableBody.requiredContainer=TableContainer,TableBody.allowedChildren=[TableRow],TableRow.requiredContainer=TableBody,TableRow.allowedChildren=[TableCell],TableCell.requiredContainer=TableRow;const table=class Table extends core_module{static register(){Quill.register(TableCell),Quill.register(TableRow),Quill.register(TableBody),Quill.register(TableContainer)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(TableContainer).forEach(table=>{table.balanceCells()})}deleteColumn(){const[table,,cell]=this.getTable();null!=cell&&(table.deleteColumn(cell.cellOffset()),this.quill.update(Quill.sources.USER))}deleteRow(){const[,row]=this.getTable();null!=row&&(row.remove(),this.quill.update(Quill.sources.USER))}deleteTable(){const[table]=this.getTable();if(null==table)return;const offset=table.offset();table.remove(),this.quill.update(Quill.sources.USER),this.quill.setSelection(offset,Quill.sources.SILENT)}getTable(){let range=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.quill.getSelection();if(null==range)return[null,null,null,-1];const[cell,offset]=this.quill.getLine(range.index);if(null==cell||cell.statics.blotName!==TableCell.blotName)return[null,null,null,-1];const row=cell.parent;return[row.parent.parent,row,cell,offset]}insertColumn(offset){const range=this.quill.getSelection();if(!range)return;const[table,row,cell]=this.getTable(range);if(null==cell)return;const column=cell.cellOffset();table.insertColumn(column+offset),this.quill.update(Quill.sources.USER);let shift=row.rowOffset();0===offset&&(shift+=1),this.quill.setSelection(range.index+shift,range.length,Quill.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(offset){const range=this.quill.getSelection();if(!range)return;const[table,row,cell]=this.getTable(range);if(null==cell)return;const index=row.rowOffset();table.insertRow(index+offset),this.quill.update(Quill.sources.USER),offset>0?this.quill.setSelection(range,Quill.sources.SILENT):this.quill.setSelection(range.index+row.children.length,range.length,Quill.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(rows,columns){const range=this.quill.getSelection();if(null==range)return;const delta=new Array(rows).fill(0).reduce(memo=>{const text=new Array(columns).fill("\n").join("");return memo.insert(text,{table:tableId()})},(new(Delta_default())).retain(range.index));this.quill.updateContents(delta,Quill.sources.USER),this.quill.setSelection(range.index,Quill.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(Quill.events.SCROLL_OPTIMIZE,mutations=>{mutations.some(mutation=>!!["TD","TR","TBODY","TABLE"].includes(mutation.target.tagName)&&(this.quill.once(Quill.events.TEXT_CHANGE,(delta,old,source)=>{source===Quill.sources.USER&&this.balanceTables()}),!0))})}},toolbar_debug=logger("quill:toolbar");class Toolbar extends core_module{constructor(quill,options){if(super(quill,options),Array.isArray(this.options.container)){const container=document.createElement("div");container.setAttribute("role","toolbar"),function addControls(container,groups){Array.isArray(groups[0])||(groups=[groups]);groups.forEach(controls=>{const group=document.createElement("span");group.classList.add("ql-formats"),controls.forEach(control=>{if("string"==typeof control)addButton(group,control);else{const format=Object.keys(control)[0],value=control[format];Array.isArray(value)?function addSelect(container,format,values){const input=document.createElement("select");input.classList.add(`ql-${format}`),values.forEach(value=>{const option=document.createElement("option");!1!==value?option.setAttribute("value",String(value)):option.setAttribute("selected","selected"),input.appendChild(option)}),container.appendChild(input)}(group,format,value):addButton(group,format,value)}}),container.appendChild(group)})}(container,this.options.container),quill.container?.parentNode?.insertBefore(container,quill.container),this.container=container}else"string"==typeof this.options.container?this.container=document.querySelector(this.options.container):this.container=this.options.container;this.container instanceof HTMLElement?(this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(format=>{const handler=this.options.handlers?.[format];handler&&this.addHandler(format,handler)}),Array.from(this.container.querySelectorAll("button, select")).forEach(input=>{this.attach(input)}),this.quill.on(Quill.events.EDITOR_CHANGE,()=>{const[range]=this.quill.selection.getRange();this.update(range)})):toolbar_debug.error("Container required for toolbar",this.options)}addHandler(format,handler){this.handlers[format]=handler}attach(input){let format=Array.from(input.classList).find(className=>0===className.indexOf("ql-"));if(!format)return;if(format=format.slice(3),"BUTTON"===input.tagName&&input.setAttribute("type","button"),null==this.handlers[format]&&null==this.quill.scroll.query(format))return void toolbar_debug.warn("ignoring attaching to nonexistent format",format,input);const eventName="SELECT"===input.tagName?"change":"click";input.addEventListener(eventName,e=>{let value;if("SELECT"===input.tagName){if(input.selectedIndex<0)return;const selected=input.options[input.selectedIndex];value=!selected.hasAttribute("selected")&&(selected.value||!1)}else value=!input.classList.contains("ql-active")&&(input.value||!input.hasAttribute("value")),e.preventDefault();this.quill.focus();const[range]=this.quill.selection.getRange();if(null!=this.handlers[format])this.handlers[format].call(this,value);else if(this.quill.scroll.query(format).prototype instanceof EmbedBlot$1){if(value=prompt(`Enter ${format}`),!value)return;this.quill.updateContents((new(Delta_default())).retain(range.index).delete(range.length).insert({[format]:value}),Quill.sources.USER)}else this.quill.format(format,value,Quill.sources.USER);this.update(range)}),this.controls.push([format,input])}update(range){const formats=null==range?{}:this.quill.getFormat(range);this.controls.forEach(pair=>{const[format,input]=pair;if("SELECT"===input.tagName){let option=null;if(null==range)option=null;else if(null==formats[format])option=input.querySelector("option[selected]");else if(!Array.isArray(formats[format])){let value=formats[format];"string"==typeof value&&(value=value.replace(/"/g,'\\"')),option=input.querySelector(`option[value="${value}"]`)}null==option?(input.value="",input.selectedIndex=-1):option.selected=!0}else if(null==range)input.classList.remove("ql-active"),input.setAttribute("aria-pressed","false");else if(input.hasAttribute("value")){const value=formats[format],isActive=value===input.getAttribute("value")||null!=value&&value.toString()===input.getAttribute("value")||null==value&&!input.getAttribute("value");input.classList.toggle("ql-active",isActive),input.setAttribute("aria-pressed",isActive.toString())}else{const isActive=null!=formats[format];input.classList.toggle("ql-active",isActive),input.setAttribute("aria-pressed",isActive.toString())}})}}function addButton(container,format,value){const input=document.createElement("button");input.setAttribute("type","button"),input.classList.add(`ql-${format}`),input.setAttribute("aria-pressed","false"),null!=value?(input.value=value,input.setAttribute("aria-label",`${format}: ${value}`)):input.setAttribute("aria-label",format),container.appendChild(input)}Toolbar.DEFAULTS={},Toolbar.DEFAULTS={container:null,handlers:{clean(){const range=this.quill.getSelection();if(null!=range)if(0===range.length){const formats=this.quill.getFormat();Object.keys(formats).forEach(name=>{null!=this.quill.scroll.query(name,Scope.INLINE)&&this.quill.format(name,!1,Quill.sources.USER)})}else this.quill.removeFormat(range.index,range.length,Quill.sources.USER)},direction(value){const{align}=this.quill.getFormat();"rtl"===value&&null==align?this.quill.format("align","right",Quill.sources.USER):value||"right"!==align||this.quill.format("align",!1,Quill.sources.USER),this.quill.format("direction",value,Quill.sources.USER)},indent(value){const range=this.quill.getSelection(),formats=this.quill.getFormat(range),indent=parseInt(formats.indent||0,10);if("+1"===value||"-1"===value){let modifier="+1"===value?1:-1;"rtl"===formats.direction&&(modifier*=-1),this.quill.format("indent",indent+modifier,Quill.sources.USER)}},link(value){!0===value&&(value=prompt("Enter link URL:")),this.quill.format("link",value,Quill.sources.USER)},list(value){const range=this.quill.getSelection(),formats=this.quill.getFormat(range);"check"===value?"checked"===formats.list||"unchecked"===formats.list?this.quill.format("list",!1,Quill.sources.USER):this.quill.format("list","unchecked",Quill.sources.USER):this.quill.format("list",value,Quill.sources.USER)}}};const codeIcon='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',icons={align:{"":'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',center:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',right:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',justify:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>'},background:'<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',blockquote:'<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',bold:'<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',clean:'<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',code:codeIcon,"code-block":codeIcon,color:'<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',direction:{"":'<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',rtl:'<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>'},formula:'<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',header:{1:'<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',2:'<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',3:'<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',4:'<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',5:'<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',6:'<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>'},italic:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',image:'<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',indent:{"+1":'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',"-1":'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>'},link:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',list:{bullet:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',check:'<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',ordered:'<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>'},script:{sub:'<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',super:'<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>'},strike:'<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',table:'<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',underline:'<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',video:'<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>'};let optionsCounter=0;function toggleAriaAttribute(element,attribute){element.setAttribute(attribute,`${!("true"===element.getAttribute(attribute))}`)}const picker=class Picker{constructor(select){this.select=select,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",event=>{switch(event.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),event.preventDefault()}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),toggleAriaAttribute(this.label,"aria-expanded"),toggleAriaAttribute(this.options,"aria-hidden")}buildItem(option){const item=document.createElement("span");item.tabIndex="0",item.setAttribute("role","button"),item.classList.add("ql-picker-item");const value=option.getAttribute("value");return value&&item.setAttribute("data-value",value),option.textContent&&item.setAttribute("data-label",option.textContent),item.addEventListener("click",()=>{this.selectItem(item,!0)}),item.addEventListener("keydown",event=>{switch(event.key){case"Enter":this.selectItem(item,!0),event.preventDefault();break;case"Escape":this.escape(),event.preventDefault()}}),item}buildLabel(){const label=document.createElement("span");return label.classList.add("ql-picker-label"),label.innerHTML='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>',label.tabIndex="0",label.setAttribute("role","button"),label.setAttribute("aria-expanded","false"),this.container.appendChild(label),label}buildOptions(){const options=document.createElement("span");options.classList.add("ql-picker-options"),options.setAttribute("aria-hidden","true"),options.tabIndex="-1",options.id=`ql-picker-options-${optionsCounter}`,optionsCounter+=1,this.label.setAttribute("aria-controls",options.id),this.options=options,Array.from(this.select.options).forEach(option=>{const item=this.buildItem(option);options.appendChild(item),!0===option.selected&&this.selectItem(item)}),this.container.appendChild(options)}buildPicker(){Array.from(this.select.attributes).forEach(item=>{this.container.setAttribute(item.name,item.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(item){let trigger=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const selected=this.container.querySelector(".ql-selected");item!==selected&&(null!=selected&&selected.classList.remove("ql-selected"),null!=item&&(item.classList.add("ql-selected"),this.select.selectedIndex=Array.from(item.parentNode.children).indexOf(item),item.hasAttribute("data-value")?this.label.setAttribute("data-value",item.getAttribute("data-value")):this.label.removeAttribute("data-value"),item.hasAttribute("data-label")?this.label.setAttribute("data-label",item.getAttribute("data-label")):this.label.removeAttribute("data-label"),trigger&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let option;if(this.select.selectedIndex>-1){const item=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];option=this.select.options[this.select.selectedIndex],this.selectItem(item)}else this.selectItem(null);const isActive=null!=option&&option!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",isActive)}};const color_picker=class ColorPicker extends picker{constructor(select,label){super(select),this.label.innerHTML=label,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(item=>{item.classList.add("ql-primary")})}buildItem(option){const item=super.buildItem(option);return item.style.backgroundColor=option.getAttribute("value")||"",item}selectItem(item,trigger){super.selectItem(item,trigger);const colorLabel=this.label.querySelector(".ql-color-label"),value=item&&item.getAttribute("data-value")||"";colorLabel&&("line"===colorLabel.tagName?colorLabel.style.stroke=value:colorLabel.style.fill=value)}};const icon_picker=class IconPicker extends picker{constructor(select,icons){super(select),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(item=>{item.innerHTML=icons[item.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(target,trigger){super.selectItem(target,trigger);const item=target||this.defaultItem;if(null!=item){if(this.label.innerHTML===item.innerHTML)return;this.label.innerHTML=item.innerHTML}}};const tooltip=class Tooltip{constructor(quill,boundsContainer){this.quill=quill,this.boundsContainer=boundsContainer||document.body,this.root=quill.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,(el=>{const{overflowY}=getComputedStyle(el,null);return"visible"!==overflowY&&"clip"!==overflowY})(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=-1*this.quill.root.scrollTop+"px"}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(reference){const left=reference.left+reference.width/2-this.root.offsetWidth/2,top=reference.bottom+this.quill.root.scrollTop;this.root.style.left=`${left}px`,this.root.style.top=`${top}px`,this.root.classList.remove("ql-flip");const containerBounds=this.boundsContainer.getBoundingClientRect(),rootBounds=this.root.getBoundingClientRect();let shift=0;if(rootBounds.right>containerBounds.right&&(shift=containerBounds.right-rootBounds.right,this.root.style.left=`${left+shift}px`),rootBounds.left<containerBounds.left&&(shift=containerBounds.left-rootBounds.left,this.root.style.left=`${left+shift}px`),rootBounds.bottom>containerBounds.bottom){const height=rootBounds.bottom-rootBounds.top,verticalShift=reference.bottom-reference.top+height;this.root.style.top=top-verticalShift+"px",this.root.classList.add("ql-flip")}return shift}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}},ALIGNS=[!1,"center","right","justify"],COLORS=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],FONTS=[!1,"serif","monospace"],HEADERS=["1","2","3",!1],SIZES=["small",!1,"large","huge"];class BaseTheme extends core_theme{constructor(quill,options){super(quill,options);const listener=e=>{document.body.contains(quill.root)?(null==this.tooltip||this.tooltip.root.contains(e.target)||document.activeElement===this.tooltip.textbox||this.quill.hasFocus()||this.tooltip.hide(),null!=this.pickers&&this.pickers.forEach(picker=>{picker.container.contains(e.target)||picker.close()})):document.body.removeEventListener("click",listener)};quill.emitter.listenDOM("click",document.body,listener)}addModule(name){const module=super.addModule(name);return"toolbar"===name&&this.extendToolbar(module),module}buildButtons(buttons,icons){Array.from(buttons).forEach(button=>{(button.getAttribute("class")||"").split(/\s+/).forEach(name=>{if(name.startsWith("ql-")&&(name=name.slice(3),null!=icons[name]))if("direction"===name)button.innerHTML=icons[name][""]+icons[name].rtl;else if("string"==typeof icons[name])button.innerHTML=icons[name];else{const value=button.value||"";null!=value&&icons[name][value]&&(button.innerHTML=icons[name][value])}})})}buildPickers(selects,icons){this.pickers=Array.from(selects).map(select=>{if(select.classList.contains("ql-align")&&(null==select.querySelector("option")&&fillSelect(select,ALIGNS),"object"==typeof icons.align))return new icon_picker(select,icons.align);if(select.classList.contains("ql-background")||select.classList.contains("ql-color")){const format=select.classList.contains("ql-background")?"background":"color";return null==select.querySelector("option")&&fillSelect(select,COLORS,"background"===format?"#ffffff":"#000000"),new color_picker(select,icons[format])}return null==select.querySelector("option")&&(select.classList.contains("ql-font")?fillSelect(select,FONTS):select.classList.contains("ql-header")?fillSelect(select,HEADERS):select.classList.contains("ql-size")&&fillSelect(select,SIZES)),new picker(select)});this.quill.on(core_emitter.events.EDITOR_CHANGE,()=>{this.pickers.forEach(picker=>{picker.update()})})}}BaseTheme.DEFAULTS=lodash_es_merge({},core_theme.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let fileInput=this.container.querySelector("input.ql-image[type=file]");null==fileInput&&(fileInput=document.createElement("input"),fileInput.setAttribute("type","file"),fileInput.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),fileInput.classList.add("ql-image"),fileInput.addEventListener("change",()=>{const range=this.quill.getSelection(!0);this.quill.uploader.upload(range,fileInput.files),fileInput.value=""}),this.container.appendChild(fileInput)),fileInput.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class BaseTooltip extends tooltip{constructor(quill,boundsContainer){super(quill,boundsContainer),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",event=>{"Enter"===event.key?(this.save(),event.preventDefault()):"Escape"===event.key&&(this.cancel(),event.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let mode=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"link",preview=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),null==this.textbox)return;null!=preview?this.textbox.value=preview:mode!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const bounds=this.quill.getBounds(this.quill.selection.savedRange);null!=bounds&&this.position(bounds),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${mode}`)||""),this.root.setAttribute("data-mode",mode)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",value,core_emitter.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",value,core_emitter.sources.USER)),this.quill.root.scrollTop=scrollTop;break}case"video":value=function extractVideoUrl(url){let match=url.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||url.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);if(match)return`${match[1]||"https"}://www.youtube.com/embed/${match[2]}?showinfo=0`;if(match=url.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))return`${match[1]||"https"}://player.vimeo.com/video/${match[2]}/`;return url}(value);case"formula":{if(!value)break;const range=this.quill.getSelection(!0);if(null!=range){const index=range.index+range.length;this.quill.insertEmbed(index,this.root.getAttribute("data-mode"),value,core_emitter.sources.USER),"formula"===this.root.getAttribute("data-mode")&&this.quill.insertText(index+1," ",core_emitter.sources.USER),this.quill.setSelection(index+2,core_emitter.sources.USER)}break}}this.textbox.value="",this.hide()}}function fillSelect(select,values){let defaultValue=arguments.length>2&&void 0!==arguments[2]&&arguments[2];values.forEach(value=>{const option=document.createElement("option");value===defaultValue?option.setAttribute("selected","selected"):option.setAttribute("value",String(value)),select.appendChild(option)})}const TOOLBAR_CONFIG=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class BubbleTooltip extends BaseTooltip{static TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");constructor(quill,bounds){super(quill,bounds),this.quill.on(core_emitter.events.EDITOR_CHANGE,(type,range,oldRange,source)=>{if(type===core_emitter.events.SELECTION_CHANGE)if(null!=range&&range.length>0&&source===core_emitter.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const lines=this.quill.getLines(range.index,range.length);if(1===lines.length){const bounds=this.quill.getBounds(range);null!=bounds&&this.position(bounds)}else{const lastLine=lines[lines.length-1],index=this.quill.getIndex(lastLine),length=Math.min(lastLine.length()-1,range.index+range.length-index),indexBounds=this.quill.getBounds(new Range(index,length));null!=indexBounds&&this.position(indexBounds)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(core_emitter.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const range=this.quill.getSelection();if(null!=range){const bounds=this.quill.getBounds(range);null!=bounds&&this.position(bounds)}},1)})}cancel(){this.show()}position(reference){const shift=super.position(reference),arrow=this.root.querySelector(".ql-tooltip-arrow");return arrow.style.marginLeft="",0!==shift&&(arrow.style.marginLeft=-1*shift-arrow.offsetWidth/2+"px"),shift}}class BubbleTheme extends BaseTheme{constructor(quill,options){null!=options.modules.toolbar&&null==options.modules.toolbar.container&&(options.modules.toolbar.container=TOOLBAR_CONFIG),super(quill,options),this.quill.container.classList.add("ql-bubble")}extendToolbar(toolbar){this.tooltip=new BubbleTooltip(this.quill,this.options.bounds),null!=toolbar.container&&(this.tooltip.root.appendChild(toolbar.container),this.buildButtons(toolbar.container.querySelectorAll("button"),icons),this.buildPickers(toolbar.container.querySelectorAll("select"),icons))}}BubbleTheme.DEFAULTS=lodash_es_merge({},BaseTheme.DEFAULTS,{modules:{toolbar:{handlers:{link(value){value?this.quill.theme.tooltip.edit():this.quill.format("link",!1,Quill.sources.USER)}}}}});const snow_TOOLBAR_CONFIG=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class SnowTooltip extends BaseTooltip{static TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");preview=this.root.querySelector("a.ql-preview");listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",event=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),event.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",event=>{if(null!=this.linkRange){const range=this.linkRange;this.restoreFocus(),this.quill.formatText(range,"link",!1,core_emitter.sources.USER),delete this.linkRange}event.preventDefault(),this.hide()}),this.quill.on(core_emitter.events.SELECTION_CHANGE,(range,oldRange,source)=>{if(null!=range){if(0===range.length&&source===core_emitter.sources.USER){const[link,offset]=this.quill.scroll.descendant(Link,range.index);if(null!=link){this.linkRange=new Range(range.index-offset,link.length());const preview=Link.formats(link.domNode);this.preview.textContent=preview,this.preview.setAttribute("href",preview),this.show();const bounds=this.quill.getBounds(this.linkRange);return void(null!=bounds&&this.position(bounds))}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}class SnowTheme extends BaseTheme{constructor(quill,options){null!=options.modules.toolbar&&null==options.modules.toolbar.container&&(options.modules.toolbar.container=snow_TOOLBAR_CONFIG),super(quill,options),this.quill.container.classList.add("ql-snow")}extendToolbar(toolbar){null!=toolbar.container&&(toolbar.container.classList.add("ql-snow"),this.buildButtons(toolbar.container.querySelectorAll("button"),icons),this.buildPickers(toolbar.container.querySelectorAll("select"),icons),this.tooltip=new SnowTooltip(this.quill,this.options.bounds),toolbar.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(_range,context)=>{toolbar.handlers.link.call(toolbar,!context.format.link)}))}}SnowTheme.DEFAULTS=lodash_es_merge({},BaseTheme.DEFAULTS,{modules:{toolbar:{handlers:{link(value){if(value){const range=this.quill.getSelection();if(null==range||0===range.length)return;let preview=this.quill.getText(range);/^\S+@\S+\.\S+$/.test(preview)&&0!==preview.indexOf("mailto:")&&(preview=`mailto:${preview}`);const{tooltip}=this.quill.theme;tooltip.edit("link",preview)}else this.quill.format("link",!1,Quill.sources.USER)}}}}});const snow=SnowTheme;core.register({"attributors/attribute/direction":DirectionAttribute,"attributors/class/align":AlignClass,"attributors/class/background":BackgroundClass,"attributors/class/color":ColorClass,"attributors/class/direction":DirectionClass,"attributors/class/font":FontClass,"attributors/class/size":SizeClass,"attributors/style/align":AlignStyle,"attributors/style/background":BackgroundStyle,"attributors/style/color":ColorStyle,"attributors/style/direction":DirectionStyle,"attributors/style/font":FontStyle,"attributors/style/size":SizeStyle},!0),core.register({"formats/align":AlignClass,"formats/direction":DirectionClass,"formats/indent":indent,"formats/background":BackgroundStyle,"formats/color":ColorStyle,"formats/font":FontClass,"formats/size":SizeClass,"formats/blockquote":blockquote,"formats/code-block":CodeBlock,"formats/header":header,"formats/list":ListItem,"formats/bold":bold,"formats/code":Code,"formats/italic":italic,"formats/link":Link,"formats/script":script,"formats/strike":strike,"formats/underline":underline,"formats/formula":formula,"formats/image":formats_image,"formats/video":video,"modules/syntax":Syntax,"modules/table":table,"modules/toolbar":Toolbar,"themes/bubble":BubbleTheme,"themes/snow":snow,"ui/icons":icons,"ui/picker":picker,"ui/icon-picker":icon_picker,"ui/color-picker":color_picker,"ui/tooltip":tooltip},!0);const quill=core},"./node_modules/react/cjs/react-jsx-runtime.production.min.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";var f=__webpack_require__("./node_modules/react/index.js"),k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p={key:!0,ref:!0,__self:!0,__source:!0};function q(c,a,g){var b,d={},e=null,h=null;for(b in void 0!==g&&(e=""+g),void 0!==a.key&&(e=""+a.key),void 0!==a.ref&&(h=a.ref),a)m.call(a,b)&&!p.hasOwnProperty(b)&&(d[b]=a[b]);if(c&&c.defaultProps)for(b in a=c.defaultProps)void 0===d[b]&&(d[b]=a[b]);return{$$typeof:k,type:c,key:e,ref:h,props:d,_owner:n.current}}exports.jsx=q,exports.jsxs=q},"./node_modules/react/jsx-runtime.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=__webpack_require__("./node_modules/react/cjs/react-jsx-runtime.production.min.js")},"./node_modules/sonic-forest/lib/avl/AvlMap.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AvlMap=exports.AvlNode=void 0;const util_1=__webpack_require__("./node_modules/sonic-forest/lib/avl/util.js"),map_1=__webpack_require__("./node_modules/sonic-forest/lib/data-types/map.js");class AvlNode{constructor(k,v){this.k=k,this.v=v,this.p=void 0,this.l=void 0,this.r=void 0,this.bf=0}}exports.AvlNode=AvlNode,exports.AvlMap=(0,map_1.createMap)(AvlNode,util_1.insert,util_1.insertLeft,util_1.insertRight,util_1.remove,util_1.print)},"./node_modules/sonic-forest/lib/avl/util.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.print=exports.remove=exports.insert=exports.insertLeft=exports.insertRight=void 0;const printBinary_1=__webpack_require__("./node_modules/sonic-forest/lib/print/printBinary.js"),stringify=JSON.stringify,rebalanceAfterInsert=(root,node,child)=>{const p=node.p;if(!p)return root;const isLeft=node===p.l;let bf=0|p.bf;switch(p.bf=isLeft?++bf:--bf,bf){case 0:return root;case 1:case-1:return rebalanceAfterInsert(root,p,node);default:{const isChildLeft=child===node.l;return isLeft?isChildLeft?(llRotate(p,node),node.p?root:node):(lrRotate(p,node,child),child.p?root:child):isChildLeft?(rlRotate(p,node,child),child.p?root:child):(rrRotate(p,node),node.p?root:node)}}},llRotate=(n,nl)=>{const p=n.p,nlr=nl.r;nl.p=p,nl.r=n,n.p=nl,n.l=nlr,nlr&&(nlr.p=n),p&&(p.l===n?p.l=nl:p.r=nl);let nbf=n.bf,nlbf=nl.bf;nbf+=-1-(nlbf>0?nlbf:0),nlbf+=-1+(nbf<0?nbf:0),n.bf=nbf,nl.bf=nlbf},rrRotate=(n,nr)=>{const p=n.p,nrl=nr.l;nr.p=p,nr.l=n,n.p=nr,n.r=nrl,nrl&&(nrl.p=n),p&&(p.l===n?p.l=nr:p.r=nr);let nbf=n.bf,nrbf=nr.bf;nbf+=1-(nrbf<0?nrbf:0),nrbf+=1+(nbf>0?nbf:0),n.bf=nbf,nr.bf=nrbf},lrRotate=(n,nl,nlr)=>{rrRotate(nl,nlr),llRotate(n,nlr)},rlRotate=(n,nr,nrl)=>{llRotate(nr,nrl),rrRotate(n,nrl)};exports.insertRight=(root,n,p)=>(p.r=n,n.p=p,p.bf--,p.l?root:rebalanceAfterInsert(root,p,n));exports.insertLeft=(root,n,p)=>(p.l=n,n.p=p,p.bf++,p.r?root:rebalanceAfterInsert(root,p,n));exports.insert=(root,node,comparator)=>{if(!root)return node;const key=node.k;let next,curr=root,cmp=0;for(;next=(cmp=comparator(key,curr.k))<0?curr.l:curr.r;)curr=next;return cmp<0?(0,exports.insertLeft)(root,node,curr):(0,exports.insertRight)(root,node,curr)};exports.remove=(root,n)=>{if(!root)return n;const p=n.p,l=n.l,r=n.r;if(n.p=n.l=n.r=void 0,l&&r){if(l.r){let v=l,tmp=v;for(;tmp=v.r;)v=tmp;const vl=v.l,vp=v.p,vc=vl;return p&&(p.l===n?p.l=v:p.r=v),v.p=p,v.r=r,v.bf=n.bf,l!==v&&(v.l=l,l.p=v),r.p=v,vp&&(vp.l===v?vp.l=vc:vp.r=vc),vc&&(vc.p=vp),rRebalance(p?root:v,vp,1)}{p&&(p.l===n?p.l=l:p.r=l),l.p=p,l.r=r,r.p=l;const nbf=n.bf;if(p)return l.bf=nbf,lRebalance(root,l,1);const lbf=nbf-1;if(l.bf=lbf,lbf>=-1)return l;const rl=r.l;return r.bf>0?(rlRotate(l,r,rl),rl):(rrRotate(l,r),r)}}const c=l||r;return c&&(c.p=p),p?p.l===n?(p.l=c,lRebalance(root,p,1)):(p.r=c,rRebalance(root,p,1)):c};const lRebalance=(root,n,d)=>{let bf=0|n.bf;bf-=d,n.bf=bf;let nextD=d;if(-1===bf)return root;if(bf<-1){const u=n.r;if(u.bf<=0)u.l&&0===u.bf&&(nextD=0),rrRotate(n,u),n=u;else{const ul=u.l;rlRotate(n,u,ul),n=ul}}const p=n.p;return p?p.l===n?lRebalance(root,p,nextD):rRebalance(root,p,nextD):n},rRebalance=(root,n,d)=>{let bf=0|n.bf;bf+=d,n.bf=bf;let nextD=d;if(1===bf)return root;if(bf>1){const u=n.l;if(u.bf>=0)u.r&&0===u.bf&&(nextD=0),llRotate(n,u),n=u;else{const ur=u.r;lrRotate(n,u,ur),n=ur}}const p=n.p;return p?p.l===n?lRebalance(root,p,nextD):rRebalance(root,p,nextD):n};exports.print=(node,tab="")=>{if(!node)return"∅";const{bf,l,r,k,v}=node,vFormatted=v&&"object"==typeof v&&v.constructor===Object?stringify(v):v&&"object"==typeof v?v.toString(tab):stringify(v),content=void 0!==k?` { ${stringify(k)} = ${vFormatted} }`:"",bfFormatted=bf?` [${bf}]`:"";return node.constructor.name+`${bfFormatted}`+content+(0,printBinary_1.printBinary)(tab,[l?tab=>(0,exports.print)(l,tab):null,r?tab=>(0,exports.print)(r,tab):null])}},"./node_modules/sonic-forest/lib/data-types/map.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMap=void 0;const util_1=__webpack_require__("./node_modules/sonic-forest/lib/util/index.js"),printTree_1=__webpack_require__("./node_modules/sonic-forest/lib/print/printTree.js"),defaultComparator=(a,b)=>a===b?0:a<b?-1:1;exports.createMap=(Node,insert,insertLeft,insertRight,remove,print)=>class SonicMapImpl{constructor(comparator){this.min=void 0,this.root=void 0,this.max=void 0,this._size=0,this.next=util_1.next,this.comparator=comparator||defaultComparator}set(k,v){const root=this.root;if(void 0===root){this._size=1;const node=new Node(k,v);return this.root=this.min=this.max=insert(void 0,node,this.comparator)}const comparator=this.comparator;let cmp;const max=this.max;if(cmp=comparator(k,max.k),0===cmp)return max.v=v,max;if(cmp>0){const node=this.max=new Node(k,v);return this.root=insertRight(root,node,max),this._size++,node}const min=this.min;if(cmp=comparator(k,min.k),0===cmp)return min.v=v,min;if(cmp<0){const node=this.min=new Node(k,v);return this.root=insertLeft(root,node,min),this._size++,node}let curr=root;for(;;){if(cmp=comparator(k,curr.k),0===cmp)return curr.v=v,curr;if(cmp>0){const r=curr.r;if(void 0===r){const node=new Node(k,v);return this.root=insertRight(root,node,curr),this._size++,node}curr=r}else if(cmp<0){const l=curr.l;if(void 0===l){const node=new Node(k,v);return this.root=insertLeft(root,node,curr),this._size++,node}curr=l}}}find(k){const comparator=this.comparator;let curr=this.root;for(;curr;){const cmp=+comparator(k,curr.k);if(0===cmp)return curr;curr=cmp<0?curr.l:curr.r}}get(k){return this.find(k)?.v}del(k){const node=this.find(k);return!!node&&(node===this.max&&(this.max=(0,util_1.prev)(node)),node===this.min&&(this.min=(0,util_1.next)(node)),this.root=remove(this.root,node),this._size--,!0)}clear(){this._size=0,this.root=this.min=this.max=void 0}has(k){return!!this.find(k)}size(){return this._size}isEmpty(){return!this.min}getOrNextLower(k){return(0,util_1.findOrNextLower)(this.root,k,this.comparator)||void 0}forEach(fn){let curr=this.first();if(curr)do{fn(curr)}while(curr=(0,util_1.next)(curr))}first(){return this.min}last(){return this.max}iterator0(){let curr=this.first();return()=>{if(!curr)return;const value=curr;return curr=(0,util_1.next)(curr),value}}iterator(){const iterator=this.iterator0();return{next:()=>{const value=iterator();return{value,done:!value}}}}entries(){return{[Symbol.iterator]:()=>this.iterator()}}toString(tab){return this.constructor.name+(0,printTree_1.printTree)(tab,[tab=>print(this.root,tab)])}}},"./node_modules/sonic-forest/lib/print/printBinary.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/tree-dump/lib/printBinary.js"),exports)},"./node_modules/sonic-forest/lib/print/printTree.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});__webpack_require__("./node_modules/tslib/tslib.es6.mjs").__exportStar(__webpack_require__("./node_modules/tree-dump/lib/printTree.js"),exports)},"./node_modules/sonic-forest/lib/splay/util.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.rlSplay=exports.lrSplay=exports.llSplay=exports.rrSplay=exports.lSplay=exports.rSplay=exports.splay=void 0;exports.splay=(root,node,repeat)=>{const p=node.p;if(!p)return root;const pp=p.p,l2=p.l===node;if(!pp)return l2?(0,exports.rSplay)(node,p):(0,exports.lSplay)(node,p),node;return root=pp.l===p?l2?(0,exports.llSplay)(root,node,p,pp):(0,exports.lrSplay)(root,node,p,pp):l2?(0,exports.rlSplay)(root,node,p,pp):(0,exports.rrSplay)(root,node,p,pp),repeat>1?(0,exports.splay)(root,node,repeat-1):root};exports.rSplay=(c2,c1)=>{const b=c2.r;c2.p=void 0,c2.r=c1,c1.p=c2,c1.l=b,b&&(b.p=c1)};exports.lSplay=(c2,c1)=>{const b=c2.l;c2.p=void 0,c2.l=c1,c1.p=c2,c1.r=b,b&&(b.p=c1)};exports.rrSplay=(root,c3,c2,c1)=>{const b=c2.l,c=c3.l,p=c1.p;return c3.p=p,c3.l=c2,c2.p=c3,c2.l=c1,c2.r=c,c1.p=c2,c1.r=b,b&&(b.p=c1),c&&(c.p=c2),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root};exports.llSplay=(root,c3,c2,c1)=>{const b=c2.r,c=c3.r,p=c1.p;return c3.p=p,c3.r=c2,c2.p=c3,c2.l=c,c2.r=c1,c1.p=c2,c1.l=b,b&&(b.p=c1),c&&(c.p=c2),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root};exports.lrSplay=(root,c3,c2,c1)=>{const c=c3.l,d=c3.r,p=c1.p;return c3.p=p,c3.l=c2,c3.r=c1,c2.p=c3,c2.r=c,c1.p=c3,c1.l=d,c&&(c.p=c2),d&&(d.p=c1),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root};exports.rlSplay=(root,c3,c2,c1)=>{const c=c3.r,d=c3.l,p=c1.p;return c3.p=p,c3.l=c1,c3.r=c2,c2.p=c3,c2.l=c,c1.p=c3,c1.r=d,c&&(c.p=c2),d&&(d.p=c1),p?p.l===c1?p.l=c3:p.r=c3:root=c3,root}},"./node_modules/sonic-forest/lib/splay/util2.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.splay2=void 0;exports.splay2=(root,node)=>{const p=node.p2;if(!p)return root;const pp=p.p2,l2=p.l2===node;if(!pp)return l2?rSplay2(node,p):lSplay2(node,p),node;return root=pp.l2===p?l2?llSplay2(root,node,p,pp):lrSplay2(root,node,p,pp):l2?rlSplay2(root,node,p,pp):rrSplay2(root,node,p,pp),(0,exports.splay2)(root,node)};const rSplay2=(c2,c1)=>{const b=c2.r2;c2.p2=void 0,c2.r2=c1,c1.p2=c2,c1.l2=b,b&&(b.p2=c1)},lSplay2=(c2,c1)=>{const b=c2.l2;c2.p2=void 0,c2.l2=c1,c1.p2=c2,c1.r2=b,b&&(b.p2=c1)},rrSplay2=(root,c3,c2,c1)=>{const b=c2.l2,c=c3.l2,p=c1.p2;return c3.p2=p,c3.l2=c2,c2.p2=c3,c2.l2=c1,c2.r2=c,c1.p2=c2,c1.r2=b,b&&(b.p2=c1),c&&(c.p2=c2),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root},llSplay2=(root,c3,c2,c1)=>{const b=c2.r2,c=c3.r2,p=c1.p2;return c3.p2=p,c3.r2=c2,c2.p2=c3,c2.l2=c,c2.r2=c1,c1.p2=c2,c1.l2=b,b&&(b.p2=c1),c&&(c.p2=c2),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root},lrSplay2=(root,c3,c2,c1)=>{const c=c3.l2,d=c3.r2,p=c1.p2;return c3.p2=p,c3.l2=c2,c3.r2=c1,c2.p2=c3,c2.r2=c,c1.p2=c3,c1.l2=d,c&&(c.p2=c2),d&&(d.p2=c1),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root},rlSplay2=(root,c3,c2,c1)=>{const c=c3.r2,d=c3.l2,p=c1.p2;return c3.p2=p,c3.l2=c1,c3.r2=c2,c2.p2=c3,c2.l2=c,c1.p2=c3,c1.r2=d,c&&(c.p2=c2),d&&(d.p2=c1),p?p.l2===c1?p.l2=c3:p.r2=c3:root=c3,root}},"./node_modules/sonic-forest/lib/util/first.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.first=void 0;exports.first=root=>{let curr=root;for(;curr;){if(!curr.l)return curr;curr=curr.l}return curr}},"./node_modules/sonic-forest/lib/util/index.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove=exports.insert=exports.insertLeft=exports.insertRight=exports.findOrNextLower=exports.find=exports.size=exports.prev=exports.last=exports.next=exports.first=void 0;const first_1=__webpack_require__("./node_modules/sonic-forest/lib/util/first.js");Object.defineProperty(exports,"first",{enumerable:!0,get:function(){return first_1.first}});const next_1=__webpack_require__("./node_modules/sonic-forest/lib/util/next.js");Object.defineProperty(exports,"next",{enumerable:!0,get:function(){return next_1.next}});exports.last=root=>{let curr=root;for(;curr;){if(!curr.r)return curr;curr=curr.r}return curr};exports.prev=curr=>{if(curr.l){for(curr=curr.l;curr.r;)curr=curr.r;return curr}let p=curr.p;for(;p&&p.l===curr;)curr=p,p=p.p;return p};const size_=root=>{const l=root.l,r=root.r;return 1+(l?size_(l):0)+(r?size_(r):0)};exports.size=root=>root?size_(root):0;exports.find=(root,key,comparator)=>{let curr=root;for(;curr;){const cmp=comparator(key,curr.k);if(0===cmp)return curr;curr=cmp<0?curr.l:curr.r}return curr};exports.findOrNextLower=(root,key,comparator)=>{let result,curr=root;for(;curr;){const cmp=comparator(curr.k,key);if(0===cmp)return curr;if(cmp>0)curr=curr.l;else{const next=curr.r;if(result=curr,!next)return result;curr=next}}return result};exports.insertRight=(node,p)=>{const r=node.r=p.r;p.r=node,node.p=p,r&&(r.p=node)};exports.insertLeft=(node,p)=>{const l=node.l=p.l;p.l=node,node.p=p,l&&(l.p=node)};exports.insert=(root,node,comparator)=>{if(!root)return node;const key=node.k;let curr=root;for(;curr;){const cmp=comparator(key,curr.k),next=cmp<0?curr.l:curr.r;if(!next){cmp<0?(0,exports.insertLeft)(node,curr):(0,exports.insertRight)(node,curr);break}curr=next}return root};exports.remove=(root,node)=>{const p=node.p,l=node.l,r=node.r;if(node.p=node.l=node.r=void 0,!l&&!r){if(!p)return;return p.l===node?p.l=void 0:p.r=void 0,root}if(l&&r){let mostRightChildFromLeft=l;for(;mostRightChildFromLeft.r;)mostRightChildFromLeft=mostRightChildFromLeft.r;return mostRightChildFromLeft.r=r,r.p=mostRightChildFromLeft,p?(p.l===node?p.l=l:p.r=l,l.p=p,root):(l.p=void 0,l)}const child=l||r;return child.p=p,p?(p.l===node?p.l=child:p.r=child,root):child}},"./node_modules/sonic-forest/lib/util/next.js":(__unused_webpack_module,exports,__webpack_require__)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.next=void 0;const first_1=__webpack_require__("./node_modules/sonic-forest/lib/util/first.js");exports.next=curr=>{const r=curr.r;if(r)return(0,first_1.first)(r);let p=curr.p;for(;p&&p.r===curr;)curr=p,p=p.p;return p}},"./node_modules/sonic-forest/lib/util2.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove2=exports.insert2=exports.prev2=exports.next2=exports.last2=exports.first2=void 0;exports.first2=root=>{let curr=root;for(;curr;){if(!curr.l2)return curr;curr=curr.l2}return curr};exports.last2=root=>{let curr=root;for(;curr;){if(!curr.r2)return curr;curr=curr.r2}return curr};exports.next2=curr=>{if(curr.r2){for(curr=curr.r2;curr.l2;)curr=curr.l2;return curr}let p=curr.p2;for(;p&&p.r2===curr;)curr=p,p=p.p2;return p};exports.prev2=curr=>{if(curr.l2){for(curr=curr.l2;curr.r2;)curr=curr.r2;return curr}let p=curr.p2;for(;p&&p.l2===curr;)curr=p,p=p.p2;return p};const insertRight2=(node,p)=>{const r=node.r2=p.r2;p.r2=node,node.p2=p,r&&(r.p2=node)},insertLeft2=(node,p)=>{const l=node.l2=p.l2;p.l2=node,node.p2=p,l&&(l.p2=node)};exports.insert2=(root,node,comparator)=>{if(!root)return node;let curr=root;for(;curr;){const cmp=comparator(node,curr),next=cmp<0?curr.l2:curr.r2;if(!next){cmp<0?insertLeft2(node,curr):insertRight2(node,curr);break}curr=next}return root};exports.remove2=(root,node)=>{const p=node.p2,l=node.l2,r=node.r2;if(node.p2=node.l2=node.r2=void 0,!l&&!r){if(!p)return;return p.l2===node?p.l2=void 0:p.r2=void 0,root}if(l&&r){let mostRightChildFromLeft=l;for(;mostRightChildFromLeft.r2;)mostRightChildFromLeft=mostRightChildFromLeft.r2;return mostRightChildFromLeft.r2=r,r.p2=mostRightChildFromLeft,p?(p.l2===node?p.l2=l:p.r2=l,l.p2=p,root):(l.p2=void 0,l)}const child=l||r;return child.p2=p,p?(p.l2===node?p.l2=child:p.r2=child,root):child}},"./node_modules/thingies/lib/fanout.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FanOut=void 0;exports.FanOut=class FanOut{constructor(){this.listeners=new Set}emit(data){this.listeners.forEach(listener=>listener(data))}listen(listener){const listeners=this.listeners;return listeners.add(listener),()=>listeners.delete(listener)}}},"./node_modules/tree-dump/lib/printBinary.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.printBinary=void 0;exports.printBinary=(tab="",children)=>{const left=children[0],right=children[1];let str="";return left&&(str+="\n"+tab+"← "+left(tab+"  ")),right&&(str+="\n"+tab+"→ "+right(tab+"  ")),str}},"./node_modules/tree-dump/lib/printTree.js":(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.printTree=void 0;exports.printTree=(tab="",children)=>{let str="",last=children.length-1;for(;last>=0&&!children[last];last--);for(let i=0;i<=last;i++){const fn=children[i];if(!fn)continue;const isLast=i===last,child=fn(tab+(isLast?" ":"│")+"  ");str+="\n"+tab+(child?isLast?"└─":"├─":"│")+(child?" "+child:"")}return str}},"./node_modules/tslib/tslib.es6.mjs":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{__addDisposableResource:()=>__addDisposableResource,__assign:()=>__assign,__asyncDelegator:()=>__asyncDelegator,__asyncGenerator:()=>__asyncGenerator,__asyncValues:()=>__asyncValues,__await:()=>__await,__awaiter:()=>__awaiter,__classPrivateFieldGet:()=>__classPrivateFieldGet,__classPrivateFieldIn:()=>__classPrivateFieldIn,__classPrivateFieldSet:()=>__classPrivateFieldSet,__createBinding:()=>__createBinding,__decorate:()=>__decorate,__disposeResources:()=>__disposeResources,__esDecorate:()=>__esDecorate,__exportStar:()=>__exportStar,__extends:()=>__extends,__generator:()=>__generator,__importDefault:()=>__importDefault,__importStar:()=>__importStar,__makeTemplateObject:()=>__makeTemplateObject,__metadata:()=>__metadata,__param:()=>__param,__propKey:()=>__propKey,__read:()=>__read,__rest:()=>__rest,__rewriteRelativeImportExtension:()=>__rewriteRelativeImportExtension,__runInitializers:()=>__runInitializers,__setFunctionName:()=>__setFunctionName,__spread:()=>__spread,__spreadArray:()=>__spreadArray,__spreadArrays:()=>__spreadArrays,__values:()=>__values,default:()=>__WEBPACK_DEFAULT_EXPORT__});var extendStatics=function(d,b){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])},extendStatics(d,b)};function __extends(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}var __assign=function(){return __assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t},__assign.apply(this,arguments)};function __rest(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t}function __decorate(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r}function __param(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}}function __esDecorate(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(void 0!==f&&"function"!=typeof f)throw new TypeError("Function expected");return f}for(var _,kind=contextIn.kind,key="getter"===kind?"get":"setter"===kind?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),done=!1,i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]="access"===p?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw new TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result=(0,decorators[i])("accessor"===kind?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if("accessor"===kind){if(void 0===result)continue;if(null===result||"object"!=typeof result)throw new TypeError("Object expected");(_=accept(result.get))&&(descriptor.get=_),(_=accept(result.set))&&(descriptor.set=_),(_=accept(result.init))&&initializers.unshift(_)}else(_=accept(result))&&("field"===kind?initializers.unshift(_):descriptor[key]=_)}target&&Object.defineProperty(target,contextIn.name,descriptor),done=!0}function __runInitializers(thisArg,initializers,value){for(var useValue=arguments.length>2,i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0}function __propKey(x){return"symbol"==typeof x?x:"".concat(x)}function __setFunctionName(f,name,prefix){return"symbol"==typeof name&&(name=name.description?"[".concat(name.description,"]"):""),Object.defineProperty(f,"name",{configurable:!0,value:prefix?"".concat(prefix," ",name):name})}function __metadata(metadataKey,metadataValue){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(metadataKey,metadataValue)}function __awaiter(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})}function __generator(thisArg,body){var f,y,t,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]},g=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return g.next=verb(0),g.throw=verb(1),g.return=verb(2),"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return function step(op){if(f)throw new TypeError("Generator is already executing.");for(;g&&(g=0,op[0]&&(_=0)),_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(!(t=_.trys,(t=t.length>0&&t[t.length-1])||6!==op[0]&&2!==op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}([n,v])}}}var __createBinding=Object.create?function(o,m,k,k2){void 0===k2&&(k2=k);var desc=Object.getOwnPropertyDescriptor(m,k);desc&&!("get"in desc?!m.__esModule:desc.writable||desc.configurable)||(desc={enumerable:!0,get:function(){return m[k]}}),Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){void 0===k2&&(k2=k),o[k2]=m[k]};function __exportStar(m,o){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(o,p)||__createBinding(o,m,p)}function __values(o){var s="function"==typeof Symbol&&Symbol.iterator,m=s&&o[s],i=0;if(m)return m.call(o);if(o&&"number"==typeof o.length)return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(o,n){var m="function"==typeof Symbol&&o[Symbol.iterator];if(!m)return o;var r,e,i=m.call(o),ar=[];try{for(;(void 0===n||n-- >0)&&!(r=i.next()).done;)ar.push(r.value)}catch(error){e={error}}finally{try{r&&!r.done&&(m=i.return)&&m.call(i)}finally{if(e)throw e.error}}return ar}function __spread(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar}function __spreadArrays(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;var r=Array(s),k=0;for(i=0;i<il;i++)for(var a=arguments[i],j=0,jl=a.length;j<jl;j++,k++)r[k]=a[j];return r}function __spreadArray(to,from,pack){if(pack||2===arguments.length)for(var ar,i=0,l=from.length;i<l;i++)!ar&&i in from||(ar||(ar=Array.prototype.slice.call(from,0,i)),ar[i]=from[i]);return to.concat(ar||Array.prototype.slice.call(from))}function __await(v){return this instanceof __await?(this.v=v,this):new __await(v)}function __asyncGenerator(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,g=generator.apply(thisArg,_arguments||[]),q=[];return i=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),verb("next"),verb("throw"),verb("return",function awaitReturn(f){return function(v){return Promise.resolve(v).then(f,reject)}}),i[Symbol.asyncIterator]=function(){return this},i;function verb(n,f){g[n]&&(i[n]=function(v){return new Promise(function(a,b){q.push([n,v,a,b])>1||resume(n,v)})},f&&(i[n]=f(i[n])))}function resume(n,v){try{!function step(r){r.value instanceof __await?Promise.resolve(r.value.v).then(fulfill,reject):settle(q[0][2],r)}(g[n](v))}catch(e){settle(q[0][3],e)}}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){f(v),q.shift(),q.length&&resume(q[0][0],q[0][1])}}function __asyncDelegator(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n,f){i[n]=o[n]?function(v){return(p=!p)?{value:__await(o[n](v)),done:!1}:f?f(v):v}:f}}function __asyncValues(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o=__values(o),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise(function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v){resolve({value:v,done:d})},reject)})(resolve,reject,(v=o[n](v)).done,v.value)})}}}function __makeTemplateObject(cooked,raw){return Object.defineProperty?Object.defineProperty(cooked,"raw",{value:raw}):cooked.raw=raw,cooked}var __setModuleDefault=Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v},ownKeys=function(o){return ownKeys=Object.getOwnPropertyNames||function(o){var ar=[];for(var k in o)Object.prototype.hasOwnProperty.call(o,k)&&(ar[ar.length]=k);return ar},ownKeys(o)};function __importStar(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k=ownKeys(mod),i=0;i<k.length;i++)"default"!==k[i]&&__createBinding(result,mod,k[i]);return __setModuleDefault(result,mod),result}function __importDefault(mod){return mod&&mod.__esModule?mod:{default:mod}}function __classPrivateFieldGet(receiver,state,kind,f){if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===kind?f:"a"===kind?f.call(receiver):f?f.value:state.get(receiver)}function __classPrivateFieldSet(receiver,state,value,kind,f){if("m"===kind)throw new TypeError("Private method is not writable");if("a"===kind&&!f)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof state?receiver!==state||!f:!state.has(receiver))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===kind?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value}function __classPrivateFieldIn(state,receiver){if(null===receiver||"object"!=typeof receiver&&"function"!=typeof receiver)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof state?receiver===state:state.has(receiver)}function __addDisposableResource(env,value,async){if(null!=value){if("object"!=typeof value&&"function"!=typeof value)throw new TypeError("Object expected.");var dispose,inner;if(async){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");dispose=value[Symbol.asyncDispose]}if(void 0===dispose){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");dispose=value[Symbol.dispose],async&&(inner=dispose)}if("function"!=typeof dispose)throw new TypeError("Object not disposable.");inner&&(dispose=function(){try{inner.call(this)}catch(e){return Promise.reject(e)}}),env.stack.push({value,dispose,async})}else async&&env.stack.push({async:!0});return value}var _SuppressedError="function"==typeof SuppressedError?SuppressedError:function(error,suppressed,message){var e=new Error(message);return e.name="SuppressedError",e.error=error,e.suppressed=suppressed,e};function __disposeResources(env){function fail(e){env.error=env.hasError?new _SuppressedError(e,env.error,"An error was suppressed during disposal."):e,env.hasError=!0}var r,s=0;return function next(){for(;r=env.stack.pop();)try{if(!r.async&&1===s)return s=0,env.stack.push(r),Promise.resolve().then(next);if(r.dispose){var result=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(result).then(next,function(e){return fail(e),next()})}else s|=1}catch(e){fail(e)}if(1===s)return env.hasError?Promise.reject(env.error):Promise.resolve();if(env.hasError)throw env.error}()}function __rewriteRelativeImportExtension(path,preserveJsx){return"string"==typeof path&&/^\.\.?\//.test(path)?path.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(m,tsx,d,ext,cm){return tsx?preserveJsx?".jsx":".js":!d||ext&&cm?d+ext+"."+cm.toLowerCase()+"js":m}):path}const __WEBPACK_DEFAULT_EXPORT__={__extends,__assign,__rest,__decorate,__param,__esDecorate,__runInitializers,__propKey,__setFunctionName,__metadata,__awaiter,__generator,__createBinding,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet,__classPrivateFieldSet,__classPrivateFieldIn,__addDisposableResource,__disposeResources,__rewriteRelativeImportExtension}}}]);