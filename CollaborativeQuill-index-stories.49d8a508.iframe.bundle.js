"use strict";(self.webpackChunkcollaborative_quill=self.webpackChunkcollaborative_quill||[]).push([[634],{"./src/CollaborativeQuill/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var react=__webpack_require__("./node_modules/react/index.js"),quill=__webpack_require__("./node_modules/quill/quill.js"),Delta=__webpack_require__("./node_modules/quill-delta/dist/Delta.js"),Delta_default=__webpack_require__.n(Delta);class QuillBinding{static bind=(api,quill)=>{const binding=new QuillBinding(api,quill);return binding.bind(),binding.unbind};race=(()=>(()=>{let invoked=!1;return fn=>{if(!invoked){invoked=!0;try{fn()}finally{invoked=!1}}}})())();constructor(api,quill){this.api=api,this.quill=quill}onTextChange=delta=>{this.race(()=>{const ops=delta.ops;if(2===ops.length){const retain=ops[0].retain,insert=ops[1].insert,attributes=ops[1].attributes;if("number"==typeof retain&&"string"==typeof insert&&attributes&&1===insert.length&&"\n"!==insert){const selection=this.quill.getSelection();selection&&0===selection.length&&selection.index===retain&&(delta.ops[0].retain=retain-1)}}this.api()?.apply(ops)})};syncFromModel(){const api=this.api();if(!api)return;const modelDelta=new(Delta_default())(api.view()),diff=this.quill.getContents().diff(modelDelta);this.quill.updateContents(diff,"silent")}onModelChange=()=>{this.race(()=>{this.syncFromModel()})};_s=null;bind=()=>{const api=this.api();if(!api)return;const delta=new(Delta_default())(api.view()),quill=this.quill;quill.setContents(delta,"silent"),quill.on("text-change",this.onTextChange),this._s=api.api.onChange.listen(this.onModelChange)};unbind=()=>{this.quill.off("text-change",this.onTextChange),this._s?.()}}const opts={theme:"snow",modules:{toolbar:[["bold","italic","underline","strike","link"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],["image"],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]}};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const CollaborativeQuill_CollaborativeQuill=_ref=>{let{api,options={...opts},readonly,themeCss,onEditor,onTextChange,onSelectionChange,onEditorChange,...rest}=_ref;const ref=react.useRef(null);return options.readOnly=readonly,react.useEffect(()=>{const div=ref.current;if(!div)return;themeCss||(themeCss=`https://cdn.jsdelivr.net/npm/quill@2.0.2/dist/quill.${options.theme||"snow"}.css`),((href,id)=>{if(id){const link=document.getElementById(id);if(link)return link}const link=document.createElement("link");id&&(link.id=id),link.rel="stylesheet",link.type="text/css",link.href=href,link.media="all",document.getElementsByTagName("head")[0].appendChild(link)})(themeCss,themeCss);const editor=new quill.Ay(div,options),unbind=QuillBinding.bind(api,editor);onEditor?.(editor);const handleChange=function(eventName){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];switch(eventName){case"text-change":onTextChange?.(...args);break;case"selection-change":onSelectionChange?.(...args)}onEditorChange?.(eventName,...args)};return editor.on("editor-change",handleChange),()=>{unbind(),editor.off("editor-change",handleChange)}},[options.theme,options.readOnly,options.debug,options.placeholder]),(0,jsx_runtime.jsx)("div",{...rest,ref})};CollaborativeQuill_CollaborativeQuill.displayName="CollaborativeQuill";try{CollaborativeQuill_CollaborativeQuill.displayName="CollaborativeQuill",CollaborativeQuill_CollaborativeQuill.__docgenInfo={description:"",displayName:"CollaborativeQuill",props:{api:{defaultValue:null,description:"",name:"api",required:!0,type:{name:"() => QuillDeltaApi | undefined"}},editor:{defaultValue:null,description:"",name:"editor",required:!1,type:{name:"Quill"}},readonly:{defaultValue:null,description:"",name:"readonly",required:!1,type:{name:"boolean"}},options:{defaultValue:{value:"{...opts}"},description:"",name:"options",required:!1,type:{name:"QuillOptions"}},themeCss:{defaultValue:null,description:"",name:"themeCss",required:!1,type:{name:"string"}},onEditor:{defaultValue:null,description:"",name:"onEditor",required:!1,type:{name:"((quill: Quill) => void)"}},onTextChange:{defaultValue:null,description:"",name:"onTextChange",required:!1,type:{name:"OnTextChange"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!1,type:{name:"OnSelectionChange"}},onEditorChange:{defaultValue:null,description:"",name:"onEditorChange",required:!1,type:{name:"OnEditorChange"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/CollaborativeQuill/index.tsx#CollaborativeQuill"]={docgenInfo:CollaborativeQuill_CollaborativeQuill.__docgenInfo,name:"CollaborativeQuill",path:"src/CollaborativeQuill/index.tsx#CollaborativeQuill"})}catch(__react_docgen_typescript_loader_error){}var json_crdt_extensions=__webpack_require__("./node_modules/json-joy/lib/json-crdt-extensions/index.js");const index_stories={component:CollaborativeQuill_CollaborativeQuill,title:"<CollaborativeQuill>"},model=json_crdt_extensions.ModelWithExt.create(json_crdt_extensions.ext.quill.new("abc")),api=()=>model.s.toExt(),Demo=()=>{react.useSyncExternalStore(model.api.subscribe,()=>model.tick);const editorRef=react.useRef(null);return(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(CollaborativeQuill_CollaborativeQuill,{api,onEditor:editor=>editorRef.current=editor}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{onClick:()=>{setTimeout(()=>{editorRef.current&&editorRef.current.updateContents(new(Delta_default())([{insert:"1. "}]))},2e3)},children:'Prepend "1. " to editor after 2s'})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{onClick:()=>{setTimeout(()=>{api().apply([{insert:"1. "}])},2e3)},children:'Prepend "1. " to model after 2s'})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{onClick:()=>{setTimeout(()=>{const delta=new(Delta_default())(api().view());api().apply([{retain:delta.length()||0},{insert:"?"}])},2e3)},children:'Append "?" to model after 2s'})}),(0,jsx_runtime.jsx)("div",{children:(0,jsx_runtime.jsx)("button",{onClick:()=>{setTimeout(()=>{const model2=json_crdt_extensions.ModelWithExt.create(json_crdt_extensions.ext.quill.new("abrakadabra"));model.reset(model2)},2e3)},children:'Reset to "abrakadabra" after 2s'})}),(0,jsx_runtime.jsx)("pre",{style:{fontSize:"10px"},children:(0,jsx_runtime.jsx)("code",{children:model.toString()})})]})};Demo.displayName="Demo";const Default={render:Demo};Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{\n  render: Demo\n}",...Default.parameters?.docs?.source}}};const __namedExportsOrder=["Default"];try{CollaborativeQuill.displayName="CollaborativeQuill",CollaborativeQuill.__docgenInfo={description:"",displayName:"CollaborativeQuill",props:{api:{defaultValue:null,description:"",name:"api",required:!0,type:{name:"() => QuillDeltaApi | undefined"}},editor:{defaultValue:null,description:"",name:"editor",required:!1,type:{name:"Quill"}},readonly:{defaultValue:null,description:"",name:"readonly",required:!1,type:{name:"boolean"}},options:{defaultValue:{value:"{...opts}"},description:"",name:"options",required:!1,type:{name:"QuillOptions"}},themeCss:{defaultValue:null,description:"",name:"themeCss",required:!1,type:{name:"string"}},onEditor:{defaultValue:null,description:"",name:"onEditor",required:!1,type:{name:"((quill: Quill) => void)"}},onTextChange:{defaultValue:null,description:"",name:"onTextChange",required:!1,type:{name:"OnTextChange"}},onSelectionChange:{defaultValue:null,description:"",name:"onSelectionChange",required:!1,type:{name:"OnSelectionChange"}},onEditorChange:{defaultValue:null,description:"",name:"onEditorChange",required:!1,type:{name:"OnEditorChange"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/CollaborativeQuill/index.stories.tsx#CollaborativeQuill"]={docgenInfo:CollaborativeQuill.__docgenInfo,name:"CollaborativeQuill",path:"src/CollaborativeQuill/index.stories.tsx#CollaborativeQuill"})}catch(__react_docgen_typescript_loader_error){}try{Demo.displayName="Demo",Demo.__docgenInfo={description:"",displayName:"Demo",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/CollaborativeQuill/index.stories.tsx#Demo"]={docgenInfo:Demo.__docgenInfo,name:"Demo",path:"src/CollaborativeQuill/index.stories.tsx#Demo"})}catch(__react_docgen_typescript_loader_error){}}}]);